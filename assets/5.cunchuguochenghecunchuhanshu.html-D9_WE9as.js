import{_ as s,c as a,d as p,o as e}from"./app-B7flraU3.js";const t={};function c(l,n){return e(),a("div",null,[...n[0]||(n[0]=[p(`<h1 id="存储过程和存储函数" tabindex="-1"><a class="header-anchor" href="#存储过程和存储函数"><span>存储过程和存储函数</span></a></h1><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">#先要有个数据库</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> studentsdb<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">USE</span> studentsdb<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#1. 输入以下代码，创建存储过程stu_info，执行时通过输入姓名，可以查询该姓名的学生的各科成绩。</span></span>
<span class="line"><span class="token keyword">DELIMITER</span> @@</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> stu_info<span class="token punctuation">(</span><span class="token operator">IN</span> name <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"> <span class="token keyword">BEGIN</span></span>
<span class="line">  <span class="token keyword">SELECT</span> s<span class="token punctuation">.</span>学号<span class="token punctuation">,</span>姓名<span class="token punctuation">,</span>课程编号<span class="token punctuation">,</span>分数 <span class="token keyword">FROM</span> student_info s<span class="token punctuation">,</span>grade g</span>
<span class="line">   <span class="token keyword">WHERE</span> s<span class="token punctuation">.</span>学号<span class="token operator">=</span>g<span class="token punctuation">.</span>学号 <span class="token operator">and</span> 姓名<span class="token operator">=</span>name<span class="token punctuation">;</span></span>
<span class="line"> <span class="token keyword">END</span> @@</span>
<span class="line"><span class="token comment">#使用CALL命令执行存储过程stu_info，其参数值为&#39;张青平&#39;。</span></span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CALL</span> stu_info<span class="token punctuation">(</span><span class="token string">&#39;张青平&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/*2. 使用studentsdb数据库中的student_info表、curriculum表、grade表。</span>
<span class="line">（1）创建一个存储过程stu_grade，查询学号为0001的学生的姓名、课程名称、分数。</span>
<span class="line">（2）调用存储过程stu_grade。*/</span></span>
<span class="line"><span class="token keyword">DELIMITER</span> @@</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> stu_grade<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">  <span class="token keyword">SELECT</span> 姓名<span class="token punctuation">,</span>课程名称<span class="token punctuation">,</span>分数 <span class="token keyword">FROM</span> student_info s<span class="token punctuation">,</span>curriculum c<span class="token punctuation">,</span>grade g</span>
<span class="line">  <span class="token keyword">WHERE</span> s<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>学号<span class="token punctuation">\`</span></span><span class="token operator">=</span>g<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>学号<span class="token punctuation">\`</span></span> <span class="token operator">AND</span> c<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>课程编号<span class="token punctuation">\`</span></span><span class="token operator">=</span>g<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>课程编号<span class="token punctuation">\`</span></span> <span class="token operator">AND</span> s<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>学号<span class="token punctuation">\`</span></span><span class="token operator">=</span><span class="token string">&#39;0001&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">end</span> @@</span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CALL</span> stu_grade<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/*3. 使用studentsdb数据库中的student_info表、curriculum表、grade表。</span>
<span class="line">（1）创建存储过程stu_name，当任意输入一个学生的姓名时，查看其课程的最高分、最低分、平均分。</span>
<span class="line">（2）调用存储过程stu_name。</span>
<span class="line">（3）删除存储过程stu_name。*/</span></span>
<span class="line"><span class="token keyword">DELIMITER</span> @@</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> stu_name<span class="token punctuation">(</span><span class="token operator">IN</span> name <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">  <span class="token keyword">SELECT</span> <span class="token identifier"><span class="token punctuation">\`</span>姓名<span class="token punctuation">\`</span></span><span class="token punctuation">,</span><span class="token function">MAX</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>分数<span class="token punctuation">)</span> 最高分<span class="token punctuation">,</span><span class="token function">MIN</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>分数<span class="token punctuation">)</span> 最低分<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>分数<span class="token punctuation">)</span> 平均分 <span class="token keyword">FROM</span> student_info s<span class="token punctuation">,</span>curriculum c<span class="token punctuation">,</span>grade g</span>
<span class="line">  <span class="token keyword">WHERE</span> s<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>学号<span class="token punctuation">\`</span></span><span class="token operator">=</span>g<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>学号<span class="token punctuation">\`</span></span> <span class="token operator">AND</span> c<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>课程编号<span class="token punctuation">\`</span></span><span class="token operator">=</span>g<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">\`</span>课程编号<span class="token punctuation">\`</span></span> <span class="token operator">AND</span> 姓名<span class="token operator">=</span>name <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 姓名<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> @@</span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CALL</span> stu_name<span class="token punctuation">(</span><span class="token string">&#39;张青平&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> stu_name<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/*4. 使用studentsdb数据库中的grade表。</span>
<span class="line">（1）创建一个存储过程stu_g_r，当输入一个学生的学号时，通过返回输出参数获取该学生选修课程的门数。</span>
<span class="line">（2）执行存储过程stu_g_r，输入学号0002。</span>
<span class="line">（3）显示0002号学生的选课门数。*/</span></span>
<span class="line"><span class="token keyword">DELIMITER</span> @@</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> stu_g_r<span class="token punctuation">(</span><span class="token operator">IN</span> cno <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">OUT</span> num <span class="token keyword">INT</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">   <span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">INTO</span> num <span class="token keyword">FROM</span> grade <span class="token keyword">WHERE</span> 学号<span class="token operator">=</span>cno<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">end</span> @@</span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CALL</span> stu_g_r<span class="token punctuation">(</span><span class="token string">&#39;0002&#39;</span><span class="token punctuation">,</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token variable">@num</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/*5. 使用studentsdb数据库中的curriculum表、grade表。</span>
<span class="line">（1）创建一个存储函数num_func，统计指定课程名称的选课人数。</span>
<span class="line">（2）执行存储函数num_func，查看“C语言程序设计”选课人数。*/</span></span>
<span class="line"><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> log_bin_trust_function_creators<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">DELIMITER</span> @@</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> num_func<span class="token punctuation">(</span>cname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">RETURNS</span> <span class="token keyword">INT</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">  <span class="token keyword">DECLARE</span> num <span class="token keyword">INT</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">INTO</span> num <span class="token keyword">FROM</span> grade g<span class="token punctuation">,</span>curriculum c</span>
<span class="line">  <span class="token keyword">WHERE</span> g<span class="token punctuation">.</span>课程编号<span class="token operator">=</span>c<span class="token punctuation">.</span>课程编号 <span class="token operator">AND</span> c<span class="token punctuation">.</span>课程名称<span class="token operator">=</span>cname<span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">RETURN</span> num<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span> @@</span>
<span class="line"><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">SELECT</span> num_func<span class="token punctuation">(</span><span class="token string">&#39;C语言程序设计&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/*6. 使用studentsdb数据库中的curriculum表、grade表。</span>
<span class="line">（1）创建一个存储函数avg_func，通过游标统计指定课程的平均分。</span>
<span class="line">（2）执行存储函数avg_func，查看“C语言程序设计”课程平均分。</span>
<span class="line">（3）删除存储函数avg_func。*/</span></span>
<span class="line"><span class="token keyword">DELIMITER</span> @@</span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> avg_func<span class="token punctuation">(</span>cname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">RETURNS</span> <span class="token keyword">DECIMAL</span></span>
<span class="line">   <span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">DECLARE</span> v_acg <span class="token keyword">DECIMAL</span><span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">DECLARE</span> avg_cur <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span> <span class="token keyword">SELECT</span> <span class="token function">avg</span><span class="token punctuation">(</span>分数<span class="token punctuation">)</span> <span class="token keyword">FROM</span> grade g<span class="token punctuation">,</span> curriculum c</span>
<span class="line">			<span class="token keyword">WHERE</span> g<span class="token punctuation">.</span>课程编号 <span class="token operator">=</span> c<span class="token punctuation">.</span>课程编号 <span class="token operator">AND</span> 课程名称 <span class="token operator">=</span> cname<span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">OPEN</span> avg_cur<span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">FETCH</span> avg_cur <span class="token keyword">INTO</span> v_acg<span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">CLOSE</span> avg_cur<span class="token punctuation">;</span></span>
<span class="line">		<span class="token keyword">RETURN</span> v_acg<span class="token punctuation">;</span></span>
<span class="line">	 <span class="token keyword">END</span> @@</span>
<span class="line"><span class="token keyword">SELECT</span> avg_func<span class="token punctuation">(</span><span class="token string">&#39;C语言程序设计&#39;</span><span class="token punctuation">)</span> 课程平均分<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> avg_func<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2)])])}const i=s(t,[["render",c]]),u=JSON.parse('{"path":"/tutorials/database/mysql/di04zhang-shijianlianxi/5.cunchuguochenghecunchuhanshu.html","title":"存储过程和存储函数","lang":"zh-CN","frontmatter":{"title":"存储过程和存储函数"},"headers":[],"git":{"createdTime":1760859744000,"updatedTime":1760959407000,"contributors":[{"name":"YIXUAN","email":"byyi.xuan@outlook.com","commits":1}]},"filePathRelative":"tutorials/database/mysql/第04章-实践练习/5.存储过程和存储函数.md"}');export{i as comp,u as data};
