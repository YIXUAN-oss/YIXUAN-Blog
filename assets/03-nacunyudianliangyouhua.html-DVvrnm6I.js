import{_ as i,c as o,d as c,e as s,f as a,b as e,w as u,r as t,o as r}from"./app-DnBTedau.js";const d={},k={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/memory-management-0000001820880781-V5",target:"_blank",rel:"noopener noreferrer"},v={href:"https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/battery-optimization-0000001774280838-V5",target:"_blank",rel:"noopener noreferrer"};function m(b,n){const p=t("ExternalLinkIcon"),l=t("RouteLink");return r(),o("div",null,[n[5]||(n[5]=c(`<h1 id="内存与电量优化" tabindex="-1"><a class="header-anchor" href="#内存与电量优化"><span>内存与电量优化</span></a></h1><blockquote><p>优化内存和电量使用</p></blockquote><h2 id="💾-内存管理" tabindex="-1"><a class="header-anchor" href="#💾-内存管理"><span>💾 内存管理</span></a></h2><h3 id="及时释放资源" tabindex="-1"><a class="header-anchor" href="#及时释放资源"><span>及时释放资源</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Entry</span></span></span>
<span class="line"><span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span></span>
<span class="line">struct MemoryOptimized <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">private</span> player<span class="token operator">:</span> AVPlayer <span class="token operator">|</span> <span class="token keyword">undefined</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">aboutToDisappear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ✅ 释放资源</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>player<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>player<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>player <span class="token operator">=</span> <span class="token keyword">undefined</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="避免内存泄漏" tabindex="-1"><a class="header-anchor" href="#避免内存泄漏"><span>避免内存泄漏</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token comment">// ✅ 取消定时器</span></span>
<span class="line"><span class="token function">aboutToDisappear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timerId <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timerId<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ✅ 移除监听器</span></span>
<span class="line"><span class="token function">aboutToDisappear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  eventBus<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#39;event&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="🔋-电量优化" tabindex="-1"><a class="header-anchor" href="#🔋-电量优化"><span>🔋 电量优化</span></a></h2><h3 id="后台任务管理" tabindex="-1"><a class="header-anchor" href="#后台任务管理"><span>后台任务管理</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> backgroundTaskManager <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@kit.BackgroundTasksKit&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 申请后台任务</span></span>
<span class="line">backgroundTaskManager<span class="token punctuation">.</span><span class="token function">requestBackgroundRunning</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  bgMode<span class="token operator">:</span> backgroundTaskManager<span class="token punctuation">.</span>BackgroundMode<span class="token punctuation">.</span><span class="token constant">DATA_TRANSFER</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;后台任务已启动&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 停止后台任务</span></span>
<span class="line">backgroundTaskManager<span class="token punctuation">.</span><span class="token function">stopBackgroundRunning</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="智能更新策略" tabindex="-1"><a class="header-anchor" href="#智能更新策略"><span>智能更新策略</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">SmartUpdateManager</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">shouldUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 检查电量</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>batteryLevel <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// 检查网络</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>isOnMobileData<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token boolean">false</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">return</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="📚-参考资源" tabindex="-1"><a class="header-anchor" href="#📚-参考资源"><span>📚 参考资源</span></a></h2>`,13)),s("ul",null,[s("li",null,[s("a",k,[n[0]||(n[0]=a("内存管理",-1)),e(p)])]),s("li",null,[s("a",v,[n[1]||(n[1]=a("电量优化",-1)),e(p)])])]),n[6]||(n[6]=s("hr",null,null,-1)),s("p",null,[n[3]||(n[3]=s("strong",null,"第15章完成！",-1)),n[4]||(n[4]=a(" 继续学习 → ",-1)),e(l,{to:"/tutorials/harmonyos-dev/16-testing-devops/"},{default:u(()=>[...n[2]||(n[2]=[a("第16章：测试与DevOps",-1)])]),_:1})])])}const g=i(d,[["render",m]]),y=JSON.parse('{"path":"/tutorials/harmonyos-dev/15-performance-optimization/03-nacunyudianliangyouhua.html","title":"内存与电量优化","lang":"zh-CN","frontmatter":{"title":"内存与电量优化","date":"2025-01-22T00:00:00.000Z"},"headers":[{"level":2,"title":"💾 内存管理","slug":"💾-内存管理","link":"#💾-内存管理","children":[{"level":3,"title":"及时释放资源","slug":"及时释放资源","link":"#及时释放资源","children":[]},{"level":3,"title":"避免内存泄漏","slug":"避免内存泄漏","link":"#避免内存泄漏","children":[]}]},{"level":2,"title":"🔋 电量优化","slug":"🔋-电量优化","link":"#🔋-电量优化","children":[{"level":3,"title":"后台任务管理","slug":"后台任务管理","link":"#后台任务管理","children":[]},{"level":3,"title":"智能更新策略","slug":"智能更新策略","link":"#智能更新策略","children":[]}]},{"level":2,"title":"📚 参考资源","slug":"📚-参考资源","link":"#📚-参考资源","children":[]}],"git":{"createdTime":1761123387000,"updatedTime":1761123387000,"contributors":[{"name":"YIXUAN","email":"byyi.xuan@outlook.com","commits":1}]},"filePathRelative":"tutorials/harmonyos-dev/15-performance-optimization/03-内存与电量优化.md"}');export{g as comp,y as data};
