import{_ as e,c as l,d as o,e as i,f as s,b as p,w as t,r as c,o as u}from"./app-QnWV-YHu.js";const r={};function k(d,n){const a=c("RouteLink");return u(),l("div",null,[n[4]||(n[4]=o(`<h1 id="实战案例" tabindex="-1"><a class="header-anchor" href="#实战案例"><span>实战案例</span></a></h1><blockquote><p>通过实战项目掌握NLP技术</p></blockquote><h2 id="📚-学习目标" tabindex="-1"><a class="header-anchor" href="#📚-学习目标"><span>📚 学习目标</span></a></h2><ul><li>应用NLP解决实际问题</li><li>掌握完整项目流程</li><li>学会综合运用技术</li></ul><h2 id="_1-新闻分类系统" tabindex="-1"><a class="header-anchor" href="#_1-新闻分类系统"><span>1. 新闻分类系统</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> jieba</span>
<span class="line"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">import</span> TfidfVectorizer</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>naive_bayes <span class="token keyword">import</span> MultinomialNB</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> classification_report</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 1. 加载数据</span></span>
<span class="line">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&#39;news.csv&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;数据量: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;类别: </span><span class="token interpolation"><span class="token punctuation">{</span>df<span class="token punctuation">[</span><span class="token string">&#39;category&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. 文本预处理</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">preprocess</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 分词</span></span>
<span class="line">    words <span class="token operator">=</span> jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>text<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 去除停用词</span></span>
<span class="line">    stopwords <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;stopwords.txt&#39;</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    words <span class="token operator">=</span> <span class="token punctuation">[</span>w <span class="token keyword">for</span> w <span class="token keyword">in</span> words <span class="token keyword">if</span> w <span class="token keyword">not</span> <span class="token keyword">in</span> stopwords <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>words<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">df<span class="token punctuation">[</span><span class="token string">&#39;text_processed&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">&#39;text&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>preprocess<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. 特征提取</span></span>
<span class="line">vectorizer <span class="token operator">=</span> TfidfVectorizer<span class="token punctuation">(</span>max_features<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span></span>
<span class="line">X <span class="token operator">=</span> vectorizer<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">&#39;text_processed&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">y <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">&#39;category&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. 划分数据集</span></span>
<span class="line">X_train<span class="token punctuation">,</span> X_test<span class="token punctuation">,</span> y_train<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span></span>
<span class="line">    X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 5. 训练模型</span></span>
<span class="line">clf <span class="token operator">=</span> MultinomialNB<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 6. 评估</span></span>
<span class="line">y_pred <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\\n分类报告:&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>classification_report<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> y_pred<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 7. 预测新文本</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">predict_category</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    text_processed <span class="token operator">=</span> preprocess<span class="token punctuation">(</span>text<span class="token punctuation">)</span></span>
<span class="line">    text_vec <span class="token operator">=</span> vectorizer<span class="token punctuation">.</span>transform<span class="token punctuation">(</span><span class="token punctuation">[</span>text_processed<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    category <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>text_vec<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">    proba <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>text_vec<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">return</span> category<span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token punctuation">(</span>proba<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试</span></span>
<span class="line">text <span class="token operator">=</span> <span class="token string">&quot;科技公司发布新产品&quot;</span></span>
<span class="line">category<span class="token punctuation">,</span> confidence <span class="token operator">=</span> predict_category<span class="token punctuation">(</span>text<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\\n预测: </span><span class="token interpolation"><span class="token punctuation">{</span>category<span class="token punctuation">}</span></span><span class="token string"> (置信度: </span><span class="token interpolation"><span class="token punctuation">{</span>confidence<span class="token punctuation">:</span><span class="token format-spec">.2%</span><span class="token punctuation">}</span></span><span class="token string">)&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-评论情感分析" tabindex="-1"><a class="header-anchor" href="#_2-评论情感分析"><span>2. 评论情感分析</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> snownlp <span class="token keyword">import</span> SnowNLP</span>
<span class="line"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 加载评论数据</span></span>
<span class="line">reviews <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">&#39;reviews.csv&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 情感分析</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">analyze_sentiment</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    s <span class="token operator">=</span> SnowNLP<span class="token punctuation">(</span>text<span class="token punctuation">)</span></span>
<span class="line">    score <span class="token operator">=</span> s<span class="token punctuation">.</span>sentiments</span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> score <span class="token operator">&gt;</span> <span class="token number">0.6</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&#39;positive&#39;</span><span class="token punctuation">,</span> score</span>
<span class="line">    <span class="token keyword">elif</span> score <span class="token operator">&lt;</span> <span class="token number">0.4</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&#39;negative&#39;</span><span class="token punctuation">,</span> score</span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&#39;neutral&#39;</span><span class="token punctuation">,</span> score</span>
<span class="line"></span>
<span class="line">reviews<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&#39;sentiment&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;score&#39;</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> reviews<span class="token punctuation">[</span><span class="token string">&#39;text&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>analyze_sentiment<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 统计分析</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\\n情感分布:&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>reviews<span class="token punctuation">[</span><span class="token string">&#39;sentiment&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\\n平均情感得分: </span><span class="token interpolation"><span class="token punctuation">{</span>reviews<span class="token punctuation">[</span><span class="token string">&#39;score&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 可视化</span></span>
<span class="line">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">reviews<span class="token punctuation">[</span><span class="token string">&#39;sentiment&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">&#39;bar&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Sentiment Distribution&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#39;Sentiment&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#39;Count&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">reviews<span class="token punctuation">[</span><span class="token string">&#39;score&#39;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>hist<span class="token punctuation">(</span>bins<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;Sentiment Score Distribution&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">&#39;Score&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">&#39;Frequency&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">&#39;sentiment_analysis.png&#39;</span><span class="token punctuation">)</span></span>
<span class="line">plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 提取关键词</span></span>
<span class="line"><span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter</span>
<span class="line"></span>
<span class="line">positive_reviews <span class="token operator">=</span> reviews<span class="token punctuation">[</span>reviews<span class="token punctuation">[</span><span class="token string">&#39;sentiment&#39;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&#39;positive&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;text&#39;</span><span class="token punctuation">]</span></span>
<span class="line">positive_words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">for</span> review <span class="token keyword">in</span> positive_reviews<span class="token punctuation">:</span></span>
<span class="line">    positive_words<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>jieba<span class="token punctuation">.</span>cut<span class="token punctuation">(</span>review<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">word_freq <span class="token operator">=</span> Counter<span class="token punctuation">(</span>positive_words<span class="token punctuation">)</span><span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\\n正面评论高频词:&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">for</span> word<span class="token punctuation">,</span> freq <span class="token keyword">in</span> word_freq<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>word<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>freq<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-智能问答系统" tabindex="-1"><a class="header-anchor" href="#_3-智能问答系统"><span>3. 智能问答系统</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> sentence_transformers <span class="token keyword">import</span> SentenceTransformer</span>
<span class="line"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics<span class="token punctuation">.</span>pairwise <span class="token keyword">import</span> cosine_similarity</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 知识库</span></span>
<span class="line">qa_pairs <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span><span class="token string">&quot;question&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;如何退货？&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;answer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;您可以在订单详情页面申请退货...&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span><span class="token string">&quot;question&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;配送需要多久？&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;answer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;一般3-5个工作日送达...&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span><span class="token string">&quot;question&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;如何联系客服？&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;answer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;可以拨打400电话或在线咨询...&quot;</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 加载模型</span></span>
<span class="line">model <span class="token operator">=</span> SentenceTransformer<span class="token punctuation">(</span><span class="token string">&#39;distiluse-base-multilingual-cased-v2&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 编码问题</span></span>
<span class="line">questions <span class="token operator">=</span> <span class="token punctuation">[</span>qa<span class="token punctuation">[</span><span class="token string">&#39;question&#39;</span><span class="token punctuation">]</span> <span class="token keyword">for</span> qa <span class="token keyword">in</span> qa_pairs<span class="token punctuation">]</span></span>
<span class="line">question_embeddings <span class="token operator">=</span> model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>questions<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">find_answer</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> threshold<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 编码查询</span></span>
<span class="line">    query_embedding <span class="token operator">=</span> model<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">[</span>query<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 计算相似度</span></span>
<span class="line">    similarities <span class="token operator">=</span> cosine_similarity<span class="token punctuation">(</span>query_embedding<span class="token punctuation">,</span> question_embeddings<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 找到最相似的问题</span></span>
<span class="line">    max_idx <span class="token operator">=</span> np<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>similarities<span class="token punctuation">)</span></span>
<span class="line">    max_sim <span class="token operator">=</span> similarities<span class="token punctuation">[</span>max_idx<span class="token punctuation">]</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> max_sim <span class="token operator">&gt;=</span> threshold<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> qa_pairs<span class="token punctuation">[</span>max_idx<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;answer&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> max_sim</span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token string">&quot;抱歉，没有找到相关答案&quot;</span><span class="token punctuation">,</span> <span class="token number">0.0</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试</span></span>
<span class="line"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></span>
<span class="line">    user_query <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;\\n请输入问题 (输入&#39;quit&#39;退出): &quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> user_query<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&#39;quit&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">break</span></span>
<span class="line">    </span>
<span class="line">    answer<span class="token punctuation">,</span> confidence <span class="token operator">=</span> find_answer<span class="token punctuation">(</span>user_query<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\\n回答: </span><span class="token interpolation"><span class="token punctuation">{</span>answer<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;置信度: </span><span class="token interpolation"><span class="token punctuation">{</span>confidence<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-文本摘要生成" tabindex="-1"><a class="header-anchor" href="#_4-文本摘要生成"><span>4. 文本摘要生成</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> transformers <span class="token keyword">import</span> pipeline</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 加载摘要模型</span></span>
<span class="line">summarizer <span class="token operator">=</span> pipeline<span class="token punctuation">(</span><span class="token string">&quot;summarization&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">                     model<span class="token operator">=</span><span class="token string">&quot;facebook/bart-large-cnn&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 长文本</span></span>
<span class="line">article <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">长篇文章内容...</span>
<span class="line">这里是一篇关于人工智能发展的文章。</span>
<span class="line">人工智能技术在近年来取得了突破性进展...</span>
<span class="line">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 生成摘要</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">generate_summary</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">130</span><span class="token punctuation">,</span> min_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    summary <span class="token operator">=</span> summarizer<span class="token punctuation">(</span>text<span class="token punctuation">,</span> </span>
<span class="line">                        max_length<span class="token operator">=</span>max_length<span class="token punctuation">,</span></span>
<span class="line">                        min_length<span class="token operator">=</span>min_length<span class="token punctuation">,</span></span>
<span class="line">                        do_sample<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> summary<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;summary_text&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">summary <span class="token operator">=</span> generate_summary<span class="token punctuation">(</span>article<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;原文长度:&quot;</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\\n摘要:&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>summary<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\\n摘要长度:&quot;</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>summary<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-聊天机器人" tabindex="-1"><a class="header-anchor" href="#_5-聊天机器人"><span>5. 聊天机器人</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">import</span> torch</span>
<span class="line"><span class="token keyword">from</span> transformers <span class="token keyword">import</span> AutoModelForCausalLM<span class="token punctuation">,</span> AutoTokenizer</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ChatBot</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model_name<span class="token operator">=</span><span class="token string">&quot;microsoft/DialoGPT-medium&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>tokenizer <span class="token operator">=</span> AutoTokenizer<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>model <span class="token operator">=</span> AutoModelForCausalLM<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model_name<span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>chat_history <span class="token operator">=</span> <span class="token boolean">None</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">respond</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user_input<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 编码输入</span></span>
<span class="line">        new_input <span class="token operator">=</span> self<span class="token punctuation">.</span>tokenizer<span class="token punctuation">.</span>encode<span class="token punctuation">(</span></span>
<span class="line">            user_input <span class="token operator">+</span> self<span class="token punctuation">.</span>tokenizer<span class="token punctuation">.</span>eos_token<span class="token punctuation">,</span></span>
<span class="line">            return_tensors<span class="token operator">=</span><span class="token string">&#39;pt&#39;</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># 拼接历史</span></span>
<span class="line">        <span class="token keyword">if</span> self<span class="token punctuation">.</span>chat_history <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span></span>
<span class="line">            bot_input <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>chat_history<span class="token punctuation">,</span> new_input<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            bot_input <span class="token operator">=</span> new_input</span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># 生成回复</span></span>
<span class="line">        self<span class="token punctuation">.</span>chat_history <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>generate<span class="token punctuation">(</span></span>
<span class="line">            bot_input<span class="token punctuation">,</span></span>
<span class="line">            max_length<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span></span>
<span class="line">            pad_token_id<span class="token operator">=</span>self<span class="token punctuation">.</span>tokenizer<span class="token punctuation">.</span>eos_token_id<span class="token punctuation">,</span></span>
<span class="line">            no_repeat_ngram_size<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">            do_sample<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>
<span class="line">            top_k<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span></span>
<span class="line">            top_p<span class="token operator">=</span><span class="token number">0.95</span><span class="token punctuation">,</span></span>
<span class="line">            temperature<span class="token operator">=</span><span class="token number">0.7</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># 解码回复</span></span>
<span class="line">        response <span class="token operator">=</span> self<span class="token punctuation">.</span>tokenizer<span class="token punctuation">.</span>decode<span class="token punctuation">(</span></span>
<span class="line">            self<span class="token punctuation">.</span>chat_history<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> bot_input<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">            skip_special_tokens<span class="token operator">=</span><span class="token boolean">True</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">return</span> response</span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">reset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>chat_history <span class="token operator">=</span> <span class="token boolean">None</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用</span></span>
<span class="line">bot <span class="token operator">=</span> ChatBot<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;ChatBot: 你好！我是智能助手，有什么可以帮您的？&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></span>
<span class="line">    user_input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;\\nYou: &quot;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> user_input<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">&#39;quit&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;exit&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;bye&#39;</span><span class="token punctuation">]</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;ChatBot: 再见！&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">break</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">if</span> user_input<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&#39;reset&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        bot<span class="token punctuation">.</span>reset<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;ChatBot: 对话已重置&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">continue</span></span>
<span class="line">    </span>
<span class="line">    response <span class="token operator">=</span> bot<span class="token punctuation">.</span>respond<span class="token punctuation">(</span>user_input<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;ChatBot: </span><span class="token interpolation"><span class="token punctuation">{</span>response<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="💡-项目总结" tabindex="-1"><a class="header-anchor" href="#💡-项目总结"><span>💡 项目总结</span></a></h2><p>通过这些实战案例，你应该掌握了：</p><ol><li><strong>完整NLP项目流程</strong> - 数据处理、模型训练、评估、部署</li><li><strong>文本分类</strong> - 新闻分类、情感分析</li><li><strong>信息检索</strong> - 问答系统、文本匹配</li><li><strong>文本生成</strong> - 摘要生成、对话系统</li><li><strong>工程实践</strong> - 模型保存、API设计、性能优化</li></ol><h2 id="练习项目" tabindex="-1"><a class="header-anchor" href="#练习项目"><span>练习项目</span></a></h2><ol><li><strong>垃圾邮件检测</strong> - 分类垃圾邮件和正常邮件</li><li><strong>关键词提取</strong> - 自动提取文章关键词</li><li><strong>文本纠错</strong> - 检测并纠正文本错误</li><li><strong>推荐系统</strong> - 基于文本相似度的内容推荐</li><li><strong>舆情监控</strong> - 实时分析社交媒体情感</li></ol><hr><p><strong>恭喜完成 NLP 教程！</strong> 🎉</p>`,21)),i("p",null,[n[2]||(n[2]=s("继续学习：",-1)),p(a,{to:"/tutorials/python-ai/cv/"},{default:t(()=>[...n[0]||(n[0]=[s("计算机视觉 CV",-1)])]),_:1}),n[3]||(n[3]=s(" 或 ",-1)),p(a,{to:"/tutorials/python-ai/pytorch/"},{default:t(()=>[...n[1]||(n[1]=[s("深度学习框架 PyTorch",-1)])]),_:1})])])}const m=e(r,[["render",k]]),b=JSON.parse('{"path":"/tutorials/python-ai/nlp/12-shizhananli.html","title":"实战案例","lang":"zh-CN","frontmatter":{"title":"实战案例"},"headers":[{"level":2,"title":"📚 学习目标","slug":"📚-学习目标","link":"#📚-学习目标","children":[]},{"level":2,"title":"1. 新闻分类系统","slug":"_1-新闻分类系统","link":"#_1-新闻分类系统","children":[]},{"level":2,"title":"2. 评论情感分析","slug":"_2-评论情感分析","link":"#_2-评论情感分析","children":[]},{"level":2,"title":"3. 智能问答系统","slug":"_3-智能问答系统","link":"#_3-智能问答系统","children":[]},{"level":2,"title":"4. 文本摘要生成","slug":"_4-文本摘要生成","link":"#_4-文本摘要生成","children":[]},{"level":2,"title":"5. 聊天机器人","slug":"_5-聊天机器人","link":"#_5-聊天机器人","children":[]},{"level":2,"title":"💡 项目总结","slug":"💡-项目总结","link":"#💡-项目总结","children":[]},{"level":2,"title":"练习项目","slug":"练习项目","link":"#练习项目","children":[]}],"git":{"createdTime":1761052725000,"updatedTime":1761052725000,"contributors":[{"name":"YIXUAN","email":"byyi.xuan@outlook.com","commits":1}]},"filePathRelative":"tutorials/python-ai/nlp/12-实战案例.md"}');export{m as comp,b as data};
