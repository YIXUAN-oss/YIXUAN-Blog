import{_ as n,c as a,d as e,o as p}from"./app-DeqJ5waz.js";const l={};function t(c,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="数据完整性" tabindex="-1"><a class="header-anchor" href="#数据完整性"><span>数据完整性</span></a></h1><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line">stu表{</span>
<span class="line">id<span class="token punctuation">,</span>  学号<span class="token punctuation">,</span>     <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">name<span class="token punctuation">,</span>姓名<span class="token punctuation">,</span>     <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span></span>
<span class="line">sex<span class="token punctuation">,</span> 性别<span class="token punctuation">,</span>     <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">date</span><span class="token punctuation">,</span>出生日期<span class="token punctuation">,</span>  <span class="token keyword">date</span></span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">sc表{</span>
<span class="line">id<span class="token punctuation">,</span>    学号<span class="token punctuation">,</span>   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">number<span class="token punctuation">,</span>课号<span class="token punctuation">,</span>   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">grade<span class="token punctuation">,</span> 成绩<span class="token punctuation">,</span>  <span class="token string">&quot;decimal(5,2)&quot;</span></span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">course表{</span>
<span class="line">number<span class="token punctuation">,</span> 课号<span class="token punctuation">,</span>  <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">name<span class="token punctuation">,</span>   课名<span class="token punctuation">,</span>  <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span></span>
<span class="line">credit<span class="token punctuation">,</span> 学分<span class="token punctuation">,</span>  <span class="token keyword">int</span></span>
<span class="line">}</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment">#1.在sc表中设置外键 fk_sno 参照stu表中的学号列</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token keyword">table</span> sc <span class="token keyword">add</span> <span class="token keyword">constraint</span> fk_sno <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">references</span> stu<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#2.在sc表中对成绩进行约束 0&lt;=成绩&lt;=100</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token keyword">table</span> sc <span class="token keyword">add</span> <span class="token keyword">constraint</span> <span class="token keyword">check</span> <span class="token punctuation">(</span>grade <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> grade <span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#3.在course表的课名列上建立唯一约束，约束名为uq_cname</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token keyword">table</span> course <span class="token keyword">add</span> <span class="token keyword">constraint</span> uq_cname <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#4. 在course表的课号列建立主键约束</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token keyword">table</span> course <span class="token keyword">add</span> <span class="token keyword">constraint</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#5. 在sc表的课号列建立外键约束fk_cno，参照course表的课号列的取值，要求实现级联更新</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token keyword">table</span> sc</span>
<span class="line"><span class="token keyword">add</span> <span class="token keyword">constraint</span> fk_cno <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token keyword">references</span> course<span class="token punctuation">(</span>number<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">on</span> <span class="token keyword">update</span> <span class="token keyword">cascade</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#6. 在stu表的姓名列建立唯一约束名uq_sname</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token keyword">table</span> stu <span class="token keyword">add</span> <span class="token keyword">constraint</span> uq_sname <span class="token keyword">unique</span> <span class="token keyword">key</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#7. 在course表的学分列建立检查约束ck_xf，检查条件为学分&gt;0</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token keyword">table</span> course <span class="token keyword">add</span> <span class="token keyword">constraint</span> ck_xf <span class="token keyword">check</span> <span class="token punctuation">(</span> credit<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#8. 删除sc表的外键约束fk_cno，fk_sno</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token keyword">table</span> sc <span class="token keyword">drop</span> <span class="token keyword">foreign</span> <span class="token keyword">key</span> fk_cno<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token keyword">table</span> sc <span class="token keyword">drop</span> <span class="token keyword">foreign</span> <span class="token keyword">key</span> fk_sno<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#9. 删除stu表的主键约束</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token keyword">table</span> stu <span class="token keyword">drop</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#10.删除course表的唯一约束uq_cname</span></span>
<span class="line"><span class="token keyword">alter</span> <span class="token keyword">table</span> course <span class="token keyword">drop</span> <span class="token keyword">index</span> uq_cname<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#11.创建测试表test，包含一个字段date_time，字段类型varchar(50);</span></span>
<span class="line"><span class="token comment">#创建触发器test_trig，实现在stu表中每插入一条学生记录后，则自动在test表中追加一条插入成功时的日期时间。SYSDATE()函数用来获取当前的日期和时间。</span></span>
<span class="line"><span class="token comment">#为stu表插入一条记录引发触发器，查看test表的内容。</span></span>
<span class="line"><span class="token keyword">create</span> <span class="token keyword">table</span> test<span class="token punctuation">(</span></span>
<span class="line">    date_time <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">create</span> <span class="token keyword">trigger</span> test_trig</span>
<span class="line"><span class="token keyword">after</span> <span class="token keyword">insert</span> <span class="token keyword">on</span> stu <span class="token keyword">for each row</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> test <span class="token keyword">values</span> <span class="token punctuation">(</span>sysdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">insert</span> <span class="token keyword">into</span> stu <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;Marx&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;F&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;1995-10-13&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">select</span> <span class="token operator">*</span><span class="token keyword">from</span> test<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#12.在course表上创建触发器del_trig，当course表上删除一门课程时，级联删除sc表该课程的记录。</span></span>
<span class="line"><span class="token comment">#删除course表的一条记录，查看sc表相应记录是否被自动删除。</span></span>
<span class="line"><span class="token keyword">create</span> <span class="token keyword">trigger</span> del_trig</span>
<span class="line"><span class="token keyword">after</span> <span class="token keyword">delete</span> <span class="token keyword">on</span> course <span class="token keyword">for each row</span></span>
<span class="line"><span class="token keyword">delete</span> <span class="token keyword">from</span> sc <span class="token keyword">where</span> number <span class="token operator">=</span>OLD<span class="token punctuation">.</span>number<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">delete</span> <span class="token keyword">from</span> course <span class="token keyword">where</span> number<span class="token operator">=</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">select</span> <span class="token operator">*</span><span class="token keyword">from</span> sc<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2)])])}const i=n(l,[["render",t]]),k=JSON.parse('{"path":"/tutorials/database/mysql/di04zhang-shijianlianxi/4.shujuwanzhengxing.html","title":"数据完整性","lang":"zh-CN","frontmatter":{"title":"数据完整性"},"headers":[],"git":{"createdTime":1760859744000,"updatedTime":1760959407000,"contributors":[{"name":"YIXUAN","email":"byyi.xuan@outlook.com","commits":1}]},"filePathRelative":"tutorials/database/mysql/第04章-实践练习/4.数据完整性.md"}');export{i as comp,k as data};
