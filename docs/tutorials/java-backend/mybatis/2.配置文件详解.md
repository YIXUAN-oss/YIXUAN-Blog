---
title: 配置文件详解
---

# 配置文件详解

## 一、mybatis-config.xml结构

### 1.1 完整结构

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
    <!-- 属性配置 -->
    <properties/>
    
    <!-- 设置 -->
    <settings/>
    
    <!-- 类型别名 -->
    <typeAliases/>
    
    <!-- 类型处理器 -->
    <typeHandlers/>
    
    <!-- 对象工厂 -->
    <objectFactory/>
    
    <!-- 插件 -->
    <plugins/>
    
    <!-- 环境配置 -->
    <environments default="development">
        <environment id="development">
            <transactionManager type="JDBC"/>
            <dataSource type="POOLED"/>
        </environment>
    </environments>
    
    <!-- 数据库厂商标识 -->
    <databaseIdProvider/>
    
    <!-- 映射器 -->
    <mappers/>
</configuration>
```

**注意：** 标签必须按顺序配置！

---

## 二、properties（属性配置）

### 2.1 外部配置文件

**db.properties：**
```properties
jdbc.driver=com.mysql.cj.jdbc.Driver
jdbc.url=jdbc:mysql://localhost:3306/mybatis_demo
jdbc.username=root
jdbc.password=123456
```

**引入配置：**
```xml
<properties resource="db.properties"/>

<dataSource type="POOLED">
    <property name="driver" value="${jdbc.driver}"/>
    <property name="url" value="${jdbc.url}"/>
    <property name="username" value="${jdbc.username}"/>
    <property name="password" value="${jdbc.password}"/>
</dataSource>
```

### 2.2 内部配置

```xml
<properties>
    <property name="jdbc.driver" value="com.mysql.cj.jdbc.Driver"/>
    <property name="jdbc.url" value="jdbc:mysql://localhost:3306/test"/>
</properties>
```

### 2.3 优先级

```
1. 方法参数传递的属性（最高）
2. properties 元素体内指定的属性
3. properties 元素的 resource/url 属性指定的配置文件（最低）
```

---

## 三、settings（设置）

### 3.1 常用设置

```xml
<settings>
    <!-- 开启驼峰命名映射 -->
    <setting name="mapUnderscoreToCamelCase" value="true"/>
    
    <!-- 开启延迟加载 -->
    <setting name="lazyLoadingEnabled" value="true"/>
    
    <!-- 按需加载 -->
    <setting name="aggressiveLazyLoading" value="false"/>
    
    <!-- 开启二级缓存 -->
    <setting name="cacheEnabled" value="true"/>
    
    <!-- 日志实现 -->
    <setting name="logImpl" value="STDOUT_LOGGING"/>
    
    <!-- 默认执行器类型 -->
    <setting name="defaultExecutorType" value="SIMPLE"/>
    
    <!-- 超时时间 -->
    <setting name="defaultStatementTimeout" value="25"/>
    
    <!-- 自动映射行为 -->
    <setting name="autoMappingBehavior" value="PARTIAL"/>
</settings>
```

### 3.2 重要设置说明

| 设置名 | 说明 | 默认值 |
|--------|------|--------|
| cacheEnabled | 开启二级缓存 | true |
| lazyLoadingEnabled | 延迟加载 | false |
| mapUnderscoreToCamelCase | 驼峰映射 | false |
| logImpl | 日志实现 | 无 |
| defaultExecutorType | 执行器类型 | SIMPLE |

---

## 四、typeAliases（类型别名）

### 4.1 单个别名

```xml
<typeAliases>
    <typeAlias type="com.example.entity.User" alias="User"/>
</typeAliases>
```

### 4.2 包扫描（推荐）

```xml
<typeAliases>
    <package name="com.example.entity"/>
</typeAliases>
```

**自动映射：**
- `com.example.entity.User` → `User` 或 `user`
- `com.example.entity.Order` → `Order` 或 `order`

### 4.3 使用@Alias注解

```java
@Alias("user")
public class User {
    // ...
}
```

### 4.4 内置别名

| 别名 | 类型 |
|------|------|
| string | java.lang.String |
| int | java.lang.Integer |
| long | java.lang.Long |
| double | java.lang.Double |
| boolean | java.lang.Boolean |
| map | java.util.Map |
| hashmap | java.util.HashMap |
| list | java.util.List |
| arraylist | java.util.ArrayList |

---

## 五、typeHandlers（类型处理器）

### 5.1 内置类型处理器

MyBatis 已经内置了常用的类型处理器，自动完成 Java 类型和 JDBC 类型的转换。

### 5.2 自定义类型处理器

**场景：** 数据库存储 JSON 字符串，Java 使用对象。

**1. 创建类型处理器**
```java
@MappedTypes(Address.class)
@MappedJdbcTypes(JdbcType.VARCHAR)
public class AddressTypeHandler extends BaseTypeHandler<Address> {
    
    @Override
    public void setNonNullParameter(PreparedStatement ps, int i, 
                                     Address parameter, JdbcType jdbcType) 
            throws SQLException {
        // Java对象 → 数据库
        ps.setString(i, JSON.toJSONString(parameter));
    }
    
    @Override
    public Address getNullableResult(ResultSet rs, String columnName) 
            throws SQLException {
        // 数据库 → Java对象
        String json = rs.getString(columnName);
        return JSON.parseObject(json, Address.class);
    }
    
    @Override
    public Address getNullableResult(ResultSet rs, int columnIndex) 
            throws SQLException {
        String json = rs.getString(columnIndex);
        return JSON.parseObject(json, Address.class);
    }
    
    @Override
    public Address getNullableResult(CallableStatement cs, int columnIndex) 
            throws SQLException {
        String json = cs.getString(columnIndex);
        return JSON.parseObject(json, Address.class);
    }
}
```

**2. 注册类型处理器**
```xml
<typeHandlers>
    <typeHandler handler="com.example.handler.AddressTypeHandler"/>
</typeHandlers>
```

---

## 六、plugins（插件）

### 6.1 MyBatis插件机制

MyBatis 允许在 SQL 执行过程的某些点进行拦截。

**可拦截的方法：**
- Executor (update, query, commit, rollback)
- ParameterHandler (getParameterObject, setParameters)
- ResultSetHandler (handleResultSets, handleOutputParameters)
- StatementHandler (prepare, parameterize, batch, update, query)

### 6.2 分页插件（PageHelper）

**添加依赖：**
```xml
<dependency>
    <groupId>com.github.pagehelper</groupId>
    <artifactId>pagehelper</artifactId>
    <version>5.3.3</version>
</dependency>
```

**配置插件：**
```xml
<plugins>
    <plugin interceptor="com.github.pagehelper.PageInterceptor">
        <property name="helperDialect" value="mysql"/>
        <property name="reasonable" value="true"/>
    </plugin>
</plugins>
```

**使用：**
```java
PageHelper.startPage(1, 10);
List<User> users = userMapper.selectAll();
PageInfo<User> pageInfo = new PageInfo<>(users);
```

---

## 七、environments（环境配置）

### 7.1 多环境配置

```xml
<environments default="development">
    <!-- 开发环境 -->
    <environment id="development">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
            <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
            <property name="url" value="jdbc:mysql://localhost:3306/dev"/>
            <property name="username" value="root"/>
            <property name="password" value="123456"/>
        </dataSource>
    </environment>
    
    <!-- 生产环境 -->
    <environment id="production">
        <transactionManager type="JDBC"/>
        <dataSource type="POOLED">
            <property name="driver" value="com.mysql.cj.jdbc.Driver"/>
            <property name="url" value="jdbc:mysql://192.168.1.100:3306/prod"/>
            <property name="username" value="prod_user"/>
            <property name="password" value="prod_pass"/>
        </dataSource>
    </environment>
</environments>
```

### 7.2 事务管理器

**JDBC：**
```xml
<transactionManager type="JDBC"/>
```
- 直接使用 JDBC 的提交和回滚
- 手动控制事务

**MANAGED：**
```xml
<transactionManager type="MANAGED"/>
```
- 让容器管理事务（如 Spring）

### 7.3 数据源类型

**POOLED：**
```xml
<dataSource type="POOLED">
    <!-- 使用连接池 -->
</dataSource>
```

**UNPOOLED：**
```xml
<dataSource type="UNPOOLED">
    <!-- 不使用连接池 -->
</dataSource>
```

**JNDI：**
```xml
<dataSource type="JNDI">
    <property name="data_source" value="java:comp/env/jdbc/mybatis"/>
</dataSource>
```

---

## 八、mappers（映射器）

### 8.1 方式一：相对路径

```xml
<mappers>
    <mapper resource="mapper/UserMapper.xml"/>
    <mapper resource="mapper/OrderMapper.xml"/>
</mappers>
```

### 8.2 方式二：绝对路径（不推荐）

```xml
<mappers>
    <mapper url="file:///D:/project/mapper/UserMapper.xml"/>
</mappers>
```

### 8.3 方式三：接口全限定名

```xml
<mappers>
    <mapper class="com.example.mapper.UserMapper"/>
</mappers>
```

**要求：**
- Mapper 接口和 XML 文件同名
- Mapper 接口和 XML 文件在同一目录

### 8.4 方式四：包扫描（推荐）

```xml
<mappers>
    <package name="com.example.mapper"/>
</mappers>
```

**要求：**
- Mapper 接口和 XML 文件同名
- Mapper 接口和 XML 文件在同一目录

**目录结构：**
```
src/main/java/com/example/mapper/
  └── UserMapper.java

src/main/resources/com/example/mapper/
  └── UserMapper.xml
```

---

## 九、总结

✅ **本章学习内容：**
- mybatis-config.xml 结构
- properties 属性配置
- settings 设置
- typeAliases 类型别名
- typeHandlers 类型处理器
- plugins 插件
- environments 环境配置
- mappers 映射器

✅ **核心要点：**
- 配置文件标签必须按顺序
- 推荐使用包扫描配置别名和映射器
- 开启驼峰命名映射
- 根据环境切换配置

**下一章预告：** 我们将学习 XML 映射文件。
