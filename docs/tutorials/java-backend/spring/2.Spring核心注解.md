---
title: Spring核心注解
---

# Spring核心注解

## 一、组件注解

### 1.1 @Component

**作用：** 将类标记为 Spring 组件，由 Spring 容器管理。

**使用：**
```java
@Component
public class MyComponent {
    public void doSomething() {
        System.out.println("执行操作");
    }
}
```

**Bean 的名称：**
```java
// 默认名称：首字母小写的类名
@Component // Bean 名称为 "myComponent"
public class MyComponent {
}

// 自定义名称
@Component("customName")
public class MyComponent {
}
```

### 1.2 @Service

**作用：** 标记业务逻辑层（Service 层）的组件。

**本质：** `@Service` 是 `@Component` 的特化注解。

**使用：**
```java
@Service
public class UserService {
    public void addUser() {
        System.out.println("添加用户");
    }
}
```

### 1.3 @Repository

**作用：** 标记数据访问层（Dao 层）的组件。

**特点：** 会自动将数据库异常转换为 Spring 的 DataAccessException。

**使用：**
```java
@Repository
public class UserDaoImpl implements UserDao {
    @Override
    public void save(User user) {
        // 保存用户到数据库
    }
}
```

### 1.4 @Controller

**作用：** 标记控制层（Controller 层）的组件，用于处理 Web 请求。

**使用：**
```java
@Controller
public class UserController {
    @RequestMapping("/users")
    public String list() {
        return "userList";
    }
}
```

### 1.5 组件注解对比

| 注解 | 层次 | 说明 |
|------|------|------|
| @Component | 通用 | 泛用组件 |
| @Service | 业务层 | 业务逻辑 |
| @Repository | 数据层 | 数据访问，异常转换 |
| @Controller | 控制层 | 处理请求 |

**关系图：**
```
@Component (父注解)
    ├── @Service
    ├── @Repository
    └── @Controller
```

---

## 二、依赖注入注解

### 2.1 @Autowired

**作用：** 自动装配 Bean，按类型注入。

**使用位置：**
- 字段
- 构造器
- Setter 方法
- 普通方法

#### 2.1.1 字段注入（不推荐）

```java
@Service
public class UserService {
    @Autowired
    private UserDao userDao;
}
```

**缺点：**
- 无法注入 final 字段
- 难以进行单元测试
- 违反了封装原则

#### 2.1.2 构造器注入（推荐）

```java
@Service
public class UserService {
    private final UserDao userDao;
    
    @Autowired // Spring 4.3+ 可省略
    public UserService(UserDao userDao) {
        this.userDao = userDao;
    }
}
```

**优点：**
- 可以注入 final 字段
- 依赖明确，易于测试
- 保证依赖不为 null

#### 2.1.3 Setter 注入

```java
@Service
public class UserService {
    private UserDao userDao;
    
    @Autowired
    public void setUserDao(UserDao userDao) {
        this.userDao = userDao;
    }
}
```

### 2.2 @Autowired 的属性

**required 属性：**
```java
@Autowired(required = false)
private UserDao userDao; // 如果找不到 Bean，不会报错
```

**处理多个候选 Bean：**
```java
// 方式1：结合 @Qualifier
@Autowired
@Qualifier("userDaoImpl")
private UserDao userDao;

// 方式2：使用 @Primary
@Primary
@Repository
public class UserDaoImpl implements UserDao {
}

// 方式3：按名称匹配
@Autowired
private UserDao userDaoImpl; // 变量名与 Bean 名称一致
```

### 2.3 @Resource

**作用：** 自动装配 Bean，按名称注入（JDK 提供）。

**与 @Autowired 的区别：**

| 特性 | @Autowired | @Resource |
|------|-----------|-----------|
| 来源 | Spring | JDK (JSR-250) |
| 装配方式 | 按类型 | 按名称 |
| 属性 | required | name, type |

**使用：**
```java
@Service
public class UserService {
    // 按名称注入
    @Resource(name = "userDaoImpl")
    private UserDao userDao;
    
    // 如果不指定 name，按变量名查找
    @Resource
    private UserDao userDaoImpl;
}
```

### 2.4 @Qualifier

**作用：** 配合 @Autowired 使用，指定要注入的 Bean 名称。

**使用：**
```java
@Service
public class UserService {
    @Autowired
    @Qualifier("mysqlUserDao") // 指定注入哪个实现
    private UserDao userDao;
}

@Repository("mysqlUserDao")
public class MysqlUserDaoImpl implements UserDao {
}

@Repository("oracleUserDao")
public class OracleUserDaoImpl implements UserDao {
}
```

### 2.5 @Primary

**作用：** 标记首选 Bean，当有多个候选时优先注入。

**使用：**
```java
@Primary
@Repository
public class MysqlUserDaoImpl implements UserDao {
    // 优先注入这个实现
}

@Repository
public class OracleUserDaoImpl implements UserDao {
}

@Service
public class UserService {
    @Autowired
    private UserDao userDao; // 注入 MysqlUserDaoImpl
}
```

---

## 三、配置注解

### 3.1 @Configuration

**作用：** 标记配置类，相当于 XML 配置文件。

**使用：**
```java
@Configuration
public class AppConfig {
    // 配置 Bean
}
```

**等价于：**
```xml
<beans>
    <!-- 配置 Bean -->
</beans>
```

### 3.2 @Bean

**作用：** 在配置类中定义 Bean，相当于 `<bean>` 标签。

**使用：**
```java
@Configuration
public class AppConfig {
    
    @Bean
    public UserDao userDao() {
        return new UserDaoImpl();
    }
    
    @Bean
    public UserService userService() {
        return new UserService(userDao());
    }
}
```

**Bean 名称：**
```java
// 默认：方法名
@Bean // Bean 名称为 "userDao"
public UserDao userDao() {
    return new UserDaoImpl();
}

// 自定义名称
@Bean(name = "customDao")
public UserDao userDao() {
    return new UserDaoImpl();
}

// 多个名称（别名）
@Bean(name = {"userDao", "dao"})
public UserDao userDao() {
    return new UserDaoImpl();
}
```

**初始化和销毁方法：**
```java
@Bean(initMethod = "init", destroyMethod = "cleanup")
public UserDao userDao() {
    return new UserDaoImpl();
}
```

### 3.3 @ComponentScan

**作用：** 指定组件扫描的包路径，相当于 `<context:component-scan>`。

**使用：**
```java
@Configuration
@ComponentScan("com.example")
public class AppConfig {
}

// 扫描多个包
@Configuration
@ComponentScan({"com.example.service", "com.example.dao"})
public class AppConfig {
}

// 排除某些组件
@Configuration
@ComponentScan(
    basePackages = "com.example",
    excludeFilters = @ComponentScan.Filter(
        type = FilterType.ANNOTATION,
        classes = Controller.class
    )
)
public class AppConfig {
}
```

### 3.4 @Import

**作用：** 导入其他配置类。

**使用：**
```java
@Configuration
public class DatabaseConfig {
    @Bean
    public DataSource dataSource() {
        // 创建数据源
    }
}

@Configuration
@Import(DatabaseConfig.class)
public class AppConfig {
    // 导入 DatabaseConfig
}
```

### 3.5 @PropertySource

**作用：** 加载外部属性文件。

**db.properties：**
```properties
jdbc.url=jdbc:mysql://localhost:3306/test
jdbc.username=root
jdbc.password=123456
```

**使用：**
```java
@Configuration
@PropertySource("classpath:db.properties")
public class DatabaseConfig {
    
    @Value("${jdbc.url}")
    private String url;
    
    @Value("${jdbc.username}")
    private String username;
    
    @Value("${jdbc.password}")
    private String password;
}
```

---

## 四、属性注入注解

### 4.1 @Value

**作用：** 注入属性值。

**注入基本类型：**
```java
@Component
public class MyBean {
    @Value("张三")
    private String name;
    
    @Value("20")
    private int age;
}
```

**注入配置文件的值：**
```java
@Component
@PropertySource("classpath:app.properties")
public class MyBean {
    @Value("${app.name}")
    private String appName;
    
    @Value("${app.version}")
    private String version;
}
```

**使用 SpEL 表达式：**
```java
@Component
public class MyBean {
    // 调用静态方法
    @Value("#{T(java.lang.Math).random()}")
    private double random;
    
    // 引用其他 Bean 的属性
    @Value("#{otherBean.name}")
    private String otherName;
    
    // 默认值
    @Value("${app.timeout:30}")
    private int timeout; // 如果没有配置，默认 30
}
```

---

## 五、作用域和生命周期注解

### 5.1 @Scope

**作用：** 指定 Bean 的作用域。

**作用域类型：**
- singleton（单例，默认）
- prototype（原型，每次获取创建新实例）
- request（Web 环境，每个请求一个实例）
- session（Web 环境，每个会话一个实例）

**使用：**
```java
@Service
@Scope("singleton") // 单例
public class UserService {
}

@Service
@Scope("prototype") // 原型
public class OrderService {
}

// 使用常量
@Service
@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)
public class ProductService {
}
```

### 5.2 @Lazy

**作用：** 延迟初始化 Bean。

**默认行为：** 单例 Bean 在容器启动时创建。

**使用 @Lazy：** Bean 在第一次使用时才创建。

```java
@Service
@Lazy
public class ExpensiveService {
    public ExpensiveService() {
        System.out.println("创建 ExpensiveService");
        // 耗时的初始化操作
    }
}
```

### 5.3 @PostConstruct

**作用：** 标记初始化方法，在依赖注入完成后执行。

**执行时机：** 构造器 → 依赖注入 → @PostConstruct

```java
@Service
public class UserService {
    
    @Autowired
    private UserDao userDao;
    
    @PostConstruct
    public void init() {
        System.out.println("UserService 初始化完成");
        // 初始化操作
    }
}
```

### 5.4 @PreDestroy

**作用：** 标记销毁方法，在 Bean 销毁前执行。

```java
@Service
public class UserService {
    
    @PreDestroy
    public void cleanup() {
        System.out.println("UserService 即将销毁");
        // 清理资源
    }
}
```

**生命周期示例：**
```java
@Component
public class LifecycleBean {
    
    public LifecycleBean() {
        System.out.println("1. 构造器");
    }
    
    @Autowired
    public void setDependency(SomeDependency dependency) {
        System.out.println("2. 依赖注入");
    }
    
    @PostConstruct
    public void init() {
        System.out.println("3. 初始化方法");
    }
    
    @PreDestroy
    public void destroy() {
        System.out.println("5. 销毁方法");
    }
}
```

---

## 六、条件注解

### 6.1 @Conditional

**作用：** 根据条件决定是否创建 Bean。

**自定义条件：**
```java
public class WindowsCondition implements Condition {
    @Override
    public boolean matches(ConditionContext context, 
                           AnnotatedTypeMetadata metadata) {
        String os = context.getEnvironment().getProperty("os.name");
        return os != null && os.contains("Windows");
    }
}

@Configuration
public class AppConfig {
    
    @Bean
    @Conditional(WindowsCondition.class)
    public MyService windowsService() {
        return new WindowsServiceImpl();
    }
}
```

### 6.2 Spring Boot 的条件注解

```java
@ConditionalOnClass(DataSource.class)   // 类存在
@ConditionalOnMissingClass("xxx")       // 类不存在
@ConditionalOnBean(DataSource.class)    // Bean 存在
@ConditionalOnMissingBean(DataSource.class) // Bean 不存在
@ConditionalOnProperty(name = "app.enabled", havingValue = "true") // 属性匹配
```

---

## 七、实战应用

### 7.1 多数据源配置

```java
@Configuration
public class DataSourceConfig {
    
    @Bean(name = "mysqlDataSource")
    @ConfigurationProperties(prefix = "spring.datasource.mysql")
    public DataSource mysqlDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    @Bean(name = "oracleDataSource")
    @ConfigurationProperties(prefix = "spring.datasource.oracle")
    public DataSource oracleDataSource() {
        return DataSourceBuilder.create().build();
    }
    
    @Bean
    @Primary
    public DataSource primaryDataSource(
            @Qualifier("mysqlDataSource") DataSource dataSource) {
        return dataSource;
    }
}
```

### 7.2 环境配置

**application-dev.properties：**
```properties
db.url=jdbc:mysql://localhost:3306/dev_db
```

**application-prod.properties：**
```properties
db.url=jdbc:mysql://prod-server:3306/prod_db
```

**配置类：**
```java
@Configuration
@PropertySource("classpath:application-${spring.profiles.active}.properties")
public class EnvConfig {
    
    @Value("${db.url}")
    private String dbUrl;
}
```

**激活 Profile：**
```bash
# 启动参数
java -jar app.jar --spring.profiles.active=prod

# 环境变量
export SPRING_PROFILES_ACTIVE=prod
```

---

## 八、注解总结

### 8.1 常用注解分类

**组件注解：**
- @Component
- @Service
- @Repository
- @Controller

**依赖注入：**
- @Autowired
- @Resource
- @Qualifier
- @Primary
- @Value

**配置注解：**
- @Configuration
- @Bean
- @ComponentScan
- @Import
- @PropertySource

**生命周期：**
- @PostConstruct
- @PreDestroy
- @Scope
- @Lazy

**条件注解：**
- @Conditional
- @ConditionalOnXxx

### 8.2 注解使用建议

1. **优先使用注解配置**，XML 配置作为辅助
2. **构造器注入优于字段注入**
3. **@Autowired 配合 @Qualifier** 处理多实现
4. **使用 @Primary** 指定默认实现
5. **合理使用 @Lazy** 优化启动速度
6. **规范使用分层注解**（@Service、@Repository等）

---

## 九、总结

✅ **本章学习内容：**
- 组件注解的使用
- 依赖注入的各种方式
- 配置类和Bean定义
- 属性注入
- Bean 作用域和生命周期
- 条件注解

✅ **核心要点：**
- 掌握组件注解的使用场景
- 理解 @Autowired 和 @Resource 的区别
- 熟练使用配置类替代 XML
- 掌握 Bean 的生命周期回调

**下一章预告：** 我们将学习 Spring AOP 面向切面编程。
