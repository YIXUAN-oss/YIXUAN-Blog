---
title: 微服务基础入门
---

# 微服务基础入门

## 一、什么是微服务？

### 1.1 微服务定义

**微服务（Microservices）**是一种软件架构风格，将单一应用程序划分为一组小型服务，每个服务运行在独立的进程中，服务间采用轻量级通信机制（通常是 HTTP RESTful API）。

**核心特点：**
- 服务独立部署
- 服务独立扩展
- 服务独立开发
- 服务松耦合
- 去中心化治理

### 1.2 微服务架构图

```
                    ┌──────────────┐
                    │   API Gateway │
                    │   (网关)      │
                    └───────┬──────┘
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
   ┌────▼────┐        ┌────▼────┐        ┌────▼────┐
   │用户服务  │        │订单服务  │        │商品服务  │
   │  8001   │        │  8002   │        │  8003   │
   └────┬────┘        └────┬────┘        └────┬────┘
        │                   │                   │
        └───────────────────┼───────────────────┘
                            │
                    ┌───────▼──────┐
                    │  注册中心     │
                    │  (Eureka)    │
                    └──────────────┘
```

---

## 二、微服务 vs 单体架构

### 2.1 单体架构

**特点：**
- 所有功能在一个项目中
- 统一部署
- 共享数据库

**优点：**
- ✅ 开发简单
- ✅ 测试容易
- ✅ 部署方便

**缺点：**
- ❌ 代码耦合度高
- ❌ 扩展困难
- ❌ 技术栈单一
- ❌ 可靠性差

### 2.2 微服务架构

**特点：**
- 功能拆分为多个服务
- 独立部署
- 独立数据库

**优点：**
- ✅ 松耦合
- ✅ 独立扩展
- ✅ 技术栈灵活
- ✅ 故障隔离

**缺点：**
- ❌ 架构复杂
- ❌ 运维成本高
- ❌ 分布式事务
- ❌ 服务间通信

### 2.3 对比表

| 特性 | 单体架构 | 微服务架构 |
|------|---------|-----------|
| **开发难度** | 简单 | 复杂 |
| **部署方式** | 一次性部署 | 独立部署 |
| **扩展性** | 差 | 好 |
| **可维护性** | 差 | 好 |
| **技术栈** | 统一 | 灵活 |
| **适用场景** | 小型项目 | 大型项目 |

---

## 三、Spring Cloud 简介

### 3.1 什么是Spring Cloud？

**Spring Cloud** 是一套微服务解决方案，基于 Spring Boot，提供了微服务开发所需的配置管理、服务发现、断路器、智能路由等组件。

**官网：** https://spring.io/projects/spring-cloud

### 3.2 核心组件

| 组件 | 功能 | 推荐 |
|------|------|------|
| **Eureka** | 服务注册与发现 | ⭐⭐⭐ |
| **Nacos** | 服务注册 + 配置中心 | ⭐⭐⭐⭐⭐ |
| **Ribbon** | 负载均衡 | ⭐⭐⭐⭐ |
| **OpenFeign** | 服务调用 | ⭐⭐⭐⭐⭐ |
| **Gateway** | 服务网关 | ⭐⭐⭐⭐⭐ |
| **Config** | 配置中心 | ⭐⭐⭐ |
| **Sentinel** | 熔断限流 | ⭐⭐⭐⭐⭐ |
| **Sleuth** | 链路追踪 | ⭐⭐⭐⭐ |

### 3.3 技术选型

**Netflix 套件（停更维护）：**
- Eureka - 服务注册
- Ribbon - 负载均衡
- Hystrix - 熔断器

**推荐套件（最新）：**
- Nacos - 服务注册 + 配置中心
- Gateway - 网关
- Sentinel - 熔断限流
- OpenFeign - 服务调用

---

## 四、Spring Cloud 版本

### 4.1 版本命名

**Spring Cloud 使用伦敦地铁站命名：**
- Hoxton
- 2020
- 2021
- 2022

### 4.2 版本对应关系

| Spring Boot | Spring Cloud |
|-------------|--------------|
| 3.0.x | 2022.0.x (Kilburn) |
| 2.7.x | 2021.0.x (Jubilee) |
| 2.6.x | 2021.0.x (Jubilee) |
| 2.4.x | 2020.0.x (Ilford) |
| 2.3.x | Hoxton |

**推荐版本组合：**
```xml
<spring-boot.version>2.7.18</spring-boot.version>
<spring-cloud.version>2021.0.8</spring-cloud.version>
```

---

## 五、创建第一个微服务项目

### 5.1 创建父工程

**pom.xml：**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<project>
    <modelVersion>4.0.0</modelVersion>
    
    <groupId>com.example</groupId>
    <artifactId>springcloud-demo</artifactId>
    <version>1.0-SNAPSHOT</version>
    <packaging>pom</packaging>
    
    <properties>
        <maven.compiler.source>8</maven.compiler.source>
        <maven.compiler.target>8</maven.compiler.target>
        <spring-boot.version>2.7.18</spring-boot.version>
        <spring-cloud.version>2021.0.8</spring-cloud.version>
        <mysql.version>8.0.33</mysql.version>
        <mybatis-plus.version>3.5.4.1</mybatis-plus.version>
    </properties>
    
    <dependencyManagement>
        <dependencies>
            <!-- Spring Boot -->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-dependencies</artifactId>
                <version>${spring-boot.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            
            <!-- Spring Cloud -->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring-cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
        </dependencies>
    </dependencyManagement>
</project>
```

### 5.2 创建公共模块（common）

**pom.xml：**
```xml
<dependencies>
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
    </dependency>
</dependencies>
```

**统一返回结果：**
```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Result<T> {
    private Integer code;
    private String message;
    private T data;
    
    public static <T> Result<T> success(T data) {
        return new Result<>(200, "success", data);
    }
    
    public static <T> Result<T> error(String message) {
        return new Result<>(500, message, null);
    }
}
```

### 5.3 创建用户服务（user-service）

**pom.xml：**
```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    
    <dependency>
        <groupId>com.example</groupId>
        <artifactId>common</artifactId>
        <version>1.0-SNAPSHOT</version>
    </dependency>
</dependencies>
```

**application.yml：**
```yaml
server:
  port: 8001

spring:
  application:
    name: user-service
```

**启动类：**
```java
@SpringBootApplication
public class UserServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(UserServiceApplication.class, args);
    }
}
```

**实体类：**
```java
@Data
public class User {
    private Long id;
    private String username;
    private String email;
    private Integer age;
}
```

**Controller：**
```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @GetMapping("/{id}")
    public Result<User> getUserById(@PathVariable Long id) {
        User user = new User();
        user.setId(id);
        user.setUsername("张三");
        user.setEmail("zhangsan@example.com");
        user.setAge(20);
        
        return Result.success(user);
    }
    
    @GetMapping("/list")
    public Result<List<User>> getUserList() {
        List<User> users = new ArrayList<>();
        users.add(new User(1L, "张三", "zhangsan@example.com", 20));
        users.add(new User(2L, "李四", "lisi@example.com", 25));
        
        return Result.success(users);
    }
}
```

### 5.4 测试

**启动项目：**
```bash
mvn spring-boot:run
```

**访问接口：**
```
GET http://localhost:8001/api/users/1
```

**返回结果：**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "id": 1,
        "username": "张三",
        "email": "zhangsan@example.com",
        "age": 20
    }
}
```

---

## 六、总结

✅ **本章学习内容：**
- 微服务概念
- 微服务 vs 单体架构
- Spring Cloud 简介
- Spring Cloud 版本
- 创建第一个微服务

✅ **核心要点：**
- 微服务是一种架构风格
- Spring Cloud 提供微服务解决方案
- 版本选择很重要
- 推荐使用 Alibaba 套件

**下一章预告：** 我们将学习 Eureka 服务注册与发现。
