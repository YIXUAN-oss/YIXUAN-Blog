---
title: OpenFeign服务调用
---

# OpenFeign服务调用

## 一、OpenFeign简介

### 1.1 什么是OpenFeign？

**OpenFeign** 是声明式的 Web 服务客户端，让编写 Web 服务客户端变得更简单。

**特点：**
- 声明式服务调用
- 集成 Ribbon
- 集成 Hystrix
- 支持多种编码器

---

## 二、OpenFeign使用

### 2.1 添加依赖

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

### 2.2 启动类

```java
@SpringBootApplication
@EnableFeignClients  // 启用 Feign
public class OrderServiceApplication {
    public static void main(String[] args) {
        SpringApplication.run(OrderServiceApplication.class, args);
    }
}
```

### 2.3 创建Feign接口

```java
@FeignClient(value = "user-service")
public interface UserClient {
    
    @GetMapping("/api/users/{id}")
    Result<User> getUserById(@PathVariable("id") Long id);
    
    @GetMapping("/api/users/list")
    Result<List<User>> getUserList();
    
    @PostMapping("/api/users")
    Result<User> createUser(@RequestBody User user);
}
```

### 2.4 使用Feign

```java
@RestController
@RequestMapping("/api/orders")
public class OrderController {
    
    @Autowired
    private UserClient userClient;
    
    @GetMapping("/{id}")
    public Result<Order> getOrderById(@PathVariable Long id) {
        // 调用用户服务
        Result<User> userResult = userClient.getUserById(1L);
        
        Order order = new Order();
        order.setId(id);
        order.setUser(userResult.getData());
        
        return Result.success(order);
    }
}
```

---

## 三、超时配置

### 3.1 配置超时

```yaml
feign:
  client:
    config:
      default:  # 全局配置
        connectTimeout: 5000  # 连接超时
        readTimeout: 5000     # 读取超时
      user-service:  # 指定服务配置
        connectTimeout: 10000
        readTimeout: 10000
```

---

## 四、日志配置

### 4.1 日志级别

```java
@Configuration
public class FeignConfig {
    
    @Bean
    public Logger.Level feignLoggerLevel() {
        return Logger.Level.FULL;
    }
}
```

**日志级别：**
- **NONE**：不记录
- **BASIC**：请求方法、URL、响应状态码、执行时间
- **HEADERS**：BASIC + 请求响应头
- **FULL**：请求响应的所有信息

### 4.2 配置文件配置

```yaml
feign:
  client:
    config:
      default:
        loggerLevel: FULL

logging:
  level:
    com.example.client: debug
```

---

## 五、总结

✅ **本章学习内容：**
- OpenFeign 简介
- 声明式服务调用
- 超时配置
- 日志配置

✅ **核心要点：**
- 声明式调用更简洁
- 内置 Ribbon 负载均衡
- 支持超时和重试

**下一章预告：** 我们将学习 Gateway 网关。
