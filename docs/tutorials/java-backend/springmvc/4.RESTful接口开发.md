---
title: RESTful接口开发
---

# RESTful接口开发

## 一、RESTful概述

### 1.1 什么是RESTful？

**REST（Representational State Transfer）**：表现层状态转换，一种软件架构风格。

**核心思想：**
- 资源（Resource）：网络上的一个实体
- 表现层（Representation）：资源的表现形式（JSON、XML）
- 状态转换（State Transfer）：通过 HTTP 方法操作资源

### 1.2 RESTful设计规范

**1. 使用名词表示资源**
```
✅ /users        - 用户列表
✅ /users/1      - ID为1的用户
❌ /getUsers     - 不要使用动词
❌ /user/list    - 不要使用动作
```

**2. HTTP方法表示操作**

| HTTP方法 | 操作 | 示例 |
|---------|------|------|
| GET | 查询 | GET /users - 获取用户列表 |
| POST | 创建 | POST /users - 创建用户 |
| PUT | 更新 | PUT /users/1 - 更新ID为1的用户 |
| PATCH | 部分更新 | PATCH /users/1 - 部分更新 |
| DELETE | 删除 | DELETE /users/1 - 删除用户 |

**3. 使用HTTP状态码**

| 状态码 | 说明 |
|--------|------|
| 200 | 成功 |
| 201 | 创建成功 |
| 204 | 删除成功（无内容） |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 禁止访问 |
| 404 | 资源不存在 |
| 500 | 服务器错误 |

---

## 二、@RestController

### 2.1 基本使用

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // 查询列表
    @GetMapping
    public List<User> list() {
        return userService.findAll();
    }
    
    // 查询详情
    @GetMapping("/{id}")
    public User detail(@PathVariable Long id) {
        return userService.findById(id);
    }
    
    // 创建
    @PostMapping
    public User create(@RequestBody User user) {
        return userService.save(user);
    }
    
    // 更新
    @PutMapping("/{id}")
    public User update(@PathVariable Long id, @RequestBody User user) {
        user.setId(id);
        return userService.update(user);
    }
    
    // 删除
    @DeleteMapping("/{id}")
    public void delete(@PathVariable Long id) {
        userService.deleteById(id);
    }
}
```

### 2.2 @RestController vs @Controller

```java
// @Controller + @ResponseBody
@Controller
public class UserController {
    @GetMapping("/users")
    @ResponseBody
    public List<User> list() {
        return userService.findAll();
    }
}

// 等价于 @RestController
@RestController
public class UserController {
    @GetMapping("/users")
    public List<User> list() {
        return userService.findAll();
    }
}
```

---

## 三、统一响应格式

### 3.1 定义响应对象

```java
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Result<T> {
    private Integer code;      // 状态码
    private String message;    // 消息
    private T data;           // 数据
    
    // 成功
    public static <T> Result<T> success(T data) {
        return new Result<>(200, "success", data);
    }
    
    public static <T> Result<T> success() {
        return new Result<>(200, "success", null);
    }
    
    // 失败
    public static <T> Result<T> error(String message) {
        return new Result<>(500, message, null);
    }
    
    public static <T> Result<T> error(Integer code, String message) {
        return new Result<>(code, message, null);
    }
}
```

### 3.2 使用统一响应

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @GetMapping
    public Result<List<User>> list() {
        List<User> users = userService.findAll();
        return Result.success(users);
    }
    
    @GetMapping("/{id}")
    public Result<User> detail(@PathVariable Long id) {
        User user = userService.findById(id);
        if (user == null) {
            return Result.error(404, "用户不存在");
        }
        return Result.success(user);
    }
    
    @PostMapping
    public Result<User> create(@RequestBody User user) {
        User saved = userService.save(user);
        return Result.success(saved);
    }
}
```

---

## 四、统一异常处理

### 4.1 自定义异常

```java
public class BusinessException extends RuntimeException {
    private Integer code;
    
    public BusinessException(String message) {
        super(message);
        this.code = 500;
    }
    
    public BusinessException(Integer code, String message) {
        super(message);
        this.code = code;
    }
    
    public Integer getCode() {
        return code;
    }
}
```

### 4.2 全局异常处理

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    // 业务异常
    @ExceptionHandler(BusinessException.class)
    public Result<?> handleBusinessException(BusinessException e) {
        return Result.error(e.getCode(), e.getMessage());
    }
    
    // 参数验证异常
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result<?> handleValidException(MethodArgumentNotValidException e) {
        BindingResult result = e.getBindingResult();
        Map<String, String> errors = new HashMap<>();
        result.getFieldErrors().forEach(error -> 
            errors.put(error.getField(), error.getDefaultMessage())
        );
        return Result.error(400, "参数验证失败").setData(errors);
    }
    
    // 系统异常
    @ExceptionHandler(Exception.class)
    public Result<?> handleException(Exception e) {
        e.printStackTrace();
        return Result.error("系统错误");
    }
}
```

### 4.3 使用异常

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @GetMapping("/{id}")
    public Result<User> detail(@PathVariable Long id) {
        User user = userService.findById(id);
        if (user == null) {
            throw new BusinessException(404, "用户不存在");
        }
        return Result.success(user);
    }
}
```

---

## 五、分页查询

### 5.1 分页参数

```java
@Data
public class PageRequest {
    private Integer page = 1;       // 页码（从1开始）
    private Integer size = 10;      // 每页大小
    private String sort;            // 排序字段
    private String order = "asc";   // 排序方向
}
```

### 5.2 分页响应

```java
@Data
@AllArgsConstructor
public class PageResult<T> {
    private Long total;        // 总记录数
    private List<T> records;   // 当前页数据
    private Integer page;      // 当前页码
    private Integer size;      // 每页大小
    private Integer pages;     // 总页数
}
```

### 5.3 分页查询

```java
@GetMapping
public Result<PageResult<User>> list(PageRequest pageRequest) {
    PageResult<User> pageResult = userService.findByPage(pageRequest);
    return Result.success(pageResult);
}

// 访问：/api/users?page=1&size=10&sort=createTime&order=desc
```

---

## 六、接口文档（Swagger）

### 6.1 添加依赖

```xml
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger2</artifactId>
    <version>2.9.2</version>
</dependency>

<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger-ui</artifactId>
    <version>2.9.2</version>
</dependency>
```

### 6.2 配置Swagger

```java
@Configuration
@EnableSwagger2
public class SwaggerConfig {
    
    @Bean
    public Docket api() {
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo())
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.example.controller"))
                .paths(PathSelectors.any())
                .build();
    }
    
    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("用户管理系统API")
                .description("用户管理系统接口文档")
                .version("1.0")
                .build();
    }
}
```

### 6.3 使用Swagger注解

```java
@Api(tags = "用户管理")
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @ApiOperation("查询用户列表")
    @GetMapping
    public Result<List<User>> list() {
        return Result.success(userService.findAll());
    }
    
    @ApiOperation("查询用户详情")
    @ApiImplicitParam(name = "id", value = "用户ID", required = true)
    @GetMapping("/{id}")
    public Result<User> detail(@PathVariable Long id) {
        return Result.success(userService.findById(id));
    }
    
    @ApiOperation("创建用户")
    @PostMapping
    public Result<User> create(@RequestBody User user) {
        return Result.success(userService.save(user));
    }
}
```

**实体类注解：**
```java
@ApiModel("用户")
public class User {
    
    @ApiModelProperty("用户ID")
    private Long id;
    
    @ApiModelProperty(value = "用户名", required = true)
    private String username;
    
    @ApiModelProperty("年龄")
    private Integer age;
    
    // getter/setter
}
```

### 6.4 访问文档

```
http://localhost:8080/swagger-ui.html
```

---

## 七、接口测试

### 7.1 Postman测试

**GET 请求：**
```
GET http://localhost:8080/api/users
```

**POST 请求：**
```
POST http://localhost:8080/api/users
Content-Type: application/json

{
    "username": "张三",
    "age": 20,
    "email": "zhangsan@example.com"
}
```

### 7.2 单元测试

```java
@RunWith(SpringRunner.class)
@SpringBootTest
@AutoConfigureMockMvc
public class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Test
    public void testList() throws Exception {
        mockMvc.perform(MockMvcRequestBuilders.get("/api/users"))
                .andExpect(MockMvcResultMatchers.status().isOk())
                .andExpect(MockMvcResultMatchers.jsonPath("$.code").value(200))
                .andDo(MockMvcResultHandlers.print());
    }
    
    @Test
    public void testCreate() throws Exception {
        String json = "{\"username\":\"张三\",\"age\":20}";
        
        mockMvc.perform(MockMvcRequestBuilders.post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(json))
                .andExpect(MockMvcResultMatchers.status().isOk())
                .andDo(MockMvcResultHandlers.print());
    }
}
```

---

## 八、总结

✅ **本章学习内容：**
- RESTful 设计规范
- @RestController 使用
- 统一响应格式
- 统一异常处理
- 分页查询
- Swagger 接口文档
- 接口测试

✅ **核心要点：**
- RESTful 使用名词表示资源，HTTP 方法表示操作
- 使用统一的响应格式和异常处理
- 使用 Swagger 生成接口文档
- 掌握接口测试方法

**下一章预告：** 我们将整理 Spring MVC 常见面试题。
