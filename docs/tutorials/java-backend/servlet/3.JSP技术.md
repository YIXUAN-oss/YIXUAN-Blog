---
title: JSP技术
---

# JSP技术

## 一、JSP概述

### 1.1 什么是JSP？

**JSP（Java Server Pages）**：运行在服务器端的动态网页技术。

**本质：** JSP 就是 Servlet。

```
JSP → Tomcat → 翻译成 Servlet.java → 编译成 .class → 执行
```

### 1.2 JSP vs Servlet

| 特性 | Servlet | JSP |
|------|---------|-----|
| 擅长 | Java 代码 | HTML |
| 输出HTML | 繁琐 | 简洁 |
| 可读性 | 差 | 好 |
| 开发效率 | 低 | 高 |

**最佳实践：** Servlet 处理业务逻辑，JSP 负责页面展示。

---

## 二、JSP基础语法

### 2.1 JSP 脚本

#### 2.1.1 Java 代码片段

```jsp
<%
    // Java 代码
    String name = "张三";
    int age = 20;
    out.println("姓名：" + name);
%>
```

#### 2.1.2 表达式

```jsp
<%= 变量或表达式 %>

<!-- 示例 -->
<p>当前时间：<%= new Date() %></p>
<p>1 + 2 = <%= 1 + 2 %></p>
```

#### 2.1.3 声明

```jsp
<%!
    // 声明成员变量和方法
    private int count = 0;
    
    public String getName() {
        return "张三";
    }
%>
```

### 2.2 JSP 指令

#### 2.2.1 page 指令

```jsp
<%@ page 
    language="java" 
    contentType="text/html;charset=UTF-8"
    pageEncoding="UTF-8"
    import="java.util.*,java.text.*"
    errorPage="error.jsp"
    isErrorPage="false"
%>
```

#### 2.2.2 include 指令（静态包含）

```jsp
<%@ include file="header.jsp" %>
```

#### 2.2.3 taglib 指令

```jsp
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
```

### 2.3 JSP 注释

```jsp
<!-- HTML 注释（会发送到客户端） -->

<%-- JSP 注释（不会发送到客户端） --%>
```

---

## 三、JSP九大内置对象

### 3.1 内置对象列表

| 对象 | 类型 | 作用域 | 说明 |
|------|------|--------|------|
| **request** | HttpServletRequest | Request | 请求对象 |
| **response** | HttpServletResponse | Page | 响应对象 |
| **session** | HttpSession | Session | 会话对象 |
| **application** | ServletContext | Application | 应用对象 |
| **out** | JspWriter | Page | 输出对象 |
| **pageContext** | PageContext | Page | 页面上下文 |
| **config** | ServletConfig | Page | 配置对象 |
| **page** | Object | Page | 当前页面对象 |
| **exception** | Throwable | Page | 异常对象 |

### 3.2 作用域对象

**四大域对象（范围从小到大）：**

```jsp
<%
    // 1. pageContext - 当前页面
    pageContext.setAttribute("msg", "page");
    
    // 2. request - 一次请求
    request.setAttribute("msg", "request");
    
    // 3. session - 一次会话
    session.setAttribute("msg", "session");
    
    // 4. application - 整个应用
    application.setAttribute("msg", "application");
%>
```

**选择原则：** 能用小的就不用大的，减少内存占用。

### 3.3 常用内置对象

```jsp
<%
    // out - 输出
    out.println("<h1>标题</h1>");
    
    // request - 获取参数
    String name = request.getParameter("name");
    
    // session - 会话管理
    session.setAttribute("user", "张三");
    
    // application - 全局数据
    Integer count = (Integer) application.getAttribute("visitCount");
    
    // pageContext - 获取其他内置对象
    HttpSession s = (HttpSession) pageContext.getSession();
%>
```

---

## 四、EL表达式

### 4.1 EL基础

**Expression Language（表达式语言）**：简化 JSP 页面中数据的获取。

**语法：** `${表达式}`

**示例：**
```jsp
<!-- 传统方式 -->
<%= request.getAttribute("username") %>

<!-- EL 方式 -->
${username}
```

### 4.2 EL 获取数据

```jsp
<%
    request.setAttribute("name", "张三");
    request.setAttribute("age", 20);
%>

<!-- 获取普通数据 -->
<p>姓名：${name}</p>
<p>年龄：${age}</p>

<!-- 获取对象属性 -->
<%
    User user = new User("李四", 25);
    request.setAttribute("user", user);
%>
<p>姓名：${user.name}</p>
<p>年龄：${user.age}</p>

<!-- 获取List -->
<%
    List<String> list = Arrays.asList("A", "B", "C");
    request.setAttribute("list", list);
%>
<p>${list[0]}</p> <!-- A -->

<!-- 获取Map -->
<%
    Map<String, String> map = new HashMap<>();
    map.put("key1", "value1");
    request.setAttribute("map", map);
%>
<p>${map.key1}</p> <!-- value1 -->
```

### 4.3 EL 运算

```jsp
<!-- 算术运算 -->
${10 + 20}  <!-- 30 -->
${10 - 5}   <!-- 5 -->
${10 * 2}   <!-- 20 -->
${10 / 2}   <!-- 5.0 -->
${10 % 3}   <!-- 1 -->

<!-- 比较运算 -->
${10 > 5}   <!-- true -->
${10 == 10} <!-- true -->

<!-- 逻辑运算 -->
${true && false}  <!-- false -->
${true || false}  <!-- true -->
${!true}          <!-- false -->

<!-- 空判断 -->
${empty name}  <!-- true/false -->
${not empty name}
```

### 4.4 EL 隐式对象

```jsp
<!-- pageContext -->
${pageContext.request.contextPath}  <!-- 上下文路径 -->

<!-- param - 获取请求参数 -->
${param.username}  <!-- 等同于 request.getParameter("username") -->

<!-- paramValues - 获取数组参数 -->
${paramValues.hobby[0]}

<!-- cookie -->
${cookie.username.value}

<!-- initParam - 全局参数 -->
${initParam.appName}
```

---

## 五、JSTL标签库

### 5.1 导入JSTL

**1. 添加依赖**
```xml
<dependency>
    <groupId>javax.servlet</groupId>
    <artifactId>jstl</artifactId>
    <version>1.2</version>
</dependency>
```

**2. 在JSP中引入**
```jsp
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
```

### 5.2 常用标签

#### 5.2.1 c:set 设置变量

```jsp
<c:set var="name" value="张三" scope="request"/>
<p>${name}</p>
```

#### 5.2.2 c:if 条件判断

```jsp
<c:set var="age" value="20"/>

<c:if test="${age >= 18}">
    <p>成年人</p>
</c:if>
```

#### 5.2.3 c:choose 多条件判断

```jsp
<c:set var="score" value="85"/>

<c:choose>
    <c:when test="${score >= 90}">
        <p>优秀</p>
    </c:when>
    <c:when test="${score >= 80}">
        <p>良好</p>
    </c:when>
    <c:otherwise>
        <p>及格</p>
    </c:otherwise>
</c:choose>
```

#### 5.2.4 c:forEach 循环

```jsp
<!-- 简单循环 -->
<c:forEach begin="1" end="10" var="i">
    <p>${i}</p>
</c:forEach>

<!-- 遍历集合 -->
<%
    List<String> list = Arrays.asList("A", "B", "C");
    request.setAttribute("list", list);
%>

<c:forEach items="${list}" var="item" varStatus="status">
    <p>索引：${status.index}，值：${item}</p>
</c:forEach>

<!-- 遍历Map -->
<c:forEach items="${map}" var="entry">
    <p>Key: ${entry.key}, Value: ${entry.value}</p>
</c:forEach>
```

---

## 六、JSP与Servlet协作

### 6.1 MVC模式

```
Model（模型） - 业务逻辑和数据
View（视图） - JSP 页面
Controller（控制器） - Servlet
```

**流程：**
```
浏览器 → Servlet（处理请求，调用Service） → JSP（展示数据）
```

### 6.2 实战示例：用户列表

**UserServlet.java：**
```java
@WebServlet("/users")
public class UserServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        // 模拟查询用户列表
        List<User> users = new ArrayList<>();
        users.add(new User(1, "张三", 20));
        users.add(new User(2, "李四", 25));
        users.add(new User(3, "王五", 30));
        
        // 存入 request 域
        req.setAttribute("users", users);
        
        // 转发到 JSP
        req.getRequestDispatcher("/userList.jsp").forward(req, resp);
    }
}
```

**userList.jsp：**
```jsp
<%@ page contentType="text/html;charset=UTF-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<!DOCTYPE html>
<html>
<head>
    <title>用户列表</title>
</head>
<body>
    <h1>用户列表</h1>
    <table border="1">
        <tr>
            <th>ID</th>
            <th>姓名</th>
            <th>年龄</th>
        </tr>
        <c:forEach items="${users}" var="user">
            <tr>
                <td>${user.id}</td>
                <td>${user.name}</td>
                <td>${user.age}</td>
            </tr>
        </c:forEach>
    </table>
</body>
</html>
```

---

## 七、总结

✅ **本章学习内容：**
- JSP 基础语法
- JSP 九大内置对象
- EL 表达式
- JSTL 标签库
- JSP 与 Servlet 协作

✅ **核心要点：**
- JSP 本质是 Servlet
- 掌握九大内置对象的使用
- 使用 EL 和 JSTL 简化开发
- 遵循 MVC 模式

**下一章预告：** 我们将学习 Session 和 Cookie。
