---
title: Servlet基础入门
---

# Servlet基础入门

## 一、Servlet是什么？

### 1.1 Servlet简介

**Servlet（Server Applet）**：运行在服务器端的 Java 小程序，用于处理客户端请求并生成动态响应。

**核心作用：**
- 接收客户端请求（HTTP请求）
- 处理业务逻辑
- 生成响应内容（HTML、JSON等）
- 返回给客户端

### 1.2 工作流程

```
1. 浏览器发送 HTTP 请求
   ↓
2. Tomcat 接收请求
   ↓
3. Tomcat 找到对应的 Servlet
   ↓
4. Servlet 处理请求（调用 doGet/doPost）
   ↓
5. Servlet 生成响应
   ↓
6. Tomcat 将响应返回给浏览器
```

### 1.3 为什么需要Servlet？

**静态资源的局限：**
```html
<!-- static.html - 静态页面 -->
<h1>欢迎访问</h1>
<p>当前时间：2024-01-01 12:00:00</p>
<!-- 问题：时间是固定的，不会变化 -->
```

**Servlet 的优势：**
```java
// DynamicServlet - 动态生成内容
@WebServlet("/time")
public class TimeServlet extends HttpServlet {
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
        PrintWriter out = resp.getWriter();
        out.println("<h1>欢迎访问</h1>");
        out.println("<p>当前时间：" + new Date() + "</p>");
        // 每次访问都显示最新时间
    }
}
```

---

## 二、Servlet体系结构

### 2.1 核心接口和类

```
javax.servlet 包
│
├── Servlet (接口)
│   ├── init(ServletConfig)
│   ├── service(ServletRequest, ServletResponse)
│   ├── destroy()
│   ├── getServletConfig()
│   └── getServletInfo()
│
├── GenericServlet (抽象类)
│   └── 实现了 Servlet 接口的通用方法
│
└── HttpServlet (抽象类) ← 通常继承这个
    ├── doGet(HttpServletRequest, HttpServletResponse)
    ├── doPost(HttpServletRequest, HttpServletResponse)
    ├── doPut(...)
    ├── doDelete(...)
    └── ...
```

### 2.2 继承关系

```java
// 方式1：实现 Servlet 接口（不推荐）
public class MyServlet1 implements Servlet {
    // 需要实现所有方法
}

// 方式2：继承 GenericServlet（不常用）
public class MyServlet2 extends GenericServlet {
    @Override
    public void service(ServletRequest req, ServletResponse res) {
        // 处理请求
    }
}

// 方式3：继承 HttpServlet（推荐）
public class MyServlet3 extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
        // 处理 GET 请求
    }
    
    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) {
        // 处理 POST 请求
    }
}
```

---

## 三、创建第一个Servlet

### 3.1 项目结构

```
servlet-demo/
├── pom.xml
└── src/
    └── main/
        ├── java/
        │   └── com/example/servlet/
        │       └── HelloServlet.java
        └── webapp/
            ├── WEB-INF/
            │   └── web.xml
            └── index.jsp
```

### 3.2 添加依赖

**pom.xml：**
```xml
<dependencies>
    <!-- Servlet API -->
    <dependency>
        <groupId>javax.servlet</groupId>
        <artifactId>javax.servlet-api</artifactId>
        <version>4.0.1</version>
        <scope>provided</scope> <!-- 由 Tomcat 提供 -->
    </dependency>
    
    <!-- JSP API -->
    <dependency>
        <groupId>javax.servlet.jsp</groupId>
        <artifactId>javax.servlet.jsp-api</artifactId>
        <version>2.3.3</version>
        <scope>provided</scope>
    </dependency>
</dependencies>

<build>
    <plugins>
        <!-- Tomcat 插件 -->
        <plugin>
            <groupId>org.apache.tomcat.maven</groupId>
            <artifactId>tomcat7-maven-plugin</artifactId>
            <version>2.2</version>
            <configuration>
                <port>8080</port>
                <path>/</path>
            </configuration>
        </plugin>
    </plugins>
</build>
```

### 3.3 编写Servlet

**HelloServlet.java：**
```java
package com.example.servlet;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.PrintWriter;

public class HelloServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        // 设置响应内容类型和编码
        resp.setContentType("text/html;charset=UTF-8");
        
        // 获取输出流
        PrintWriter out = resp.getWriter();
        
        // 输出 HTML
        out.println("<!DOCTYPE html>");
        out.println("<html>");
        out.println("<head>");
        out.println("<meta charset='UTF-8'>");
        out.println("<title>Hello Servlet</title>");
        out.println("</head>");
        out.println("<body>");
        out.println("<h1>Hello, Servlet!</h1>");
        out.println("<p>这是第一个 Servlet 程序</p>");
        out.println("</body>");
        out.println("</html>");
    }
}
```

### 3.4 配置Servlet

#### 方式1：web.xml 配置（传统方式）

**web.xml：**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
         http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">
    
    <!-- 声明 Servlet -->
    <servlet>
        <servlet-name>helloServlet</servlet-name>
        <servlet-class>com.example.servlet.HelloServlet</servlet-class>
    </servlet>
    
    <!-- 映射 URL -->
    <servlet-mapping>
        <servlet-name>helloServlet</servlet-name>
        <url-pattern>/hello</url-pattern>
    </servlet-mapping>
</web-app>
```

#### 方式2：注解配置（推荐，Servlet 3.0+）

```java
@WebServlet("/hello")
public class HelloServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        // 处理请求
    }
}
```

**@WebServlet 属性：**
```java
@WebServlet(
    name = "helloServlet",           // Servlet 名称
    urlPatterns = {"/hello", "/hi"}, // URL 映射（可多个）
    loadOnStartup = 1                // 启动时加载顺序
)
```

### 3.5 运行项目

**方式1：使用 Tomcat 插件**
```bash
mvn tomcat7:run

# 访问：http://localhost:8080/hello
```

**方式2：部署到 Tomcat**
```bash
# 1. 打包
mvn clean package

# 2. 将 war 文件复制到 Tomcat 的 webapps 目录

# 3. 启动 Tomcat
# Linux/Mac: ./catalina.sh run
# Windows: catalina.bat run

# 4. 访问：http://localhost:8080/servlet-demo/hello
```

---

## 四、Servlet生命周期

### 4.1 生命周期概述

**完整流程：**
```
1. 加载类：Tomcat 启动时或首次访问时加载 Servlet 类
2. 创建实例：调用无参构造器
3. 初始化：调用 init() 方法（只执行一次）
4. 服务：每次请求调用 service() 方法
   └─ service() 根据请求方法调用 doGet()/doPost() 等
5. 销毁：Tomcat 关闭时调用 destroy() 方法（只执行一次）
```

### 4.2 生命周期方法

```java
public class LifecycleServlet extends HttpServlet {
    
    // 1. 构造器（只执行一次）
    public LifecycleServlet() {
        System.out.println("1. 构造器被调用");
    }
    
    // 2. 初始化（只执行一次）
    @Override
    public void init() throws ServletException {
        System.out.println("2. init() 方法被调用");
        // 执行初始化操作（如：加载配置、建立数据库连接）
    }
    
    // 3. 服务（每次请求都执行）
    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        System.out.println("3. service() 方法被调用");
        super.service(req, resp); // 调用 doGet/doPost
    }
    
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        System.out.println("4. doGet() 方法被调用");
        resp.getWriter().println("Hello!");
    }
    
    // 5. 销毁（只执行一次）
    @Override
    public void destroy() {
        System.out.println("5. destroy() 方法被调用");
        // 释放资源（如：关闭数据库连接）
    }
}
```

### 4.3 执行时机

**第一次访问：**
```
1. 构造器
2. init()
3. service()
4. doGet()
```

**第二次访问：**
```
3. service()
4. doGet()
```

**服务器关闭：**
```
5. destroy()
```

### 4.4 Servlet 单例模式

**重要特性：**
- Servlet 在容器中是**单例**的
- 多个请求共享同一个 Servlet 实例
- **线程不安全**：避免使用成员变量

**错误示例：**
```java
@WebServlet("/count")
public class CountServlet extends HttpServlet {
    private int count = 0; // 成员变量，线程不安全
    
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
        count++; // 多个线程同时访问，会出现问题
        resp.getWriter().println("访问次数：" + count);
    }
}
```

**正确示例：**
```java
@WebServlet("/count")
public class CountServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
        int count = 0; // 局部变量，线程安全
        count++;
        resp.getWriter().println("当前：" + count);
    }
}
```

---

## 五、URL映射模式

### 5.1 映射规则

**1. 精确匹配**
```java
@WebServlet("/hello")
// 只匹配：/hello
```

**2. 路径匹配**
```java
@WebServlet("/user/*")
// 匹配：/user/list、/user/add、/user/delete 等
```

**3. 扩展名匹配**
```java
@WebServlet("*.do")
// 匹配：/login.do、/register.do 等
```

**4. 默认匹配**
```java
@WebServlet("/")
// 匹配所有未被其他 Servlet 匹配的请求
```

### 5.2 优先级

```
精确匹配 > 路径匹配 > 扩展名匹配 > 默认匹配

示例：
请求 /user/list.do

1. 精确匹配：/user/list.do     ← 优先
2. 路径匹配：/user/*
3. 扩展名匹配：*.do
4. 默认匹配：/
```

---

## 六、ServletConfig 和 ServletContext

### 6.1 ServletConfig

**作用：** 获取当前 Servlet 的配置信息。

**配置参数：**
```xml
<servlet>
    <servlet-name>configServlet</servlet-name>
    <servlet-class>com.example.servlet.ConfigServlet</servlet-class>
    
    <!-- 初始化参数 -->
    <init-param>
        <param-name>username</param-name>
        <param-value>admin</param-value>
    </init-param>
    <init-param>
        <param-name>password</param-name>
        <param-value>123456</param-value>
    </init-param>
</servlet>
```

**获取参数：**
```java
@Override
public void init(ServletConfig config) throws ServletException {
    super.init(config);
    
    String username = config.getInitParameter("username");
    String password = config.getInitParameter("password");
    
    System.out.println("用户名：" + username);
    System.out.println("密码：" + password);
}
```

**注解方式：**
```java
@WebServlet(
    urlPatterns = "/config",
    initParams = {
        @WebInitParam(name = "username", value = "admin"),
        @WebInitParam(name = "password", value = "123456")
    }
)
```

### 6.2 ServletContext

**作用：** 代表整个 Web 应用，用于在不同 Servlet 之间共享数据。

**特点：**
- 全局唯一，整个应用只有一个 ServletContext
- 应用启动时创建，关闭时销毁
- 所有 Servlet 共享

**常用方法：**
```java
@WebServlet("/context")
public class ContextServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) {
        
        // 获取 ServletContext
        ServletContext context = this.getServletContext();
        
        // 1. 获取全局初始化参数（web.xml 配置）
        String appName = context.getInitParameter("appName");
        
        // 2. 获取资源路径
        String realPath = context.getRealPath("/WEB-INF/config.properties");
        
        // 3. 共享数据（域对象）
        context.setAttribute("user", "张三");
        Object user = context.getAttribute("user");
        
        // 4. 获取 MIME 类型
        String mimeType = context.getMimeType("test.jpg"); // image/jpeg
        
        // 5. 获取上下文路径
        String contextPath = context.getContextPath(); // /servlet-demo
    }
}
```

**全局参数配置（web.xml）：**
```xml
<web-app>
    <!-- 全局初始化参数 -->
    <context-param>
        <param-name>appName</param-name>
        <param-value>Servlet Demo</param-value>
    </context-param>
</web-app>
```

---

## 七、实战练习

### 7.1 练习1：用户登录

**login.html：**
```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>用户登录</title>
</head>
<body>
    <h2>用户登录</h2>
    <form action="/servlet-demo/login" method="post">
        <label>用户名：<input type="text" name="username"></label><br>
        <label>密码：<input type="password" name="password"></label><br>
        <button type="submit">登录</button>
    </form>
</body>
</html>
```

**LoginServlet.java：**
```java
@WebServlet("/login")
public class LoginServlet extends HttpServlet {
    
    @Override
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        // 设置请求编码
        req.setCharacterEncoding("UTF-8");
        // 设置响应编码
        resp.setContentType("text/html;charset=UTF-8");
        
        // 获取参数
        String username = req.getParameter("username");
        String password = req.getParameter("password");
        
        // 验证
        if ("admin".equals(username) && "123456".equals(password)) {
            resp.getWriter().println("<h1>登录成功！</h1>");
            resp.getWriter().println("<p>欢迎，" + username + "</p>");
        } else {
            resp.getWriter().println("<h1>登录失败！</h1>");
            resp.getWriter().println("<p>用户名或密码错误</p>");
        }
    }
}
```

### 7.2 练习2：显示当前时间

```java
@WebServlet("/time")
public class TimeServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) 
            throws ServletException, IOException {
        
        resp.setContentType("text/html;charset=UTF-8");
        PrintWriter out = resp.getWriter();
        
        SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        String currentTime = sdf.format(new Date());
        
        out.println("<!DOCTYPE html>");
        out.println("<html>");
        out.println("<head><title>当前时间</title></head>");
        out.println("<body>");
        out.println("<h1>当前时间</h1>");
        out.println("<p>" + currentTime + "</p>");
        out.println("<a href='/servlet-demo/time'>刷新</a>");
        out.println("</body>");
        out.println("</html>");
    }
}
```

---

## 八、总结

✅ **本章学习内容：**
- Servlet 的概念和作用
- Servlet 体系结构
- 创建第一个 Servlet
- Servlet 生命周期
- URL 映射模式
- ServletConfig 和 ServletContext

✅ **核心要点：**
- Servlet 是运行在服务器端的 Java 程序
- 继承 HttpServlet 并重写 doGet/doPost
- Servlet 是单例的，注意线程安全
- 掌握生命周期的三个阶段
- 理解 ServletContext 的全局特性

**下一章预告：** 我们将学习 Servlet 的核心技术，包括请求响应处理、文件上传下载、过滤器和监听器。
