---
title: Dockeré¢è¯•é¢˜é›†
---

# Dockeré¢è¯•é¢˜é›†

## ä¸€ã€DockeråŸºç¡€æ¦‚å¿µé¢è¯•é¢˜

### 1.1 ä»€ä¹ˆæ˜¯Dockerï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

**ç­”æ¡ˆï¼š**

Docker æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨åŒ–å¹³å°ï¼Œç”¨äºå¼€å‘ã€éƒ¨ç½²å’Œè¿è¡Œåº”ç”¨ç¨‹åºã€‚

**è§£å†³çš„é—®é¢˜ï¼š**
1. **ç¯å¢ƒä¸€è‡´æ€§** - "åœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘"çš„é—®é¢˜
2. **èµ„æºéš”ç¦»** - åº”ç”¨ä¹‹é—´äº’ä¸å½±å“
3. **å¿«é€Ÿéƒ¨ç½²** - ç§’çº§å¯åŠ¨ï¼Œæé«˜æ•ˆç‡
4. **ç‰ˆæœ¬ç®¡ç†** - é•œåƒç‰ˆæœ¬åŒ–ï¼Œæ–¹ä¾¿å›æ»š
5. **èµ„æºåˆ©ç”¨** - ç›¸æ¯”è™šæ‹Ÿæœºæ›´è½»é‡ï¼Œèµ„æºå ç”¨å°‘

### 1.2 Docker ä¸è™šæ‹Ÿæœºæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**

| ç‰¹æ€§ | Docker å®¹å™¨ | è™šæ‹Ÿæœº |
|------|-----------|--------|
| å¯åŠ¨é€Ÿåº¦ | ç§’çº§ | åˆ†é’Ÿçº§ |
| ç¡¬ç›˜ä½¿ç”¨ | MB çº§ | GB çº§ |
| æ€§èƒ½ | æ¥è¿‘åŸç”Ÿ | å¼±äºåŸç”Ÿ |
| ç³»ç»Ÿæ”¯æŒé‡ | å•æœºå¯æ”¯æŒä¸Šåƒä¸ª | ä¸€èˆ¬å‡ åä¸ª |
| éš”ç¦»æ€§ | è¿›ç¨‹çº§åˆ« | ç³»ç»Ÿçº§åˆ« |

**æ ¸å¿ƒåŒºåˆ«ï¼š**
- è™šæ‹Ÿæœºéœ€è¦å®Œæ•´çš„ Guest OSï¼ŒDocker å…±äº«ä¸»æœºå†…æ ¸
- Docker æ˜¯è¿›ç¨‹çº§è™šæ‹ŸåŒ–ï¼Œè™šæ‹Ÿæœºæ˜¯ç³»ç»Ÿçº§è™šæ‹ŸåŒ–

### 1.3 Docker çš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ

**ç­”æ¡ˆï¼š**

1. **Docker Clientï¼ˆå®¢æˆ·ç«¯ï¼‰**
   - ç”¨æˆ·ä¸ Docker äº¤äº’çš„ä¸»è¦æ–¹å¼
   - å‘é€å‘½ä»¤åˆ° Docker Daemon

2. **Docker Daemonï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰**
   - ç›‘å¬ Docker API è¯·æ±‚
   - ç®¡ç†é•œåƒã€å®¹å™¨ã€ç½‘ç»œã€å·

3. **Docker Imageï¼ˆé•œåƒï¼‰**
   - åªè¯»æ¨¡æ¿ï¼Œç”¨äºåˆ›å»ºå®¹å™¨
   - é‡‡ç”¨åˆ†å±‚å­˜å‚¨ç»“æ„

4. **Docker Containerï¼ˆå®¹å™¨ï¼‰**
   - é•œåƒçš„è¿è¡Œå®ä¾‹
   - å¯åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤

5. **Docker Registryï¼ˆä»“åº“ï¼‰**
   - å­˜å‚¨å’Œåˆ†å‘é•œåƒ
   - å¦‚ Docker Hubã€ç§æœ‰ä»“åº“

### 1.4 ä»€ä¹ˆæ˜¯é•œåƒåˆ†å±‚ï¼Ÿä¸ºä»€ä¹ˆè¦åˆ†å±‚ï¼Ÿ

**ç­”æ¡ˆï¼š**

Docker é•œåƒé‡‡ç”¨è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnion FSï¼‰ï¼Œæ¯ä¸ªé•œåƒç”±å¤šä¸ªåªè¯»å±‚ç»„æˆã€‚

**åˆ†å±‚ç»“æ„ç¤ºä¾‹ï¼š**
```
åº”ç”¨å±‚      â† COPY app.jar
ä¾èµ–å±‚      â† RUN apt-get install
åŸºç¡€å±‚      â† FROM ubuntu
```

**åˆ†å±‚çš„ä¼˜åŠ¿ï¼š**
1. **èŠ‚çœå­˜å‚¨ç©ºé—´** - å¤šä¸ªé•œåƒå…±äº«ç›¸åŒçš„åŸºç¡€å±‚
2. **åŠ å¿«ä¼ è¾“é€Ÿåº¦** - åªä¼ è¾“å˜åŒ–çš„å±‚
3. **æé«˜æ„å»ºæ•ˆç‡** - åˆ©ç”¨ç¼“å­˜æœºåˆ¶
4. **ä¾¿äºç‰ˆæœ¬ç®¡ç†** - æ¯å±‚éƒ½æœ‰å”¯ä¸€ ID

### 1.5 Dockerfile ä¸­ COPY å’Œ ADD çš„åŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**

| ç‰¹æ€§ | COPY | ADD |
|------|------|-----|
| åŸºæœ¬å¤åˆ¶ | âœ… | âœ… |
| æ”¯æŒ URL | âŒ | âœ… |
| è‡ªåŠ¨è§£å‹ tar | âŒ | âœ… |
| é€æ˜æ€§ | é«˜ | ä½ |
| æ¨èä½¿ç”¨ | âœ… | ç‰¹å®šåœºæ™¯ |

**å»ºè®®ï¼š**
- ä¸€èˆ¬æƒ…å†µä½¿ç”¨ COPYï¼Œè¯­ä¹‰æ›´æ¸…æ™°
- åªåœ¨éœ€è¦è‡ªåŠ¨è§£å‹æ—¶ä½¿ç”¨ ADD

### 1.6 CMD å’Œ ENTRYPOINT çš„åŒºåˆ«ï¼Ÿ

**ç­”æ¡ˆï¼š**

**CMDï¼š**
- æä¾›å®¹å™¨é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤
- å¯è¢« `docker run` å‘½ä»¤è¡Œå‚æ•°è¦†ç›–

**ENTRYPOINTï¼š**
- é…ç½®å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤
- ä¸å®¹æ˜“è¢«è¦†ç›–ï¼ˆéœ€è¦ --entrypoint å‚æ•°ï¼‰

**ç»„åˆä½¿ç”¨ï¼š**
```dockerfile
ENTRYPOINT ["java", "-jar"]
CMD ["app.jar"]

# è¿è¡Œ: docker run myapp
# æ‰§è¡Œ: java -jar app.jar

# è¿è¡Œ: docker run myapp another.jar
# æ‰§è¡Œ: java -jar another.jar
```

---

## äºŒã€é•œåƒä¸å®¹å™¨ç›¸å…³é¢è¯•é¢˜

### 2.1 å¦‚ä½•ä¼˜åŒ– Docker é•œåƒå¤§å°ï¼Ÿ

**ç­”æ¡ˆï¼š**

**1. ä½¿ç”¨è½»é‡çº§åŸºç¡€é•œåƒ**
```dockerfile
FROM alpine:latest  # 5MB
# è€Œä¸æ˜¯ FROM ubuntu:latest  # 80MB
```

**2. å¤šé˜¶æ®µæ„å»º**
```dockerfile
FROM maven:3.8 AS builder
RUN mvn package

FROM openjdk:8-jre-alpine  # åªåŒ…å«è¿è¡Œæ—¶
COPY --from=builder /app/target/*.jar app.jar
```

**3. åˆå¹¶ RUN æŒ‡ä»¤**
```dockerfile
RUN apt-get update && \
    apt-get install -y curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*
```

**4. ä½¿ç”¨ .dockerignore**
```
.git
node_modules/
*.md
```

**5. æ¸…ç†ç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶**

### 2.2 Docker å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ€æ ·çš„ï¼Ÿ

**ç­”æ¡ˆï¼š**

```
created â†’ running â†’ paused â†’ stopped â†’ deleted
   â†‘         â†“                    â†“
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€è¯´æ˜ï¼š**
1. **Created** - å®¹å™¨å·²åˆ›å»ºä½†æœªå¯åŠ¨
2. **Running** - å®¹å™¨æ­£åœ¨è¿è¡Œ
3. **Paused** - å®¹å™¨è¢«æš‚åœ
4. **Stopped** - å®¹å™¨å·²åœæ­¢
5. **Deleted** - å®¹å™¨è¢«åˆ é™¤

**å¸¸ç”¨å‘½ä»¤ï¼š**
```bash
docker create   # åˆ›å»º
docker start    # å¯åŠ¨
docker pause    # æš‚åœ
docker unpause  # æ¢å¤
docker stop     # åœæ­¢
docker rm       # åˆ é™¤
```

### 2.3 å¦‚ä½•è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨ï¼Ÿ

**ç­”æ¡ˆï¼š**

**æ–¹æ³•ä¸€ï¼šdocker execï¼ˆæ¨èï¼‰**
```bash
docker exec -it container_name bash
```

**æ–¹æ³•äºŒï¼šdocker attach**
```bash
docker attach container_name
```

**åŒºåˆ«ï¼š**
- `exec` åˆ›å»ºæ–°è¿›ç¨‹ï¼Œé€€å‡ºä¸å½±å“å®¹å™¨
- `attach` è¿æ¥åˆ°ä¸»è¿›ç¨‹ï¼Œé€€å‡ºä¼šåœæ­¢å®¹å™¨

### 2.4 å®¹å™¨æ•°æ®å¦‚ä½•æŒä¹…åŒ–ï¼Ÿ

**ç­”æ¡ˆï¼š**

**1. Volumeï¼ˆæ•°æ®å·ï¼‰- æ¨è**
```bash
docker volume create my-volume
docker run -v my-volume:/data myapp
```

**2. Bind Mountï¼ˆç»‘å®šæŒ‚è½½ï¼‰**
```bash
docker run -v /host/path:/container/path myapp
```

**3. tmpfs Mountï¼ˆå†…å­˜æŒ‚è½½ï¼‰**
```bash
docker run --tmpfs /tmp myapp
```

**å¯¹æ¯”ï¼š**
- Volumeï¼šDocker ç®¡ç†ï¼Œç”Ÿäº§ç¯å¢ƒæ¨è
- Bind Mountï¼šä¾èµ–ä¸»æœºè·¯å¾„ï¼Œå¼€å‘ç¯å¢ƒä½¿ç”¨
- tmpfsï¼šæ•°æ®åœ¨å†…å­˜ä¸­ï¼Œå®¹å™¨åœæ­¢å³ä¸¢å¤±

---

## ä¸‰ã€ç½‘ç»œä¸å­˜å‚¨é¢è¯•é¢˜

### 3.1 Docker æœ‰å“ªäº›ç½‘ç»œæ¨¡å¼ï¼Ÿ

**ç­”æ¡ˆï¼š**

**1. bridgeï¼ˆæ¡¥æ¥æ¨¡å¼ï¼‰- é»˜è®¤**
- å®¹å™¨è¿æ¥åˆ°è™šæ‹Ÿç½‘æ¡¥
- å¯é€šè¿‡ç«¯å£æ˜ å°„è®¿é—®

**2. hostï¼ˆä¸»æœºæ¨¡å¼ï¼‰**
- å®¹å™¨ä½¿ç”¨ä¸»æœºç½‘ç»œæ ˆ
- æ€§èƒ½æœ€ä½³ï¼Œä½†å¤±å»éš”ç¦»æ€§

**3. noneï¼ˆæ— ç½‘ç»œï¼‰**
- å®¹å™¨æ²¡æœ‰ç½‘ç»œæ¥å£
- å®Œå…¨éš”ç¦»

**4. container**
- ä¸å…¶ä»–å®¹å™¨å…±äº«ç½‘ç»œ
- é€‚åˆç´§å¯†é€šä¿¡çš„å®¹å™¨

**5. è‡ªå®šä¹‰ç½‘ç»œ**
- ç”¨æˆ·å®šä¹‰çš„ç½‘ç»œ
- æ”¯æŒå®¹å™¨åè§£æ

**ç¤ºä¾‹ï¼š**
```bash
docker network create my-network
docker run --network my-network nginx
```

### 3.2 å®¹å™¨é—´å¦‚ä½•é€šä¿¡ï¼Ÿ

**ç­”æ¡ˆï¼š**

**1. åŒä¸€ç½‘ç»œä¸­é€šè¿‡å®¹å™¨å**
```bash
docker network create app-net
docker run --name db --network app-net mysql
docker run --name app --network app-net myapp

# app ä¸­å¯ä»¥é€šè¿‡ db:3306 è¿æ¥ MySQL
```

**2. é€šè¿‡ linkï¼ˆå·²åºŸå¼ƒï¼‰**
```bash
docker run --link db:database myapp
```

**3. é€šè¿‡ä¸»æœºç«¯å£**
```bash
docker run -p 3306:3306 mysql
# å…¶ä»–å®¹å™¨é€šè¿‡ host.docker.internal:3306 è®¿é—®
```

### 3.3 å¦‚ä½•é™åˆ¶å®¹å™¨èµ„æºä½¿ç”¨ï¼Ÿ

**ç­”æ¡ˆï¼š**

**CPU é™åˆ¶ï¼š**
```bash
docker run --cpus=1.5 myapp          # é™åˆ¶ CPU
docker run --cpu-shares=512 myapp    # CPU æƒé‡
```

**å†…å­˜é™åˆ¶ï¼š**
```bash
docker run --memory=512m myapp       # é™åˆ¶å†…å­˜
docker run --memory-swap=1g myapp    # é™åˆ¶ swap
```

**ç£ç›˜ IO é™åˆ¶ï¼š**
```bash
docker run --device-read-bps /dev/sda:1mb myapp
docker run --device-write-bps /dev/sda:1mb myapp
```

**åœ¨ docker-compose.yml ä¸­ï¼š**
```yaml
services:
  app:
    image: myapp
    deploy:
      resources:
        limits:
          cpus: '1.5'
          memory: 512M
```

---

## å››ã€å®æˆ˜åœºæ™¯é¢è¯•é¢˜

### 4.1 å¦‚ä½•æ’æŸ¥å®¹å™¨æ— æ³•å¯åŠ¨çš„é—®é¢˜ï¼Ÿ

**ç­”æ¡ˆï¼š**

**æ­¥éª¤ 1ï¼šæŸ¥çœ‹å®¹å™¨çŠ¶æ€**
```bash
docker ps -a
```

**æ­¥éª¤ 2ï¼šæŸ¥çœ‹æ—¥å¿—**
```bash
docker logs container_name
docker logs --tail 100 container_name
```

**æ­¥éª¤ 3ï¼šæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯**
```bash
docker inspect container_name
```

**æ­¥éª¤ 4ï¼šå°è¯•æ‰‹åŠ¨è¿è¡Œ**
```bash
docker run -it --entrypoint sh myapp
```

**å¸¸è§é—®é¢˜ï¼š**
1. ç«¯å£å·²è¢«å ç”¨
2. é…ç½®æ–‡ä»¶é”™è¯¯
3. ä¾èµ–æœåŠ¡æœªå°±ç»ª
4. æƒé™é—®é¢˜
5. èµ„æºä¸è¶³

### 4.2 å¦‚ä½•å¤‡ä»½å’Œæ¢å¤ Docker å®¹å™¨ï¼Ÿ

**ç­”æ¡ˆï¼š**

**å¤‡ä»½å®¹å™¨ï¼š**
```bash
# 1. æäº¤å®¹å™¨ä¸ºé•œåƒ
docker commit container_name backup_image:v1

# 2. å¯¼å‡ºé•œåƒ
docker save -o backup.tar backup_image:v1

# 3. å¤‡ä»½æ•°æ®å·
docker run --rm -v volume_name:/data -v $(pwd):/backup ubuntu tar czf /backup/data.tar.gz /data
```

**æ¢å¤å®¹å™¨ï¼š**
```bash
# 1. å¯¼å…¥é•œåƒ
docker load -i backup.tar

# 2. æ¢å¤æ•°æ®å·
docker run --rm -v volume_name:/data -v $(pwd):/backup ubuntu tar xzf /backup/data.tar.gz -C /

# 3. è¿è¡Œå®¹å™¨
docker run -d -v volume_name:/data backup_image:v1
```

### 4.3 Spring Boot åº”ç”¨å®¹å™¨åŒ–çš„æœ€ä½³å®è·µï¼Ÿ

**ç­”æ¡ˆï¼š**

**Dockerfile ç¤ºä¾‹ï¼š**
```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM maven:3.8-openjdk-8-slim AS builder
WORKDIR /build
COPY pom.xml .
RUN mvn dependency:go-offline
COPY src ./src
RUN mvn package -DskipTests

# è¿è¡Œé˜¶æ®µ
FROM openjdk:8-jre-alpine
RUN addgroup -S spring && adduser -S spring -G spring
USER spring:spring
WORKDIR /app
COPY --from=builder /build/target/*.jar app.jar

HEALTHCHECK --interval=30s --timeout=3s \
  CMD wget -q --spider http://localhost:8080/actuator/health || exit 1

EXPOSE 8080
ENTRYPOINT ["java", "-Xmx512m", "-jar", "app.jar"]
```

**æœ€ä½³å®è·µï¼š**
1. ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°é•œåƒ
2. ä¸ä»¥ root ç”¨æˆ·è¿è¡Œ
3. æ·»åŠ å¥åº·æ£€æŸ¥
4. è®¾ç½® JVM å‚æ•°
5. ä½¿ç”¨ Alpine åŸºç¡€é•œåƒ

### 4.4 å¦‚ä½•å®ç° Docker çš„é›¶åœæœºéƒ¨ç½²ï¼Ÿ

**ç­”æ¡ˆï¼š**

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ Docker Compose æ»šåŠ¨æ›´æ–°**
```bash
# 1. æ›´æ–°é•œåƒ
docker-compose pull

# 2. æ»šåŠ¨æ›´æ–°ï¼ˆé€ä¸ªé‡å¯ï¼‰
docker-compose up -d --no-deps --scale app=2 --no-recreate app
docker-compose up -d --no-deps --scale app=1 --force-recreate app
```

**æ–¹å¼äºŒï¼šè“ç»¿éƒ¨ç½²**
```bash
# 1. å¯åŠ¨æ–°ç‰ˆæœ¬ï¼ˆç»¿ï¼‰
docker run -d --name app-green myapp:v2

# 2. æµ‹è¯•æ–°ç‰ˆæœ¬
curl http://app-green:8080/health

# 3. åˆ‡æ¢æµé‡ï¼ˆæ›´æ–° Nginx é…ç½®ï¼‰
# 4. åœæ­¢æ—§ç‰ˆæœ¬ï¼ˆè“ï¼‰
docker stop app-blue
```

**æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Kubernetes**
```yaml
kind: Deployment
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
```

---

## äº”ã€é«˜é¢‘é¢è¯•é¢˜è§£æ

### 5.1 Docker é•œåƒæ˜¯å¦‚ä½•æ„å»ºçš„ï¼Ÿ

**ç­”æ¡ˆï¼š**

**æ„å»ºè¿‡ç¨‹ï¼š**
1. ä» Dockerfile è¯»å–æŒ‡ä»¤
2. ä»åŸºç¡€é•œåƒå¼€å§‹
3. æ¯æ¡æŒ‡ä»¤åˆ›å»ºä¸€ä¸ªæ–°å±‚
4. æœ€ç»ˆç”Ÿæˆé•œåƒ ID

**ç¤ºä¾‹ï¼š**
```bash
docker build -t myapp:v1 .

# æ„å»ºè¿‡ç¨‹
Step 1/5 : FROM openjdk:8
Step 2/5 : WORKDIR /app
Step 3/5 : COPY app.jar .
Step 4/5 : EXPOSE 8080
Step 5/5 : CMD ["java", "-jar", "app.jar"]
Successfully built abc123def456
```

**ä¼˜åŒ–æŠ€å·§ï¼š**
- åˆç†å®‰æ’æŒ‡ä»¤é¡ºåºï¼ˆå˜åŒ–å°‘çš„åœ¨å‰ï¼‰
- åˆ©ç”¨æ„å»ºç¼“å­˜
- ä½¿ç”¨ .dockerignore

### 5.2 ä»€ä¹ˆæ˜¯ Docker Composeï¼Ÿå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

**ç­”æ¡ˆï¼š**

Docker Compose æ˜¯ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨çš„å·¥å…·ã€‚

**è§£å†³çš„é—®é¢˜ï¼š**
1. **ç®€åŒ–å¤šå®¹å™¨ç®¡ç†** - ä¸€ä¸ªæ–‡ä»¶å®šä¹‰æ‰€æœ‰æœåŠ¡
2. **æœåŠ¡ç¼–æ’** - ç®¡ç†æœåŠ¡ä¾èµ–å…³ç³»
3. **ä¸€é”®éƒ¨ç½²** - å•æ¡å‘½ä»¤å¯åŠ¨æ•´ä¸ªåº”ç”¨
4. **ç¯å¢ƒéš”ç¦»** - ä¸åŒé¡¹ç›®äº’ä¸å½±å“

**ç¤ºä¾‹ï¼š**
```yaml
version: '3.8'
services:
  web:
    build: .
    ports:
      - "8080:8080"
    depends_on:
      - db
  db:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: root
```

### 5.3 å®¹å™¨é€€å‡ºåæ•°æ®ä¼šä¸¢å¤±å—ï¼Ÿå¦‚ä½•ä¿ç•™ï¼Ÿ

**ç­”æ¡ˆï¼š**

**é»˜è®¤æƒ…å†µï¼š**
- å®¹å™¨æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä¼šä¸¢å¤±
- å®¹å™¨åˆ é™¤åæ•°æ®å®Œå…¨ä¸¢å¤±

**ä¿ç•™æ•°æ®çš„æ–¹æ³•ï¼š**

**1. ä½¿ç”¨ Volumeï¼ˆæ¨èï¼‰**
```bash
docker volume create app-data
docker run -v app-data:/data myapp
```

**2. æŒ‚è½½ä¸»æœºç›®å½•**
```bash
docker run -v /host/data:/container/data myapp
```

**3. å¯¼å‡ºå®¹å™¨**
```bash
docker export container_name > backup.tar
```

### 5.4 Docker çš„å®‰å…¨æ€§å¦‚ä½•ä¿éšœï¼Ÿ

**ç­”æ¡ˆï¼š**

**1. ä¸ä»¥ root ç”¨æˆ·è¿è¡Œ**
```dockerfile
RUN adduser -S appuser
USER appuser
```

**2. ä½¿ç”¨åªè¯»æ–‡ä»¶ç³»ç»Ÿ**
```bash
docker run --read-only myapp
```

**3. é™åˆ¶å®¹å™¨æƒé™**
```bash
docker run --cap-drop ALL --cap-add NET_BIND_SERVICE myapp
```

**4. æ‰«æé•œåƒæ¼æ´**
```bash
docker scan myapp:latest
```

**5. ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“**

**6. ç½‘ç»œéš”ç¦»**
```yaml
networks:
  internal:
    internal: true  # ä¸èƒ½è®¿é—®å¤–ç½‘
```

### 5.5 å¦‚ä½•ç›‘æ§ Docker å®¹å™¨ï¼Ÿ

**ç­”æ¡ˆï¼š**

**1. docker stats å‘½ä»¤**
```bash
docker stats
docker stats --no-stream
```

**2. cAdvisor**
```bash
docker run -d \
  -p 8080:8080 \
  -v /:/rootfs:ro \
  -v /var/run:/var/run:ro \
  google/cadvisor
```

**3. Prometheus + Grafana**
```yaml
services:
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
  
  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
```

**4. ELK Stackï¼ˆæ—¥å¿—ç›‘æ§ï¼‰**

**ç›‘æ§æŒ‡æ ‡ï¼š**
- CPU ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨ç‡
- ç½‘ç»œ I/O
- ç£ç›˜ I/O
- å®¹å™¨æ•°é‡

---

## å…­ã€ç»¼åˆåº”ç”¨é¢˜

### 6.1 è®¾è®¡ä¸€ä¸ªå¾®æœåŠ¡åº”ç”¨çš„ Docker éƒ¨ç½²æ–¹æ¡ˆ

**ç­”æ¡ˆï¼š**

**æ¶æ„è®¾è®¡ï¼š**
```
Nginx â†’ Gateway â†’ å¤šä¸ªå¾®æœåŠ¡ â†’ MySQL/Redis/RabbitMQ
```

**docker-compose.ymlï¼š**
```yaml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    depends_on:
      - gateway

  gateway:
    build: ./gateway
    depends_on:
      - eureka
    environment:
      EUREKA_SERVER: http://eureka:8761/eureka

  eureka:
    build: ./eureka
    ports:
      - "8761:8761"

  user-service:
    build: ./user-service
    depends_on:
      - mysql
      - redis
    environment:
      DB_HOST: mysql
      REDIS_HOST: redis

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: root
    volumes:
      - mysql-data:/var/lib/mysql

  redis:
    image: redis:alpine
    command: redis-server --requirepass redis123

volumes:
  mysql-data:
```

### 6.2 å¦‚ä½•å®ç° Docker çš„ CI/CDï¼Ÿ

**ç­”æ¡ˆï¼š**

**GitLab CI/CD ç¤ºä¾‹ï¼š**
```yaml
stages:
  - build
  - test
  - deploy

build:
  stage: build
  script:
    - docker build -t myapp:$CI_COMMIT_SHA .
    - docker push myapp:$CI_COMMIT_SHA

test:
  stage: test
  script:
    - docker run myapp:$CI_COMMIT_SHA npm test

deploy:
  stage: deploy
  script:
    - docker-compose pull
    - docker-compose up -d
  only:
    - main
```

---

## ä¸ƒã€å°ç»“

**Docker é¢è¯•é«˜é¢‘è€ƒç‚¹ï¼š**

âœ… **åŸºç¡€æ¦‚å¿µ**
- Docker æ˜¯ä»€ä¹ˆ
- ä¸è™šæ‹Ÿæœºçš„åŒºåˆ«
- æ ¸å¿ƒç»„ä»¶

âœ… **é•œåƒä¸å®¹å™¨**
- åˆ†å±‚å­˜å‚¨åŸç†
- Dockerfile ç¼–å†™
- å®¹å™¨ç”Ÿå‘½å‘¨æœŸ

âœ… **ç½‘ç»œä¸å­˜å‚¨**
- ç½‘ç»œæ¨¡å¼
- æ•°æ®æŒä¹…åŒ–
- å®¹å™¨é€šä¿¡

âœ… **å®æˆ˜åº”ç”¨**
- åº”ç”¨å®¹å™¨åŒ–
- é—®é¢˜æ’æŸ¥
- æ€§èƒ½ä¼˜åŒ–

âœ… **è¿›é˜¶å†…å®¹**
- Docker Compose
- å¾®æœåŠ¡éƒ¨ç½²
- CI/CD é›†æˆ

**é¢è¯•å‡†å¤‡å»ºè®®ï¼š**
1. ç†è§£ Docker æ ¸å¿ƒåŸç†
2. ç†Ÿç»ƒæŒæ¡å¸¸ç”¨å‘½ä»¤
3. æœ‰å®é™…é¡¹ç›®ç»éªŒ
4. äº†è§£å®¹å™¨ç¼–æ’ï¼ˆKubernetesï¼‰
5. å…³æ³¨å®‰å…¨æ€§å’Œæ€§èƒ½ä¼˜åŒ–

---

**æ­å–œä½ å®Œæˆäº† Docker æ•™ç¨‹çš„å­¦ä¹ ï¼ğŸ‰**

**å»ºè®®ï¼š**
- å¤šåŠ¨æ‰‹å®è·µ
- å‚ä¸å¼€æºé¡¹ç›®
- å…³æ³¨å®˜æ–¹æ–‡æ¡£æ›´æ–°
- å­¦ä¹  Kubernetes ç­‰å®¹å™¨ç¼–æ’å·¥å…·

**ç»§ç»­å­¦ä¹ è·¯å¾„ï¼š**
- Kubernetes å®¹å™¨ç¼–æ’
- Docker Swarm
- æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰
- äº‘åŸç”ŸæŠ€æœ¯æ ˆ
