---
title: Docker基础入门
---

# Docker基础入门

## 一、Docker是什么？

### 1.1 Docker简介

**Docker** 是一个开源的容器化平台，它可以让开发者将应用及其依赖打包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 或 Windows 机器上。

**Docker 的核心价值：**
- 🚀 **快速部署** - 秒级启动，比虚拟机快得多
- 📦 **环境一致** - "在我机器上能跑"的问题彻底解决
- 🔄 **轻量级** - 共享主机内核，资源占用少
- 🌍 **跨平台** - 一次构建，到处运行

### 1.2 为什么要用Docker？

**传统部署的痛点：**
```
问题1：环境不一致
开发环境 ≠ 测试环境 ≠ 生产环境
"在我机器上可以运行啊！"

问题2：资源浪费
虚拟机需要完整的操作系统
启动慢，资源占用大

问题3：部署复杂
手动配置环境
依赖管理困难
版本冲突频繁

问题4：扩展困难
横向扩展需要重复配置
成本高，效率低
```

**使用 Docker 的优势：**
```
✅ 环境隔离 - 每个容器独立运行，互不干扰
✅ 快速启动 - 秒级启动，即开即用
✅ 版本控制 - 镜像版本化管理，方便回滚
✅ 资源高效 - 共享内核，资源占用小
✅ 持续交付 - 与 CI/CD 完美集成
✅ 微服务 - 天然适合微服务架构
```

### 1.3 Docker vs 虚拟机

| 特性 | Docker 容器 | 虚拟机 |
|------|-----------|--------|
| 启动速度 | 秒级 | 分钟级 |
| 性能 | 接近原生 | 有损耗 |
| 资源占用 | MB级别 | GB级别 |
| 操作系统 | 共享主机内核 | 完整OS |
| 隔离性 | 进程级别 | 系统级别 |
| 迁移性 | 非常方便 | 相对困难 |

**架构对比：**
```
虚拟机架构：
┌─────────────────────────────┐
│      应用A      │   应用B    │
├─────────────────┼───────────┤
│    Guest OS A   │ Guest OS B│
├─────────────────┴───────────┤
│        Hypervisor           │
├─────────────────────────────┤
│        Host OS              │
└─────────────────────────────┘

Docker 架构：
┌─────────────────────────────┐
│   应用A   │    应用B   │应用C│
├───────────┼───────────┼─────┤
│  容器A    │  容器B    │容器C│
├─────────────────────────────┤
│      Docker Engine          │
├─────────────────────────────┤
│        Host OS              │
└─────────────────────────────┘
```

---

## 二、Docker安装与配置

### 2.1 系统要求

**Linux：**
- 64位操作系统
- 内核版本 3.10 以上

**Windows：**
- Windows 10 64位：Pro、Enterprise 或 Education
- 启用 Hyper-V 和容器功能

**macOS：**
- macOS 10.14 或更高版本
- 4GB RAM 最小配置

### 2.2 Windows 安装（Docker Desktop）

**步骤1：下载安装包**
```
访问官网：https://www.docker.com/products/docker-desktop
下载：Docker Desktop for Windows
```

**步骤2：安装 Docker Desktop**
```
1. 双击安装包运行
2. 勾选 "Install required Windows components for WSL 2"
3. 按照向导完成安装
4. 重启电脑
```

**步骤3：启动 Docker Desktop**
```
1. 从开始菜单启动 Docker Desktop
2. 等待 Docker 启动（状态栏显示 Docker 图标）
3. 打开 PowerShell 或 CMD
```

**步骤4：验证安装**
```powershell
# 查看版本
docker --version
docker version

# 运行测试容器
docker run hello-world

# 应该看到：
# Hello from Docker!
# This message shows that your installation appears to be working correctly.
```

### 2.3 Linux 安装（Ubuntu）

**方式一：使用官方脚本（推荐）**
```bash
# 下载并运行官方安装脚本
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# 启动 Docker 服务
sudo systemctl start docker
sudo systemctl enable docker

# 验证安装
sudo docker version
```

**方式二：手动安装**
```bash
# 1. 卸载旧版本
sudo apt-get remove docker docker-engine docker.io containerd runc

# 2. 更新软件包索引
sudo apt-get update

# 3. 安装依赖包
sudo apt-get install \
    ca-certificates \
    curl \
    gnupg \
    lsb-release

# 4. 添加 Docker 官方 GPG 密钥
sudo mkdir -p /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

# 5. 设置 Docker 仓库
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# 6. 安装 Docker Engine
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin

# 7. 验证安装
sudo docker run hello-world
```

**配置非root用户使用Docker：**
```bash
# 创建 docker 组
sudo groupadd docker

# 将当前用户添加到 docker 组
sudo usermod -aG docker $USER

# 重新登录或执行
newgrp docker

# 现在可以不用 sudo 运行 docker 命令
docker run hello-world
```

### 2.4 macOS 安装

**步骤1：下载 Docker Desktop**
```
访问：https://www.docker.com/products/docker-desktop
下载：Docker Desktop for Mac (Apple Silicon 或 Intel)
```

**步骤2：安装**
```
1. 打开 .dmg 文件
2. 拖拽 Docker 图标到 Applications 文件夹
3. 从 Applications 启动 Docker
4. 授权 Docker 访问权限
```

**步骤3：验证**
```bash
docker --version
docker run hello-world
```

### 2.5 配置镜像加速器

由于 Docker Hub 在国内访问较慢，建议配置镜像加速器。

**阿里云镜像加速器（推荐）：**

1. 登录阿里云容器镜像服务
2. 获取专属加速地址：https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors

**Linux 配置：**
```bash
# 创建或编辑 daemon.json
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": [
    "https://mirror.ccs.tencentyun.com",
    "https://docker.mirrors.ustc.edu.cn",
    "https://registry.docker-cn.com"
  ]
}
EOF

# 重启 Docker 服务
sudo systemctl daemon-reload
sudo systemctl restart docker

# 验证配置
docker info | grep -A 1 "Registry Mirrors"
```

**Windows/macOS 配置：**
```
1. 打开 Docker Desktop
2. 点击设置（Settings）
3. 选择 Docker Engine
4. 在 JSON 配置中添加：
{
  "registry-mirrors": [
    "https://mirror.ccs.tencentyun.com",
    "https://docker.mirrors.ustc.edu.cn"
  ]
}
5. 点击 Apply & Restart
```

---

## 三、Docker架构与核心组件

### 3.1 Docker 架构

Docker 使用客户端-服务器（C/S）架构：

```
┌──────────────────────────────────────────────┐
│           Docker Client (客户端)              │
│  docker build, docker pull, docker run...    │
└───────────────────┬──────────────────────────┘
                    │ REST API
                    ▼
┌──────────────────────────────────────────────┐
│         Docker Daemon (dockerd)              │
│  ┌────────────┐  ┌────────────┐             │
│  │  镜像管理  │  │  容器管理  │             │
│  └────────────┘  └────────────┘             │
│  ┌────────────┐  ┌────────────┐             │
│  │  网络管理  │  │  数据卷    │             │
│  └────────────┘  └────────────┘             │
└───────────────────┬──────────────────────────┘
                    │
                    ▼
┌──────────────────────────────────────────────┐
│        Docker Registry (镜像仓库)             │
│  Docker Hub, 阿里云, Harbor...               │
└──────────────────────────────────────────────┘
```

### 3.2 核心组件

**1. Docker Client（客户端）**
- 用户与 Docker 交互的主要方式
- 发送命令到 Docker Daemon
- 可以与多个 Daemon 通信

**2. Docker Daemon（守护进程）**
- 监听 Docker API 请求
- 管理 Docker 对象（镜像、容器、网络、卷）
- 可以与其他 Daemon 通信

**3. Docker Images（镜像）**
- 只读模板，用于创建容器
- 包含运行应用所需的所有内容
- 分层存储，节省空间

**4. Docker Containers（容器）**
- 镜像的运行实例
- 可以被创建、启动、停止、删除
- 相互隔离，保证安全

**5. Docker Registry（仓库）**
- 存储 Docker 镜像
- 公共仓库：Docker Hub
- 私有仓库：Harbor、阿里云

### 3.3 核心概念

**镜像（Image）：**
```
镜像 = 应用 + 依赖 + 运行时环境

特点：
- 只读模板
- 分层存储
- 可以基于其他镜像构建
- 版本控制（通过标签）
```

**容器（Container）：**
```
容器 = 镜像的运行实例

特点：
- 可读可写
- 轻量级
- 相互隔离
- 可以被启动、停止、删除
```

**仓库（Registry）：**
```
仓库 = 存储和分发镜像的服务

类型：
- 公共仓库（Docker Hub）
- 私有仓库（Harbor）
- 云服务商仓库（阿里云、腾讯云）
```

---

## 四、Docker镜像与容器基础操作

### 4.1 镜像操作

**查看本地镜像：**
```bash
# 列出所有镜像
docker images
# 或
docker image ls

# 输出示例：
# REPOSITORY    TAG       IMAGE ID       CREATED        SIZE
# nginx         latest    605c77e624dd   2 weeks ago    141MB
# mysql         8.0       3218b38490ce   3 weeks ago    516MB
```

**搜索镜像：**
```bash
# 在 Docker Hub 搜索镜像
docker search nginx

# 输出示例：
# NAME                DESCRIPTION           STARS     OFFICIAL
# nginx               Official build...     15000     [OK]
```

**拉取镜像：**
```bash
# 拉取最新版本
docker pull nginx

# 拉取指定版本
docker pull nginx:1.21

# 拉取指定平台镜像
docker pull --platform linux/amd64 nginx
```

**删除镜像：**
```bash
# 通过镜像ID删除
docker rmi 605c77e624dd

# 通过名称删除
docker rmi nginx:latest

# 强制删除（即使有容器在使用）
docker rmi -f nginx

# 删除所有未使用的镜像
docker image prune -a
```

**查看镜像详情：**
```bash
# 查看镜像详细信息
docker inspect nginx

# 查看镜像历史
docker history nginx
```

### 4.2 容器操作

**运行容器：**
```bash
# 基本运行
docker run nginx

# 后台运行
docker run -d nginx

# 指定容器名称
docker run -d --name my-nginx nginx

# 端口映射
docker run -d -p 80:80 --name my-nginx nginx

# 环境变量
docker run -d -e MYSQL_ROOT_PASSWORD=root mysql:8.0

# 数据卷挂载
docker run -d -v /my/data:/var/lib/mysql mysql:8.0

# 组合使用
docker run -d \
  --name my-nginx \
  -p 8080:80 \
  -v /my/html:/usr/share/nginx/html \
  nginx
```

**查看容器：**
```bash
# 查看运行中的容器
docker ps

# 查看所有容器（包括已停止的）
docker ps -a

# 查看容器详细信息
docker inspect my-nginx

# 查看容器资源使用
docker stats my-nginx
```

**容器生命周期管理：**
```bash
# 启动容器
docker start my-nginx

# 停止容器
docker stop my-nginx

# 重启容器
docker restart my-nginx

# 暂停容器
docker pause my-nginx

# 恢复容器
docker unpause my-nginx

# 删除容器
docker rm my-nginx

# 强制删除运行中的容器
docker rm -f my-nginx

# 删除所有已停止的容器
docker container prune
```

**进入容器：**
```bash
# 进入容器（推荐）
docker exec -it my-nginx bash

# 如果没有 bash，使用 sh
docker exec -it my-nginx sh

# 以 root 用户进入
docker exec -it -u root my-nginx bash

# 执行单条命令
docker exec my-nginx ls -la
```

**查看容器日志：**
```bash
# 查看日志
docker logs my-nginx

# 实时查看日志
docker logs -f my-nginx

# 查看最后100行
docker logs --tail 100 my-nginx

# 显示时间戳
docker logs -t my-nginx
```

**容器与主机之间复制文件：**
```bash
# 从容器复制到主机
docker cp my-nginx:/etc/nginx/nginx.conf ./nginx.conf

# 从主机复制到容器
docker cp ./index.html my-nginx:/usr/share/nginx/html/
```

---

## 五、Docker仓库使用

### 5.1 Docker Hub

**注册与登录：**
```bash
# 登录 Docker Hub
docker login

# 输入用户名和密码

# 登出
docker logout
```

**推送镜像：**
```bash
# 1. 标记镜像（添加用户名前缀）
docker tag my-app:latest username/my-app:latest

# 2. 推送到 Docker Hub
docker push username/my-app:latest

# 3. 推送所有标签
docker push username/my-app --all-tags
```

**拉取镜像：**
```bash
# 拉取公共镜像
docker pull nginx

# 拉取私有镜像（需要先登录）
docker pull username/my-private-app
```

### 5.2 阿里云容器镜像服务

**配置阿里云镜像仓库：**
```bash
# 1. 登录阿里云镜像仓库
docker login --username=your_username registry.cn-hangzhou.aliyuncs.com

# 2. 标记镜像
docker tag my-app:latest registry.cn-hangzhou.aliyuncs.com/namespace/my-app:latest

# 3. 推送镜像
docker push registry.cn-hangzhou.aliyuncs.com/namespace/my-app:latest

# 4. 拉取镜像
docker pull registry.cn-hangzhou.aliyuncs.com/namespace/my-app:latest
```

### 5.3 私有仓库（Registry）

**快速搭建私有仓库：**
```bash
# 1. 运行 Registry 容器
docker run -d \
  -p 5000:5000 \
  --name registry \
  -v /my/registry:/var/lib/registry \
  registry:2

# 2. 标记镜像
docker tag my-app:latest localhost:5000/my-app:latest

# 3. 推送到私有仓库
docker push localhost:5000/my-app:latest

# 4. 从私有仓库拉取
docker pull localhost:5000/my-app:latest
```

---

## 六、Docker常用命令速查

### 6.1 镜像命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `docker pull` | 拉取镜像 | `docker pull nginx:1.21` |
| `docker images` | 列出镜像 | `docker images` |
| `docker rmi` | 删除镜像 | `docker rmi nginx` |
| `docker build` | 构建镜像 | `docker build -t myapp .` |
| `docker tag` | 标记镜像 | `docker tag app:v1 app:latest` |
| `docker push` | 推送镜像 | `docker push myapp:latest` |
| `docker history` | 查看镜像历史 | `docker history nginx` |
| `docker inspect` | 查看镜像详情 | `docker inspect nginx` |

### 6.2 容器命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `docker run` | 创建并运行容器 | `docker run -d nginx` |
| `docker ps` | 列出容器 | `docker ps -a` |
| `docker start` | 启动容器 | `docker start my-nginx` |
| `docker stop` | 停止容器 | `docker stop my-nginx` |
| `docker restart` | 重启容器 | `docker restart my-nginx` |
| `docker rm` | 删除容器 | `docker rm my-nginx` |
| `docker exec` | 进入容器 | `docker exec -it nginx bash` |
| `docker logs` | 查看日志 | `docker logs -f nginx` |
| `docker cp` | 复制文件 | `docker cp nginx:/file ./` |

### 6.3 系统命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `docker info` | 查看系统信息 | `docker info` |
| `docker version` | 查看版本 | `docker version` |
| `docker system df` | 查看磁盘使用 | `docker system df` |
| `docker system prune` | 清理资源 | `docker system prune -a` |

### 6.4 常用参数

**docker run 常用参数：**
```bash
-d                    # 后台运行
-it                   # 交互式运行
--name                # 指定容器名称
-p 主机端口:容器端口   # 端口映射
-v 主机路径:容器路径   # 数据卷挂载
-e KEY=VALUE          # 环境变量
--network             # 指定网络
--restart             # 重启策略
--rm                  # 容器停止后自动删除
--memory              # 内存限制
--cpus                # CPU限制
```

**示例：**
```bash
docker run -d \
  --name my-app \
  -p 8080:8080 \
  -v /data:/app/data \
  -e SPRING_PROFILES_ACTIVE=prod \
  --network my-network \
  --restart unless-stopped \
  --memory 512m \
  --cpus 1.0 \
  my-app:latest
```

---

## 七、实践练习

### 练习1：运行 Nginx 服务器

```bash
# 1. 拉取 nginx 镜像
docker pull nginx

# 2. 运行 nginx 容器
docker run -d --name my-nginx -p 8080:80 nginx

# 3. 访问 http://localhost:8080

# 4. 查看容器日志
docker logs my-nginx

# 5. 进入容器
docker exec -it my-nginx bash

# 6. 停止并删除容器
docker stop my-nginx
docker rm my-nginx
```

### 练习2：运行 MySQL 数据库

```bash
# 1. 运行 MySQL 容器
docker run -d \
  --name my-mysql \
  -p 3306:3306 \
  -e MYSQL_ROOT_PASSWORD=root123 \
  -e MYSQL_DATABASE=testdb \
  -v mysql-data:/var/lib/mysql \
  mysql:8.0

# 2. 查看容器状态
docker ps

# 3. 查看日志
docker logs my-mysql

# 4. 进入容器连接数据库
docker exec -it my-mysql mysql -uroot -proot123

# 5. 在 MySQL 中执行命令
SHOW DATABASES;
USE testdb;

# 6. 退出并清理
exit
docker stop my-mysql
docker rm my-mysql
docker volume rm mysql-data
```

### 练习3：构建自定义镜像

```bash
# 1. 创建项目目录
mkdir my-web-app && cd my-web-app

# 2. 创建 index.html
echo "<h1>Hello Docker!</h1>" > index.html

# 3. 创建 Dockerfile
cat > Dockerfile <<EOF
FROM nginx:alpine
COPY index.html /usr/share/nginx/html/
EOF

# 4. 构建镜像
docker build -t my-web-app:v1 .

# 5. 运行容器
docker run -d -p 8080:80 --name web my-web-app:v1

# 6. 访问 http://localhost:8080

# 7. 清理
docker stop web
docker rm web
docker rmi my-web-app:v1
```

---

## 八、小结

通过本章学习，你应该掌握：

✅ **Docker 是什么**
- 容器化平台
- 轻量级、快速、可移植

✅ **Docker 的优势**
- 环境一致性
- 快速部署
- 资源高效

✅ **Docker 的安装**
- Windows/Linux/macOS
- 镜像加速器配置

✅ **核心概念**
- 镜像、容器、仓库
- 客户端-服务器架构

✅ **基础操作**
- 镜像管理
- 容器生命周期
- 常用命令

**下一章预告：**
在下一章中，我们将深入学习 Docker 的核心概念，包括镜像原理、Dockerfile 编写、网络和数据卷管理等内容。

---

**继续学习** → [第二章：Docker 核心概念](2.Docker核心概念.md)
