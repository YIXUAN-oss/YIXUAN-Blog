---
title: 分页插件
---

# 分页插件

## 一、分页插件简介

### 1.1 什么是分页插件？

MyBatis-Plus 内置了分页插件 `PaginationInnerInterceptor`，无需手写分页SQL，自动完成分页查询。

**优点：**
- ✅ 自动分页
- ✅ 支持多种数据库
- ✅ 性能优化
- ✅ 使用简单

---

## 二、配置分页插件

### 2.1 添加配置

```java
@Configuration
public class MybatisPlusConfig {
    
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        
        // 分页插件
        PaginationInnerInterceptor paginationInnerInterceptor = 
            new PaginationInnerInterceptor(DbType.MYSQL);
        
        // 设置最大单页限制数量（默认500条，-1不限制）
        paginationInnerInterceptor.setMaxLimit(1000L);
        
        // 溢出总页数后是否进行处理
        paginationInnerInterceptor.setOverflow(true);
        
        interceptor.addInnerInterceptor(paginationInnerInterceptor);
        
        return interceptor;
    }
}
```

---

## 三、基本分页

### 3.1 Mapper层分页

```java
@Mapper
public interface UserMapper extends BaseMapper<User> {
}
```

**使用：**
```java
// 创建分页对象
Page<User> page = new Page<>(1, 10);  // 第1页，每页10条

// 执行分页查询
userMapper.selectPage(page, null);

// 获取结果
List<User> records = page.getRecords();  // 当前页数据
long total = page.getTotal();            // 总记录数
long pages = page.getPages();            // 总页数
long current = page.getCurrent();        // 当前页
long size = page.getSize();              // 每页大小
```

### 3.2 条件分页

```java
Page<User> page = new Page<>(1, 10);

LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<>();
wrapper.gt(User::getAge, 20)
       .orderByDesc(User::getCreateTime);

userMapper.selectPage(page, wrapper);
```

### 3.3 Service层分页

```java
Page<User> page = new Page<>(1, 10);

LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<>();
wrapper.like(User::getUsername, "张");

userService.page(page, wrapper);
```

---

## 四、自定义分页

### 4.1 Mapper XML分页

**Mapper接口：**
```java
@Mapper
public interface UserMapper extends BaseMapper<User> {
    
    IPage<User> selectUserPage(IPage<User> page, @Param("age") Integer age);
}
```

**Mapper XML：**
```xml
<mapper namespace="com.example.mapper.UserMapper">
    <select id="selectUserPage" resultType="com.example.entity.User">
        SELECT * FROM user
        WHERE age > #{age}
    </select>
</mapper>
```

**使用：**
```java
Page<User> page = new Page<>(1, 10);
userMapper.selectUserPage(page, 20);
```

### 4.2 多表关联分页

**UserVO：**
```java
@Data
public class UserVO {
    private Long id;
    private String username;
    private String deptName;  // 部门名称
}
```

**Mapper接口：**
```java
IPage<UserVO> selectUserVOPage(IPage<UserVO> page, @Param("username") String username);
```

**Mapper XML：**
```xml
<select id="selectUserVOPage" resultType="com.example.vo.UserVO">
    SELECT u.id, u.username, d.dept_name
    FROM user u
    LEFT JOIN department d ON u.dept_id = d.id
    <where>
        <if test="username != null and username != ''">
            AND u.username LIKE CONCAT('%', #{username}, '%')
        </if>
    </where>
</select>
```

---

## 五、分页参数

### 5.1 Page参数

```java
// 构造方法
Page<User> page = new Page<>(current, size);

// 设置参数
page.setCurrent(1);      // 当前页（从1开始）
page.setSize(10);        // 每页大小
page.setOptimizeCountSql(true);  // 优化COUNT查询
page.setSearchCount(true);       // 是否查询总数
page.setMaxLimit(1000L); // 最大单页限制
```

### 5.2 获取结果

```java
List<User> records = page.getRecords();  // 当前页数据
long total = page.getTotal();            // 总记录数
long size = page.getSize();              // 每页大小
long current = page.getCurrent();        // 当前页
long pages = page.getPages();            // 总页数
boolean hasNext = page.hasNext();        // 是否有下一页
boolean hasPrevious = page.hasPrevious();  // 是否有上一页
```

---

## 六、性能优化

### 6.1 优化COUNT查询

```java
Page<User> page = new Page<>(1, 10);

// 优化COUNT查询（移除 ORDER BY）
page.setOptimizeCountSql(true);

userMapper.selectPage(page, null);
```

### 6.2 不查询总数

```java
// 某些场景不需要总数
Page<User> page = new Page<>(1, 10);
page.setSearchCount(false);  // 不查询总数

userMapper.selectPage(page, null);
```

### 6.3 手动设置总数

```java
// 第一次查询总数
Page<User> page = new Page<>(1, 10);
userMapper.selectPage(page, null);
long total = page.getTotal();

// 后续翻页不再查询总数
Page<User> page2 = new Page<>(2, 10);
page2.setSearchCount(false);
page2.setTotal(total);  // 手动设置总数
userMapper.selectPage(page2, null);
```

---

## 七、实战案例

### 7.1 完整分页接口

**Controller：**
```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping("/page")
    public Result<IPage<User>> page(
        @RequestParam(defaultValue = "1") Integer current,
        @RequestParam(defaultValue = "10") Integer size,
        String username,
        Integer minAge) {
        
        Page<User> page = new Page<>(current, size);
        
        LambdaQueryWrapper<User> wrapper = new LambdaQueryWrapper<>();
        wrapper.like(StringUtils.isNotBlank(username), User::getUsername, username)
               .ge(minAge != null, User::getAge, minAge)
               .orderByDesc(User::getCreateTime);
        
        userService.page(page, wrapper);
        
        return Result.success(page);
    }
}
```

**返回结果：**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "records": [
            {
                "id": 1,
                "username": "张三",
                "age": 20
            }
        ],
        "total": 100,
        "size": 10,
        "current": 1,
        "pages": 10
    }
}
```

---

## 八、总结

✅ **本章学习内容：**
- 分页插件配置
- 基本分页
- 自定义分页
- 分页参数
- 性能优化
- 实战案例

✅ **核心要点：**
- 配置分页插件
- 使用 Page 对象
- 支持自定义 SQL 分页
- 优化 COUNT 查询

**下一章预告：** 我们将学习高级功能。
