# çº¦æŸä¸æ•°æ®å®Œæ•´æ€§

> çº¦æŸæ˜¯ä¿è¯æ•°æ®å‡†ç¡®æ€§å’Œä¸€è‡´æ€§çš„é‡è¦æœºåˆ¶ã€‚æœ¬ç« å°†æ·±å…¥è®²è§£MySQLä¸­çš„å„ç§çº¦æŸç±»å‹åŠå…¶åº”ç”¨ã€‚

## ğŸ“‹ æœ¬ç« ç›®å½•

- [ä¸€ã€çº¦æŸæ¦‚è¿°](#ä¸€çº¦æŸæ¦‚è¿°)
- [äºŒã€ä¸»é”®çº¦æŸ](#äºŒä¸»é”®çº¦æŸ)
- [ä¸‰ã€å¤–é”®çº¦æŸ](#ä¸‰å¤–é”®çº¦æŸ)
- [å››ã€å”¯ä¸€çº¦æŸ](#å››å”¯ä¸€çº¦æŸ)
- [äº”ã€éç©ºçº¦æŸ](#äº”éç©ºçº¦æŸ)
- [å…­ã€é»˜è®¤çº¦æŸ](#å…­é»˜è®¤çº¦æŸ)
- [ä¸ƒã€æ£€æŸ¥çº¦æŸ](#ä¸ƒæ£€æŸ¥çº¦æŸ)
- [å…«ã€ç»¼åˆåº”ç”¨æ¡ˆä¾‹](#å…«ç»¼åˆåº”ç”¨æ¡ˆä¾‹)

---

## ä¸€ã€çº¦æŸæ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯çº¦æŸï¼Ÿ

**çº¦æŸï¼ˆConstraintï¼‰** æ˜¯ä½œç”¨äºè¡¨ä¸­å­—æ®µä¸Šçš„è§„åˆ™ï¼Œç”¨äºé™åˆ¶å­˜å‚¨åœ¨è¡¨ä¸­çš„æ•°æ®ï¼Œä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ã€æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§ã€‚

### 1.2 çº¦æŸçš„åˆ†ç±»

| çº¦æŸç±»å‹ | å…³é”®å­— | è¯´æ˜ |
|---------|--------|------|
| **ä¸»é”®çº¦æŸ** | `PRIMARY KEY` | å”¯ä¸€æ ‡è¯†ï¼Œéç©ºä¸”å”¯ä¸€ |
| **å¤–é”®çº¦æŸ** | `FOREIGN KEY` | å»ºç«‹è¡¨é—´å…³ç³»ï¼Œä¿è¯å¼•ç”¨å®Œæ•´æ€§ |
| **å”¯ä¸€çº¦æŸ** | `UNIQUE` | ä¿è¯æ•°æ®å”¯ä¸€ï¼Œå¯ä»¥ä¸ºNULL |
| **éç©ºçº¦æŸ** | `NOT NULL` | ä¸å…è®¸ä¸ºNULL |
| **é»˜è®¤çº¦æŸ** | `DEFAULT` | è®¾ç½®é»˜è®¤å€¼ |
| **æ£€æŸ¥çº¦æŸ** | `CHECK` | ä¿è¯å­—æ®µå€¼æ»¡è¶³æ¡ä»¶ï¼ˆMySQL 8.0.16+ï¼‰ |

### 1.3 çº¦æŸçš„ä½œç”¨

- âœ… **ä¿è¯æ•°æ®å‡†ç¡®æ€§**ï¼šé˜²æ­¢éæ³•æ•°æ®æ’å…¥
- âœ… **ç»´æŠ¤æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿æ•°æ®ç¬¦åˆä¸šåŠ¡è§„åˆ™
- âœ… **å»ºç«‹è¡¨é—´å…³ç³»**ï¼šé€šè¿‡å¤–é”®ç»´æŠ¤å…³è”
- âœ… **æé«˜æ•°æ®è´¨é‡**ï¼šåœ¨æ•°æ®åº“å±‚é¢æŠŠå…³

---

## äºŒã€ä¸»é”®çº¦æŸ

### 2.1 ä¸»é”®çš„ç‰¹ç‚¹

- ğŸ”‘ **å”¯ä¸€æ ‡è¯†**ï¼šæ¯æ¡è®°å½•çš„ä¸»é”®å€¼å¿…é¡»å”¯ä¸€
- âŒ **éç©º**ï¼šä¸»é”®å€¼ä¸èƒ½ä¸ºNULL
- ğŸ¯ **ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®**
- âš¡ **è‡ªåŠ¨åˆ›å»ºç´¢å¼•**ï¼šæé«˜æŸ¥è¯¢æ•ˆç‡

### 2.2 åˆ›å»ºä¸»é”®

#### æ–¹å¼ä¸€ï¼šåˆ›å»ºè¡¨æ—¶å®šä¹‰

```sql
-- å•å­—æ®µä¸»é”®
CREATE TABLE students (
    id INT PRIMARY KEY,
    name VARCHAR(50),
    age INT
);

-- æˆ–ä½¿ç”¨AUTO_INCREMENTè‡ªå¢
CREATE TABLE students (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50),
    age INT
);

-- åœ¨å­—æ®µåˆ—è¡¨åå®šä¹‰
CREATE TABLE students (
    id INT,
    name VARCHAR(50),
    age INT,
    PRIMARY KEY (id)
);

-- è”åˆä¸»é”®ï¼ˆå¤šä¸ªå­—æ®µç»„åˆï¼‰
CREATE TABLE student_courses (
    student_id INT,
    course_id INT,
    score DECIMAL(5,2),
    PRIMARY KEY (student_id, course_id)
);
```

#### æ–¹å¼äºŒï¼šä¿®æ”¹è¡¨æ·»åŠ ä¸»é”®

```sql
-- æ·»åŠ ä¸»é”®
ALTER TABLE students ADD PRIMARY KEY (id);

-- æ·»åŠ è‡ªå¢ä¸»é”®
ALTER TABLE students 
MODIFY id INT AUTO_INCREMENT,
ADD PRIMARY KEY (id);
```

### 2.3 åˆ é™¤ä¸»é”®

```sql
-- å…ˆåˆ é™¤è‡ªå¢å±æ€§
ALTER TABLE students MODIFY id INT;

-- å†åˆ é™¤ä¸»é”®
ALTER TABLE students DROP PRIMARY KEY;
```

### 2.4 AUTO_INCREMENTè‡ªå¢

```sql
-- åˆ›å»ºè‡ªå¢ä¸»é”®
CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    customer_name VARCHAR(50),
    order_date DATE
);

-- æ’å…¥æ•°æ®ï¼ˆè‡ªåŠ¨ç”ŸæˆIDï¼‰
INSERT INTO orders (customer_name, order_date) 
VALUES ('å¼ ä¸‰', '2024-01-01');

-- æŒ‡å®šèµ·å§‹å€¼
ALTER TABLE orders AUTO_INCREMENT = 1000;

-- æŸ¥è¯¢ä¸‹ä¸€ä¸ªè‡ªå¢å€¼
SELECT AUTO_INCREMENT 
FROM information_schema.TABLES 
WHERE TABLE_NAME = 'orders';
```

---

## ä¸‰ã€å¤–é”®çº¦æŸ

### 3.1 å¤–é”®çš„ä½œç”¨

å¤–é”®ç”¨äºå»ºç«‹ä¸¤ä¸ªè¡¨ä¹‹é—´çš„è¿æ¥ï¼Œä¿è¯æ•°æ®çš„**å¼•ç”¨å®Œæ•´æ€§**ã€‚

**ç¤ºä¾‹å…³ç³»**ï¼š
- å‘˜å·¥è¡¨ï¼ˆemployeesï¼‰ï¼šå‘˜å·¥ä¿¡æ¯
- éƒ¨é—¨è¡¨ï¼ˆdepartmentsï¼‰ï¼šéƒ¨é—¨ä¿¡æ¯
- å…³ç³»ï¼šå‘˜å·¥å±äºæŸä¸ªéƒ¨é—¨

### 3.2 åˆ›å»ºå¤–é”®

#### æ–¹å¼ä¸€ï¼šåˆ›å»ºè¡¨æ—¶å®šä¹‰

```sql
-- å…ˆåˆ›å»ºçˆ¶è¡¨ï¼ˆè¢«å¼•ç”¨çš„è¡¨ï¼‰
CREATE TABLE departments (
    dept_id INT PRIMARY KEY AUTO_INCREMENT,
    dept_name VARCHAR(50) NOT NULL
);

-- å†åˆ›å»ºå­è¡¨ï¼ˆå¼•ç”¨çš„è¡¨ï¼‰
CREATE TABLE employees (
    emp_id INT PRIMARY KEY AUTO_INCREMENT,
    emp_name VARCHAR(50) NOT NULL,
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
);
```

#### æ–¹å¼äºŒï¼šä¿®æ”¹è¡¨æ·»åŠ å¤–é”®

```sql
-- æ·»åŠ å¤–é”®çº¦æŸ
ALTER TABLE employees 
ADD CONSTRAINT fk_emp_dept 
FOREIGN KEY (dept_id) REFERENCES departments(dept_id);
```

### 3.3 å¤–é”®çš„çº§è”æ“ä½œ

| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| `CASCADE` | çº§è”æ“ä½œï¼ˆçˆ¶è¡¨åˆ é™¤/æ›´æ–°æ—¶ï¼Œå­è¡¨åŒæ­¥æ“ä½œï¼‰ |
| `SET NULL` | çˆ¶è¡¨åˆ é™¤/æ›´æ–°æ—¶ï¼Œå­è¡¨å¤–é”®è®¾ä¸ºNULL |
| `RESTRICT` | æœ‰å­è¡¨è®°å½•æ—¶ï¼Œæ‹’ç»çˆ¶è¡¨åˆ é™¤/æ›´æ–°ï¼ˆé»˜è®¤ï¼‰ |
| `NO ACTION` | åŒRESTRICT |
| `SET DEFAULT` | è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼ˆInnoDBä¸æ”¯æŒï¼‰ |

**ç¤ºä¾‹ï¼š**

```sql
CREATE TABLE employees (
    emp_id INT PRIMARY KEY AUTO_INCREMENT,
    emp_name VARCHAR(50),
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
        ON DELETE CASCADE      -- åˆ é™¤éƒ¨é—¨æ—¶ï¼Œåˆ é™¤è¯¥éƒ¨é—¨æ‰€æœ‰å‘˜å·¥
        ON UPDATE CASCADE      -- æ›´æ–°éƒ¨é—¨IDæ—¶ï¼ŒåŒæ­¥æ›´æ–°å‘˜å·¥è¡¨
);

-- æˆ–è€…è®¾ç½®ä¸ºNULL
CREATE TABLE employees (
    emp_id INT PRIMARY KEY AUTO_INCREMENT,
    emp_name VARCHAR(50),
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
        ON DELETE SET NULL     -- åˆ é™¤éƒ¨é—¨æ—¶ï¼Œå‘˜å·¥çš„dept_idè®¾ä¸ºNULL
        ON UPDATE SET NULL
);
```

### 3.4 åˆ é™¤å¤–é”®

```sql
-- åˆ é™¤å¤–é”®ï¼ˆéœ€è¦çŸ¥é“å¤–é”®åç§°ï¼‰
ALTER TABLE employees DROP FOREIGN KEY fk_emp_dept;

-- æŸ¥çœ‹å¤–é”®åç§°
SHOW CREATE TABLE employees;
```

### 3.5 å¤–é”®ä½¿ç”¨æ³¨æ„äº‹é¡¹

âš ï¸ **æ³¨æ„**ï¼š
1. å¤–é”®å­—æ®µçš„æ•°æ®ç±»å‹å¿…é¡»ä¸ä¸»è¡¨ä¸»é”®ä¸€è‡´
2. å¤–é”®å­—æ®µå¯ä»¥ä¸ºNULLï¼ˆé™¤éè®¾ç½®NOT NULLï¼‰
3. åªæœ‰InnoDBå¼•æ“æ”¯æŒå¤–é”®
4. å¤–é”®ä¼šå½±å“æ€§èƒ½ï¼Œå¤§å‹ç³»ç»Ÿå¯è€ƒè™‘åœ¨åº”ç”¨å±‚ç»´æŠ¤å…³ç³»

---

## å››ã€å”¯ä¸€çº¦æŸ

### 4.1 å”¯ä¸€çº¦æŸçš„ç‰¹ç‚¹

- âœ… ä¿è¯å­—æ®µå€¼å”¯ä¸€
- âœ… å¯ä»¥ä¸ºNULLï¼ˆNULLä¸å‚ä¸å”¯ä¸€æ€§æ£€æŸ¥ï¼‰
- âœ… ä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€çº¦æŸ
- âš¡ è‡ªåŠ¨åˆ›å»ºå”¯ä¸€ç´¢å¼•

### 4.2 åˆ›å»ºå”¯ä¸€çº¦æŸ

```sql
-- æ–¹å¼ä¸€ï¼šåˆ›å»ºè¡¨æ—¶å®šä¹‰
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL UNIQUE,      -- å”¯ä¸€çº¦æŸ
    email VARCHAR(100) UNIQUE,                 -- å”¯ä¸€çº¦æŸ
    phone VARCHAR(20),
    UNIQUE (phone)                             -- æˆ–åœ¨åé¢å®šä¹‰
);

-- è”åˆå”¯ä¸€çº¦æŸ
CREATE TABLE user_roles (
    user_id INT,
    role_id INT,
    UNIQUE (user_id, role_id)  -- ç»„åˆå¿…é¡»å”¯ä¸€
);

-- æ–¹å¼äºŒï¼šä¿®æ”¹è¡¨æ·»åŠ 
ALTER TABLE users ADD UNIQUE (email);

-- æŒ‡å®šçº¦æŸå
ALTER TABLE users 
ADD CONSTRAINT uk_email UNIQUE (email);
```

### 4.3 åˆ é™¤å”¯ä¸€çº¦æŸ

```sql
-- åˆ é™¤å”¯ä¸€çº¦æŸï¼ˆé€šè¿‡ç´¢å¼•åï¼‰
ALTER TABLE users DROP INDEX email;

-- åˆ é™¤å‘½åçš„çº¦æŸ
ALTER TABLE users DROP INDEX uk_email;
```

### 4.4 ä¸»é”® vs å”¯ä¸€çº¦æŸ

| ç‰¹æ€§ | ä¸»é”® PRIMARY KEY | å”¯ä¸€çº¦æŸ UNIQUE |
|------|-----------------|----------------|
| å”¯ä¸€æ€§ | âœ… | âœ… |
| å¯ä¸ºNULL | âŒ | âœ… |
| æ•°é‡é™åˆ¶ | ä¸€å¼ è¡¨åªèƒ½ä¸€ä¸ª | å¯ä»¥æœ‰å¤šä¸ª |
| è‡ªåŠ¨åˆ›å»ºç´¢å¼• | âœ… | âœ… |

---

## äº”ã€éç©ºçº¦æŸ

### 5.1 éç©ºçº¦æŸçš„ä½œç”¨

- âŒ ä¸å…è®¸å­—æ®µå€¼ä¸ºNULL
- âœ… ä¿è¯æ•°æ®å®Œæ•´æ€§

### 5.2 åˆ›å»ºéç©ºçº¦æŸ

```sql
-- åˆ›å»ºè¡¨æ—¶å®šä¹‰
CREATE TABLE employees (
    id INT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,        -- éç©º
    email VARCHAR(100) NOT NULL,      -- éç©º
    phone VARCHAR(20)                 -- å¯ä¸ºç©º
);

-- ä¿®æ”¹è¡¨æ·»åŠ éç©ºçº¦æŸ
ALTER TABLE employees MODIFY phone VARCHAR(20) NOT NULL;
```

### 5.3 åˆ é™¤éç©ºçº¦æŸ

```sql
-- ä¿®æ”¹å­—æ®µä¸ºå…è®¸NULL
ALTER TABLE employees MODIFY phone VARCHAR(20) NULL;
```

---

## å…­ã€é»˜è®¤çº¦æŸ

### 6.1 é»˜è®¤çº¦æŸçš„ä½œç”¨

å½“æ’å…¥æ•°æ®æ—¶æœªæŒ‡å®šå­—æ®µå€¼ï¼Œè‡ªåŠ¨ä½¿ç”¨é»˜è®¤å€¼ã€‚

### 6.2 åˆ›å»ºé»˜è®¤çº¦æŸ

```sql
-- åˆ›å»ºè¡¨æ—¶å®šä¹‰
CREATE TABLE articles (
    id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    view_count INT DEFAULT 0,              -- é»˜è®¤ä¸º0
    status TINYINT DEFAULT 1,              -- é»˜è®¤ä¸º1
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,          -- é»˜è®¤å½“å‰æ—¶é—´
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP 
               ON UPDATE CURRENT_TIMESTAMP                   -- è‡ªåŠ¨æ›´æ–°
);

-- ä¿®æ”¹è¡¨æ·»åŠ é»˜è®¤å€¼
ALTER TABLE articles 
ALTER COLUMN status SET DEFAULT 1;
```

### 6.3 åˆ é™¤é»˜è®¤çº¦æŸ

```sql
ALTER TABLE articles 
ALTER COLUMN status DROP DEFAULT;
```

### 6.4 å¸¸ç”¨é»˜è®¤å€¼

```sql
-- æ•°å€¼é»˜è®¤å€¼
price DECIMAL(10,2) DEFAULT 0.00

-- å­—ç¬¦ä¸²é»˜è®¤å€¼
gender CHAR(1) DEFAULT 'ç”·'
status VARCHAR(20) DEFAULT 'active'

-- æ—¥æœŸæ—¶é—´é»˜è®¤å€¼
created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP

-- å¸ƒå°”é»˜è®¤å€¼ï¼ˆTINYINTï¼‰
is_deleted TINYINT DEFAULT 0
```

---

## ä¸ƒã€æ£€æŸ¥çº¦æŸ

### 7.1 æ£€æŸ¥çº¦æŸçš„ä½œç”¨

æ£€æŸ¥çº¦æŸç”¨äºé™åˆ¶å­—æ®µå€¼å¿…é¡»æ»¡è¶³æŒ‡å®šæ¡ä»¶ï¼ˆMySQL 8.0.16+æ”¯æŒï¼‰ã€‚

### 7.2 åˆ›å»ºæ£€æŸ¥çº¦æŸ

```sql
-- åˆ›å»ºè¡¨æ—¶å®šä¹‰
CREATE TABLE employees (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(50) NOT NULL,
    age INT CHECK (age >= 18 AND age <= 65),              -- å¹´é¾„èŒƒå›´
    salary DECIMAL(10,2) CHECK (salary > 0),              -- è–ªèµ„å¤§äº0
    gender CHAR(1) CHECK (gender IN ('ç”·', 'å¥³')),        -- æ€§åˆ«é™åˆ¶
    email VARCHAR(100),
    CONSTRAINT chk_email CHECK (email LIKE '%@%.%')       -- é‚®ç®±æ ¼å¼
);

-- ä¿®æ”¹è¡¨æ·»åŠ æ£€æŸ¥çº¦æŸ
ALTER TABLE employees 
ADD CONSTRAINT chk_age CHECK (age BETWEEN 18 AND 65);
```

### 7.3 åˆ é™¤æ£€æŸ¥çº¦æŸ

```sql
ALTER TABLE employees DROP CHECK chk_age;
```

### 7.4 å¸¸ç”¨æ£€æŸ¥çº¦æŸç¤ºä¾‹

```sql
-- èŒƒå›´æ£€æŸ¥
age INT CHECK (age >= 0 AND age <= 150)
score DECIMAL(5,2) CHECK (score >= 0 AND score <= 100)

-- æšä¸¾æ£€æŸ¥
status VARCHAR(20) CHECK (status IN ('active', 'inactive', 'banned'))
level TINYINT CHECK (level IN (1, 2, 3, 4, 5))

-- æ ¼å¼æ£€æŸ¥
phone VARCHAR(20) CHECK (phone REGEXP '^1[3-9][0-9]{9}$')
email VARCHAR(100) CHECK (email LIKE '%@%.%')

-- é€»è¾‘æ£€æŸ¥
start_date DATE,
end_date DATE,
CHECK (end_date > start_date)
```

---

## å…«ã€ç»¼åˆåº”ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šå®Œæ•´çš„ç”¨æˆ·è¡¨

```sql
CREATE TABLE users (
    -- ä¸»é”®çº¦æŸ + è‡ªå¢
    user_id INT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
    
    -- éç©º + å”¯ä¸€çº¦æŸ
    username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·å',
    
    -- éç©ºçº¦æŸ
    password VARCHAR(100) NOT NULL COMMENT 'å¯†ç ',
    
    -- å”¯ä¸€çº¦æŸ + æ£€æŸ¥çº¦æŸ
    email VARCHAR(100) UNIQUE 
        CHECK (email LIKE '%@%.%') COMMENT 'é‚®ç®±',
    
    -- å”¯ä¸€çº¦æŸ + æ£€æŸ¥çº¦æŸ
    phone VARCHAR(20) UNIQUE 
        CHECK (phone REGEXP '^1[3-9][0-9]{9}$') COMMENT 'æ‰‹æœºå·',
    
    -- æ£€æŸ¥çº¦æŸ
    age INT CHECK (age >= 18 AND age <= 120) COMMENT 'å¹´é¾„',
    
    -- æ£€æŸ¥çº¦æŸï¼ˆæšä¸¾ï¼‰
    gender CHAR(1) DEFAULT 'ç”·' 
        CHECK (gender IN ('ç”·', 'å¥³')) COMMENT 'æ€§åˆ«',
    
    -- é»˜è®¤çº¦æŸ
    status TINYINT DEFAULT 1 
        CHECK (status IN (0, 1)) COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨',
    
    -- é»˜è®¤çº¦æŸï¼ˆæ—¶é—´æˆ³ï¼‰
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP 
               ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
) COMMENT 'ç”¨æˆ·è¡¨';
```

### æ¡ˆä¾‹2ï¼šè®¢å•å’Œè®¢å•è¯¦æƒ…ï¼ˆå¤–é”®ï¼‰

```sql
-- è®¢å•è¡¨
CREATE TABLE orders (
    order_id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    order_no VARCHAR(50) NOT NULL UNIQUE,
    total_amount DECIMAL(10,2) NOT NULL CHECK (total_amount >= 0),
    status TINYINT DEFAULT 1 CHECK (status IN (1,2,3,4,5)),
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) 
        ON DELETE RESTRICT 
        ON UPDATE CASCADE
) COMMENT 'è®¢å•è¡¨';

-- è®¢å•è¯¦æƒ…è¡¨
CREATE TABLE order_items (
    item_id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT NOT NULL CHECK (quantity > 0),
    price DECIMAL(10,2) NOT NULL CHECK (price >= 0),
    subtotal DECIMAL(10,2) NOT NULL CHECK (subtotal >= 0),
    FOREIGN KEY (order_id) REFERENCES orders(order_id) 
        ON DELETE CASCADE 
        ON UPDATE CASCADE
) COMMENT 'è®¢å•è¯¦æƒ…è¡¨';
```

### æ¡ˆä¾‹3ï¼šå­¦ç”Ÿé€‰è¯¾ç³»ç»Ÿ

```sql
-- å­¦ç”Ÿè¡¨
CREATE TABLE students (
    student_id INT PRIMARY KEY AUTO_INCREMENT,
    student_no VARCHAR(20) NOT NULL UNIQUE,
    name VARCHAR(50) NOT NULL,
    gender CHAR(1) CHECK (gender IN ('ç”·', 'å¥³')),
    birth_date DATE,
    major VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- è¯¾ç¨‹è¡¨
CREATE TABLE courses (
    course_id INT PRIMARY KEY AUTO_INCREMENT,
    course_no VARCHAR(20) NOT NULL UNIQUE,
    course_name VARCHAR(100) NOT NULL,
    credits DECIMAL(3,1) CHECK (credits > 0),
    max_students INT CHECK (max_students > 0)
);

-- é€‰è¯¾è¡¨ï¼ˆè”åˆä¸»é”® + å¤–é”®ï¼‰
CREATE TABLE enrollments (
    student_id INT,
    course_id INT,
    score DECIMAL(5,2) CHECK (score >= 0 AND score <= 100),
    enroll_date DATE NOT NULL,
    PRIMARY KEY (student_id, course_id),
    FOREIGN KEY (student_id) REFERENCES students(student_id) 
        ON DELETE CASCADE,
    FOREIGN KEY (course_id) REFERENCES courses(course_id) 
        ON DELETE CASCADE
);
```

---

## ä¹ã€æœ¬ç« æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **ä¸»é”®çº¦æŸ**ï¼šå”¯ä¸€æ ‡è¯†ï¼Œéç©ºä¸”å”¯ä¸€ï¼Œä¸€è¡¨ä¸€ä¸ª
2. **å¤–é”®çº¦æŸ**ï¼šç»´æŠ¤è¡¨é—´å…³ç³»ï¼Œä¿è¯å¼•ç”¨å®Œæ•´æ€§
3. **å”¯ä¸€çº¦æŸ**ï¼šä¿è¯æ•°æ®å”¯ä¸€ï¼Œå¯ä»¥ä¸ºNULL
4. **éç©ºçº¦æŸ**ï¼šå­—æ®µå€¼ä¸èƒ½ä¸ºNULL
5. **é»˜è®¤çº¦æŸ**ï¼šæœªæŒ‡å®šå€¼æ—¶ä½¿ç”¨é»˜è®¤å€¼
6. **æ£€æŸ¥çº¦æŸ**ï¼šé™åˆ¶å­—æ®µå€¼æ»¡è¶³æ¡ä»¶

### çº¦æŸä½¿ç”¨å»ºè®®

- âœ… åˆç†ä½¿ç”¨çº¦æŸä¿è¯æ•°æ®è´¨é‡
- âœ… ä¸»é”®å°½é‡ä½¿ç”¨è‡ªå¢æ•´æ•°
- âœ… å¤–é”®è°¨æ…ä½¿ç”¨ï¼Œæ³¨æ„æ€§èƒ½å½±å“
- âœ… å”¯ä¸€çº¦æŸç”¨äºä¿è¯ä¸šåŠ¡å”¯ä¸€æ€§
- âœ… é‡è¦å­—æ®µæ·»åŠ éç©ºçº¦æŸ
- âœ… æ£€æŸ¥çº¦æŸå‡è½»åº”ç”¨å±‚è´Ÿæ‹…

---

## ç»ƒä¹ é¢˜

```sql
-- 1. åˆ›å»ºå‘˜å·¥è¡¨ï¼ŒåŒ…å«å„ç§çº¦æŸ
CREATE TABLE employees (
    emp_id INT PRIMARY KEY AUTO_INCREMENT,
    emp_no VARCHAR(20) NOT NULL UNIQUE,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE CHECK (email LIKE '%@%.%'),
    age INT CHECK (age >= 18 AND age <= 65),
    salary DECIMAL(10,2) CHECK (salary > 0),
    dept_id INT,
    status TINYINT DEFAULT 1 CHECK (status IN (0, 1)),
    FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
);

-- 2. æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO employees (emp_no, name, email, age, salary, dept_id) 
VALUES ('E001', 'å¼ ä¸‰', 'zhangsan@example.com', 28, 8000, 1);

-- 3. å°è¯•æ’å…¥è¿åçº¦æŸçš„æ•°æ®ï¼ˆä¼šå¤±è´¥ï¼‰
INSERT INTO employees (emp_no, name, age) 
VALUES ('E001', 'æå››', 17);  -- è¿åå”¯ä¸€çº¦æŸå’Œå¹´é¾„æ£€æŸ¥
```

---

**ä¸‹ä¸€ç« ï¼š[ç¬¬05ç«  - å¤šè¡¨æŸ¥è¯¢ä¸è¿æ¥](05-å¤šè¡¨æŸ¥è¯¢ä¸è¿æ¥.md)** â†’
