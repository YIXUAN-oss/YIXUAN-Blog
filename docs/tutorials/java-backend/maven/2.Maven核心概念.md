---
title: Maven核心概念
---

# Maven核心概念

## 一、Maven 坐标详解

### 1.1 坐标的概念

Maven 坐标（Coordinates）是 Maven 中用于唯一标识一个项目或依赖的标识符，类似于现实世界中的"地址"。

**Maven 坐标由以下要素组成（GAV）：**

```xml
<groupId>com.example</groupId>      <!-- G: Group ID -->
<artifactId>my-app</artifactId>     <!-- A: Artifact ID -->
<version>1.0.0</version>            <!-- V: Version -->
<packaging>jar</packaging>          <!-- 可选：打包方式 -->
<classifier>sources</classifier>    <!-- 可选：分类器 -->
```

### 1.2 坐标要素详解

#### groupId（组织标识）

**作用：** 定义项目所属的组织或公司。

**命名规范：**
- 通常使用公司/组织的域名反写
- 使用小写字母
- 用点号（.）分隔

**示例：**
```xml
<groupId>com.alibaba</groupId>       <!-- 阿里巴巴 -->
<groupId>org.springframework</groupId> <!-- Spring 框架 -->
<groupId>org.apache.commons</groupId>  <!-- Apache Commons -->
<groupId>com.example</groupId>       <!-- 示例项目 -->
```

#### artifactId（项目标识）

**作用：** 定义项目的名称。

**命名规范：**
- 使用小写字母
- 多个单词用连字符（-）分隔
- 项目名称应简洁明了

**示例：**
```xml
<artifactId>spring-boot</artifactId>
<artifactId>mybatis-plus</artifactId>
<artifactId>user-service</artifactId>
<artifactId>common-utils</artifactId>
```

#### version（版本号）

**作用：** 定义项目的版本。

**版本号格式：** `主版本.次版本.修订号[-限定符]`

```xml
<!-- 开发版本 -->
<version>1.0.0-SNAPSHOT</version>

<!-- 正式版本 -->
<version>1.0.0</version>
<version>2.1.5</version>

<!-- 里程碑版本 -->
<version>1.0.0-M1</version>

<!-- 候选版本 -->
<version>1.0.0-RC1</version>

<!-- Alpha/Beta 版本 -->
<version>1.0.0-ALPHA</version>
<version>1.0.0-BETA</version>
```

**版本号含义：**
- **主版本号：** 重大功能变更或不兼容的 API 修改
- **次版本号：** 向下兼容的功能性新增
- **修订号：** 向下兼容的问题修正
- **SNAPSHOT：** 快照版本，开发中的不稳定版本

#### packaging（打包方式）

**作用：** 定义项目的打包类型。

**常见值：**
```xml
<packaging>jar</packaging>      <!-- Java 应用（默认） -->
<packaging>war</packaging>      <!-- Web 应用 -->
<packaging>pom</packaging>      <!-- 父项目/聚合项目 -->
<packaging>maven-plugin</packaging> <!-- Maven 插件 -->
```

### 1.3 坐标在仓库中的位置

Maven 根据坐标来确定依赖在仓库中的位置：

```
仓库路径规则：
groupId/artifactId/version/artifactId-version.packaging

示例：
com/example/my-app/1.0.0/my-app-1.0.0.jar

完整路径：
~/.m2/repository/com/example/my-app/1.0.0/my-app-1.0.0.jar
```

---

## 二、依赖管理

### 2.1 添加依赖

在 `pom.xml` 的 `<dependencies>` 标签中添加依赖：

```xml
<dependencies>
    <!-- MySQL 驱动 -->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>8.0.28</version>
    </dependency>
    
    <!-- Lombok -->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
        <version>1.18.24</version>
        <scope>provided</scope>
    </dependency>
    
    <!-- JUnit -->
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.13.2</version>
        <scope>test</scope>
    </dependency>
</dependencies>
```

### 2.2 查找依赖坐标

**方式1：Maven 中央仓库**
- 访问：https://mvnrepository.com/
- 搜索依赖名称
- 选择版本，复制 Maven 坐标

**方式2：IDE 插件**
- IDEA：使用 Maven Helper 插件
- 直接搜索并添加依赖

### 2.3 依赖范围（Scope）

依赖范围用于控制依赖在不同阶段的可见性。

#### 2.3.1 依赖范围类型

| Scope | 编译 | 测试 | 运行 | 打包 | 说明 |
|-------|-----|------|------|-----|------|
| **compile** | ✅ | ✅ | ✅ | ✅ | 默认范围，全程可用 |
| **test** | ❌ | ✅ | ❌ | ❌ | 仅测试使用 |
| **provided** | ✅ | ✅ | ❌ | ❌ | 运行时由容器提供 |
| **runtime** | ❌ | ✅ | ✅ | ✅ | 运行时需要 |
| **system** | ✅ | ✅ | ❌ | ❌ | 本地系统依赖 |
| **import** | - | - | - | - | 导入依赖管理 |

#### 2.3.2 Scope 详细说明

**compile（默认）**
```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-core</artifactId>
    <version>5.3.20</version>
    <scope>compile</scope> <!-- 可省略 -->
</dependency>
```
- 适用于项目的核心依赖
- 会被打包到最终的产物中

**test**
```xml
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.13.2</version>
    <scope>test</scope>
</dependency>
```
- 仅在测试代码中可用
- 不会被打包到最终产物

**provided**
```xml
<dependency>
    <groupId>javax.servlet</groupId>
    <artifactId>javax.servlet-api</artifactId>
    <version>4.0.1</version>
    <scope>provided</scope>
</dependency>
```
- 编译和测试时可用
- 运行时由容器（如 Tomcat）提供
- 不会被打包到 WAR 文件

**runtime**
```xml
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
    <version>8.0.28</version>
    <scope>runtime</scope>
</dependency>
```
- 运行和测试时需要
- 编译时不需要（如 JDBC 驱动）

**system（不推荐）**
```xml
<dependency>
    <groupId>com.example</groupId>
    <artifactId>custom-lib</artifactId>
    <version>1.0</version>
    <scope>system</scope>
    <systemPath>${project.basedir}/lib/custom-lib.jar</systemPath>
</dependency>
```
- 指定本地 jar 包
- 不推荐使用，建议安装到本地仓库

### 2.4 依赖传递

#### 2.4.1 什么是依赖传递

当项目依赖 A，而 A 又依赖 B 时，B 会被传递到项目中。

```
我的项目
  └── 依赖 Spring Core
       └── 依赖 Spring JCL
            └── 依赖 Commons Logging

结果：我的项目自动包含了 Spring JCL 和 Commons Logging
```

#### 2.4.2 查看依赖树

```bash
# 查看完整依赖树
mvn dependency:tree

# 输出示例：
[INFO] com.example:my-app:jar:1.0-SNAPSHOT
[INFO] +- org.springframework:spring-core:jar:5.3.20:compile
[INFO] |  \- org.springframework:spring-jcl:jar:5.3.20:compile
[INFO] \- junit:junit:jar:4.13.2:test
[INFO]    \- org.hamcrest:hamcrest-core:jar:1.3:test
```

#### 2.4.3 传递依赖的范围规则

| 直接依赖 | 传递依赖 | 最终范围 |
|---------|---------|---------|
| compile | compile | compile |
| compile | runtime | runtime |
| compile | provided | provided |
| compile | test | - |
| test | 任意 | - |
| provided | 任意 | provided |
| runtime | compile | runtime |
| runtime | runtime | runtime |

### 2.5 依赖冲突解决

#### 2.5.1 依赖冲突的原因

同一个依赖的不同版本被引入到项目中。

```
我的项目
  ├── 依赖 A → 依赖 C 1.0
  └── 依赖 B → 依赖 C 2.0

冲突：C 应该用哪个版本？
```

#### 2.5.2 Maven 依赖调解原则

**原则1：路径最短者优先**
```
项目 → A → B → C 2.0  (路径长度: 3)
项目 → D → C 1.0      (路径长度: 2)

结果：使用 C 1.0
```

**原则2：路径相同时，先声明者优先**
```xml
<dependencies>
    <dependency>A → C 1.0</dependency>  <!-- 先声明 -->
    <dependency>B → C 2.0</dependency>
</dependencies>

结果：使用 C 1.0
```

#### 2.5.3 排除依赖

使用 `<exclusions>` 排除传递依赖：

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
    <version>2.7.0</version>
    <exclusions>
        <!-- 排除默认的 Tomcat -->
        <exclusion>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-tomcat</artifactId>
        </exclusion>
    </exclusions>
</dependency>

<!-- 使用 Jetty 替代 -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jetty</artifactId>
    <version>2.7.0</version>
</dependency>
```

#### 2.5.4 锁定版本

使用 `<dependencyManagement>` 统一管理版本：

```xml
<dependencyManagement>
    <dependencies>
        <!-- 锁定 Spring 版本 -->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <version>5.3.20</version>
        </dependency>
    </dependencies>
</dependencyManagement>

<dependencies>
    <!-- 子项目中可以不指定版本 -->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-core</artifactId>
    </dependency>
</dependencies>
```

#### 2.5.5 使用 BOM 统一版本

```xml
<dependencyManagement>
    <dependencies>
        <!-- Spring Boot BOM -->
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-dependencies</artifactId>
            <version>2.7.0</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

---

## 三、Maven 生命周期

### 3.1 生命周期概述

Maven 有三个独立的生命周期，每个生命周期包含多个阶段（Phase）。

```
三大生命周期：
1. clean 生命周期 - 清理项目
2. default 生命周期 - 构建项目
3. site 生命周期 - 生成项目站点
```

### 3.2 Clean 生命周期

```
clean 生命周期的阶段：
1. pre-clean   → 执行清理前的工作
2. clean       → 清理上一次构建生成的文件
3. post-clean  → 执行清理后的工作
```

**常用命令：**
```bash
mvn clean      # 清理 target 目录
```

### 3.3 Default 生命周期（核心）

Default 生命周期包含 23 个阶段，常用的有：

```
default 生命周期的主要阶段：
1. validate      → 验证项目是否正确
2. compile       → 编译源代码
3. test          → 运行单元测试
4. package       → 打包编译后的代码
5. verify        → 运行检查以验证包是否有效
6. install       → 安装包到本地仓库
7. deploy        → 部署到远程仓库
```

**完整的 Default 生命周期阶段：**
```
validate
initialize
generate-sources
process-sources
generate-resources
process-resources
compile              ← 编译
process-classes
generate-test-sources
process-test-sources
generate-test-resources
process-test-resources
test-compile
process-test-classes
test                 ← 测试
prepare-package
package              ← 打包
pre-integration-test
integration-test
post-integration-test
verify
install              ← 安装到本地仓库
deploy               ← 部署到远程仓库
```

### 3.4 Site 生命周期

```
site 生命周期的阶段：
1. pre-site    → 执行生成站点前的工作
2. site        → 生成项目站点文档
3. post-site   → 执行生成站点后的工作
4. site-deploy → 部署站点到服务器
```

**常用命令：**
```bash
mvn site       # 生成项目站点
```

### 3.5 生命周期执行规则

**规则：** 执行某个阶段时，会自动执行该阶段之前的所有阶段。

**示例：**
```bash
# 执行 package
mvn package

# 实际执行顺序：
validate → compile → test → package
```

```bash
# 执行 install
mvn install

# 实际执行顺序：
validate → compile → test → package → verify → install
```

### 3.6 常用命令组合

```bash
# 清理并编译
mvn clean compile

# 清理并打包
mvn clean package

# 清理、打包并安装到本地仓库
mvn clean install

# 跳过测试打包
mvn clean package -DskipTests

# 跳过测试编译和运行
mvn clean package -Dmaven.test.skip=true

# 强制更新依赖
mvn clean install -U
```

---

## 四、Maven 插件机制

### 4.1 插件的概念

Maven 本身只是一个框架，实际的构建任务都是由**插件（Plugin）**完成的。

**插件与生命周期的关系：**
```
生命周期阶段 → 绑定 → 插件目标

例如：
compile 阶段 → 绑定 → maven-compiler-plugin:compile 目标
test 阶段    → 绑定 → maven-surefire-plugin:test 目标
package 阶段 → 绑定 → maven-jar-plugin:jar 目标
```

### 4.2 内置绑定

Maven 为各个生命周期阶段绑定了默认插件：

| 生命周期阶段 | 插件目标 | 功能 |
|------------|---------|------|
| process-resources | maven-resources-plugin:resources | 复制资源文件 |
| compile | maven-compiler-plugin:compile | 编译源代码 |
| process-test-resources | maven-resources-plugin:testResources | 复制测试资源 |
| test-compile | maven-compiler-plugin:testCompile | 编译测试代码 |
| test | maven-surefire-plugin:test | 运行单元测试 |
| package (jar) | maven-jar-plugin:jar | 打包为 jar |
| package (war) | maven-war-plugin:war | 打包为 war |
| install | maven-install-plugin:install | 安装到本地仓库 |
| deploy | maven-deploy-plugin:deploy | 部署到远程仓库 |

### 4.3 配置插件

在 `pom.xml` 中配置插件：

```xml
<build>
    <plugins>
        <!-- 编译插件 -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>3.8.1</version>
            <configuration>
                <source>1.8</source>
                <target>1.8</target>
                <encoding>UTF-8</encoding>
            </configuration>
        </plugin>
        
        <!-- 打包插件 -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-jar-plugin</artifactId>
            <version>3.2.0</version>
            <configuration>
                <archive>
                    <manifest>
                        <mainClass>com.example.App</mainClass>
                    </manifest>
                </archive>
            </configuration>
        </plugin>
    </plugins>
</build>
```

### 4.4 常用插件

#### maven-compiler-plugin（编译插件）

```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-compiler-plugin</artifactId>
    <version>3.8.1</version>
    <configuration>
        <source>1.8</source>
        <target>1.8</target>
        <encoding>UTF-8</encoding>
    </configuration>
</plugin>
```

#### maven-surefire-plugin（测试插件）

```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-surefire-plugin</artifactId>
    <version>2.22.2</version>
    <configuration>
        <!-- 跳过测试 -->
        <skipTests>false</skipTests>
        <!-- 包含的测试类 -->
        <includes>
            <include>**/*Test.java</include>
        </includes>
    </configuration>
</plugin>
```

#### maven-resources-plugin（资源插件）

```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-resources-plugin</artifactId>
    <version>3.2.0</version>
    <configuration>
        <encoding>UTF-8</encoding>
    </configuration>
</plugin>
```

---

## 五、依赖管理最佳实践

### 5.1 使用属性统一版本

```xml
<properties>
    <spring.version>5.3.20</spring.version>
    <mysql.version>8.0.28</mysql.version>
</properties>

<dependencies>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-core</artifactId>
        <version>${spring.version}</version>
    </dependency>
    
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>${mysql.version}</version>
    </dependency>
</dependencies>
```

### 5.2 使用 dependencyManagement 管理版本

```xml
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <version>5.3.20</version>
        </dependency>
    </dependencies>
</dependencyManagement>

<dependencies>
    <!-- 继承版本号，无需指定 version -->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-core</artifactId>
    </dependency>
</dependencies>
```

### 5.3 定期检查依赖更新

```bash
# 检查依赖更新
mvn versions:display-dependency-updates

# 检查插件更新
mvn versions:display-plugin-updates
```

---

## 六、总结

✅ **本章学习内容：**
- Maven 坐标（GAV）详解
- 依赖管理和依赖范围
- 依赖传递和冲突解决
- Maven 生命周期
- Maven 插件机制

✅ **核心要点：**
- 理解 Maven 坐标的组成和作用
- 掌握依赖范围（scope）的使用
- 学会解决依赖冲突
- 熟悉 Maven 生命周期和常用命令
- 了解插件与生命周期的绑定关系

**下一章预告：** 我们将进行 Maven 实战应用，构建 Web 项目和多模块项目。
