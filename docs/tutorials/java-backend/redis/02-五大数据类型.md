---
title: Redis五大数据类型
---

# 02 - Redis五大数据类型

## 🎯 学习目标

- 深入理解Redis五大基本数据类型
- 掌握每种类型的常用命令
- 了解各数据类型的应用场景
- 理解底层数据结构

## 📊 数据类型概览

| 类型 | 说明 | 典型应用 |
|------|------|----------|
| String | 字符串 | 缓存、计数器、分布式锁 |
| List | 列表 | 消息队列、文章列表、评论列表 |
| Set | 集合 | 标签、好友关系、抽奖 |
| Hash | 哈希表 | 对象存储、购物车 |
| Zset | 有序集合 | 排行榜、延时队列 |

## 1️⃣ String（字符串）

### 特点
- 最基本的数据类型
- 二进制安全，可以存储任何数据
- 单个value最大512MB

### 常用命令

#### 基本操作
```bash
# 设置值
SET key value [EX seconds] [PX milliseconds] [NX|XX]
SET name "Redis"
SET session:abc123 "user_data" EX 3600  # 设置过期时间

# 获取值
GET key
GET name

# 设置并返回旧值
GETSET key value
GETSET name "New Redis"

# 仅当key不存在时设置
SETNX key value
SETNX lock "1"  # 分布式锁

# 批量设置
MSET key1 value1 key2 value2
MSET user:1:name "John" user:1:age "30"

# 批量获取
MGET key1 key2
MGET user:1:name user:1:age

# 删除
DEL key
```

#### 数值操作
```bash
# 初始化计数器
SET counter 0

# 自增1
INCR counter

# 自减1
DECR counter

# 增加指定值
INCRBY counter 10

# 减少指定值
DECRBY counter 5

# 浮点数增加
INCRBYFLOAT price 0.5
```

#### 字符串操作
```bash
# 追加字符串
APPEND key value
APPEND message " World"

# 获取字符串长度
STRLEN key

# 获取子字符串
GETRANGE key start end
GETRANGE message 0 4

# 设置子字符串
SETRANGE key offset value

# 设置过期时间
EXPIRE key seconds
EXPIRE session:abc 3600

# 查看剩余时间
TTL key
```

### 应用场景

#### 1. 缓存对象
```bash
# 缓存用户信息（JSON字符串）
SET user:1001 '{"id":1001,"name":"John","email":"john@example.com"}' EX 1800

# 获取用户信息
GET user:1001
```

#### 2. 计数器
```bash
# 文章阅读量
INCR article:100:views

# 点赞数
INCR post:200:likes

# 获取统计
GET article:100:views
```

#### 3. 分布式锁
```bash
# 获取锁（30秒过期）
SET lock:order:1001 "uuid123" EX 30 NX

# 释放锁
DEL lock:order:1001
```

#### 4. 限流
```bash
# 用户每分钟最多10次请求
SET rate:user:1001 1 EX 60
INCR rate:user:1001
GET rate:user:1001  # 检查是否超过10
```

## 2️⃣ List（列表）

### 特点
- 有序的字符串列表
- 底层是双向链表
- 支持头部和尾部操作
- 最多2^32-1个元素

### 常用命令

```bash
# 左侧插入（头部）
LPUSH list value1 [value2 ...]
LPUSH tasks "task1" "task2"

# 右侧插入（尾部）
RPUSH list value1 [value2 ...]
RPUSH logs "log1" "log2"

# 左侧弹出
LPOP list
LPOP tasks

# 右侧弹出
RPOP list

# 阻塞式弹出（队列为空时等待）
BLPOP list timeout
BLPOP tasks 0  # 一直等待

BRPOP list timeout
BRPOP tasks 10  # 等待10秒

# 获取列表长度
LLEN list

# 获取指定范围元素
LRANGE list start stop
LRANGE logs 0 -1    # 获取所有
LRANGE logs 0 9     # 获取前10条

# 获取指定索引元素
LINDEX list index
LINDEX logs 0

# 设置指定索引元素
LSET list index value
LSET logs 0 "new log"

# 删除元素
LREM list count value
LREM logs 2 "error"  # 删除2个"error"

# 保留指定范围
LTRIM list start stop
LTRIM logs 0 99  # 只保留前100条
```

### 应用场景

#### 1. 消息队列
```bash
# 生产者：推送任务
LPUSH queue:email "send email to user1"
LPUSH queue:email "send email to user2"

# 消费者：处理任务
BRPOP queue:email 0
```

#### 2. 最新文章列表
```bash
# 添加最新文章
LPUSH articles:latest "article:1001"
LPUSH articles:latest "article:1002"

# 保留最新100篇
LTRIM articles:latest 0 99

# 获取最新10篇
LRANGE articles:latest 0 9
```

#### 3. 评论列表
```bash
# 添加评论
RPUSH comments:article:100 "Great article!"
RPUSH comments:article:100 "Thanks for sharing!"

# 获取所有评论
LRANGE comments:article:100 0 -1

# 分页获取（每页10条）
LRANGE comments:article:100 0 9    # 第1页
LRANGE comments:article:100 10 19  # 第2页
```

## 3️⃣ Set（集合）

### 特点
- 无序的字符串集合
- 元素唯一，自动去重
- 支持集合运算（交集、并集、差集）
- 最多2^32-1个元素

### 常用命令

```bash
# 添加元素
SADD set member1 [member2 ...]
SADD tags "redis" "database" "cache"

# 删除元素
SREM set member1 [member2 ...]
SREM tags "cache"

# 获取所有元素
SMEMBERS set
SMEMBERS tags

# 判断元素是否存在
SISMEMBER set member
SISMEMBER tags "redis"

# 获取集合大小
SCARD set
SCARD tags

# 随机获取元素
SRANDMEMBER set [count]
SRANDMEMBER tags 2

# 随机弹出元素
SPOP set [count]
SPOP tags

# 移动元素到另一个集合
SMOVE source dest member
SMOVE tags1 tags2 "redis"

# 集合运算
# 交集
SINTER set1 set2
SINTER user:1:tags user:2:tags

# 并集
SUNION set1 set2
SUNION user:1:friends user:2:friends

# 差集
SDIFF set1 set2
SDIFF user:1:tags user:2:tags
```

### 应用场景

#### 1. 标签系统
```bash
# 文章标签
SADD article:100:tags "Java" "Spring" "Redis"

# 查询文章标签
SMEMBERS article:100:tags

# 查找同时有Java和Redis标签的文章
SINTER article:100:tags article:101:tags
```

#### 2. 好友关系
```bash
# 用户的好友
SADD user:1001:friends "2001" "2002" "2003"
SADD user:1002:friends "2001" "2003" "2004"

# 共同好友
SINTER user:1001:friends user:1002:friends

# 可能认识的人（朋友的朋友）
SDIFF user:1002:friends user:1001:friends
```

#### 3. 抽奖系统
```bash
# 添加参与用户
SADD lottery:2024 "user1001" "user1002" "user1003"

# 随机抽取1名中奖者
SPOP lottery:2024 1

# 随机抽取3名（不删除）
SRANDMEMBER lottery:2024 3
```

#### 4. 去重
```bash
# 记录今日访问用户（自动去重）
SADD visit:2024-01-01 "user1001"
SADD visit:2024-01-01 "user1002"
SADD visit:2024-01-01 "user1001"  # 重复添加无效

# 获取今日UV
SCARD visit:2024-01-01
```

## 4️⃣ Hash（哈希）

### 特点
- 键值对集合
- 适合存储对象
- 每个Hash可存储2^32-1个键值对

### 常用命令

```bash
# 设置单个字段
HSET hash field value
HSET user:1001 name "John"

# 设置多个字段
HMSET hash field1 value1 field2 value2
HMSET user:1001 name "John" age "30" email "john@example.com"

# 获取单个字段
HGET hash field
HGET user:1001 name

# 获取多个字段
HMGET hash field1 field2
HMGET user:1001 name age

# 获取所有字段和值
HGETALL hash
HGETALL user:1001

# 获取所有字段名
HKEYS hash

# 获取所有值
HVALS hash

# 判断字段是否存在
HEXISTS hash field
HEXISTS user:1001 email

# 删除字段
HDEL hash field1 [field2 ...]
HDEL user:1001 email

# 获取字段数量
HLEN hash

# 字段值增加
HINCRBY hash field increment
HINCRBY user:1001 age 1

# 仅当字段不存在时设置
HSETNX hash field value
```

### 应用场景

#### 1. 存储对象
```bash
# 存储用户信息
HMSET user:1001 \
  name "John Doe" \
  age "30" \
  email "john@example.com" \
  phone "1234567890"

# 获取用户信息
HGETALL user:1001

# 更新年龄
HINCRBY user:1001 age 1
```

#### 2. 购物车
```bash
# 添加商品到购物车
HSET cart:user:1001 product:2001 "2"  # 商品ID:数量
HSET cart:user:1001 product:2002 "1"

# 修改商品数量
HINCRBY cart:user:1001 product:2001 1

# 删除商品
HDEL cart:user:1001 product:2002

# 获取购物车所有商品
HGETALL cart:user:1001

# 商品数量
HLEN cart:user:1001
```

#### 3. 文章详情
```bash
# 存储文章信息
HMSET article:100 \
  title "Redis Tutorial" \
  author "John" \
  views "1000" \
  likes "50"

# 增加阅读量
HINCRBY article:100 views 1

# 增加点赞数
HINCRBY article:100 likes 1
```

## 5️⃣ Zset（有序集合）

### 特点
- 有序的字符串集合
- 每个元素关联一个分数（score）
- 按分数排序
- 元素唯一，分数可重复

### 常用命令

```bash
# 添加元素
ZADD zset score member [score member ...]
ZADD leaderboard 100 "player1" 95 "player2" 90 "player3"

# 获取元素分数
ZSCORE zset member
ZSCORE leaderboard "player1"

# 增加分数
ZINCRBY zset increment member
ZINCRBY leaderboard 10 "player1"

# 获取排名（从小到大）
ZRANK zset member

# 获取排名（从大到小）
ZREVRANK zset member
ZREVRANK leaderboard "player1"

# 获取指定范围元素（按索引）
ZRANGE zset start stop [WITHSCORES]
ZRANGE leaderboard 0 -1 WITHSCORES

# 倒序获取
ZREVRANGE zset start stop [WITHSCORES]
ZREVRANGE leaderboard 0 9 WITHSCORES  # 前10名

# 按分数范围获取
ZRANGEBYSCORE zset min max [WITHSCORES]
ZRANGEBYSCORE leaderboard 90 100 WITHSCORES

# 获取元素数量
ZCARD zset

# 删除元素
ZREM zset member1 [member2 ...]
ZREM leaderboard "player1"

# 按排名删除
ZREMRANGEBYRANK zset start stop
ZREMRANGEBYRANK leaderboard 10 -1  # 删除10名以后

# 按分数删除
ZREMRANGEBYSCORE zset min max
```

### 应用场景

#### 1. 排行榜
```bash
# 游戏排行榜
ZADD game:rank 1000 "player1"
ZADD game:rank 950 "player2"
ZADD game:rank 900 "player3"

# 增加玩家分数
ZINCRBY game:rank 50 "player1"

# 获取前10名
ZREVRANGE game:rank 0 9 WITHSCORES

# 获取某玩家排名
ZREVRANK game:rank "player1"

# 获取玩家分数
ZSCORE game:rank "player1"
```

#### 2. 延时队列
```bash
# 添加延时任务（分数为时间戳）
ZADD delay:queue 1704067200 "task1"  # 2024-01-01 00:00:00
ZADD delay:queue 1704153600 "task2"  # 2024-01-02 00:00:00

# 获取到期任务
ZRANGEBYSCORE delay:queue 0 1704067200

# 删除已处理任务
ZREM delay:queue "task1"
```

#### 3. 热搜榜
```bash
# 添加搜索词（分数为搜索次数）
ZADD hotsearch 1000 "Redis"
ZADD hotsearch 800 "MySQL"
ZADD hotsearch 600 "MongoDB"

# 搜索时增加计数
ZINCRBY hotsearch 1 "Redis"

# 获取热搜前10
ZREVRANGE hotsearch 0 9 WITHSCORES
```

#### 4. 时间线
```bash
# 添加动态（分数为时间戳）
ZADD timeline:user:1001 1704067200 "post:100"
ZADD timeline:user:1001 1704153600 "post:101"

# 获取最新动态
ZREVRANGE timeline:user:1001 0 9
```

## 📚 底层数据结构

| 数据类型 | 底层实现 |
|---------|---------|
| String | SDS（简单动态字符串） |
| List | QuickList（快速列表）|
| Set | IntSet 或 HashTable |
| Hash | ZipList 或 HashTable |
| Zset | ZipList 或 SkipList + HashTable |

## 💡 最佳实践

1. **选择合适的数据类型** - 根据业务场景选择
2. **合理设置过期时间** - 避免内存溢出
3. **避免大key** - 单个key不要超过10KB
4. **使用Pipeline** - 批量操作提高性能
5. **使用Hash存储对象** - 节省内存

---

**下一节：** [03-持久化机制](03-持久化机制.md)
