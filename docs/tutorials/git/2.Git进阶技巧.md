---
title: Git进阶技巧
---

# Git进阶技巧

## 一、高级分支操作

### 1.1 变基（Rebase）

**什么是Rebase？**

Rebase可以让提交历史更加整洁，将分支的提交"移动"到另一个分支上。

```bash
# 在feature分支上执行
git checkout feature
git rebase master

# 等同于将feature分支的提交重新应用到master最新提交之后
```

**Merge vs Rebase：**

```
# Merge方式
master:    A---B---C---F
                    /
feature:       D---E

# Rebase方式
master:    A---B---C
                    \
feature:             D'---E'
```

**交互式Rebase：**
```bash
# 修改最近3次提交
git rebase -i HEAD~3

# 在编辑器中可以：
# pick: 保留提交
# reword: 修改提交信息
# edit: 修改提交内容
# squash: 合并到上一个提交
# drop: 删除提交
```

### 1.2 Cherry-pick

选择特定的提交应用到当前分支：

```bash
# 应用某个提交
git cherry-pick <commit-id>

# 应用多个提交
git cherry-pick <commit-id1> <commit-id2>

# 应用提交但不自动提交
git cherry-pick -n <commit-id>
```

### 1.3 分支策略详解

**Git Flow完整流程：**

```bash
# 1. 初始化Git Flow
git flow init

# 2. 开始新功能
git flow feature start user-login

# 3. 完成功能
git flow feature finish user-login

# 4. 开始发布
git flow release start 1.0.0

# 5. 完成发布
git flow release finish 1.0.0

# 6. 紧急修复
git flow hotfix start critical-bug
git flow hotfix finish critical-bug
```

---

## 二、标签管理

### 2.1 创建标签

**轻量标签：**
```bash
git tag v1.0.0
```

**附注标签（推荐）：**
```bash
git tag -a v1.0.0 -m "版本1.0.0发布"
```

**为历史提交打标签：**
```bash
git tag -a v0.9.0 <commit-id> -m "版本0.9.0"
```

### 2.2 查看标签

```bash
# 查看所有标签
git tag

# 查看标签详情
git show v1.0.0

# 查看符合模式的标签
git tag -l "v1.*"
```

### 2.3 推送标签

```bash
# 推送单个标签
git push origin v1.0.0

# 推送所有标签
git push origin --tags

# 删除本地标签
git tag -d v1.0.0

# 删除远程标签
git push origin :refs/tags/v1.0.0
# 或
git push origin --delete v1.0.0
```

---

## 三、子模块（Submodule）

### 3.1 添加子模块

```bash
# 添加子模块
git submodule add https://github.com/user/library.git libs/library

# 初始化子模块
git submodule init

# 更新子模块
git submodule update
```

### 3.2 克隆包含子模块的项目

```bash
# 方式一：克隆后初始化
git clone https://github.com/user/project.git
cd project
git submodule init
git submodule update

# 方式二：克隆时自动初始化
git clone --recursive https://github.com/user/project.git
```

### 3.3 更新子模块

```bash
# 更新所有子模块
git submodule update --remote

# 更新特定子模块
git submodule update --remote libs/library
```

---

## 四、Git工作流

### 4.1 集中式工作流

适合小团队，所有人都在master分支上工作。

```bash
# 1. 克隆仓库
git clone <repository>

# 2. 修改代码
# ... 编写代码 ...

# 3. 提交
git add .
git commit -m "完成功能"

# 4. 拉取最新代码
git pull --rebase

# 5. 推送
git push
```

### 4.2 功能分支工作流

每个功能都在独立分支上开发。

```bash
# 1. 创建功能分支
git checkout -b feature/user-profile

# 2. 开发功能
git add .
git commit -m "实现用户资料页面"

# 3. 推送到远程
git push -u origin feature/user-profile

# 4. 创建Pull Request
# 在GitHub/GitLab上操作

# 5. 代码审查后合并
git checkout master
git pull
git merge feature/user-profile
```

### 4.3 Gitflow工作流

适合有计划发布周期的项目。

**分支说明：**
- `master`: 生产环境代码
- `develop`: 开发环境代码
- `feature/*`: 功能分支
- `release/*`: 发布分支
- `hotfix/*`: 紧急修复分支

**完整流程：**
```bash
# 开发新功能
git checkout develop
git checkout -b feature/shopping-cart
# ... 开发 ...
git checkout develop
git merge feature/shopping-cart

# 准备发布
git checkout -b release/1.2.0 develop
# ... 修复bug ...
git checkout master
git merge release/1.2.0
git tag -a v1.2.0
git checkout develop
git merge release/1.2.0

# 紧急修复
git checkout -b hotfix/critical-bug master
# ... 修复 ...
git checkout master
git merge hotfix/critical-bug
git tag -a v1.2.1
git checkout develop
git merge hotfix/critical-bug
```

### 4.4 Forking工作流

适合开源项目。

```bash
# 1. Fork项目到自己账号

# 2. 克隆自己的仓库
git clone https://github.com/yourname/project.git

# 3. 添加上游仓库
git remote add upstream https://github.com/original/project.git

# 4. 创建功能分支
git checkout -b feature/new-feature

# 5. 开发并提交
git add .
git commit -m "添加新功能"

# 6. 推送到自己的仓库
git push origin feature/new-feature

# 7. 创建Pull Request到原仓库

# 8. 同步上游更新
git fetch upstream
git checkout master
git merge upstream/master
```

---

## 五、高级技巧

### 5.1 Stash进阶

```bash
# 暂存包括未跟踪的文件
git stash -u

# 暂存所有文件（包括忽略的）
git stash -a

# 暂存时添加说明
git stash save "工作进行到一半"

# 查看stash内容
git stash show -p stash@{0}

# 从stash创建分支
git stash branch new-branch stash@{0}

# 清空所有stash
git stash clear
```

### 5.2 搜索和查找

```bash
# 在提交历史中搜索
git log --grep="关键词"

# 搜索代码
git grep "function_name"

# 查找引入bug的提交
git bisect start
git bisect bad                 # 当前版本有bug
git bisect good <commit-id>    # 某个版本没有bug
# Git会自动二分查找，测试后标记
git bisect good/bad
# 找到后
git bisect reset
```

### 5.3 重写历史

```bash
# 修改最近的提交
git commit --amend

# 合并多个提交
git rebase -i HEAD~3

# 拆分提交
git rebase -i HEAD~3
# 标记为edit
git reset HEAD^
git add file1
git commit -m "提交1"
git add file2
git commit -m "提交2"
git rebase --continue

# 修改作者信息
git commit --amend --author="Name <email@example.com>"
```

### 5.4 清理和维护

```bash
# 清理未跟踪的文件
git clean -n    # 预览
git clean -f    # 删除文件
git clean -fd   # 删除文件和目录

# 垃圾回收
git gc

# 优化仓库
git gc --aggressive

# 检查仓库完整性
git fsck

# 查看仓库大小
git count-objects -vH
```

---

## 六、Git Hooks

### 6.1 什么是Git Hooks？

Git Hooks是在特定事件发生时自动执行的脚本。

**常用Hooks：**
- `pre-commit`: 提交前执行
- `commit-msg`: 提交信息验证
- `pre-push`: 推送前执行
- `post-merge`: 合并后执行

### 6.2 创建Hook示例

**pre-commit（代码检查）：**
```bash
#!/bin/sh
# .git/hooks/pre-commit

# 运行代码检查
npm run lint

if [ $? -ne 0 ]; then
    echo "代码检查失败，请修复后再提交"
    exit 1
fi
```

**commit-msg（提交信息验证）：**
```bash
#!/bin/sh
# .git/hooks/commit-msg

commit_msg=$(cat $1)
pattern="^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .+"

if ! echo "$commit_msg" | grep -qE "$pattern"; then
    echo "提交信息格式错误！"
    echo "格式：<type>(<scope>): <subject>"
    exit 1
fi
```

### 6.3 使用Husky管理Hooks

```bash
# 安装husky
npm install husky --save-dev

# 初始化
npx husky install

# 添加pre-commit hook
npx husky add .husky/pre-commit "npm test"

# 添加commit-msg hook
npx husky add .husky/commit-msg 'npx --no -- commitlint --edit "$1"'
```

---

## 七、性能优化

### 7.1 大文件处理

**使用Git LFS（Large File Storage）：**

```bash
# 安装Git LFS
git lfs install

# 跟踪大文件
git lfs track "*.psd"
git lfs track "*.mp4"

# 查看跟踪的文件
git lfs ls-files

# 提交.gitattributes
git add .gitattributes
git commit -m "配置Git LFS"
```

### 7.2 浅克隆

```bash
# 只克隆最近的提交
git clone --depth 1 <repository>

# 克隆单个分支
git clone --single-branch --branch master <repository>

# 后续获取完整历史
git fetch --unshallow
```

### 7.3 稀疏检出

只检出部分文件：

```bash
git clone --filter=blob:none --sparse <repository>
cd repository
git sparse-checkout init --cone
git sparse-checkout set src/main
```

---

## 八、团队协作技巧

### 8.1 代码审查流程

```bash
# 1. 创建功能分支
git checkout -b feature/new-api

# 2. 开发并提交
git add .
git commit -m "feat(api): 添加新API接口"

# 3. 推送到远程
git push -u origin feature/new-api

# 4. 创建Pull Request
# 在GitHub/GitLab上操作

# 5. 代码审查
# 审查者在PR中评论

# 6. 修改代码
git add .
git commit -m "fix: 根据审查意见修改"
git push

# 7. 审查通过后合并
```

### 8.2 解决合并冲突

```bash
# 1. 拉取最新代码
git pull origin master

# 2. 出现冲突
# CONFLICT (content): Merge conflict in file.txt

# 3. 查看冲突文件
git status

# 4. 编辑冲突文件
<<<<<<< HEAD
当前分支的内容
=======
要合并分支的内容
>>>>>>> branch-name

# 5. 解决后标记
git add file.txt

# 6. 完成合并
git commit
```

**使用合并工具：**
```bash
# 配置合并工具
git config --global merge.tool vimdiff

# 使用工具解决冲突
git mergetool
```

### 8.3 保持分支同步

```bash
# 定期同步主分支
git checkout master
git pull origin master

# 将主分支合并到功能分支
git checkout feature-branch
git merge master

# 或使用rebase保持历史整洁
git rebase master
```

---

## 九、安全和权限

### 9.1 签名提交

```bash
# 生成GPG密钥
gpg --gen-key

# 查看密钥
gpg --list-keys

# 配置Git使用GPG
git config --global user.signingkey <key-id>

# 签名提交
git commit -S -m "签名提交"

# 默认签名所有提交
git config --global commit.gpgsign true

# 验证签名
git log --show-signature
```

### 9.2 保护敏感信息

```bash
# 使用git-secrets防止提交敏感信息
git secrets --install
git secrets --register-aws

# 扫描历史
git secrets --scan-history

# 从历史中删除敏感文件
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch path/to/secret.txt" \
  --prune-empty --tag-name-filter cat -- --all
```

**使用BFG Repo-Cleaner：**
```bash
# 删除大文件
java -jar bfg.jar --strip-blobs-bigger-than 100M repo.git

# 删除敏感文件
java -jar bfg.jar --delete-files passwords.txt repo.git

# 清理
cd repo.git
git reflog expire --expire=now --all
git gc --prune=now --aggressive
```

---

## 十、故障排查

### 10.1 常见问题

**问题1：提交到错误的分支**
```bash
# 撤销最后一次提交，保留修改
git reset --soft HEAD^

# 切换到正确的分支
git checkout correct-branch

# 重新提交
git commit -m "提交信息"
```

**问题2：需要撤销已推送的提交**
```bash
# 使用revert（推荐）
git revert <commit-id>
git push

# 使用reset（危险）
git reset --hard <commit-id>
git push -f
```

**问题3：恢复删除的分支**
```bash
# 查找分支的最后一次提交
git reflog

# 恢复分支
git checkout -b recovered-branch <commit-id>
```

**问题4：合并后想撤销**
```bash
# 如果还没推送
git reset --hard HEAD~1

# 如果已经推送
git revert -m 1 <merge-commit-id>
```

### 10.2 调试技巧

```bash
# 查看引用日志
git reflog

# 查看对象信息
git cat-file -p <object-id>

# 查看文件历史
git log --follow -- filename.txt

# 查看谁修改了某一行
git blame filename.txt

# 查看两个提交的差异
git diff commit1 commit2

# 查看分支差异
git diff master..feature
```

---

## 十一、Git配置优化

### 11.1 全局配置

```bash
# 设置默认编辑器
git config --global core.editor "code --wait"

# 设置差异工具
git config --global diff.tool vscode
git config --global difftool.vscode.cmd "code --wait --diff $LOCAL $REMOTE"

# 设置合并工具
git config --global merge.tool vscode
git config --global mergetool.vscode.cmd "code --wait $MERGED"

# 自动纠正命令
git config --global help.autocorrect 1

# 设置默认分支名
git config --global init.defaultBranch main

# 设置推送策略
git config --global push.default current

# 设置拉取策略
git config --global pull.rebase true
```

### 11.2 别名配置

```bash
# 常用别名
git config --global alias.st status
git config --global alias.co checkout
git config --global alias.br branch
git config --global alias.ci commit
git config --global alias.unstage 'reset HEAD --'
git config --global alias.last 'log -1 HEAD'
git config --global alias.visual 'log --graph --oneline --all'
git config --global alias.amend 'commit --amend --no-edit'
```

### 11.3 .gitconfig示例

```ini
[user]
    name = Your Name
    email = your.email@example.com
    signingkey = GPG_KEY_ID

[core]
    editor = code --wait
    autocrlf = input
    ignorecase = false

[color]
    ui = auto

[alias]
    st = status
    co = checkout
    br = branch
    ci = commit
    lg = log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit

[push]
    default = current
    followTags = true

[pull]
    rebase = true

[merge]
    tool = vscode
    conflictstyle = diff3

[diff]
    tool = vscode

[commit]
    gpgsign = true
```

---

## 十二、最佳实践总结

### 12.1 提交规范

✅ **DO（推荐）：**
- 频繁提交，每次提交只做一件事
- 写清晰的提交信息
- 提交前进行代码审查
- 使用规范的提交格式

❌ **DON'T（避免）：**
- 提交未测试的代码
- 提交包含多个功能的大提交
- 使用模糊的提交信息（如"fix bug"）
- 提交敏感信息

### 12.2 分支管理

✅ **DO（推荐）：**
- 使用有意义的分支名
- 及时删除已合并的分支
- 保持主分支稳定
- 定期同步远程分支

❌ **DON'T（避免）：**
- 直接在主分支上开发
- 长期不合并的功能分支
- 随意使用force push
- 忽略分支命名规范

### 12.3 团队协作

✅ **DO（推荐）：**
- 使用Pull Request进行代码审查
- 及时响应审查意见
- 保持代码风格一致
- 编写清晰的文档

❌ **DON'T（避免）：**
- 跳过代码审查直接合并
- 忽略CI/CD检查
- 不沟通就修改公共代码
- 提交未解决的冲突

---

## 总结

掌握Git进阶技巧能够：
- 🚀 提高开发效率
- 🛡️ 保证代码质量
- 🤝 促进团队协作
- 📊 优化项目管理

**持续学习建议：**
1. 深入理解Git内部原理
2. 实践各种工作流模型
3. 学习团队最佳实践
4. 关注Git新特性
5. 分享经验和技巧

记住：**工具只是手段，规范和协作才是关键！** 💪
