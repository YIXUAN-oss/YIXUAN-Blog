---
title: Git实战场景
---

# Git实战场景

## 一、日常开发场景

### 1.1 开始新的一天工作

```bash
# 1. 切换到主分支
git checkout master

# 2. 拉取最新代码
git pull origin master

# 3. 创建今天的工作分支
git checkout -b feature/user-dashboard

# 4. 开始编码
# ... 开发 ...
```

### 1.2 临时切换任务

**场景：**正在开发功能A，突然需要紧急修复bug。

```bash
# 1. 暂存当前工作
git stash save "功能A开发到一半"

# 2. 切换到主分支
git checkout master

# 3. 创建修复分支
git checkout -b hotfix/critical-bug

# 4. 修复bug
# ... 修复代码 ...
git add .
git commit -m "fix: 修复关键bug"

# 5. 合并到主分支
git checkout master
git merge hotfix/critical-bug
git push origin master

# 6. 回到原来的工作
git checkout feature/user-dashboard
git stash pop
```

### 1.3 多人协作开发同一功能

**场景：**两个人同时开发一个大功能的不同部分。

```bash
# 开发者A
git checkout -b feature/payment-system
# ... 开发支付模块 ...
git add .
git commit -m "feat: 实现支付核心逻辑"
git push origin feature/payment-system

# 开发者B
git checkout feature/payment-system
git pull origin feature/payment-system
# ... 开发支付UI ...
git add .
git commit -m "feat: 实现支付界面"
git push origin feature/payment-system

# 定期同步主分支
git checkout master
git pull origin master
git checkout feature/payment-system
git merge master
# 解决冲突（如果有）
git push origin feature/payment-system
```

### 1.4 代码审查流程

```bash
# 1. 推送功能分支
git push -u origin feature/new-feature

# 2. 在GitHub/GitLab创建Pull Request

# 3. 审查者提出修改意见后
git checkout feature/new-feature
# ... 修改代码 ...
git add .
git commit -m "refactor: 根据审查意见优化代码"
git push origin feature/new-feature

# 4. 审查通过，合并到主分支
# 在Web界面点击Merge按钮

# 5. 本地同步并删除分支
git checkout master
git pull origin master
git branch -d feature/new-feature
git push origin --delete feature/new-feature
```

---

## 二、版本发布场景

### 2.1 准备发布新版本

```bash
# 1. 从develop分支创建发布分支
git checkout develop
git pull origin develop
git checkout -b release/v1.2.0

# 2. 更新版本号
# 编辑package.json、version.txt等文件
git add .
git commit -m "chore: 更新版本号为1.2.0"

# 3. 修复发现的小bug
git add .
git commit -m "fix: 修复发布前发现的bug"

# 4. 合并到master并打标签
git checkout master
git merge release/v1.2.0
git tag -a v1.2.0 -m "版本1.2.0发布"
git push origin master --tags

# 5. 合并回develop
git checkout develop
git merge release/v1.2.0
git push origin develop

# 6. 删除发布分支
git branch -d release/v1.2.0
git push origin --delete release/v1.2.0
```

### 2.2 回滚到上一个版本

```bash
# 方式一：使用revert（推荐，保留历史）
git revert <commit-id>
git push origin master

# 方式二：使用reset（危险，重写历史）
git reset --hard v1.1.0
git push -f origin master

# 方式三：创建回滚分支
git checkout -b rollback/v1.1.0 v1.1.0
git push origin rollback/v1.1.0
# 然后部署这个分支
```

### 2.3 热修复生产环境bug

```bash
# 1. 从master创建热修复分支
git checkout master
git pull origin master
git checkout -b hotfix/v1.2.1

# 2. 修复bug
# ... 修改代码 ...
git add .
git commit -m "fix: 修复生产环境关键bug"

# 3. 测试修复

# 4. 合并到master
git checkout master
git merge hotfix/v1.2.1
git tag -a v1.2.1 -m "热修复版本1.2.1"
git push origin master --tags

# 5. 合并到develop
git checkout develop
git merge hotfix/v1.2.1
git push origin develop

# 6. 删除热修复分支
git branch -d hotfix/v1.2.1
```

---

## 三、冲突解决场景

### 3.1 合并冲突

**场景：**合并分支时出现冲突。

```bash
# 1. 尝试合并
git checkout master
git merge feature-branch
# Auto-merging file.txt
# CONFLICT (content): Merge conflict in file.txt

# 2. 查看冲突文件
git status
# Unmerged paths:
#   both modified:   file.txt

# 3. 打开冲突文件
<<<<<<< HEAD
这是master分支的内容
=======
这是feature分支的内容
>>>>>>> feature-branch

# 4. 手动解决冲突，保留需要的内容
这是合并后的最终内容

# 5. 标记为已解决
git add file.txt

# 6. 完成合并
git commit -m "merge: 合并feature-branch，解决冲突"
```

### 3.2 Rebase冲突

```bash
# 1. 开始rebase
git checkout feature
git rebase master
# CONFLICT (content): Merge conflict in file.txt

# 2. 解决冲突
# 编辑冲突文件

# 3. 添加已解决的文件
git add file.txt

# 4. 继续rebase
git rebase --continue

# 如果想放弃rebase
git rebase --abort
```

### 3.3 Pull冲突

```bash
# 1. 拉取时出现冲突
git pull origin master
# CONFLICT (content): Merge conflict in file.txt

# 2. 解决冲突
# 编辑冲突文件

# 3. 添加并提交
git add file.txt
git commit -m "resolve: 解决pull冲突"

# 4. 推送
git push origin master
```

### 3.4 使用工具解决冲突

```bash
# 配置合并工具（VS Code）
git config --global merge.tool vscode
git config --global mergetool.vscode.cmd "code --wait $MERGED"

# 使用工具解决冲突
git mergetool

# 完成后提交
git commit
```

---

## 四、错误恢复场景

### 4.1 撤销未提交的修改

```bash
# 撤销工作区的修改（未add）
git checkout -- file.txt

# 撤销所有工作区修改
git checkout .

# 撤销暂存区的修改（已add未commit）
git reset HEAD file.txt

# 撤销所有暂存区修改
git reset HEAD .
```

### 4.2 修改最后一次提交

```bash
# 修改提交信息
git commit --amend -m "新的提交信息"

# 添加遗漏的文件
git add forgotten-file.txt
git commit --amend --no-edit

# 修改提交内容
# 编辑文件
git add .
git commit --amend
```

### 4.3 撤销已提交但未推送的提交

```bash
# 方式一：保留修改
git reset --soft HEAD^

# 方式二：不保留修改
git reset --hard HEAD^

# 撤销多个提交
git reset --hard HEAD~3
```

### 4.4 撤销已推送的提交

```bash
# 方式一：使用revert（推荐）
git revert <commit-id>
git push origin master

# 方式二：使用reset（需要force push）
git reset --hard <commit-id>
git push -f origin master
```

### 4.5 恢复删除的文件

```bash
# 恢复工作区删除的文件
git checkout -- deleted-file.txt

# 恢复已提交删除的文件
git checkout <commit-id> -- deleted-file.txt

# 查找文件被删除的提交
git log --all --full-history -- deleted-file.txt
```

### 4.6 恢复删除的分支

```bash
# 1. 查找分支最后的提交
git reflog
# 找到类似这样的记录：
# abc1234 HEAD@{2}: commit: 最后一次提交

# 2. 恢复分支
git checkout -b recovered-branch abc1234
```

### 4.7 恢复删除的提交

```bash
# 1. 查看reflog
git reflog

# 2. 找到要恢复的提交ID
# abc1234 HEAD@{5}: commit: 被删除的提交

# 3. 恢复提交
git cherry-pick abc1234

# 或者重置到该提交
git reset --hard abc1234
```

---

## 五、大型项目管理场景

### 5.1 管理大型仓库

```bash
# 1. 使用浅克隆
git clone --depth 1 https://github.com/large/project.git

# 2. 只克隆单个分支
git clone --single-branch --branch master https://github.com/large/project.git

# 3. 使用稀疏检出
git clone --filter=blob:none --sparse https://github.com/large/project.git
cd project
git sparse-checkout init --cone
git sparse-checkout set src/main

# 4. 定期清理
git gc --aggressive
git prune
```

### 5.2 处理大文件

```bash
# 1. 安装Git LFS
git lfs install

# 2. 跟踪大文件类型
git lfs track "*.psd"
git lfs track "*.mp4"
git lfs track "*.zip"

# 3. 提交.gitattributes
git add .gitattributes
git commit -m "chore: 配置Git LFS"

# 4. 正常提交大文件
git add large-file.psd
git commit -m "add: 添加设计文件"
git push
```

### 5.3 拆分大型提交

```bash
# 1. 重置到上一个提交，保留修改
git reset --soft HEAD^

# 2. 分批添加文件
git add file1.txt file2.txt
git commit -m "feat: 实现功能A"

git add file3.txt file4.txt
git commit -m "feat: 实现功能B"

# 3. 推送
git push
```

### 5.4 清理历史中的大文件

```bash
# 使用BFG Repo-Cleaner
java -jar bfg.jar --strip-blobs-bigger-than 50M repo.git

# 或使用filter-branch
git filter-branch --tree-filter 'rm -f large-file.zip' HEAD

# 清理
git reflog expire --expire=now --all
git gc --prune=now --aggressive
```

---

## 六、多仓库管理场景

### 6.1 使用子模块

```bash
# 1. 添加子模块
git submodule add https://github.com/user/library.git libs/library

# 2. 克隆包含子模块的项目
git clone --recursive https://github.com/user/project.git

# 3. 更新子模块
git submodule update --remote

# 4. 在子模块中工作
cd libs/library
git checkout master
# ... 修改代码 ...
git add .
git commit -m "update library"
git push

# 5. 更新主项目
cd ../..
git add libs/library
git commit -m "chore: 更新library子模块"
git push
```

### 6.2 使用Git Subtree

```bash
# 1. 添加subtree
git subtree add --prefix=libs/library https://github.com/user/library.git master --squash

# 2. 拉取subtree更新
git subtree pull --prefix=libs/library https://github.com/user/library.git master --squash

# 3. 推送subtree修改
git subtree push --prefix=libs/library https://github.com/user/library.git master
```

### 6.3 Monorepo管理

```bash
# 项目结构
monorepo/
├── packages/
│   ├── app1/
│   ├── app2/
│   └── shared/
└── .git/

# 只构建修改的包
git diff --name-only HEAD~1 | grep "packages/app1" && npm run build:app1

# 使用工具（如Lerna）
npx lerna init
npx lerna bootstrap
npx lerna publish
```

---

## 七、CI/CD集成场景

### 7.1 GitHub Actions示例

```yaml
# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [ master, develop ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run tests
      run: npm test
    
    - name: Build
      run: npm run build
    
    - name: Deploy
      if: github.ref == 'refs/heads/master'
      run: npm run deploy
```

### 7.2 自动化版本发布

```bash
# 使用semantic-release
npm install --save-dev semantic-release

# .releaserc.json
{
  "branches": ["master"],
  "plugins": [
    "@semantic-release/commit-analyzer",
    "@semantic-release/release-notes-generator",
    "@semantic-release/changelog",
    "@semantic-release/npm",
    "@semantic-release/git"
  ]
}

# 提交格式触发自动发布
git commit -m "feat: 添加新功能"  # 触发minor版本
git commit -m "fix: 修复bug"      # 触发patch版本
git commit -m "feat!: 破坏性更新" # 触发major版本
```

### 7.3 自动化测试

```bash
# pre-commit hook
#!/bin/sh
npm run lint
npm run test

if [ $? -ne 0 ]; then
    echo "测试失败，请修复后再提交"
    exit 1
fi
```

---

## 八、安全和权限场景

### 8.1 保护敏感信息

```bash
# 1. 创建.env文件存储敏感信息
DATABASE_PASSWORD=secret123
API_KEY=abc123xyz

# 2. 添加到.gitignore
echo ".env" >> .gitignore

# 3. 创建.env.example作为模板
DATABASE_PASSWORD=your_password_here
API_KEY=your_api_key_here

# 4. 提交
git add .gitignore .env.example
git commit -m "chore: 添加环境变量配置"
```

### 8.2 从历史中删除敏感信息

```bash
# 使用BFG
java -jar bfg.jar --delete-files passwords.txt repo.git
cd repo.git
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# 使用filter-branch
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch config/secrets.yml" \
  --prune-empty --tag-name-filter cat -- --all

# 强制推送
git push origin --force --all
git push origin --force --tags
```

### 8.3 签名提交

```bash
# 1. 生成GPG密钥
gpg --full-generate-key

# 2. 查看密钥ID
gpg --list-secret-keys --keyid-format LONG

# 3. 配置Git
git config --global user.signingkey <key-id>
git config --global commit.gpgsign true

# 4. 导出公钥添加到GitHub
gpg --armor --export <key-id>

# 5. 签名提交
git commit -S -m "签名提交"
```

---

## 九、性能优化场景

### 9.1 加速克隆

```bash
# 浅克隆
git clone --depth 1 https://github.com/large/repo.git

# 单分支克隆
git clone --single-branch --branch master https://github.com/large/repo.git

# 使用镜像
git clone https://gitee.com/mirrors/repo.git
```

### 9.2 优化仓库大小

```bash
# 1. 查看仓库大小
git count-objects -vH

# 2. 找出大文件
git rev-list --objects --all | \
  git cat-file --batch-check='%(objecttype) %(objectname) %(objectsize) %(rest)' | \
  sed -n 's/^blob //p' | \
  sort --numeric-sort --key=2 | \
  tail -n 10

# 3. 清理大文件
git filter-branch --tree-filter 'rm -f large-file.zip' HEAD

# 4. 清理和优化
git reflog expire --expire=now --all
git gc --prune=now --aggressive
```

### 9.3 加速日常操作

```bash
# 启用文件系统监控
git config --global core.fsmonitor true

# 启用并行处理
git config --global submodule.fetchJobs 8

# 使用增量repack
git config --global repack.useDeltaBaseOffset true

# 启用commit graph
git config --global core.commitGraph true
git commit-graph write --reachable
```

---

## 十、故障排查场景

### 10.1 找出引入bug的提交

```bash
# 使用git bisect
git bisect start
git bisect bad                    # 当前版本有bug
git bisect good v1.0.0           # v1.0.0版本正常

# Git会自动切换到中间版本
# 测试后标记
git bisect good  # 或 git bisect bad

# 重复直到找到问题提交
# 找到后
git bisect reset
```

### 10.2 查找丢失的提交

```bash
# 查看reflog
git reflog

# 恢复丢失的提交
git checkout -b recovery <commit-id>

# 或cherry-pick
git cherry-pick <commit-id>
```

### 10.3 修复损坏的仓库

```bash
# 检查仓库完整性
git fsck --full

# 恢复损坏的对象
git reflog expire --expire=now --all
git gc --prune=now

# 从远程重新克隆
git clone https://github.com/user/repo.git repo-backup
```

### 10.4 解决推送被拒绝

```bash
# 场景：推送时提示"Updates were rejected"

# 方式一：拉取后推送
git pull --rebase origin master
git push origin master

# 方式二：强制推送（慎用）
git push -f origin master

# 方式三：创建新分支
git push origin HEAD:new-branch
```

---

## 十一、团队协作最佳实践

### 11.1 代码审查清单

**提交前检查：**
- [ ] 代码是否通过所有测试
- [ ] 是否遵循代码规范
- [ ] 是否添加了必要的注释
- [ ] 是否更新了文档
- [ ] 提交信息是否清晰

**审查时检查：**
- [ ] 代码逻辑是否正确
- [ ] 是否有潜在的性能问题
- [ ] 是否有安全隐患
- [ ] 是否可以简化
- [ ] 测试覆盖是否充分

### 11.2 分支命名规范

```bash
# 功能分支
feature/user-authentication
feature/payment-integration

# 修复分支
fix/login-error
fix/memory-leak

# 热修复分支
hotfix/critical-security-issue

# 发布分支
release/v1.2.0

# 文档分支
docs/api-documentation
```

### 11.3 提交信息规范

```bash
# 格式
<type>(<scope>): <subject>

<body>

<footer>

# 示例
feat(auth): 添加JWT认证功能

实现了基于JWT的用户认证系统，包括：
- 用户登录接口
- Token验证中间件
- Token刷新机制

Closes #123
```

**类型说明：**
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式
- `refactor`: 重构
- `perf`: 性能优化
- `test`: 测试相关
- `chore`: 构建/工具

---

## 十二、实用技巧汇总

### 12.1 快捷命令

```bash
# 快速提交
git commit -am "快速提交"

# 快速推送
git push

# 快速拉取
git pull --rebase

# 查看简洁日志
git log --oneline --graph --all

# 查看文件修改
git diff HEAD

# 查看暂存区
git diff --cached
```

### 12.2 别名配置

```bash
# 添加到~/.gitconfig
[alias]
    st = status
    co = checkout
    br = branch
    ci = commit
    unstage = reset HEAD --
    last = log -1 HEAD
    visual = log --graph --oneline --all
    amend = commit --amend --no-edit
    undo = reset --soft HEAD^
    save = stash save
    load = stash pop
```

### 12.3 工作流模板

```bash
# 每日工作流
git checkout master
git pull origin master
git checkout -b feature/today-work
# ... 开发 ...
git add .
git commit -m "feat: 完成今日工作"
git push origin feature/today-work
# 创建PR

# 每周同步
git checkout master
git pull origin master
git checkout develop
git merge master
git push origin develop
```

---

## 总结

通过这些实战场景，你应该能够：
- ✅ 处理日常开发中的各种情况
- ✅ 解决常见的Git问题
- ✅ 优化团队协作流程
- ✅ 提高开发效率

**记住：**
1. 频繁提交，小步快跑
2. 写清晰的提交信息
3. 定期同步远程仓库
4. 遇到问题先查reflog
5. 重要操作前先备份

**持续实践，不断总结，你会越来越熟练！** 🎯
