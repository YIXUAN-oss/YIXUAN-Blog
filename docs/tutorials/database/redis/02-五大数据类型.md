---
title: Redisäº”å¤§æ•°æ®ç±»å‹
---

# 02 - Redisäº”å¤§æ•°æ®ç±»å‹

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- æ·±å…¥ç†è§£Redisäº”å¤§åŸºæœ¬æ•°æ®ç±»å‹
- æŒæ¡æ¯ç§ç±»å‹çš„å¸¸ç”¨å‘½ä»¤
- äº†è§£å„æ•°æ®ç±»å‹çš„åº”ç”¨åœºæ™¯
- ç†è§£åº•å±‚æ•°æ®ç»“æ„

## ğŸ“Š æ•°æ®ç±»å‹æ¦‚è§ˆ

| ç±»å‹ | è¯´æ˜ | å…¸å‹åº”ç”¨ |
|------|------|----------|
| String | å­—ç¬¦ä¸² | ç¼“å­˜ã€è®¡æ•°å™¨ã€åˆ†å¸ƒå¼é” |
| List | åˆ—è¡¨ | æ¶ˆæ¯é˜Ÿåˆ—ã€æ–‡ç« åˆ—è¡¨ã€è¯„è®ºåˆ—è¡¨ |
| Set | é›†åˆ | æ ‡ç­¾ã€å¥½å‹å…³ç³»ã€æŠ½å¥– |
| Hash | å“ˆå¸Œè¡¨ | å¯¹è±¡å­˜å‚¨ã€è´­ç‰©è½¦ |
| Zset | æœ‰åºé›†åˆ | æ’è¡Œæ¦œã€å»¶æ—¶é˜Ÿåˆ— |

## 1ï¸âƒ£ Stringï¼ˆå­—ç¬¦ä¸²ï¼‰

### ç‰¹ç‚¹
- æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹
- äºŒè¿›åˆ¶å®‰å…¨ï¼Œå¯ä»¥å­˜å‚¨ä»»ä½•æ•°æ®
- å•ä¸ªvalueæœ€å¤§512MB

### å¸¸ç”¨å‘½ä»¤

#### åŸºæœ¬æ“ä½œ
```bash
# è®¾ç½®å€¼
SET key value [EX seconds] [PX milliseconds] [NX|XX]
SET name "Redis"
SET session:abc123 "user_data" EX 3600  # è®¾ç½®è¿‡æœŸæ—¶é—´

# è·å–å€¼
GET key
GET name

# è®¾ç½®å¹¶è¿”å›æ—§å€¼
GETSET key value
GETSET name "New Redis"

# ä»…å½“keyä¸å­˜åœ¨æ—¶è®¾ç½®
SETNX key value
SETNX lock "1"  # åˆ†å¸ƒå¼é”

# æ‰¹é‡è®¾ç½®
MSET key1 value1 key2 value2
MSET user:1:name "John" user:1:age "30"

# æ‰¹é‡è·å–
MGET key1 key2
MGET user:1:name user:1:age

# åˆ é™¤
DEL key
```

#### æ•°å€¼æ“ä½œ
```bash
# åˆå§‹åŒ–è®¡æ•°å™¨
SET counter 0

# è‡ªå¢1
INCR counter

# è‡ªå‡1
DECR counter

# å¢åŠ æŒ‡å®šå€¼
INCRBY counter 10

# å‡å°‘æŒ‡å®šå€¼
DECRBY counter 5

# æµ®ç‚¹æ•°å¢åŠ 
INCRBYFLOAT price 0.5
```

#### å­—ç¬¦ä¸²æ“ä½œ
```bash
# è¿½åŠ å­—ç¬¦ä¸²
APPEND key value
APPEND message " World"

# è·å–å­—ç¬¦ä¸²é•¿åº¦
STRLEN key

# è·å–å­å­—ç¬¦ä¸²
GETRANGE key start end
GETRANGE message 0 4

# è®¾ç½®å­å­—ç¬¦ä¸²
SETRANGE key offset value

# è®¾ç½®è¿‡æœŸæ—¶é—´
EXPIRE key seconds
EXPIRE session:abc 3600

# æŸ¥çœ‹å‰©ä½™æ—¶é—´
TTL key
```

### åº”ç”¨åœºæ™¯

#### 1. ç¼“å­˜å¯¹è±¡
```bash
# ç¼“å­˜ç”¨æˆ·ä¿¡æ¯ï¼ˆJSONå­—ç¬¦ä¸²ï¼‰
SET user:1001 '{"id":1001,"name":"John","email":"john@example.com"}' EX 1800

# è·å–ç”¨æˆ·ä¿¡æ¯
GET user:1001
```

#### 2. è®¡æ•°å™¨
```bash
# æ–‡ç« é˜…è¯»é‡
INCR article:100:views

# ç‚¹èµæ•°
INCR post:200:likes

# è·å–ç»Ÿè®¡
GET article:100:views
```

#### 3. åˆ†å¸ƒå¼é”
```bash
# è·å–é”ï¼ˆ30ç§’è¿‡æœŸï¼‰
SET lock:order:1001 "uuid123" EX 30 NX

# é‡Šæ”¾é”
DEL lock:order:1001
```

#### 4. é™æµ
```bash
# ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤š10æ¬¡è¯·æ±‚
SET rate:user:1001 1 EX 60
INCR rate:user:1001
GET rate:user:1001  # æ£€æŸ¥æ˜¯å¦è¶…è¿‡10
```

## 2ï¸âƒ£ Listï¼ˆåˆ—è¡¨ï¼‰

### ç‰¹ç‚¹
- æœ‰åºçš„å­—ç¬¦ä¸²åˆ—è¡¨
- åº•å±‚æ˜¯åŒå‘é“¾è¡¨
- æ”¯æŒå¤´éƒ¨å’Œå°¾éƒ¨æ“ä½œ
- æœ€å¤š2^32-1ä¸ªå…ƒç´ 

### å¸¸ç”¨å‘½ä»¤

```bash
# å·¦ä¾§æ’å…¥ï¼ˆå¤´éƒ¨ï¼‰
LPUSH list value1 [value2 ...]
LPUSH tasks "task1" "task2"

# å³ä¾§æ’å…¥ï¼ˆå°¾éƒ¨ï¼‰
RPUSH list value1 [value2 ...]
RPUSH logs "log1" "log2"

# å·¦ä¾§å¼¹å‡º
LPOP list
LPOP tasks

# å³ä¾§å¼¹å‡º
RPOP list

# é˜»å¡å¼å¼¹å‡ºï¼ˆé˜Ÿåˆ—ä¸ºç©ºæ—¶ç­‰å¾…ï¼‰
BLPOP list timeout
BLPOP tasks 0  # ä¸€ç›´ç­‰å¾…

BRPOP list timeout
BRPOP tasks 10  # ç­‰å¾…10ç§’

# è·å–åˆ—è¡¨é•¿åº¦
LLEN list

# è·å–æŒ‡å®šèŒƒå›´å…ƒç´ 
LRANGE list start stop
LRANGE logs 0 -1    # è·å–æ‰€æœ‰
LRANGE logs 0 9     # è·å–å‰10æ¡

# è·å–æŒ‡å®šç´¢å¼•å…ƒç´ 
LINDEX list index
LINDEX logs 0

# è®¾ç½®æŒ‡å®šç´¢å¼•å…ƒç´ 
LSET list index value
LSET logs 0 "new log"

# åˆ é™¤å…ƒç´ 
LREM list count value
LREM logs 2 "error"  # åˆ é™¤2ä¸ª"error"

# ä¿ç•™æŒ‡å®šèŒƒå›´
LTRIM list start stop
LTRIM logs 0 99  # åªä¿ç•™å‰100æ¡
```

### åº”ç”¨åœºæ™¯

#### 1. æ¶ˆæ¯é˜Ÿåˆ—
```bash
# ç”Ÿäº§è€…ï¼šæ¨é€ä»»åŠ¡
LPUSH queue:email "send email to user1"
LPUSH queue:email "send email to user2"

# æ¶ˆè´¹è€…ï¼šå¤„ç†ä»»åŠ¡
BRPOP queue:email 0
```

#### 2. æœ€æ–°æ–‡ç« åˆ—è¡¨
```bash
# æ·»åŠ æœ€æ–°æ–‡ç« 
LPUSH articles:latest "article:1001"
LPUSH articles:latest "article:1002"

# ä¿ç•™æœ€æ–°100ç¯‡
LTRIM articles:latest 0 99

# è·å–æœ€æ–°10ç¯‡
LRANGE articles:latest 0 9
```

#### 3. è¯„è®ºåˆ—è¡¨
```bash
# æ·»åŠ è¯„è®º
RPUSH comments:article:100 "Great article!"
RPUSH comments:article:100 "Thanks for sharing!"

# è·å–æ‰€æœ‰è¯„è®º
LRANGE comments:article:100 0 -1

# åˆ†é¡µè·å–ï¼ˆæ¯é¡µ10æ¡ï¼‰
LRANGE comments:article:100 0 9    # ç¬¬1é¡µ
LRANGE comments:article:100 10 19  # ç¬¬2é¡µ
```

## 3ï¸âƒ£ Setï¼ˆé›†åˆï¼‰

### ç‰¹ç‚¹
- æ— åºçš„å­—ç¬¦ä¸²é›†åˆ
- å…ƒç´ å”¯ä¸€ï¼Œè‡ªåŠ¨å»é‡
- æ”¯æŒé›†åˆè¿ç®—ï¼ˆäº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼‰
- æœ€å¤š2^32-1ä¸ªå…ƒç´ 

### å¸¸ç”¨å‘½ä»¤

```bash
# æ·»åŠ å…ƒç´ 
SADD set member1 [member2 ...]
SADD tags "redis" "database" "cache"

# åˆ é™¤å…ƒç´ 
SREM set member1 [member2 ...]
SREM tags "cache"

# è·å–æ‰€æœ‰å…ƒç´ 
SMEMBERS set
SMEMBERS tags

# åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨
SISMEMBER set member
SISMEMBER tags "redis"

# è·å–é›†åˆå¤§å°
SCARD set
SCARD tags

# éšæœºè·å–å…ƒç´ 
SRANDMEMBER set [count]
SRANDMEMBER tags 2

# éšæœºå¼¹å‡ºå…ƒç´ 
SPOP set [count]
SPOP tags

# ç§»åŠ¨å…ƒç´ åˆ°å¦ä¸€ä¸ªé›†åˆ
SMOVE source dest member
SMOVE tags1 tags2 "redis"

# é›†åˆè¿ç®—
# äº¤é›†
SINTER set1 set2
SINTER user:1:tags user:2:tags

# å¹¶é›†
SUNION set1 set2
SUNION user:1:friends user:2:friends

# å·®é›†
SDIFF set1 set2
SDIFF user:1:tags user:2:tags
```

### åº”ç”¨åœºæ™¯

#### 1. æ ‡ç­¾ç³»ç»Ÿ
```bash
# æ–‡ç« æ ‡ç­¾
SADD article:100:tags "Java" "Spring" "Redis"

# æŸ¥è¯¢æ–‡ç« æ ‡ç­¾
SMEMBERS article:100:tags

# æŸ¥æ‰¾åŒæ—¶æœ‰Javaå’ŒRedisæ ‡ç­¾çš„æ–‡ç« 
SINTER article:100:tags article:101:tags
```

#### 2. å¥½å‹å…³ç³»
```bash
# ç”¨æˆ·çš„å¥½å‹
SADD user:1001:friends "2001" "2002" "2003"
SADD user:1002:friends "2001" "2003" "2004"

# å…±åŒå¥½å‹
SINTER user:1001:friends user:1002:friends

# å¯èƒ½è®¤è¯†çš„äººï¼ˆæœ‹å‹çš„æœ‹å‹ï¼‰
SDIFF user:1002:friends user:1001:friends
```

#### 3. æŠ½å¥–ç³»ç»Ÿ
```bash
# æ·»åŠ å‚ä¸ç”¨æˆ·
SADD lottery:2024 "user1001" "user1002" "user1003"

# éšæœºæŠ½å–1åä¸­å¥–è€…
SPOP lottery:2024 1

# éšæœºæŠ½å–3åï¼ˆä¸åˆ é™¤ï¼‰
SRANDMEMBER lottery:2024 3
```

#### 4. å»é‡
```bash
# è®°å½•ä»Šæ—¥è®¿é—®ç”¨æˆ·ï¼ˆè‡ªåŠ¨å»é‡ï¼‰
SADD visit:2024-01-01 "user1001"
SADD visit:2024-01-01 "user1002"
SADD visit:2024-01-01 "user1001"  # é‡å¤æ·»åŠ æ— æ•ˆ

# è·å–ä»Šæ—¥UV
SCARD visit:2024-01-01
```

## 4ï¸âƒ£ Hashï¼ˆå“ˆå¸Œï¼‰

### ç‰¹ç‚¹
- é”®å€¼å¯¹é›†åˆ
- é€‚åˆå­˜å‚¨å¯¹è±¡
- æ¯ä¸ªHashå¯å­˜å‚¨2^32-1ä¸ªé”®å€¼å¯¹

### å¸¸ç”¨å‘½ä»¤

```bash
# è®¾ç½®å•ä¸ªå­—æ®µ
HSET hash field value
HSET user:1001 name "John"

# è®¾ç½®å¤šä¸ªå­—æ®µ
HMSET hash field1 value1 field2 value2
HMSET user:1001 name "John" age "30" email "john@example.com"

# è·å–å•ä¸ªå­—æ®µ
HGET hash field
HGET user:1001 name

# è·å–å¤šä¸ªå­—æ®µ
HMGET hash field1 field2
HMGET user:1001 name age

# è·å–æ‰€æœ‰å­—æ®µå’Œå€¼
HGETALL hash
HGETALL user:1001

# è·å–æ‰€æœ‰å­—æ®µå
HKEYS hash

# è·å–æ‰€æœ‰å€¼
HVALS hash

# åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨
HEXISTS hash field
HEXISTS user:1001 email

# åˆ é™¤å­—æ®µ
HDEL hash field1 [field2 ...]
HDEL user:1001 email

# è·å–å­—æ®µæ•°é‡
HLEN hash

# å­—æ®µå€¼å¢åŠ 
HINCRBY hash field increment
HINCRBY user:1001 age 1

# ä»…å½“å­—æ®µä¸å­˜åœ¨æ—¶è®¾ç½®
HSETNX hash field value
```

### åº”ç”¨åœºæ™¯

#### 1. å­˜å‚¨å¯¹è±¡
```bash
# å­˜å‚¨ç”¨æˆ·ä¿¡æ¯
HMSET user:1001 \
  name "John Doe" \
  age "30" \
  email "john@example.com" \
  phone "1234567890"

# è·å–ç”¨æˆ·ä¿¡æ¯
HGETALL user:1001

# æ›´æ–°å¹´é¾„
HINCRBY user:1001 age 1
```

#### 2. è´­ç‰©è½¦
```bash
# æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
HSET cart:user:1001 product:2001 "2"  # å•†å“ID:æ•°é‡
HSET cart:user:1001 product:2002 "1"

# ä¿®æ”¹å•†å“æ•°é‡
HINCRBY cart:user:1001 product:2001 1

# åˆ é™¤å•†å“
HDEL cart:user:1001 product:2002

# è·å–è´­ç‰©è½¦æ‰€æœ‰å•†å“
HGETALL cart:user:1001

# å•†å“æ•°é‡
HLEN cart:user:1001
```

#### 3. æ–‡ç« è¯¦æƒ…
```bash
# å­˜å‚¨æ–‡ç« ä¿¡æ¯
HMSET article:100 \
  title "Redis Tutorial" \
  author "John" \
  views "1000" \
  likes "50"

# å¢åŠ é˜…è¯»é‡
HINCRBY article:100 views 1

# å¢åŠ ç‚¹èµæ•°
HINCRBY article:100 likes 1
```

## 5ï¸âƒ£ Zsetï¼ˆæœ‰åºé›†åˆï¼‰

### ç‰¹ç‚¹
- æœ‰åºçš„å­—ç¬¦ä¸²é›†åˆ
- æ¯ä¸ªå…ƒç´ å…³è”ä¸€ä¸ªåˆ†æ•°ï¼ˆscoreï¼‰
- æŒ‰åˆ†æ•°æ’åº
- å…ƒç´ å”¯ä¸€ï¼Œåˆ†æ•°å¯é‡å¤

### å¸¸ç”¨å‘½ä»¤

```bash
# æ·»åŠ å…ƒç´ 
ZADD zset score member [score member ...]
ZADD leaderboard 100 "player1" 95 "player2" 90 "player3"

# è·å–å…ƒç´ åˆ†æ•°
ZSCORE zset member
ZSCORE leaderboard "player1"

# å¢åŠ åˆ†æ•°
ZINCRBY zset increment member
ZINCRBY leaderboard 10 "player1"

# è·å–æ’åï¼ˆä»å°åˆ°å¤§ï¼‰
ZRANK zset member

# è·å–æ’åï¼ˆä»å¤§åˆ°å°ï¼‰
ZREVRANK zset member
ZREVRANK leaderboard "player1"

# è·å–æŒ‡å®šèŒƒå›´å…ƒç´ ï¼ˆæŒ‰ç´¢å¼•ï¼‰
ZRANGE zset start stop [WITHSCORES]
ZRANGE leaderboard 0 -1 WITHSCORES

# å€’åºè·å–
ZREVRANGE zset start stop [WITHSCORES]
ZREVRANGE leaderboard 0 9 WITHSCORES  # å‰10å

# æŒ‰åˆ†æ•°èŒƒå›´è·å–
ZRANGEBYSCORE zset min max [WITHSCORES]
ZRANGEBYSCORE leaderboard 90 100 WITHSCORES

# è·å–å…ƒç´ æ•°é‡
ZCARD zset

# åˆ é™¤å…ƒç´ 
ZREM zset member1 [member2 ...]
ZREM leaderboard "player1"

# æŒ‰æ’ååˆ é™¤
ZREMRANGEBYRANK zset start stop
ZREMRANGEBYRANK leaderboard 10 -1  # åˆ é™¤10åä»¥å

# æŒ‰åˆ†æ•°åˆ é™¤
ZREMRANGEBYSCORE zset min max
```

### åº”ç”¨åœºæ™¯

#### 1. æ’è¡Œæ¦œ
```bash
# æ¸¸æˆæ’è¡Œæ¦œ
ZADD game:rank 1000 "player1"
ZADD game:rank 950 "player2"
ZADD game:rank 900 "player3"

# å¢åŠ ç©å®¶åˆ†æ•°
ZINCRBY game:rank 50 "player1"

# è·å–å‰10å
ZREVRANGE game:rank 0 9 WITHSCORES

# è·å–æŸç©å®¶æ’å
ZREVRANK game:rank "player1"

# è·å–ç©å®¶åˆ†æ•°
ZSCORE game:rank "player1"
```

#### 2. å»¶æ—¶é˜Ÿåˆ—
```bash
# æ·»åŠ å»¶æ—¶ä»»åŠ¡ï¼ˆåˆ†æ•°ä¸ºæ—¶é—´æˆ³ï¼‰
ZADD delay:queue 1704067200 "task1"  # 2024-01-01 00:00:00
ZADD delay:queue 1704153600 "task2"  # 2024-01-02 00:00:00

# è·å–åˆ°æœŸä»»åŠ¡
ZRANGEBYSCORE delay:queue 0 1704067200

# åˆ é™¤å·²å¤„ç†ä»»åŠ¡
ZREM delay:queue "task1"
```

#### 3. çƒ­æœæ¦œ
```bash
# æ·»åŠ æœç´¢è¯ï¼ˆåˆ†æ•°ä¸ºæœç´¢æ¬¡æ•°ï¼‰
ZADD hotsearch 1000 "Redis"
ZADD hotsearch 800 "MySQL"
ZADD hotsearch 600 "MongoDB"

# æœç´¢æ—¶å¢åŠ è®¡æ•°
ZINCRBY hotsearch 1 "Redis"

# è·å–çƒ­æœå‰10
ZREVRANGE hotsearch 0 9 WITHSCORES
```

#### 4. æ—¶é—´çº¿
```bash
# æ·»åŠ åŠ¨æ€ï¼ˆåˆ†æ•°ä¸ºæ—¶é—´æˆ³ï¼‰
ZADD timeline:user:1001 1704067200 "post:100"
ZADD timeline:user:1001 1704153600 "post:101"

# è·å–æœ€æ–°åŠ¨æ€
ZREVRANGE timeline:user:1001 0 9
```

## ğŸ“š åº•å±‚æ•°æ®ç»“æ„

| æ•°æ®ç±»å‹ | åº•å±‚å®ç° |
|---------|---------|
| String | SDSï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰ |
| List | QuickListï¼ˆå¿«é€Ÿåˆ—è¡¨ï¼‰|
| Set | IntSet æˆ– HashTable |
| Hash | ZipList æˆ– HashTable |
| Zset | ZipList æˆ– SkipList + HashTable |

## ğŸ’¡ æœ€ä½³å®è·µ

1. **é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹** - æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©
2. **åˆç†è®¾ç½®è¿‡æœŸæ—¶é—´** - é¿å…å†…å­˜æº¢å‡º
3. **é¿å…å¤§key** - å•ä¸ªkeyä¸è¦è¶…è¿‡10KB
4. **ä½¿ç”¨Pipeline** - æ‰¹é‡æ“ä½œæé«˜æ€§èƒ½
5. **ä½¿ç”¨Hashå­˜å‚¨å¯¹è±¡** - èŠ‚çœå†…å­˜

---

**ä¸‹ä¸€èŠ‚ï¼š** [03-æŒä¹…åŒ–æœºåˆ¶](03-æŒä¹…åŒ–æœºåˆ¶.md)
