---
title: 数据完整性
---

# 数据完整性

```sql
stu表{
id,  学号,     char(4)
name,姓名,     char(8)
sex, 性别,     char(2)
date,出生日期,  date
}

sc表{
id,    学号,   char(4)
number,课号,   char(4)
grade, 成绩,  "decimal(5,2)"
}

course表{
number, 课号,  char(4)
name,   课名,  char(20)
credit, 学分,  int
}


#1.在sc表中设置外键 fk_sno 参照stu表中的学号列
alter table sc add constraint fk_sno foreign key (id) references stu(id);

#2.在sc表中对成绩进行约束 0<=成绩<=100
alter table sc add constraint check (grade >= 0 && grade <=100);

#3.在course表的课名列上建立唯一约束，约束名为uq_cname
alter table course add constraint uq_cname primary key(name);

#4. 在course表的课号列建立主键约束
alter table course add constraint primary key (number);

#5. 在sc表的课号列建立外键约束fk_cno，参照course表的课号列的取值，要求实现级联更新
alter table sc
add constraint fk_cno foreign key (number) references course(number)
on update cascade;

#6. 在stu表的姓名列建立唯一约束名uq_sname
alter table stu add constraint uq_sname unique key(name);

#7. 在course表的学分列建立检查约束ck_xf，检查条件为学分>0
alter table course add constraint ck_xf check ( credit>0 );

#8. 删除sc表的外键约束fk_cno，fk_sno
alter table sc drop foreign key fk_cno;
alter table sc drop foreign key fk_sno;

#9. 删除stu表的主键约束
alter table stu drop primary key;

#10.删除course表的唯一约束uq_cname
alter table course drop index uq_cname;

#11.创建测试表test，包含一个字段date_time，字段类型varchar(50);
#创建触发器test_trig，实现在stu表中每插入一条学生记录后，则自动在test表中追加一条插入成功时的日期时间。SYSDATE()函数用来获取当前的日期和时间。
#为stu表插入一条记录引发触发器，查看test表的内容。
create table test(
    date_time varchar(50)
);
create trigger test_trig
after insert on stu for each row insert into test values (sysdate());

insert into stu values('1','Marx','F','1995-10-13');
select *from test;

#12.在course表上创建触发器del_trig，当course表上删除一门课程时，级联删除sc表该课程的记录。
#删除course表的一条记录，查看sc表相应记录是否被自动删除。
create trigger del_trig
after delete on course for each row
delete from sc where number =OLD.number;

delete from course where number='1';
select *from sc;

```

