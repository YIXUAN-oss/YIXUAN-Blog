---
title: 动画基础
date: 2025-01-22
---

# 动画基础

> 掌握 HarmonyOS 动画开发基础

## 🎬 动画类型

### HarmonyOS 动画分类

```
动画类型
├─ 属性动画（animateTo）
├─ 显式动画（animation）
├─ 转场动画（transition）
└─ 组件内置动画
```

## 📐 属性动画

### animateTo 全局动画

```typescript
@Entry
@Component
struct AnimationDemo {
  @State width: number = 100
  @State opacity: number = 1
  
  build() {
    Column({ space: 20 }) {
      // 动画目标
      Column()
        .width(this.width)
        .height(100)
        .backgroundColor(Color.Blue)
        .opacity(this.opacity)
      
      Button('开始动画')
        .onClick(() => {
          animateTo({
            duration: 1000,           // 持续时间
            curve: Curve.EaseInOut,   // 动画曲线
            iterations: 1,            // 播放次数
            playMode: PlayMode.Normal // 播放模式
          }, () => {
            // 修改状态触发动画
            this.width = 200
            this.opacity = 0.5
          })
        })
      
      Button('重置')
        .onClick(() => {
          animateTo({ duration: 500 }, () => {
            this.width = 100
            this.opacity = 1
          })
        })
    }
    .width('100%')
    .padding(20)
  }
}
```

### 多属性动画

```typescript
@Entry
@Component
struct MultiPropertyAnimation {
  @State translateX: number = 0
  @State translateY: number = 0
  @State scale: number = 1
  @State rotate: number = 0
  
  startAnimation() {
    animateTo({
      duration: 1500,
      curve: Curve.EaseInOut,
      onFinish: () => {
        console.log('动画完成')
      }
    }, () => {
      this.translateX = 100
      this.translateY = 50
      this.scale = 1.5
      this.rotate = 360
    })
  }
  
  build() {
    Column() {
      // 动画目标
      Column()
        .width(100)
        .height(100)
        .backgroundColor(Color.Red)
        .translate({ x: this.translateX, y: this.translateY })
        .scale({ x: this.scale, y: this.scale })
        .rotate({ angle: this.rotate })
      
      Button('开始动画')
        .margin({ top: 100 })
        .onClick(() => {
          this.startAnimation()
        })
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

## ✨ 显式动画

### animation 组件动画

```typescript
@Entry
@Component
struct ExplicitAnimation {
  @State flag: boolean = false
  
  build() {
    Column({ space: 30 }) {
      Column()
        .width(100)
        .height(100)
        .backgroundColor(this.flag ? Color.Blue : Color.Red)
        .animation({
          duration: 800,
          curve: Curve.Ease,
          iterations: 1
        })
      
      Button('切换颜色')
        .onClick(() => {
          this.flag = !this.flag
        })
    }
    .width('100%')
    .padding(20)
  }
}
```

### 链式动画

```typescript
@Entry
@Component
struct ChainAnimation {
  @State offsetX: number = 0
  @State offsetY: number = 0
  @State color: Color = Color.Red
  
  async startChainAnimation() {
    // 第一步：向右移动
    animateTo({ duration: 500 }, () => {
      this.offsetX = 100
    })
    
    await this.delay(500)
    
    // 第二步：向下移动
    animateTo({ duration: 500 }, () => {
      this.offsetY = 100
    })
    
    await this.delay(500)
    
    // 第三步：变色
    animateTo({ duration: 500 }, () => {
      this.color = Color.Blue
    })
  }
  
  delay(ms: number): Promise<void> {
    return new Promise(resolve => setTimeout(resolve, ms))
  }
  
  build() {
    Column() {
      Column()
        .width(50)
        .height(50)
        .backgroundColor(this.color)
        .translate({ x: this.offsetX, y: this.offsetY })
      
      Button('链式动画')
        .margin({ top: 200 })
        .onClick(() => {
          this.startChainAnimation()
        })
    }
    .width('100%')
    .height('100%')
  }
}
```

## 🔄 转场动画

### 页面转场

```typescript
@Entry
@Component
struct PageTransitionDemo {
  @State show: boolean = true
  
  build() {
    Column() {
      if (this.show) {
        Column()
          .width(200)
          .height(200)
          .backgroundColor(Color.Blue)
          .transition({
            type: TransitionType.Insert,
            opacity: 0,
            translate: { x: -100 },
            scale: { x: 0.5, y: 0.5 }
          })
          .transition({
            type: TransitionType.Delete,
            opacity: 0,
            translate: { x: 100 },
            scale: { x: 0.5, y: 0.5 }
          })
      }
      
      Button(this.show ? '隐藏' : '显示')
        .margin({ top: 50 })
        .onClick(() => {
          animateTo({ duration: 500 }, () => {
            this.show = !this.show
          })
        })
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

### 共享元素转场

```typescript
// 页面 A
@Entry
@Component
struct PageA {
  build() {
    Column() {
      Image($r('app.media.image'))
        .width(100)
        .height(100)
        .sharedTransition('sharedImage', {
          duration: 800,
          curve: Curve.Smooth
        })
        .onClick(() => {
          router.pushUrl({ url: 'pages/PageB' })
        })
    }
  }
}

// 页面 B
@Entry
@Component
struct PageB {
  build() {
    Column() {
      Image($r('app.media.image'))
        .width(300)
        .height(300)
        .sharedTransition('sharedImage', {
          duration: 800,
          curve: Curve.Smooth
        })
    }
  }
}
```

## 📊 动画曲线

### 内置曲线

```typescript
@Entry
@Component
struct CurveDemo {
  @State offset: number = 0
  
  animateWithCurve(curve: Curve) {
    this.offset = 0
    animateTo({
      duration: 1000,
      curve: curve
    }, () => {
      this.offset = 200
    })
  }
  
  build() {
    Column({ space: 20 }) {
      // 动画目标
      Column()
        .width(50)
        .height(50)
        .backgroundColor(Color.Red)
        .translate({ x: this.offset })
      
      // 曲线选择
      Button('Linear - 线性')
        .onClick(() => this.animateWithCurve(Curve.Linear))
      
      Button('Ease - 缓动')
        .onClick(() => this.animateWithCurve(Curve.Ease))
      
      Button('EaseIn - 缓入')
        .onClick(() => this.animateWithCurve(Curve.EaseIn))
      
      Button('EaseOut - 缓出')
        .onClick(() => this.animateWithCurve(Curve.EaseOut))
      
      Button('EaseInOut - 缓入缓出')
        .onClick(() => this.animateWithCurve(Curve.EaseInOut))
      
      Button('FastOutSlowIn - 快出慢入')
        .onClick(() => this.animateWithCurve(Curve.FastOutSlowIn))
      
      Button('Spring - 弹簧')
        .onClick(() => this.animateWithCurve(Curve.Spring))
    }
    .width('100%')
    .padding(20)
  }
}
```

### 自定义曲线

```typescript
// 三次贝塞尔曲线
const customCurve = curves.cubicBezierCurve(0.25, 0.1, 0.25, 1)

animateTo({
  duration: 1000,
  curve: customCurve
}, () => {
  this.width = 200
})
```

## 🎯 实战案例：卡片翻转动画

```typescript
@Entry
@Component
struct CardFlip {
  @State rotateY: number = 0
  @State isFlipped: boolean = false
  
  flipCard() {
    animateTo({
      duration: 600,
      curve: Curve.EaseInOut
    }, () => {
      this.rotateY = this.isFlipped ? 0 : 180
      this.isFlipped = !this.isFlipped
    })
  }
  
  build() {
    Column() {
      Stack() {
        // 正面
        Column() {
          Text('正面')
            .fontSize(32)
            .fontColor(Color.White)
        }
        .width(200)
        .height(300)
        .backgroundColor(Color.Blue)
        .borderRadius(20)
        .justifyContent(FlexAlign.Center)
        .rotate({ y: 1, angle: this.rotateY })
        .visibility(this.rotateY < 90 ? Visibility.Visible : Visibility.Hidden)
        
        // 背面
        Column() {
          Text('背面')
            .fontSize(32)
            .fontColor(Color.White)
        }
        .width(200)
        .height(300)
        .backgroundColor(Color.Red)
        .borderRadius(20)
        .justifyContent(FlexAlign.Center)
        .rotate({ y: 1, angle: this.rotateY - 180 })
        .visibility(this.rotateY >= 90 ? Visibility.Visible : Visibility.Hidden)
      }
      
      Button('翻转')
        .margin({ top: 50 })
        .onClick(() => {
          this.flipCard()
        })
    }
    .width('100%')
    .height('100%')
    .justifyContent(FlexAlign.Center)
  }
}
```

## 💡 最佳实践

### 1. 性能优化

```typescript
// ✅ 优先使用 transform 属性（GPU 加速）
.translate()
.scale()
.rotate()

// ❌ 避免频繁改变布局属性
.width()
.height()
```

### 2. 合理设置时长

```typescript
// ✅ 短动画：200-300ms
// ✅ 标准动画：300-500ms
// ✅ 长动画：500-1000ms
// ❌ 避免超过 1000ms
```

### 3. 动画结束回调

```typescript
animateTo({
  duration: 500,
  onFinish: () => {
    // 清理工作
    console.log('动画完成')
  }
}, () => {
  this.width = 200
})
```

## 📚 参考资源

- [动画](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-animation-overview-0000001820880269-V5)
- [属性动画](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-attribute-animation-apis-0000001821000237-V5)
- [转场动画](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-transition-animation-0000001820999333-V5)

---

**下一节** → [Canvas 绘图](02-Canvas绘图.md)
