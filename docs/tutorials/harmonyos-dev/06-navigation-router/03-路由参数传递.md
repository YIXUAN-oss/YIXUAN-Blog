---
title: 路由参数传递
date: 2025-01-22
---

# 路由参数传递

> 在页面间安全传递数据

## 📦 基础参数传递

### 简单类型

```typescript
// 传递字符串和数字
this.pageStack.pushPath({
  name: 'DetailPage',
  param: {
    id: 123,
    title: '商品详情',
    price: 99.99
  }
})

// 接收参数
@Component
struct DetailPage {
  @State id: number = 0
  @State title: string = ''
  @State price: number = 0
  
  build() {
    NavDestination() {
      Column() {
        Text(`ID: ${this.id}`)
        Text(`标题: ${this.title}`)
        Text(`价格: ¥${this.price}`)
      }
    }
    .onReady((context) => {
      const param = context.pathStack.getParamByName('DetailPage')
      if (param) {
        this.id = param.id
        this.title = param.title
        this.price = param.price
      }
    })
  }
}
```

### 复杂对象

```typescript
interface Product {
  id: number
  name: string
  price: number
  tags: string[]
  images: string[]
}

// 传递对象
const product: Product = {
  id: 1,
  name: 'iPhone 15',
  price: 5999,
  tags: ['热销', '新品'],
  images: ['img1.jpg', 'img2.jpg']
}

this.pageStack.pushPath({
  name: 'ProductDetail',
  param: { product }
})

// 接收对象
@Component
struct ProductDetail {
  @State product: Product = null
  
  build() {
    NavDestination() {
      Column({ space: 15 }) {
        Text(this.product?.name)
          .fontSize(24)
        
        Text(`¥${this.product?.price}`)
          .fontSize(20)
          .fontColor(Color.Red)
        
        Row() {
          ForEach(this.product?.tags || [], (tag: string) => {
            Text(tag)
              .padding(5)
              .backgroundColor(Color.Blue)
              .fontColor(Color.White)
              .borderRadius(4)
          })
        }
      }
    }
    .onReady((context) => {
      const param = context.pathStack.getParamByName('ProductDetail')
      this.product = param?.product
    })
  }
}
```

## 🔄 双向传递

### 带回调的参数传递

```typescript
// 页面 A - 传递回调
@Entry
@Component
struct PageA {
  pageStack: NavPathStack = new NavPathStack()
  @State selectedColor: string = ''
  
  openColorPicker() {
    this.pageStack.pushPath({
      name: 'ColorPicker',
      param: {
        currentColor: this.selectedColor,
        onColorSelected: (color: string) => {
          this.selectedColor = color
        }
      }
    })
  }
  
  build() {
    Navigation(this.pageStack) {
      Column() {
        Text(`选择的颜色: ${this.selectedColor}`)
        
        Button('选择颜色')
          .onClick(() => {
            this.openColorPicker()
          })
      }
    }
  }
}

// 页面 B - 使用回调
@Component
struct ColorPicker {
  pageStack: NavPathStack = new NavPathStack()
  @State colors: string[] = ['Red', 'Blue', 'Green', 'Yellow']
  private onColorSelected: (color: string) => void
  
  build() {
    NavDestination() {
      Column() {
        ForEach(this.colors, (color: string) => {
          Button(color)
            .width('100%')
            .onClick(() => {
              // 调用回调
              if (this.onColorSelected) {
                this.onColorSelected(color)
              }
              // 返回上一页
              this.pageStack.pop()
            })
        })
      }
    }
    .onReady((context) => {
      const param = context.pathStack.getParamByName('ColorPicker')
      this.onColorSelected = param?.onColorSelected
    })
  }
}
```

### 通过 pop 返回数据

```typescript
// 页面 A - 等待返回结果
@Entry
@Component
struct PageA {
  pageStack: NavPathStack = new NavPathStack()
  @State result: string = ''
  
  openSelector() {
    this.pageStack.pushPath({
      name: 'Selector',
      onPop: (popResult) => {
        console.log('返回结果:', popResult)
        if (popResult?.selected) {
          this.result = popResult.selected
        }
      }
    })
  }
  
  build() {
    Navigation(this.pageStack) {
      Column() {
        Text(`选择结果: ${this.result}`)
        
        Button('打开选择器')
          .onClick(() => {
            this.openSelector()
          })
      }
    }
  }
}

// 页面 B - 返回数据
@Component
struct Selector {
  pageStack: NavPathStack = new NavPathStack()
  @State items: string[] = ['Option 1', 'Option 2', 'Option 3']
  
  selectItem(item: string) {
    // 返回选择结果
    this.pageStack.pop({
      selected: item
    })
  }
  
  build() {
    NavDestination() {
      List() {
        ForEach(this.items, (item: string) => {
          ListItem() {
            Text(item)
              .width('100%')
              .padding(15)
              .onClick(() => {
                this.selectItem(item)
              })
          }
        })
      }
    }
  }
}
```

## 🎯 类型安全

### 使用接口定义参数

```typescript
// 定义参数接口
interface UserDetailParams {
  userId: number
  showEdit?: boolean
}

interface UserDetailResult {
  updated: boolean
  user?: User
}

// 类型安全的传递
function navigateToUserDetail(userId: number) {
  const params: UserDetailParams = {
    userId,
    showEdit: true
  }
  
  this.pageStack.pushPath({
    name: 'UserDetail',
    param: params,
    onPop: (result: UserDetailResult) => {
      if (result?.updated) {
        console.log('用户已更新:', result.user)
      }
    }
  })
}

// 类型安全的接收
@Component
struct UserDetail {
  @State userId: number = 0
  @State showEdit: boolean = false
  
  build() {
    NavDestination() {
      Column() {
        Text(`用户ID: ${this.userId}`)
        
        if (this.showEdit) {
          Button('编辑')
        }
      }
    }
    .onReady((context) => {
      const params = context.pathStack.getParamByName('UserDetail') as UserDetailParams
      if (params) {
        this.userId = params.userId
        this.showEdit = params.showEdit ?? false
      }
    })
  }
}
```

## 💡 最佳实践

### 1. 避免传递大对象

```typescript
// ❌ 避免传递大量数据
this.pageStack.pushPath({
  name: 'Detail',
  param: {
    largeArray: Array.from({ length: 10000 }, () => ({ /* 大对象 */ }))
  }
})

// ✅ 只传递 ID，在目标页面加载数据
this.pageStack.pushPath({
  name: 'Detail',
  param: { id: 123 }
})

// 目标页面
async aboutToAppear() {
  this.data = await loadDataById(this.id)
}
```

### 2. 使用 AppStorage 共享状态

```typescript
// 设置共享数据
AppStorage.SetOrCreate('selectedItems', [1, 2, 3])

// 跳转（不传参）
this.pageStack.pushPath({ name: 'Detail' })

// 读取共享数据
@StorageLink('selectedItems') selectedItems: number[] = []
```

### 3. 参数验证

```typescript
build() {
  NavDestination() {
    Column() {
      if (this.isValidParams()) {
        // 显示内容
        Content()
      } else {
        // 显示错误
        Text('参数错误')
      }
    }
  }
  .onReady((context) => {
    const params = context.pathStack.getParamByName('Detail')
    this.loadParams(params)
  })
}

isValidParams(): boolean {
  return this.id > 0 && this.title !== ''
}
```

## 📚 参考资源

- [Navigation 参数传递](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/arkts-routing-0000001503325125-V3)

---

**第6章完成！** 继续学习 → [第7章：数据管理](../07-data-management/)
