---
title: 性能优化技巧
date: 2025-01-22
---

# 性能优化技巧

> 编写高性能的 ArkTS 代码

## ⚡ 代码优化

### 1. 使用 const/let

```typescript
// ✅ 推荐
const MAX_SIZE = 100
let count = 0

// ❌ 避免
var size = 100
```

### 2. 避免不必要的计算

```typescript
// ❌ 每次都计算
build() {
  Column() {
    Text(`总价: ${this.items.reduce((sum, item) => sum + item.price, 0)}`)
  }
}

// ✅ 使用计算属性
@State items: Item[] = []

get totalPrice(): number {
  return this.items.reduce((sum, item) => sum + item.price, 0)
}

build() {
  Column() {
    Text(`总价: ${this.totalPrice}`)
  }
}
```

### 3. 对象解构

```typescript
// ✅ 高效
const { name, age, email } = user

// ❌ 低效
const name = user.name
const age = user.age
const email = user.email
```

## 💾 内存管理

### 1. 及时清理资源

```typescript
@Entry
@Component
struct MyComponent {
  private timer: number
  
  aboutToAppear() {
    this.timer = setInterval(() => {
      console.log('tick')
    }, 1000)
  }
  
  aboutToDisappear() {
    // ✅ 清理定时器
    clearInterval(this.timer)
  }
}
```

### 2. 避免内存泄漏

```typescript
// ❌ 可能导致内存泄漏
class EventBus {
  private listeners = []
  
  on(callback) {
    this.listeners.push(callback)
  }
}

// ✅ 提供移除方法
class EventBus {
  private listeners = new Set()
  
  on(callback) {
    this.listeners.add(callback)
    return () => this.listeners.delete(callback)
  }
}
```

## 🚀 编译优化

### 1. Tree Shaking

```typescript
// ✅ 只导入需要的
import { formatDate } from './utils'

// ❌ 导入全部
import * as utils from './utils'
```

### 2. 懒加载

```typescript
// 动态导入
async function loadFeature() {
  if (needFeature) {
    const module = await import('./feature')
    module.init()
  }
}
```

## 📊 性能监控

### 使用 hiTraceMeter

```typescript
import hiTraceMeter from '@ohos.hiTraceMeter'

function expensiveOperation() {
  hiTraceMeter.startTrace('ExpensiveOp', 1)
  
  // 耗时操作
  
  hiTraceMeter.finishTrace('ExpensiveOp', 1)
}
```

## 💡 最佳实践

1. ✅ 使用 const/let 替代 var
2. ✅ 及时清理定时器和监听器
3. ✅ 避免在循环中创建对象
4. ✅ 使用懒加载优化首屏
5. ✅ 合理使用缓存

## 📚 参考资源

- [性能优化指南](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/performance-optimization-overview-0000001581809185-V3)

---

**第2章完成！** 继续学习 → [第3章：ArkUI NEXT 框架](../03-arkui-next/)
