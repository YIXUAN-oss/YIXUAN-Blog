---
title: å¹¶å‘ä¸å¼‚æ­¥å¢å¼º
date: 2025-01-22
---

# å¹¶å‘ä¸å¼‚æ­¥å¢å¼º

> æŒæ¡ HarmonyOS NEXT çš„å¹¶å‘ç¼–ç¨‹

## ğŸ”„ Promise ä¸ async/await

### åŸºç¡€ç”¨æ³•

```typescript
// Promise åŸºç¡€
function fetchData(): Promise<string> {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve('æ•°æ®åŠ è½½å®Œæˆ')
    }, 1000)
  })
}

// async/await
async function loadData() {
  try {
    const data = await fetchData()
    console.log(data)
  } catch (error) {
    console.error('åŠ è½½å¤±è´¥:', error)
  }
}
```

### å¹¶è¡Œæ‰§è¡Œ

```typescript
// å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œ
async function loadAll() {
  const [user, orders, products] = await Promise.all([
    fetchUser(),
    fetchOrders(),
    fetchProducts()
  ])
  
  return { user, orders, products }
}

// Promise.race - å–æœ€å¿«çš„
async function quickFetch() {
  const result = await Promise.race([
    fetchFromCache(),
    fetchFromNetwork()
  ])
  return result
}
```

## âš¡ TaskPool ä»»åŠ¡æ± 

### åŸºæœ¬ä½¿ç”¨

```typescript
import taskpool from '@ohos.taskpool'

// å®šä¹‰å¹¶å‘ä»»åŠ¡
@Concurrent
function heavyComputation(numbers: number[]): number {
  return numbers.reduce((sum, num) => sum + num, 0)
}

// æ‰§è¡Œä»»åŠ¡
async function compute() {
  const data = Array.from({ length: 10000 }, (_, i) => i)
  
  const task = new taskpool.Task(heavyComputation, data)
  const result = await taskpool.execute(task)
  
  console.log('è®¡ç®—ç»“æœ:', result)
}
```

### ä»»åŠ¡ç»„

```typescript
// æ‰¹é‡æ‰§è¡Œä»»åŠ¡
async function batchProcess() {
  const tasks = [
    new taskpool.Task(processImage, image1),
    new taskpool.Task(processImage, image2),
    new taskpool.Task(processImage, image3)
  ]
  
  const group = new taskpool.TaskGroup()
  tasks.forEach(task => group.addTask(task))
  
  const results = await group.execute()
  console.log('å¤„ç†å®Œæˆ:', results)
}
```

## ğŸ‘· Worker å¹¶å‘

### åˆ›å»º Worker

```typescript
// ä¸»çº¿ç¨‹
import worker from '@ohos.worker'

const workerInstance = new worker.ThreadWorker('entry/ets/workers/MyWorker.ets')

// å‘é€æ¶ˆæ¯
workerInstance.postMessage({ type: 'start', data: [1, 2, 3] })

// æ¥æ”¶æ¶ˆæ¯
workerInstance.onmessage = (e) => {
  console.log('Worker è¿”å›:', e.data)
}

// Worker çº¿ç¨‹ (MyWorker.ets)
import worker from '@ohos.worker'

const parentPort = worker.workerPort

parentPort.onmessage = (e) => {
  const { type, data } = e.data
  
  if (type === 'start') {
    const result = processData(data)
    parentPort.postMessage({ result })
  }
}

function processData(data: number[]): number {
  return data.reduce((sum, num) => sum + num, 0)
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„å¹¶å‘æ–¹å¼

```typescript
// TaskPool - çŸ­æ—¶ä»»åŠ¡
@Concurrent
function quickTask(data: number): number {
  return data * 2
}

// Worker - é•¿æ—¶ä»»åŠ¡
// åœ¨ Worker.ets ä¸­å¤„ç†è€—æ—¶æ“ä½œ
```

### 2. é”™è¯¯å¤„ç†

```typescript
async function safeExecute() {
  try {
    const task = new taskpool.Task(compute, data)
    const result = await taskpool.execute(task)
    return result
  } catch (error) {
    console.error('ä»»åŠ¡æ‰§è¡Œå¤±è´¥:', error)
    return null
  }
}
```

### 3. é¿å…é˜»å¡ä¸»çº¿ç¨‹

```typescript
// âœ… è€—æ—¶æ“ä½œæ”¾åˆ°åå°
async function processLargeData(data: number[]) {
  const task = new taskpool.Task(heavyProcess, data)
  return await taskpool.execute(task)
}

// âŒ é¿å…åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ
function badProcess(data: number[]) {
  for (let i = 0; i < 1000000; i++) {
    // é˜»å¡ä¸»çº¿ç¨‹
  }
}
```

## ğŸ“š å‚è€ƒèµ„æº

- [TaskPool ä»»åŠ¡æ± ](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-taskpool-0000001820880665-V5)
- [Worker å·¥ä½œçº¿ç¨‹](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-worker-0000001821000441-V5)

---

**ä¸‹ä¸€èŠ‚** â†’ [ç±»å‹å®‰å…¨æœ€ä½³å®è·µ](05-ç±»å‹å®‰å…¨æœ€ä½³å®è·µ.md)
