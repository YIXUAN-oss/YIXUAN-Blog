---
title: è£…é¥°å™¨ç³»ç»Ÿå‡çº§
date: 2025-01-22
---

# è£…é¥°å™¨ç³»ç»Ÿå‡çº§

> æŒæ¡ HarmonyOS NEXT çš„æ ¸å¿ƒç‰¹æ€§

## ğŸ“Œ è£…é¥°å™¨æ¦‚è¿°

è£…é¥°å™¨æ˜¯ ArkTS çš„æ ¸å¿ƒç‰¹æ€§ï¼Œç”¨äºå£°æ˜ç»„ä»¶ã€çŠ¶æ€å’Œè¡Œä¸ºã€‚

### è£…é¥°å™¨åˆ†ç±»

```typescript
è£…é¥°å™¨ä½“ç³»
â”œâ”€ ç»„ä»¶è£…é¥°å™¨
â”‚   â”œâ”€ @Componentï¼ˆå®šä¹‰ç»„ä»¶ï¼‰
â”‚   â”œâ”€ @Entryï¼ˆå…¥å£ç»„ä»¶ï¼‰
â”‚   â””â”€ @Reusableï¼ˆå¯å¤ç”¨ç»„ä»¶ï¼‰
â”œâ”€ çŠ¶æ€è£…é¥°å™¨
â”‚   â”œâ”€ @Stateï¼ˆå†…éƒ¨çŠ¶æ€ï¼‰
â”‚   â”œâ”€ @Propï¼ˆå•å‘ä¼ é€’ï¼‰
â”‚   â”œâ”€ @Linkï¼ˆåŒå‘ç»‘å®šï¼‰
â”‚   â”œâ”€ @Provide/@Consumeï¼ˆè·¨ç»„ä»¶å…±äº«ï¼‰
â”‚   â””â”€ @ObservedV2/@Traceï¼ˆV2 ç‰ˆæœ¬ï¼‰â­ æ–°å¢
â””â”€ å…¶ä»–è£…é¥°å™¨
    â”œâ”€ @Watchï¼ˆç›‘å¬å˜åŒ–ï¼‰
    â”œâ”€ @Concurrentï¼ˆå¹¶å‘ä»»åŠ¡ï¼‰
    â””â”€ @Builderï¼ˆæ„å»ºå‡½æ•°ï¼‰
```

## ğŸ†• V2 çŠ¶æ€ç®¡ç†è£…é¥°å™¨

### @ObservedV2 å’Œ @Trace

```typescript
// æ–°ç‰ˆæœ¬ï¼ˆHarmonyOS NEXTï¼‰
@ObservedV2
class Person {
  @Trace name: string = ''      // ç»†ç²’åº¦ç›‘å¬
  @Trace age: number = 0
  city: string = ''              // ä¸ç›‘å¬
}

@Entry
@Component
struct PersonPage {
  @Local person: Person = new Person()
  
  build() {
    Column() {
      Text(`å§“å: ${this.person.name}`)
      Text(`å¹´é¾„: ${this.person.age}`)
      
      Button('ä¿®æ”¹å§“å')
        .onClick(() => {
          this.person.name = 'å¼ ä¸‰'  // UI è‡ªåŠ¨æ›´æ–°
        })
      
      Button('ä¿®æ”¹åŸå¸‚')
        .onClick(() => {
          this.person.city = 'åŒ—äº¬'  // UI ä¸æ›´æ–°ï¼ˆæœªç›‘å¬ï¼‰
        })
    }
  }
}
```

### å¯¹æ¯”æ—§ç‰ˆæœ¬

```typescript
// æ—§ç‰ˆæœ¬ï¼ˆHarmonyOS 4.0ï¼‰
@Observed
class Person {
  name: string = ''
  age: number = 0
}

// é—®é¢˜ï¼šæ•´ä¸ªå¯¹è±¡éƒ½ä¼šè¢«ç›‘å¬ï¼Œæ€§èƒ½å·®
```

## ğŸ¯ æ ¸å¿ƒè£…é¥°å™¨è¯¦è§£

### @Component - ç»„ä»¶è£…é¥°å™¨

```typescript
@Component
struct CustomButton {
  @Prop text: string = 'æŒ‰é’®'
  @Prop onClick: () => void
  
  build() {
    Button(this.text)
      .onClick(this.onClick)
      .backgroundColor(Color.Blue)
  }
}

// ä½¿ç”¨
@Entry
@Component
struct Index {
  build() {
    CustomButton({
      text: 'ç‚¹å‡»æˆ‘',
      onClick: () => console.log('Clicked')
    })
  }
}
```

### @State - å†…éƒ¨çŠ¶æ€

```typescript
@Entry
@Component
struct Counter {
  @State count: number = 0
  @State message: string = 'Hello'
  @State isVisible: boolean = true
  
  build() {
    Column() {
      if (this.isVisible) {
        Text(this.message)
        Text(`Count: ${this.count}`)
      }
      
      Button('å¢åŠ ')
        .onClick(() => {
          this.count++           // UI è‡ªåŠ¨æ›´æ–°
        })
      
      Button('åˆ‡æ¢æ˜¾ç¤º')
        .onClick(() => {
          this.isVisible = !this.isVisible
        })
    }
  }
}
```

### @Prop - å•å‘æ•°æ®æµ

```typescript
@Component
struct ChildComponent {
  @Prop title: string = ''
  @Prop count: number = 0
  
  build() {
    Column() {
      Text(this.title)
      Text(`Count: ${this.count}`)
      
      Button('å°è¯•ä¿®æ”¹')
        .onClick(() => {
          // âŒ ç¼–è¯‘é”™è¯¯ï¼š@Prop æ˜¯åªè¯»çš„
          // this.count++
        })
    }
  }
}

@Entry
@Component
struct ParentComponent {
  @State parentCount: number = 0
  
  build() {
    Column() {
      Text(`çˆ¶ç»„ä»¶: ${this.parentCount}`)
      
      ChildComponent({
        title: 'å­ç»„ä»¶',
        count: this.parentCount
      })
      
      Button('çˆ¶ç»„ä»¶ä¿®æ”¹')
        .onClick(() => {
          this.parentCount++  // å­ç»„ä»¶ä¼šæ›´æ–°
        })
    }
  }
}
```

### @Link - åŒå‘ç»‘å®š

```typescript
@Component
struct ChildComponent {
  @Link value: number  // åŒå‘ç»‘å®š
  
  build() {
    Column() {
      Text(`å­ç»„ä»¶: ${this.value}`)
      
      Button('å­ç»„ä»¶ä¿®æ”¹')
        .onClick(() => {
          this.value++  // çˆ¶ç»„ä»¶ä¹Ÿä¼šæ›´æ–°
        })
    }
  }
}

@Entry
@Component
struct ParentComponent {
  @State count: number = 0
  
  build() {
    Column() {
      Text(`çˆ¶ç»„ä»¶: ${this.count}`)
      
      // ä½¿ç”¨ $count ä¼ é€’å¼•ç”¨
      ChildComponent({ value: $count })
      
      Button('çˆ¶ç»„ä»¶ä¿®æ”¹')
        .onClick(() => {
          this.count++  // å­ç»„ä»¶ä¹Ÿä¼šæ›´æ–°
        })
    }
  }
}
```

### @Provide / @Consume - è·¨ç»„ä»¶å…±äº«

```typescript
@Entry
@Component
struct GrandParent {
  @Provide('theme') theme: string = 'light'
  
  build() {
    Column() {
      Parent()
      
      Button('åˆ‡æ¢ä¸»é¢˜')
        .onClick(() => {
          this.theme = this.theme === 'light' ? 'dark' : 'light'
        })
    }
  }
}

@Component
struct Parent {
  build() {
    Child()  // ä¸­é—´ç»„ä»¶ä¸éœ€è¦ä¼ é€’
  }
}

@Component
struct Child {
  @Consume('theme') theme: string  // ç›´æ¥æ¶ˆè´¹ç¥–å…ˆç»„ä»¶çš„çŠ¶æ€
  
  build() {
    Text(`å½“å‰ä¸»é¢˜: ${this.theme}`)
      .backgroundColor(this.theme === 'light' ? Color.White : Color.Black)
  }
}
```

## âš¡ é«˜çº§è£…é¥°å™¨

### @Watch - ç›‘å¬å˜åŒ–

```typescript
@Entry
@Component
struct WatchExample {
  @State @Watch('onCountChange') count: number = 0
  @State message: string = ''
  
  onCountChange() {
    this.message = `Count changed to ${this.count}`
    console.log('Count:', this.count)
  }
  
  build() {
    Column() {
      Text(this.message)
      Button(`Count: ${this.count}`)
        .onClick(() => this.count++)
    }
  }
}
```

### @Builder - è‡ªå®šä¹‰æ„å»ºå‡½æ•°

```typescript
@Entry
@Component
struct BuilderExample {
  @State selected: number = 0
  
  @Builder
  TabBuilder(index: number, name: string) {
    Column() {
      Text(name)
        .fontColor(this.selected === index ? Color.Blue : Color.Gray)
    }
    .onClick(() => {
      this.selected = index
    })
  }
  
  build() {
    Column() {
      Row() {
        this.TabBuilder(0, 'é¦–é¡µ')
        this.TabBuilder(1, 'æ¶ˆæ¯')
        this.TabBuilder(2, 'æˆ‘çš„')
      }
      
      if (this.selected === 0) {
        Text('é¦–é¡µå†…å®¹')
      } else if (this.selected === 1) {
        Text('æ¶ˆæ¯å†…å®¹')
      } else {
        Text('æˆ‘çš„å†…å®¹')
      }
    }
  }
}
```

### @Concurrent - å¹¶å‘ä»»åŠ¡

```typescript
import taskpool from '@ohos.taskpool'

@Concurrent
function heavyComputation(data: number[]): number {
  // è€—æ—¶è®¡ç®—
  return data.reduce((sum, num) => sum + num, 0)
}

@Entry
@Component
struct ConcurrentExample {
  @State result: number = 0
  
  async compute() {
    const data = Array.from({ length: 10000 }, (_, i) => i)
    
    // åœ¨åå°çº¿ç¨‹æ‰§è¡Œ
    const task = new taskpool.Task(heavyComputation, data)
    this.result = await taskpool.execute(task)
  }
  
  build() {
    Column() {
      Text(`Result: ${this.result}`)
      Button('è®¡ç®—')
        .onClick(() => this.compute())
    }
  }
}
```

## ğŸ“š æœ€ä½³å®è·µ

### 1. åˆç†ä½¿ç”¨çŠ¶æ€è£…é¥°å™¨

```typescript
// âœ… å¥½çš„å®è·µ
@Entry
@Component
struct GoodPractice {
  @State activeTab: number = 0        // éœ€è¦å“åº”å¼
  private readonly title: string = 'æ ‡é¢˜'  // ä¸éœ€è¦å“åº”å¼
  
  build() {
    Column() {
      Text(this.title)
      Tabs({ index: this.activeTab })
    }
  }
}

// âŒ é¿å…
@Entry
@Component
struct BadPractice {
  @State title: string = 'æ ‡é¢˜'  // ä¸éœ€è¦ @State
}
```

### 2. ä½¿ç”¨ V2 è£…é¥°å™¨æå‡æ€§èƒ½

```typescript
// âœ… æ¨èï¼šä½¿ç”¨ @ObservedV2 å’Œ @Trace
@ObservedV2
class User {
  @Trace name: string = ''
  @Trace age: number = 0
  address: string = ''  // ä¸éœ€è¦ç›‘å¬
}

// âŒ é¿å…ï¼šä½¿ç”¨ @Observed
@Observed
class User {
  name: string = ''
  age: number = 0
}
```

### 3. é¿å…è¿‡åº¦ä½¿ç”¨ @Link

```typescript
// âœ… åªåœ¨éœ€è¦åŒå‘ç»‘å®šæ—¶ä½¿ç”¨ @Link
@Component
struct Input {
  @Link text: string
  
  build() {
    TextInput({ text: this.text })
      .onChange((value) => {
        this.text = value
      })
  }
}

// âŒ ä¸éœ€è¦åŒå‘ç»‘å®šæ—¶ä½¿ç”¨ @Prop
@Component
struct Display {
  @Prop text: string
  
  build() {
    Text(this.text)
  }
}
```

## ğŸ“š å‚è€ƒèµ„æº

- [çŠ¶æ€ç®¡ç†ï¼ˆV2è¯•ç”¨ç‰ˆï¼‰](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-new-observedv2-and-trace-0000001820999489-V5)

---

**ä¸‹ä¸€èŠ‚** â†’ [å¹¶å‘ä¸å¼‚æ­¥å¢å¼º](04-å¹¶å‘ä¸å¼‚æ­¥å¢å¼º.md)
