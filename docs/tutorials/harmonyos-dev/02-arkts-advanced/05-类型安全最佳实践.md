---
title: 类型安全最佳实践
date: 2025-01-22
---

# 类型安全最佳实践

> 编写健壮的 TypeScript 代码

## 🛡️ 类型设计原则

### 1. 优先使用类型推导

```typescript
// ❌ 不必要的类型注解
const name: string = 'Alice'
const count: number = 0

// ✅ 让 TypeScript 推导
const name = 'Alice'
const count = 0
```

### 2. 使用严格的类型

```typescript
// ❌ 避免使用 any
function process(data: any) {
  return data
}

// ✅ 使用具体类型
function process<T>(data: T): T {
  return data
}

// ✅ 或使用 unknown
function process(data: unknown) {
  if (typeof data === 'string') {
    return data.toUpperCase()
  }
}
```

## ✅ null 安全

### 可选链操作符

```typescript
interface User {
  name: string
  address?: {
    city?: string
    street?: string
  }
}

const user: User = { name: 'Alice' }

// ✅ 安全访问
const city = user.address?.city ?? '未知城市'

// ❌ 不安全
const city = user.address.city  // 可能报错
```

### 空值合并

```typescript
// ✅ 使用 ??
const value = input ?? defaultValue

// ❌ 使用 ||（会将 0、'' 等视为假值）
const value = input || defaultValue
```

## 🎯 类型守卫

### 自定义类型守卫

```typescript
interface Fish {
  swim(): void
}

interface Bird {
  fly(): void
}

function isFish(pet: Fish | Bird): pet is Fish {
  return (pet as Fish).swim !== undefined
}

function move(pet: Fish | Bird) {
  if (isFish(pet)) {
    pet.swim()
  } else {
    pet.fly()
  }
}
```

## ❌ 错误处理

### Result 类型模式

```typescript
type Result<T, E = Error> = 
  | { success: true; value: T }
  | { success: false; error: E }

function divide(a: number, b: number): Result<number> {
  if (b === 0) {
    return {
      success: false,
      error: new Error('除数不能为0')
    }
  }
  
  return {
    success: true,
    value: a / b
  }
}

// 使用
const result = divide(10, 2)
if (result.success) {
  console.log(result.value)
} else {
  console.error(result.error.message)
}
```

## 💡 最佳实践

### 1. 启用严格模式

```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true
  }
}
```

### 2. 避免类型断言

```typescript
// ❌ 避免
const value = getData() as string

// ✅ 使用类型守卫
const value = getData()
if (typeof value === 'string') {
  console.log(value.toUpperCase())
}
```

### 3. 使用 const 断言

```typescript
// const 断言
const config = {
  apiUrl: 'https://api.example.com',
  timeout: 3000
} as const

// config.apiUrl = 'other'  // ❌ 只读
```

## 📚 参考资源

- [TypeScript 严格模式](https://www.typescriptlang.org/tsconfig#strict)

---

**下一节** → [性能优化技巧](06-性能优化技巧.md)
