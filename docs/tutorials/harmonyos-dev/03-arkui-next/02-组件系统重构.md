---
title: 组件系统重构
date: 2025-01-22
---

# 组件系统重构

> ArkUI NEXT 3.0 的组件体系全面升级

## 📦 组件分类

### 组件体系结构

```
ArkUI NEXT 组件
├─ 基础组件
│   ├─ Text（文本）
│   ├─ Image（图片）
│   ├─ Button（按钮）
│   ├─ TextInput（输入框）
│   └─ Progress（进度条）
├─ 容器组件
│   ├─ Column（垂直布局）
│   ├─ Row（水平布局）
│   ├─ Stack（层叠布局）
│   ├─ Flex（弹性布局）
│   └─ Grid（网格布局）
├─ 导航组件
│   ├─ Navigation（导航）
│   ├─ Tabs（标签页）
│   └─ Swiper（轮播）
└─ 列表组件
    ├─ List（列表）
    └─ Grid（网格）
```

## 🎨 基础组件升级

### 1. Text 组件增强

```typescript
@Entry
@Component
struct TextExample {
  build() {
    Column({ space: 20 }) {
      // 基础文本
      Text('基础文本')
        .fontSize(16)
        .fontColor(Color.Black)
      
      // 富文本
      Text() {
        Span('Hello ')
          .fontSize(20)
          .fontColor(Color.Red)
        Span('World')
          .fontSize(24)
          .fontColor(Color.Blue)
          .fontWeight(FontWeight.Bold)
      }
      
      // 文本装饰
      Text('下划线文本')
        .decoration({
          type: TextDecorationType.Underline,
          color: Color.Blue
        })
      
      // 文本溢出处理
      Text('这是一段很长的文本内容，会自动处理溢出情况')
        .maxLines(2)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
        .width('80%')
      
      // 文本选择
      Text('可选择的文本')
        .copyOption(CopyOptions.InApp)
    }
    .padding(20)
  }
}
```

### 2. Button 组件增强

```typescript
@Entry
@Component
struct ButtonExample {
  @State counter: number = 0
  
  build() {
    Column({ space: 15 }) {
      // 普通按钮
      Button('普通按钮')
        .type(ButtonType.Normal)
        .onClick(() => this.counter++)
      
      // 胶囊按钮
      Button('胶囊按钮')
        .type(ButtonType.Capsule)
        .backgroundColor(Color.Blue)
        .fontColor(Color.White)
      
      // 圆形按钮
      Button({ type: ButtonType.Circle }) {
        Image($r('app.media.icon_add'))
          .width(24)
          .height(24)
      }
      .width(60)
      .height(60)
      
      // 自定义按钮
      Button() {
        Row({ space: 8 }) {
          Image($r('app.media.icon_cart'))
            .width(20)
            .height(20)
          Text('加入购物车')
        }
      }
      .width(200)
      .height(50)
      
      // 按钮状态
      Button('禁用按钮')
        .enabled(false)
        .backgroundColor(Color.Gray)
      
      // 加载状态
      Button('加载中...')
        .stateEffect(true)
      
      Text(`点击次数: ${this.counter}`)
        .fontSize(18)
    }
    .width('100%')
    .padding(20)
  }
}
```

### 3. Image 组件增强

```typescript
@Entry
@Component
struct ImageExample {
  @State isLoading: boolean = true
  
  build() {
    Column({ space: 20 }) {
      // 本地资源
      Image($r('app.media.icon'))
        .width(100)
        .height(100)
      
      // 网络图片
      Image('https://example.com/image.jpg')
        .width(200)
        .height(200)
        .objectFit(ImageFit.Cover)
        .alt($r('app.media.placeholder'))  // 占位图
        .onComplete(() => {
          this.isLoading = false
          console.log('图片加载完成')
        })
        .onError(() => {
          console.error('图片加载失败')
        })
      
      // 圆形图片
      Image($r('app.media.avatar'))
        .width(80)
        .height(80)
        .borderRadius(40)
        .border({ width: 2, color: Color.White })
      
      // 图片插值
      Image($r('app.media.photo'))
        .interpolation(ImageInterpolation.High)
        .renderMode(ImageRenderMode.Original)
      
      // 图片填充模式
      Image($r('app.media.background'))
        .objectFit(ImageFit.Cover)  // Cover/Contain/Fill/ScaleDown
        .width('100%')
        .height(200)
    }
    .width('100%')
    .padding(20)
  }
}
```

### 4. TextInput 组件增强

```typescript
@Entry
@Component
struct InputExample {
  @State username: string = ''
  @State password: string = ''
  @State phone: string = ''
  @State code: string = ''
  
  build() {
    Column({ space: 15 }) {
      // 普通输入框
      TextInput({ placeholder: '请输入用户名' })
        .onChange((value: string) => {
          this.username = value
        })
        .maxLength(20)
      
      // 密码输入框
      TextInput({ placeholder: '请输入密码' })
        .type(InputType.Password)
        .onChange((value: string) => {
          this.password = value
        })
        .showPasswordIcon(true)
      
      // 手机号输入
      TextInput({ placeholder: '请输入手机号' })
        .type(InputType.PhoneNumber)
        .maxLength(11)
        .onChange((value: string) => {
          this.phone = value
        })
      
      // 验证码输入
      Row({ space: 10 }) {
        TextInput({ placeholder: '验证码' })
          .type(InputType.Number)
          .maxLength(6)
          .layoutWeight(1)
          .onChange((value: string) => {
            this.code = value
          })
        
        Button('获取验证码')
          .width(120)
      }
      .width('100%')
      
      // 多行输入
      TextArea({ placeholder: '请输入内容' })
        .height(100)
        .onChange((value: string) => {
          console.log('内容:', value)
        })
      
      // 带清除按钮
      TextInput({ placeholder: '搜索' })
        .enterKeyType(EnterKeyType.Search)
        .onSubmit(() => {
          console.log('搜索:', this.username)
        })
      
      Button('提交')
        .width('100%')
        .onClick(() => {
          console.log({
            username: this.username,
            password: this.password,
            phone: this.phone
          })
        })
    }
    .width('100%')
    .padding(20)
  }
}
```

## 📐 容器组件升级

### 1. Column 增强

```typescript
Column({ space: 10 }) {  // 子组件间距
  Text('Item 1')
  Text('Item 2')
  Text('Item 3')
}
.width('100%')
.height(200)
.justifyContent(FlexAlign.SpaceBetween)   // 垂直对齐
.alignItems(HorizontalAlign.Center)       // 水平对齐
.padding(20)
.backgroundColor(Color.White)
```

### 2. Row 增强

```typescript
Row({ space: 10 }) {
  Text('Left')
    .layoutWeight(1)
  Text('Center')
    .layoutWeight(2)
  Text('Right')
    .layoutWeight(1)
}
.width('100%')
.height(60)
.justifyContent(FlexAlign.SpaceBetween)
.alignItems(VerticalAlign.Center)
```

### 3. Stack 层叠布局

```typescript
Stack({ alignContent: Alignment.BottomEnd }) {
  Image($r('app.media.background'))
    .width('100%')
    .height('100%')
  
  Text('水印')
    .fontSize(12)
    .fontColor(Color.White)
    .padding(10)
    .backgroundColor(0x80000000)
}
.width('100%')
.height(200)
```

### 4. Flex 弹性布局

```typescript
Flex({
  direction: FlexDirection.Row,
  wrap: FlexWrap.Wrap,
  justifyContent: FlexAlign.SpaceBetween,
  alignItems: ItemAlign.Center
}) {
  Text('Item 1')
    .flexGrow(1)
    .backgroundColor(Color.Red)
  
  Text('Item 2')
    .flexGrow(2)
    .backgroundColor(Color.Blue)
  
  Text('Item 3')
    .flexShrink(1)
    .backgroundColor(Color.Green)
}
.width('100%')
.height(200)
```

## 🔄 组件生命周期

### 生命周期钩子

```typescript
@Entry
@Component
struct LifecycleExample {
  @State message: string = ''
  
  // 组件即将出现
  aboutToAppear() {
    console.log('组件即将出现')
    this.message = '初始化数据'
  }
  
  // 组件即将消失
  aboutToDisappear() {
    console.log('组件即将消失')
    // 清理资源
  }
  
  // 组件显示
  onPageShow() {
    console.log('页面显示')
  }
  
  // 组件隐藏
  onPageHide() {
    console.log('页面隐藏')
  }
  
  build() {
    Column() {
      Text(this.message)
    }
  }
}
```

### 生命周期顺序

```
创建阶段：
1. constructor()
2. aboutToAppear()
3. build()

更新阶段：
1. build() - 状态变化时重新构建

销毁阶段：
1. aboutToDisappear()
```

## 🎯 自定义组件

### 基础自定义组件

```typescript
@Component
struct CustomCard {
  @Prop title: string = ''
  @Prop content: string = ''
  
  build() {
    Column({ space: 10 }) {
      Text(this.title)
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
      
      Text(this.content)
        .fontSize(14)
        .fontColor(Color.Gray)
    }
    .width('100%')
    .padding(15)
    .backgroundColor(Color.White)
    .borderRadius(8)
    .shadow({
      radius: 10,
      color: 0x20000000,
      offsetX: 0,
      offsetY: 2
    })
  }
}

// 使用
@Entry
@Component
struct HomePage {
  build() {
    Column({ space: 15 }) {
      CustomCard({
        title: '标题1',
        content: '这是内容1'
      })
      
      CustomCard({
        title: '标题2',
        content: '这是内容2'
      })
    }
    .padding(20)
  }
}
```

### 带插槽的组件

```typescript
@Component
struct Card {
  @Prop title: string
  @BuilderParam content: () => void  // 插槽
  
  build() {
    Column() {
      Text(this.title)
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .padding(10)
      
      Divider()
      
      // 渲染插槽内容
      this.content()
    }
    .width('100%')
    .backgroundColor(Color.White)
    .borderRadius(8)
  }
}

// 使用
@Entry
@Component
struct HomePage {
  @Builder
  cardContent() {
    Column({ space: 10 }) {
      Text('自定义内容1')
      Text('自定义内容2')
      Button('操作按钮')
    }
    .padding(15)
  }
  
  build() {
    Card({
      title: '卡片标题',
      content: this.cardContent
    })
  }
}
```

## 💡 最佳实践

### 1. 组件拆分原则

```typescript
// ✅ 单一职责 - 每个组件只做一件事
@Component
struct UserAvatar {
  @Prop url: string
  @Prop size: number = 50
  
  build() {
    Image(this.url)
      .width(this.size)
      .height(this.size)
      .borderRadius(this.size / 2)
  }
}

@Component
struct UserInfo {
  @Prop name: string
  @Prop email: string
  
  build() {
    Column({ space: 5 }) {
      Text(this.name)
        .fontSize(16)
        .fontWeight(FontWeight.Bold)
      Text(this.email)
        .fontSize(14)
        .fontColor(Color.Gray)
    }
    .alignItems(HorizontalAlign.Start)
  }
}
```

### 2. 避免过度嵌套

```typescript
// ❌ 避免
Column() {
  Row() {
    Column() {
      Row() {
        Text('深层嵌套')
      }
    }
  }
}

// ✅ 提取组件
@Component
struct Content {
  build() {
    Text('清晰结构')
  }
}
```

### 3. 性能优化

```typescript
// ✅ 使用 @Reusable 标记可复用组件
@Reusable
@Component
struct ListItem {
  @Prop data: ItemData
  
  aboutToReuse(params: Record<string, Object>) {
    this.data = params.data as ItemData
  }
  
  build() {
    Row() {
      Text(this.data.title)
    }
  }
}
```

## 📚 参考资源

- [Text 组件](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-text-0000001815767568-V5)

---

**下一节** → [新增组件库](03-新增组件库.md)
