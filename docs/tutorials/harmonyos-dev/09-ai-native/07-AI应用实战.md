---
title: AI 应用实战
date: 2025-01-22
---

# AI 应用实战

> 综合AI能力的实战项目

## 🎤 智能语音助手

### 完整实现

```typescript
@Entry
@Component
struct SmartAssistant {
  @State transcript: string = ''
  @State response: string = ''
  @State isListening: boolean = false
  @State conversation: Message[] = []
  
  private recognizer: SpeechRecognizer
  private tts: TTS
  private nlp: NLPEngine
  
  async aboutToAppear() {
    await this.initAI()
  }
  
  async initAI() {
    // 初始化语音识别
    this.recognizer = speechRecognizer.create({
      language: 'zh-CN',
      continuous: false
    })
    
    // 初始化语音合成
    this.tts = textToSpeech.create({
      language: 'zh-CN',
      voice: 'female'
    })
    
    // 初始化NLP
    this.nlp = nlpEngine.create()
  }
  
  async startListening() {
    this.isListening = true
    
    this.recognizer.on('result', async (result) => {
      const userInput = result.text
      this.transcript = userInput
      
      // 添加到对话历史
      this.conversation.push({
        role: 'user',
        content: userInput,
        timestamp: Date.now()
      })
      
      // 处理指令
      const response = await this.processCommand(userInput)
      
      // 添加助手回复
      this.conversation.push({
        role: 'assistant',
        content: response,
        timestamp: Date.now()
      })
      
      // 语音播报
      await this.speak(response)
      
      this.isListening = false
    })
    
    this.recognizer.start()
  }
  
  async processCommand(command: string): Promise<string> {
    // 1. 意图识别
    const intent = await this.nlp.detectIntent(command)
    
    switch (intent.type) {
      case 'WEATHER':
        return await this.getWeather(intent.location)
      
      case 'TIME':
        return this.getTime()
      
      case 'REMINDER':
        return await this.setReminder(intent.params)
      
      case 'SEARCH':
        return await this.search(intent.query)
      
      case 'TRANSLATE':
        return await this.translate(intent.text, intent.targetLang)
      
      default:
        return '抱歉，我还不能理解这个指令'
    }
  }
  
  async getWeather(location: string): Promise<string> {
    // 调用天气API
    const weather = await weatherService.get(location)
    return `${location}今天${weather.condition}，温度${weather.temperature}度`
  }
  
  getTime(): string {
    const now = new Date()
    return `现在是${now.getHours()}点${now.getMinutes()}分`
  }
  
  async setReminder(params: any): Promise<string> {
    await reminderService.create(params)
    return `好的，我已经设置了提醒`
  }
  
  async search(query: string): Promise<string> {
    const results = await searchService.search(query)
    return `我为你找到了${results.length}条结果`
  }
  
  async translate(text: string, targetLang: string): Promise<string> {
    const result = await translator.translate(text, targetLang)
    return `翻译结果：${result.text}`
  }
  
  async speak(text: string) {
    await this.tts.speak(text)
  }
  
  build() {
    Column({ space: 20 }) {
      // 标题
      Text('智能语音助手')
        .fontSize(28)
        .fontWeight(FontWeight.Bold)
      
      // 对话历史
      List({ space: 15 }) {
        ForEach(this.conversation, (msg: Message) => {
          ListItem() {
            Row() {
              if (msg.role === 'assistant') {
                Blank()
              }
              
              Column({ space: 5 }) {
                Text(msg.content)
                  .fontSize(16)
                  .padding(15)
                  .backgroundColor(msg.role === 'user' ? 0x3B82F6 : 0xE5E7EB)
                  .fontColor(msg.role === 'user' ? Color.White : Color.Black)
                  .borderRadius(12)
                  .maxWidth('80%')
                
                Text(new Date(msg.timestamp).toLocaleTimeString())
                  .fontSize(12)
                  .fontColor(Color.Gray)
              }
              
              if (msg.role === 'user') {
                Blank()
              }
            }
            .width('100%')
          }
        })
      }
      .layoutWeight(1)
      .scrollBar(BarState.Off)
      
      // 控制按钮
      Button(this.isListening ? '正在听...' : '点击说话')
        .width(200)
        .height(60)
        .fontSize(18)
        .backgroundColor(this.isListening ? Color.Red : Color.Blue)
        .onClick(() => {
          if (!this.isListening) {
            this.startListening()
          }
        })
    }
    .width('100%')
    .height('100%')
    .padding(20)
    .backgroundColor(0xF5F5F5)
  }
}

interface Message {
  role: 'user' | 'assistant'
  content: string
  timestamp: number
}
```

## 📸 智能相册

### AI 照片管理

```typescript
@Entry
@Component
struct SmartAlbum {
  @State photos: SmartPhoto[] = []
  @State searchQuery: string = ''
  @State selectedTags: string[] = []
  
  private classifier: ImageClassifier
  private faceDetector: FaceDetector
  
  async aboutToAppear() {
    await this.initAI()
    await this.scanPhotos()
  }
  
  async initAI() {
    this.classifier = imageClassifier.create()
    this.faceDetector = faceDetector.create()
  }
  
  async scanPhotos() {
    const allPhotos = await photoLibrary.getAll()
    
    for (const photo of allPhotos) {
      const imageData = await photo.getData()
      
      // 图像分类
      const tags = await this.classifier.classify(imageData)
      
      // 人脸检测
      const faces = await this.faceDetector.detect(imageData)
      
      // OCR 文字识别
      const text = await ocrEngine.recognize(imageData)
      
      this.photos.push({
        id: photo.id,
        path: photo.path,
        tags: tags.map(t => t.label),
        faces: faces.length,
        text: text,
        timestamp: photo.timestamp
      })
    }
  }
  
  async searchPhotos(query: string) {
    return this.photos.filter(photo => {
      // 标签匹配
      const tagMatch = photo.tags.some(tag => 
        tag.toLowerCase().includes(query.toLowerCase())
      )
      
      // 文字匹配
      const textMatch = photo.text && 
        photo.text.toLowerCase().includes(query.toLowerCase())
      
      return tagMatch || textMatch
    })
  }
  
  build() {
    Column() {
      // 搜索栏
      SearchBar({
        placeholder: '搜索照片（如：猫、海滩、文字）',
        onSearch: async (query) => {
          const results = await this.searchPhotos(query)
          this.photos = results
        }
      })
      
      // 标签过滤
      Scroll(Axis.Horizontal) {
        Row({ space: 10 }) {
          ForEach(['人物', '风景', '美食', '宠物', '建筑'], (tag: string) => {
            Button(tag)
              .fontSize(14)
              .onClick(() => {
                this.searchPhotos(tag)
              })
          })
        }
      }
      .padding({ left: 15, right: 15 })
      
      // 照片网格
      Grid() {
        ForEach(this.photos, (photo: SmartPhoto) => {
          GridItem() {
            Column() {
              Image(photo.path)
                .width('100%')
                .aspectRatio(1)
                .borderRadius(8)
              
              // 标签
              Text(photo.tags.slice(0, 2).join(', '))
                .fontSize(12)
                .maxLines(1)
            }
          }
        })
      }
      .columnsTemplate('1fr 1fr 1fr')
      .rowsGap(10)
      .columnsGap(10)
      .padding(15)
    }
  }
}
```

## 🌐 实时翻译器

### 多模态翻译

```typescript
@Entry
@Component
struct MultiModalTranslator {
  @State sourceText: string = ''
  @State translatedText: string = ''
  @State mode: 'text' | 'voice' | 'camera' = 'text'
  
  private translator: Translator
  private recognizer: SpeechRecognizer
  private ocrEngine: OCREngine
  
  async translateText(text: string) {
    this.sourceText = text
    const result = await this.translator.translate(text, {
      from: 'auto',
      to: 'en-US'
    })
    this.translatedText = result.text
  }
  
  async translateVoice() {
    this.recognizer.on('result', async (result) => {
      await this.translateText(result.text)
    })
    this.recognizer.start()
  }
  
  async translateCamera(imagePath: string) {
    const imageData = await loadImage(imagePath)
    const text = await this.ocrEngine.recognize(imageData)
    await this.translateText(text)
  }
  
  build() {
    Column() {
      // 模式切换
      Tabs() {
        TabContent() {
          TextTranslator({ onTranslate: this.translateText.bind(this) })
        }.tabBar('文字')
        
        TabContent() {
          VoiceTranslator({ onTranslate: this.translateVoice.bind(this) })
        }.tabBar('语音')
        
        TabContent() {
          CameraTranslator({ onTranslate: this.translateCamera.bind(this) })
        }.tabBar('拍照')
      }
    }
  }
}
```

## 💡 性能优化

### 1. 模型预加载

```typescript
// 应用启动时预加载
async function preloadModels() {
  await Promise.all([
    imageClassifier.create(),
    speechRecognizer.create(),
    translator.create()
  ])
}
```

### 2. 结果缓存

```typescript
const cache = new LRUCache<string, any>(100)

async function classifyWithCache(image: ImageData) {
  const key = getImageHash(image)
  
  if (cache.has(key)) {
    return cache.get(key)
  }
  
  const result = await classifier.classify(image)
  cache.set(key, result)
  return result
}
```

### 3. 后台处理

```typescript
import worker from '@ohos.worker'

// 在 Worker 中处理耗时任务
const aiWorker = new worker.ThreadWorker('workers/ai_worker.ts')

aiWorker.postMessage({ type: 'classify', image: imageData })

aiWorker.on('message', (result) => {
  console.log('分类结果:', result)
})
```

## 📚 参考资源

- [AI能力开发指南](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ai-development-intro-0000001820880589-V5)

---

**第9章完成！** 继续学习 → [第10章：分布式能力升级](../10-distributed-next/)
