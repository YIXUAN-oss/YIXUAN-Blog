---
title: 端侧 AI 概述
date: 2025-01-22
---

# 端侧 AI 概述

> HarmonyOS NEXT 的核心竞争力 - AI 原生化

## 🤖 什么是端侧 AI

### 云端 AI vs 端侧 AI

| 特性 | 云端 AI | 端侧 AI |
|------|--------|---------|
| **响应速度** | 慢（网络延迟） | 快（毫秒级） |
| **隐私保护** | 数据上传到云端 | 数据不离设备 ⭐ |
| **离线可用** | 需要网络 | 完全离线 ⭐ |
| **计算资源** | 云端服务器 | 本地硬件 |
| **成本** | 按使用计费 | 一次性成本 |
| **模型规模** | 大模型 | 轻量化模型 |

### 端侧 AI 优势

```
端侧 AI = 
├─ 🚀 极速响应（<100ms）
├─ 🔒 隐私安全（数据不出设备）
├─ 📡 离线可用（无需网络）
├─ 💰 降低成本（无云端费用）
└─ 🎯 个性化（本地学习）
```

## 🏗️ HarmonyOS NEXT AI 架构

### 整体架构

```
┌──────────────────────────────────┐
│     应用层 (Application)           │
│  ├─ 语音助手                       │
│  ├─ 智能相册                       │
│  └─ 实时翻译                       │
├──────────────────────────────────┤
│     AI Engine API                 │
│  ├─ 语音识别/合成                  │
│  ├─ 图像识别/分类                  │
│  ├─ 自然语言处理                   │
│  └─ 模型管理                       │
├──────────────────────────────────┤
│     AI 推理引擎                    │
│  ├─ MindSpore Lite               │
│  ├─ ONNX Runtime                 │
│  └─ TensorFlow Lite              │
├──────────────────────────────────┤
│     硬件加速层                     │
│  ├─ NPU（神经网络处理器）           │
│  ├─ GPU                          │
│  └─ DSP                          │
└──────────────────────────────────┘
```

### AI Engine 核心能力

```typescript
AI Engine
├─ 语音能力
│   ├─ 语音识别 (ASR)
│   ├─ 语音合成 (TTS)
│   ├─ 声纹识别
│   └─ 语音唤醒
├─ 视觉能力
│   ├─ 图像分类
│   ├─ 目标检测
│   ├─ 人脸识别
│   ├─ OCR 文字识别
│   └─ 图像分割
├─ 语言能力
│   ├─ 文本分类
│   ├─ 情感分析
│   ├─ 命名实体识别
│   ├─ 机器翻译
│   └─ 文本生成
└─ 多模态
    ├─ 图文理解
    ├─ 视频理解
    └─ 跨模态检索
```

## 🎯 核心 API 概览

### 1. AI Engine 初始化

```typescript
import { aiEngine } from '@ohos.ai.engine'

// 初始化 AI Engine
const engine = aiEngine.create({
  enableNPU: true,      // 启用 NPU 加速
  enableGPU: true,      // 启用 GPU 加速
  threads: 4,           // 线程数
  priority: 'high'      // 优先级
})
```

### 2. 语音识别示例

```typescript
import { speechRecognizer } from '@ohos.ai.speech'

// 创建语音识别器
const recognizer = speechRecognizer.create({
  language: 'zh-CN',
  continuous: true,
  enablePunctuation: true
})

// 开始识别
recognizer.start()

// 监听识别结果
recognizer.on('result', (result) => {
  console.log('识别结果:', result.text)
  console.log('置信度:', result.confidence)
})

// 停止识别
recognizer.stop()
```

### 3. 图像识别示例

```typescript
import { imageClassifier } from '@ohos.ai.vision'

// 创建图像分类器
const classifier = imageClassifier.create({
  modelType: 'MobileNetV3',
  topK: 5  // 返回前5个结果
})

// 加载图片
const imageData = await loadImage('path/to/image.jpg')

// 执行分类
const results = await classifier.classify(imageData)

results.forEach((result, index) => {
  console.log(`${index + 1}. ${result.label}: ${result.confidence}`)
})
```

### 4. 文本分类示例

```typescript
import { textClassifier } from '@ohos.ai.nlp'

// 创建文本分类器
const classifier = textClassifier.create({
  modelPath: 'sentiment_analysis.ms',
  labels: ['正面', '负面', '中性']
})

// 分类文本
const text = '这个产品非常好用，我很满意！'
const result = await classifier.classify(text)

console.log('情感:', result.label)
console.log('置信度:', result.confidence)
```

## 🚀 应用场景

### 1. 智能语音助手

```typescript
@Entry
@Component
struct VoiceAssistant {
  @State transcript: string = ''
  @State isListening: boolean = false
  private recognizer: SpeechRecognizer
  
  async startListening() {
    this.recognizer = speechRecognizer.create({
      language: 'zh-CN'
    })
    
    this.recognizer.on('result', (result) => {
      this.transcript = result.text
      this.handleCommand(result.text)
    })
    
    await this.recognizer.start()
    this.isListening = true
  }
  
  handleCommand(command: string) {
    if (command.includes('打开相机')) {
      // 打开相机
    } else if (command.includes('播放音乐')) {
      // 播放音乐
    }
  }
  
  build() {
    Column() {
      Text(this.transcript)
        .fontSize(18)
      
      Button(this.isListening ? '停止' : '开始')
        .onClick(() => {
          if (this.isListening) {
            this.recognizer.stop()
            this.isListening = false
          } else {
            this.startListening()
          }
        })
    }
  }
}
```

### 2. 智能相册

```typescript
@Entry
@Component
struct SmartAlbum {
  @State photos: Photo[] = []
  @State searchResults: Photo[] = []
  private classifier: ImageClassifier
  
  async aboutToAppear() {
    this.classifier = imageClassifier.create()
    await this.scanPhotos()
  }
  
  async scanPhotos() {
    const allPhotos = await getPhotoList()
    
    for (const photo of allPhotos) {
      const imageData = await loadPhoto(photo.path)
      const tags = await this.classifier.classify(imageData)
      
      photo.tags = tags.map(t => t.label)
      this.photos.push(photo)
    }
  }
  
  async searchByText(query: string) {
    // 根据标签搜索照片
    this.searchResults = this.photos.filter(photo => 
      photo.tags.some(tag => tag.includes(query))
    )
  }
  
  build() {
    Column() {
      SearchBar({ 
        onSearch: (text) => this.searchByText(text) 
      })
      
      Grid() {
        ForEach(this.searchResults, (photo: Photo) => {
          GridItem() {
            Image(photo.path)
          }
        })
      }
    }
  }
}
```

### 3. 实时翻译

```typescript
@Entry
@Component
struct RealtimeTranslator {
  @State sourceText: string = ''
  @State translatedText: string = ''
  private translator: Translator
  
  async aboutToAppear() {
    this.translator = translator.create({
      sourceLang: 'zh',
      targetLang: 'en',
      offline: true  // 离线翻译
    })
  }
  
  async translate() {
    const result = await this.translator.translate(this.sourceText)
    this.translatedText = result.text
  }
  
  build() {
    Column() {
      TextArea({ 
        placeholder: '输入中文' 
      })
        .onChange((value) => {
          this.sourceText = value
          this.translate()  // 实时翻译
        })
      
      Divider()
      
      Text(this.translatedText)
        .fontSize(18)
        .padding(20)
    }
  }
}
```

## 💡 性能优化

### 1. 模型加载优化

```typescript
// ❌ 每次都加载模型
async function classify(image) {
  const classifier = await imageClassifier.create()
  return await classifier.classify(image)
}

// ✅ 复用模型实例
class ImageService {
  private classifier: ImageClassifier
  
  async init() {
    this.classifier = await imageClassifier.create()
  }
  
  async classify(image) {
    return await this.classifier.classify(image)
  }
}
```

### 2. 硬件加速

```typescript
// 启用 NPU 加速
const classifier = imageClassifier.create({
  enableNPU: true,        // NPU 加速
  enableGPU: true,        // GPU 加速
  enableDSP: true,        // DSP 加速
  precision: 'FP16'       // 半精度计算
})
```

### 3. 批处理

```typescript
// ✅ 批量处理提高效率
async function batchClassify(images: ImageData[]) {
  const classifier = await imageClassifier.create()
  const results = await classifier.batchClassify(images, {
    batchSize: 32  // 批量大小
  })
  return results
}
```

## 🔒 隐私保护

### 数据不出设备

```typescript
// 所有 AI 推理都在本地完成
const result = await classifier.classify(imageData)
// imageData 从未上传到云端

// 用户数据完全本地化
const userProfile = {
  preferences: localAI.analyze(userBehavior),
  recommendations: localAI.recommend(userHistory)
}
```

### 权限管理

```typescript
// 请求 AI 能力权限
const permissions = [
  'ohos.permission.MICROPHONE',       // 麦克风（语音识别）
  'ohos.permission.CAMERA',           // 相机（图像识别）
  'ohos.permission.READ_MEDIA'        // 读取媒体（图片分析）
]

await requestPermissions(permissions)
```

## 📊 性能指标

### 推理速度

| 任务类型 | 模型大小 | NPU 推理时间 | CPU 推理时间 |
|---------|---------|-------------|-------------|
| 图像分类 | 5MB | 10ms | 100ms |
| 目标检测 | 20MB | 50ms | 500ms |
| 语音识别 | 10MB | 20ms | 200ms |
| 文本分类 | 2MB | 5ms | 50ms |

### 功耗对比

```
推理 1000 次图像分类任务：
├─ NPU: 30mAh
├─ GPU: 50mAh
└─ CPU: 100mAh
```

## 🎓 学习路径

### 初级（1-2周）

1. ✅ 理解端侧 AI 概念
2. ✅ 学习 AI Engine API
3. ✅ 运行示例代码
4. ✅ 完成简单 Demo

### 中级（3-4周）

1. ✅ 集成各种 AI 能力
2. ✅ 优化模型性能
3. ✅ 处理实际场景
4. ✅ 完成中等项目

### 高级（5-8周）

1. ✅ 自定义模型训练
2. ✅ 模型转换和部署
3. ✅ 复杂场景优化
4. ✅ 完成产品级应用

## 📚 参考资源

- [AI能力概述](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ai-overview-0000001820880597-V5)
- [MindSpore Lite推理](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/mindspore-lite-guidelines-0000001774121034-V5)
- [MindSpore官网](https://www.mindspore.cn/lite)

---

**下一节** → [AI Engine API](02-AI-Engine-API.md)
