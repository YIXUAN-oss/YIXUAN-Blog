---
title: 语音识别与合成
date: 2025-01-22
---

# 语音识别与合成

> 实现语音交互功能

## 🎤 语音识别（ASR）

### 基础语音识别

```typescript
import { speechRecognizer } from '@ohos.ai.speech'

// 创建识别器
const recognizer = speechRecognizer.create({
  language: 'zh-CN',
  continuous: true,
  enablePunctuation: true
})

// 开始识别
recognizer.start()

// 监听识别结果
recognizer.on('result', (result) => {
  console.log('识别结果:', result.text)
  console.log('置信度:', result.confidence)
})

// 监听错误
recognizer.on('error', (err) => {
  console.error('识别错误:', err)
})

// 停止识别
recognizer.stop()
```

### 实时语音识别

```typescript
@Entry
@Component
struct VoiceRecognition {
  @State transcript: string = ''
  @State isListening: boolean = false
  private recognizer: SpeechRecognizer
  
  startListening() {
    this.recognizer = speechRecognizer.create({
      language: 'zh-CN',
      continuous: true
    })
    
    this.recognizer.on('result', (result) => {
      this.transcript = result.text
    })
    
    this.recognizer.on('partialResult', (result) => {
      // 实时显示部分结果
      this.transcript = result.text
    })
    
    this.recognizer.start()
    this.isListening = true
  }
  
  stopListening() {
    this.recognizer.stop()
    this.isListening = false
  }
  
  build() {
    Column({ space: 20 }) {
      Text(this.transcript || '请说话...')
        .fontSize(18)
        .padding(20)
        .backgroundColor(0xF5F5F5)
        .width('100%')
        .minHeight(100)
      
      Button(this.isListening ? '停止' : '开始识别')
        .width(200)
        .onClick(() => {
          if (this.isListening) {
            this.stopListening()
          } else {
            this.startListening()
          }
        })
    }
    .padding(20)
  }
}
```

## 🔊 语音合成（TTS）

### 基础语音合成

```typescript
import { textToSpeech } from '@ohos.ai.speech'

// 创建合成器
const tts = textToSpeech.create({
  language: 'zh-CN',
  voice: 'female',
  speed: 1.0,
  pitch: 1.0
})

// 合成语音
await tts.speak('你好，欢迎使用语音助手')

// 监听合成进度
tts.on('progress', (progress) => {
  console.log('合成进度:', progress)
})

// 监听完成
tts.on('complete', () => {
  console.log('合成完成')
})

// 停止合成
tts.stop()
```

### 语音播报

```typescript
@Entry
@Component
struct TextToSpeech {
  @State text: string = ''
  @State isSpeaking: boolean = false
  private tts: TTS
  
  async speak() {
    if (!this.text.trim()) return
    
    this.tts = textToSpeech.create({
      language: 'zh-CN',
      voice: 'female',
      speed: 1.0
    })
    
    this.tts.on('start', () => {
      this.isSpeaking = true
    })
    
    this.tts.on('complete', () => {
      this.isSpeaking = false
    })
    
    await this.tts.speak(this.text)
  }
  
  stop() {
    if (this.tts) {
      this.tts.stop()
      this.isSpeaking = false
    }
  }
  
  build() {
    Column({ space: 20 }) {
      TextArea({ placeholder: '输入要朗读的文本' })
        .height(200)
        .onChange((value) => {
          this.text = value
        })
      
      Row({ space: 10 }) {
        Button('朗读')
          .onClick(() => {
            this.speak()
          })
        
        Button('停止')
          .onClick(() => {
            this.stop()
          })
          .enabled(this.isSpeaking)
      }
    }
    .padding(20)
  }
}
```

## 🎯 实战案例：语音助手

```typescript
@Entry
@Component
struct VoiceAssistant {
  @State transcript: string = ''
  @State response: string = ''
  @State isListening: boolean = false
  private recognizer: SpeechRecognizer
  private tts: TTS
  
  async startVoiceCommand() {
    // 语音识别
    this.recognizer = speechRecognizer.create({
      language: 'zh-CN'
    })
    
    this.recognizer.on('result', async (result) => {
      this.transcript = result.text
      
      // 处理命令
      const response = await this.processCommand(result.text)
      this.response = response
      
      // 语音播报
      this.speak(response)
    })
    
    this.recognizer.start()
    this.isListening = true
  }
  
  async processCommand(command: string): Promise<string> {
    if (command.includes('天气')) {
      return '今天天气晴朗，温度25度'
    } else if (command.includes('时间')) {
      const now = new Date()
      return `现在是${now.getHours()}点${now.getMinutes()}分`
    } else {
      return '抱歉，我没有理解您的指令'
    }
  }
  
  async speak(text: string) {
    this.tts = textToSpeech.create({
      language: 'zh-CN'
    })
    
    await this.tts.speak(text)
  }
  
  build() {
    Column({ space: 20 }) {
      Text('语音助手')
        .fontSize(24)
        .fontWeight(FontWeight.Bold)
      
      Column({ space: 10 }) {
        Text('您说：')
          .fontSize(14)
          .fontColor(Color.Gray)
        
        Text(this.transcript || '点击开始说话')
          .fontSize(18)
          .padding(15)
          .backgroundColor(0xF5F5F5)
          .width('100%')
          .borderRadius(8)
      }
      
      Column({ space: 10 }) {
        Text('助手回复：')
          .fontSize(14)
          .fontColor(Color.Gray)
        
        Text(this.response || '等待回复')
          .fontSize(18)
          .padding(15)
          .backgroundColor(0xE3F2FD)
          .width('100%')
          .borderRadius(8)
      }
      
      Button(this.isListening ? '停止' : '开始对话')
        .width(200)
        .height(60)
        .fontSize(18)
        .onClick(() => {
          if (this.isListening) {
            this.recognizer.stop()
            this.isListening = false
          } else {
            this.startVoiceCommand()
          }
        })
    }
    .padding(20)
    .width('100%')
  }
}
```

## 💡 最佳实践

### 1. 权限申请

```json5
// module.json5
{
  "requestPermissions": [
    {
      "name": "ohos.permission.MICROPHONE",
      "reason": "用于语音识别"
    }
  ]
}
```

### 2. 降噪处理

```typescript
const recognizer = speechRecognizer.create({
  enableNoiseReduction: true,  // 启用降噪
  enableEchoCancellation: true  // 回声消除
})
```

### 3. 错误处理

```typescript
recognizer.on('error', (err) => {
  if (err.code === 'NO_MICROPHONE') {
    showError('未检测到麦克风')
  } else if (err.code === 'PERMISSION_DENIED') {
    showError('请授予麦克风权限')
  }
})
```

## 📚 参考资源

- [AI能力概述](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ai-overview-0000001820880597-V5)
- [语音Kit参考](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-media-0000001821000377-V5)

---

**下一节** → [图像识别与处理](04-图像识别与处理.md)
