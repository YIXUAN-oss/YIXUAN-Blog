---
title: 多端协同开发
date: 2025-01-22
---

# 多端协同开发

> 构建多设备协同应用

## 📱 设备类型

### HarmonyOS NEXT 支持的设备

```typescript
// 设备类型枚举
enum DeviceType {
  PHONE = 'phone',          // 手机
  TABLET = 'tablet',        // 平板
  TWO_IN_ONE = '2in1',      // 2合1设备
  WEARABLE = 'wearable',    // 穿戴设备
  TV = 'tv',                // 智慧屏
  CAR = 'car'               // 车机
}
```

## 🖥️ 手机 + 平板协同

### 响应式适配

```typescript
@Entry
@Component
struct ResponsiveLayout {
  @State currentBreakpoint: string = 'sm'
  
  aboutToAppear() {
    // 监听断点变化
    this.currentBreakpoint = this.getBreakpoint()
  }
  
  getBreakpoint(): string {
    const width = display.getDefaultDisplaySync().width
    
    if (width < 600) {
      return 'sm'  // 手机
    } else if (width < 840) {
      return 'md'  // 小平板
    } else {
      return 'lg'  // 大平板
    }
  }
  
  build() {
    if (this.currentBreakpoint === 'sm') {
      // 手机布局 - 单栏
      this.phoneLayout()
    } else {
      // 平板布局 - 双栏
      this.tabletLayout()
    }
  }
  
  @Builder
  phoneLayout() {
    Column() {
      // 单栏布局
      List() {
        ForEach([1, 2, 3, 4, 5], (item: number) => {
          ListItem() {
            Text(`Item ${item}`)
              .width('100%')
              .padding(20)
          }
        })
      }
    }
  }
  
  @Builder
  tabletLayout() {
    Row() {
      // 左侧列表
      List() {
        ForEach([1, 2, 3, 4, 5], (item: number) => {
          ListItem() {
            Text(`Item ${item}`)
          }
        })
      }
      .width('40%')
      
      Divider().vertical(true)
      
      // 右侧详情
      Column() {
        Text('详情区域')
          .fontSize(24)
      }
      .width('60%')
    }
  }
}
```

## 💻 手机 + PC 协同

### 跨设备剪贴板

```typescript
import { pasteboard } from '@kit.BasicServicesKit'

class CrossDeviceClipboard {
  // 复制到分布式剪贴板
  async copyToDistributed(text: string) {
    const pasteData = pasteboard.createData(pasteboard.MIMETYPE_TEXT_PLAIN, text)
    
    // 设置为分布式剪贴板
    const systemPasteboard = pasteboard.getSystemPasteboard()
    await systemPasteboard.setData(pasteData)
    
    // 设置分布式标志
    await systemPasteboard.setShareOption(pasteboard.ShareOption.CrossDevice)
  }
  
  // 从分布式剪贴板读取
  async pasteFromDistributed(): Promise<string> {
    const systemPasteboard = pasteboard.getSystemPasteboard()
    const pasteData = await systemPasteboard.getData()
    
    if (pasteData.hasMimeType(pasteboard.MIMETYPE_TEXT_PLAIN)) {
      return pasteData.getPrimaryText()
    }
    
    return ''
  }
}

// 使用
@Entry
@Component
struct ClipboardDemo {
  @State copiedText: string = ''
  private clipboard: CrossDeviceClipboard = new CrossDeviceClipboard()
  
  build() {
    Column({ space: 20 }) {
      TextInput({ placeholder: '输入文本' })
        .onChange((value) => {
          this.copiedText = value
        })
      
      Button('复制到其他设备')
        .onClick(async () => {
          await this.clipboard.copyToDistributed(this.copiedText)
          promptAction.showToast({ message: '已复制到分布式剪贴板' })
        })
      
      Button('从其他设备粘贴')
        .onClick(async () => {
          const text = await this.clipboard.pasteFromDistributed()
          this.copiedText = text
          promptAction.showToast({ message: '已粘贴' })
        })
    }
    .padding(20)
  }
}
```

## 🎯 实战：多屏协同笔记应用

```typescript
import { distributedDataObject } from '@kit.ArkData'
import { deviceManager } from '@kit.DistributedServiceKit'

@Entry
@Component
struct MultiScreenNotes {
  @State notes: Note[] = []
  @State selectedNote: Note | null = null
  @State deviceType: string = 'phone'
  @State connectedDevices: DeviceInfo[] = []
  
  private distributedObj: distributedDataObject.DataObject
  
  async aboutToAppear() {
    // 检测设备类型
    this.deviceType = this.getDeviceType()
    
    // 初始化分布式数据
    await this.initDistributedData()
    
    // 获取设备列表
    await this.getDeviceList()
  }
  
  getDeviceType(): string {
    const width = display.getDefaultDisplaySync().width
    return width < 600 ? 'phone' : 'tablet'
  }
  
  async initDistributedData() {
    this.distributedObj = distributedDataObject.create(getContext(this), {
      notes: [],
      selectedNoteId: ''
    })
    
    this.distributedObj.setSessionId('multiscreen_notes')
    
    this.distributedObj.on('change', (sessionId, fields) => {
      if (fields.includes('notes')) {
        this.notes = JSON.parse(JSON.stringify(this.distributedObj['notes']))
      }
      
      if (fields.includes('selectedNoteId')) {
        const id = this.distributedObj['selectedNoteId']
        this.selectedNote = this.notes.find(n => n.id === id) || null
      }
    })
  }
  
  async getDeviceList() {
    const dmInstance = deviceManager.createDeviceManager('com.example.notes')
    this.connectedDevices = dmInstance.getAvailableDeviceListSync()
  }
  
  selectNote(note: Note) {
    this.selectedNote = note
    // 同步到其他设备
    this.distributedObj['selectedNoteId'] = note.id
  }
  
  build() {
    if (this.deviceType === 'phone') {
      // 手机布局 - 使用Navigation组件
      Navigation() {
        this.buildNoteList()
      }
    } else {
      // 平板/PC布局 - 左右分栏
      Row() {
        // 左侧：笔记列表
        Column() {
          this.buildNoteList()
        }
        .width('35%')
        .height('100%')
        .backgroundColor(0xF5F5F5)
        
        Divider().vertical(true)
        
        // 右侧：笔记详情
        Column() {
          this.buildNoteDetail()
        }
        .width('65%')
        .height('100%')
      }
    }
  }
  
  @Builder
  buildNoteList() {
    Column() {
      // 标题栏
      Row({ space: 10 }) {
        Text('我的笔记')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
        
        Blank()
        
        Button('新建')
          .onClick(() => {
            this.createNote()
          })
      }
      .width('100%')
      .padding(15)
      
      // 设备列表
      if (this.connectedDevices.length > 0) {
        Row({ space: 5 }) {
          Text('已连接设备:')
            .fontSize(12)
            .fontColor(Color.Gray)
          
          ForEach(this.connectedDevices, (device: DeviceInfo) => {
            Text(device.deviceName)
              .fontSize(12)
              .padding({ left: 5, right: 5 })
              .backgroundColor(0xE3F2FD)
              .borderRadius(4)
          })
        }
        .padding({ left: 15, right: 15, bottom: 10 })
      }
      
      // 笔记列表
      List({ space: 5 }) {
        ForEach(this.notes, (note: Note) => {
          ListItem() {
            Column({ space: 5 }) {
              Text(note.title)
                .fontSize(16)
                .fontWeight(FontWeight.Medium)
              
              Text(note.content)
                .fontSize(14)
                .maxLines(2)
                .fontColor(Color.Gray)
            }
            .width('100%')
            .padding(15)
            .backgroundColor(this.selectedNote?.id === note.id ? 0xE3F2FD : Color.White)
            .borderRadius(8)
            .onClick(() => {
              this.selectNote(note)
              
              // 手机端跳转到详情页
              if (this.deviceType === 'phone') {
                // router.pushUrl({ url: 'pages/NoteDetail' })
              }
            })
          }
        })
      }
      .layoutWeight(1)
      .padding({ left: 15, right: 15 })
    }
  }
  
  @Builder
  buildNoteDetail() {
    if (this.selectedNote) {
      Column({ space: 20 }) {
        Text(this.selectedNote.title)
          .fontSize(28)
          .fontWeight(FontWeight.Bold)
        
        Text(this.selectedNote.content)
          .fontSize(16)
          .lineHeight(24)
        
        Blank()
        
        Row({ space: 10 }) {
          Button('编辑')
            .onClick(() => {
              this.editNote(this.selectedNote!)
            })
          
          Button('删除')
            .backgroundColor(Color.Red)
            .onClick(() => {
              this.deleteNote(this.selectedNote!)
            })
        }
      }
      .padding(30)
      .alignItems(HorizontalAlign.Start)
    } else {
      Column() {
        Text('选择一条笔记查看')
          .fontSize(18)
          .fontColor(Color.Gray)
      }
      .width('100%')
      .height('100%')
      .justifyContent(FlexAlign.Center)
    }
  }
  
  createNote() {
    const newNote: Note = {
      id: Date.now().toString(),
      title: '新笔记',
      content: '',
      timestamp: Date.now()
    }
    
    this.notes.push(newNote)
    this.distributedObj['notes'] = this.notes
    this.selectNote(newNote)
  }
  
  editNote(note: Note) {
    // 实现编辑逻辑
  }
  
  deleteNote(note: Note) {
    this.notes = this.notes.filter(n => n.id !== note.id)
    this.distributedObj['notes'] = this.notes
    this.selectedNote = null
  }
}

interface Note {
  id: string
  title: string
  content: string
  timestamp: number
}

interface DeviceInfo {
  deviceId: string
  deviceName: string
  deviceType: number
}
```

## 💡 最佳实践

### 1. 设备能力检测

```typescript
function getDeviceCapabilities() {
  const deviceInfo = deviceManager.getDeviceInfo()
  
  return {
    hasCamera: deviceInfo.hasCamera,
    hasBluetooth: deviceInfo.hasBluetooth,
    screenSize: deviceInfo.screenSize,
    deviceType: deviceInfo.deviceType
  }
}
```

### 2. 自适应布局

```typescript
// ✅ 使用断点系统
GridRow({
  breakpoints: {
    value: ['sm', 'md', 'lg'],
    reference: BreakpointsReference.WindowSize
  }
}) {
  GridCol({ span: { sm: 12, md: 6, lg: 4 } }) {
    // 内容
  }
}
```

### 3. 多设备测试

```typescript
// 使用 DevEco Studio 多设备预览
// 同时查看手机、平板、折叠屏效果
```

## 📚 参考资源

- [一多能力](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-preview-0000001337571249-V5)
- [分布式设备管理](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/device-management-overview-0000001774279934-V5)

---

**第10章完成！** 继续学习 → [第11章：图形与动画](../11-graphics-animation/)
