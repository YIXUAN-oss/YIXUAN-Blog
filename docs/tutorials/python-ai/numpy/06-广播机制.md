---
title: 广播机制
---

# 广播机制

> 理解NumPy的广播规则，实现高效运算

## 📚 学习目标

- 理解广播的概念
- 掌握广播规则
- 学会应用广播机制
- 避免广播的常见陷阱

## 1. 什么是广播

```python
import numpy as np

# 标量广播
arr = np.array([1, 2, 3, 4])
print(arr + 10)  # [11 12 13 14]

# 不同形状数组的广播
arr_2d = np.array([[1, 2, 3], [4, 5, 6]])
arr_1d = np.array([10, 20, 30])
print(arr_2d + arr_1d)
# [[11 22 33]
#  [14 25 36]]
```

## 2. 广播规则

```python
# 规则1：维度不同时，较小数组在左侧补1
arr_2d = np.ones((3, 4))  # (3, 4)
arr_1d = np.ones(4)       # (4,) -> (1, 4)
result = arr_2d + arr_1d  # 可以广播

# 规则2：任一维度为1可以扩展
arr_col = np.array([[1], [2], [3]])  # (3, 1)
arr_row = np.array([10, 20, 30, 40])  # (4,) -> (1, 4)
result = arr_col + arr_row            # (3, 4)
print(result)

# 规则3：维度不兼容则报错
arr_3 = np.ones((3, 4))
arr_5 = np.ones(5)
# arr_3 + arr_5  # ValueError!
```

## 3. 广播应用

```python
# 矩阵每行减去该行的均值
matrix = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])
row_means = matrix.mean(axis=1, keepdims=True)
centered = matrix - row_means
print(centered)

# 归一化（每列）
col_min = matrix.min(axis=0)
col_max = matrix.max(axis=0)
normalized = (matrix - col_min) / (col_max - col_min)
print(normalized)

# 外积
a = np.array([1, 2, 3])
b = np.array([10, 20, 30, 40])
outer = a[:, np.newaxis] * b
print(outer)
```

## 4. 常见广播模式

```python
# 模式1：标量广播
arr = np.array([1, 2, 3])
print(arr * 2)

# 模式2：一维广播到二维
arr_2d = np.array([[1, 2, 3], [4, 5, 6]])
arr_1d = np.array([10, 20, 30])
print(arr_2d + arr_1d)

# 模式3：列向量广播
arr = np.array([[1, 2, 3], [4, 5, 6]])
col = np.array([[10], [20]])
print(arr + col)

# 模式4：同时广播
a = np.array([[1], [2], [3]])  # (3, 1)
b = np.array([10, 20, 30])     # (3,)
print(a + b)  # (3, 3)
```

## 5. 广播的性能优势

```python
import time

# 使用广播
arr = np.random.rand(1000, 1000)
start = time.time()
result = arr + 10
print(f'广播耗时: {time.time() - start:.6f}秒')

# 使用循环（慢）
start = time.time()
for i in range(1000):
    for j in range(1000):
        arr[i, j] = arr[i, j] + 10
print(f'循环耗时: {time.time() - start:.6f}秒')
```

## 练习题

1. 实现每行归一化
2. 计算欧氏距离矩阵

---

**下一节：** [线性代数](07-线性代数.md)
