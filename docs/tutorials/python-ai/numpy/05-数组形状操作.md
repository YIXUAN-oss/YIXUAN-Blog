---
title: 数组形状操作
---

# 数组形状操作

> 掌握数组形状的变换和操作

## 📚 学习目标

- 掌握 reshape 重塑数组
- 理解ravel和flatten的区别
- 掌握数组的转置
- 学会数组的连接和分割

## 1. reshape - 重塑

```python
import numpy as np

# 一维到二维
arr = np.arange(12)
arr_2d = arr.reshape(3, 4)
print(arr_2d)

# 多维转换
arr_3d = arr.reshape(2, 2, 3)
print(arr_3d.shape)  # (2, 2, 3)

# 自动推断维度（-1）
arr_2d = arr.reshape(3, -1)  # 自动计算列数
print(arr_2d.shape)  # (3, 4)

# reshape不改变原数组
print(arr.shape)  # (12,)
```

## 2. ravel和flatten

```python
arr = np.array([[1, 2, 3], [4, 5, 6]])

# ravel - 返回视图
arr_ravel = arr.ravel()
print(arr_ravel)  # [1 2 3 4 5 6]
arr_ravel[0] = 100
print(arr[0, 0])  # 100（原数组被修改）

# flatten - 返回副本
arr_flatten = arr.flatten()
arr_flatten[0] = 999
print(arr[0, 0])  # 100（原数组不变）
```

## 3. 转置

```python
arr = np.array([[1, 2, 3], [4, 5, 6]])

# 使用T属性
print(arr.T)
# [[1 4]
#  [2 5]
#  [3 6]]

# 使用transpose函数
print(arr.transpose())

# 多维转置
arr_3d = np.arange(24).reshape(2, 3, 4)
print(arr_3d.transpose(2, 0, 1).shape)  # (4, 2, 3)
```

## 4. 数组连接

```python
# concatenate
a = np.array([[1, 2], [3, 4]])
b = np.array([[5, 6], [7, 8]])

# 垂直连接（axis=0）
v_stack = np.concatenate([a, b], axis=0)
print(v_stack)
# [[1 2]
#  [3 4]
#  [5 6]
#  [7 8]]

# 水平连接（axis=1）
h_stack = np.concatenate([a, b], axis=1)
print(h_stack)
# [[1 2 5 6]
#  [3 4 7 8]]

# vstack和hstack
print(np.vstack([a, b]))  # 垂直堆叠
print(np.hstack([a, b]))  # 水平堆叠

# stack - 创建新维度
stacked = np.stack([a, b])
print(stacked.shape)  # (2, 2, 2)
```

## 5. 数组分割

```python
arr = np.arange(12).reshape(3, 4)

# 水平分割
h_split = np.hsplit(arr, 2)
print(h_split)

# 垂直分割
v_split = np.vsplit(arr, 3)
print(v_split)

# split函数
parts = np.split(arr, [1, 3], axis=0)
print(len(parts))  # 3个部分
```

## 6. 添加和删除维度

```python
arr = np.array([1, 2, 3])

# 添加维度
arr_newaxis = arr[np.newaxis, :]
print(arr_newaxis.shape)  # (1, 3)

arr_expand = np.expand_dims(arr, axis=0)
print(arr_expand.shape)  # (1, 3)

# 删除维度
arr_squeeze = arr_newaxis.squeeze()
print(arr_squeeze.shape)  # (3,)
```

## 7. 实战示例

```python
# 数据批处理
images = np.random.rand(100, 28, 28)  # 100张28x28图像
batch_size = 10
batches = images.reshape(-1, batch_size, 28, 28)
print(f'批次数: {batches.shape[0]}')

# 图像通道转换（HWC to CHW）
image_hwc = np.random.rand(224, 224, 3)
image_chw = image_hwc.transpose(2, 0, 1)
print(f'CHW形状: {image_chw.shape}')  # (3, 224, 224)
```

## 练习题

1. 将一维数组reshape为5x4的二维数组
2. 转置一个3x4矩阵
3. 合并两个数组并分割

---

**下一节：** [广播机制](06-广播机制.md)
