---
title: 实战案例
---

# 实战案例

> 通过实战项目掌握NLP技术

## 📚 学习目标

- 应用NLP解决实际问题
- 掌握完整项目流程
- 学会综合运用技术

## 1. 新闻分类系统

```python
import jieba
import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.naive_bayes import MultinomialNB
from sklearn.model_selection import train_test_split
from sklearn.metrics import classification_report

# 1. 加载数据
df = pd.read_csv('news.csv')
print(f"数据量: {len(df)}")
print(f"类别: {df['category'].unique()}")

# 2. 文本预处理
def preprocess(text):
    # 分词
    words = jieba.cut(text)
    # 去除停用词
    stopwords = set(open('stopwords.txt', encoding='utf-8').read().split())
    words = [w for w in words if w not in stopwords and len(w) > 1]
    return ' '.join(words)

df['text_processed'] = df['text'].apply(preprocess)

# 3. 特征提取
vectorizer = TfidfVectorizer(max_features=5000)
X = vectorizer.fit_transform(df['text_processed'])
y = df['category']

# 4. 划分数据集
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# 5. 训练模型
clf = MultinomialNB()
clf.fit(X_train, y_train)

# 6. 评估
y_pred = clf.predict(X_test)
print("\n分类报告:")
print(classification_report(y_test, y_pred))

# 7. 预测新文本
def predict_category(text):
    text_processed = preprocess(text)
    text_vec = vectorizer.transform([text_processed])
    category = clf.predict(text_vec)[0]
    proba = clf.predict_proba(text_vec)[0]
    return category, max(proba)

# 测试
text = "科技公司发布新产品"
category, confidence = predict_category(text)
print(f"\n预测: {category} (置信度: {confidence:.2%})")
```

## 2. 评论情感分析

```python
from snownlp import SnowNLP
import matplotlib.pyplot as plt

# 加载评论数据
reviews = pd.read_csv('reviews.csv')

# 情感分析
def analyze_sentiment(text):
    s = SnowNLP(text)
    score = s.sentiments
    
    if score > 0.6:
        return 'positive', score
    elif score < 0.4:
        return 'negative', score
    else:
        return 'neutral', score

reviews[['sentiment', 'score']] = reviews['text'].apply(
    lambda x: pd.Series(analyze_sentiment(x))
)

# 统计分析
print("\n情感分布:")
print(reviews['sentiment'].value_counts())

print(f"\n平均情感得分: {reviews['score'].mean():.2f}")

# 可视化
plt.figure(figsize=(12, 5))

plt.subplot(1, 2, 1)
reviews['sentiment'].value_counts().plot(kind='bar')
plt.title('Sentiment Distribution')
plt.xlabel('Sentiment')
plt.ylabel('Count')

plt.subplot(1, 2, 2)
reviews['score'].hist(bins=30)
plt.title('Sentiment Score Distribution')
plt.xlabel('Score')
plt.ylabel('Frequency')

plt.tight_layout()
plt.savefig('sentiment_analysis.png')
plt.show()

# 提取关键词
from collections import Counter

positive_reviews = reviews[reviews['sentiment'] == 'positive']['text']
positive_words = []
for review in positive_reviews:
    positive_words.extend(jieba.cut(review))

word_freq = Counter(positive_words).most_common(20)
print("\n正面评论高频词:")
for word, freq in word_freq:
    print(f"{word}: {freq}")
```

## 3. 智能问答系统

```python
from sentence_transformers import SentenceTransformer
from sklearn.metrics.pairwise import cosine_similarity
import numpy as np

# 知识库
qa_pairs = [
    {"question": "如何退货？", "answer": "您可以在订单详情页面申请退货..."},
    {"question": "配送需要多久？", "answer": "一般3-5个工作日送达..."},
    {"question": "如何联系客服？", "answer": "可以拨打400电话或在线咨询..."}
]

# 加载模型
model = SentenceTransformer('distiluse-base-multilingual-cased-v2')

# 编码问题
questions = [qa['question'] for qa in qa_pairs]
question_embeddings = model.encode(questions)

def find_answer(query, threshold=0.5):
    # 编码查询
    query_embedding = model.encode([query])
    
    # 计算相似度
    similarities = cosine_similarity(query_embedding, question_embeddings)[0]
    
    # 找到最相似的问题
    max_idx = np.argmax(similarities)
    max_sim = similarities[max_idx]
    
    if max_sim >= threshold:
        return qa_pairs[max_idx]['answer'], max_sim
    else:
        return "抱歉，没有找到相关答案", 0.0

# 测试
while True:
    user_query = input("\n请输入问题 (输入'quit'退出): ")
    if user_query.lower() == 'quit':
        break
    
    answer, confidence = find_answer(user_query)
    print(f"\n回答: {answer}")
    print(f"置信度: {confidence:.2f}")
```

## 4. 文本摘要生成

```python
from transformers import pipeline

# 加载摘要模型
summarizer = pipeline("summarization", 
                     model="facebook/bart-large-cnn")

# 长文本
article = """
长篇文章内容...
这里是一篇关于人工智能发展的文章。
人工智能技术在近年来取得了突破性进展...
"""

# 生成摘要
def generate_summary(text, max_length=130, min_length=30):
    summary = summarizer(text, 
                        max_length=max_length,
                        min_length=min_length,
                        do_sample=False)
    return summary[0]['summary_text']

summary = generate_summary(article)
print("原文长度:", len(article))
print("\n摘要:")
print(summary)
print("\n摘要长度:", len(summary))
```

## 5. 聊天机器人

```python
import torch
from transformers import AutoModelForCausalLM, AutoTokenizer

class ChatBot:
    def __init__(self, model_name="microsoft/DialoGPT-medium"):
        self.tokenizer = AutoTokenizer.from_pretrained(model_name)
        self.model = AutoModelForCausalLM.from_pretrained(model_name)
        self.chat_history = None
    
    def respond(self, user_input):
        # 编码输入
        new_input = self.tokenizer.encode(
            user_input + self.tokenizer.eos_token,
            return_tensors='pt'
        )
        
        # 拼接历史
        if self.chat_history is not None:
            bot_input = torch.cat([self.chat_history, new_input], dim=-1)
        else:
            bot_input = new_input
        
        # 生成回复
        self.chat_history = self.model.generate(
            bot_input,
            max_length=1000,
            pad_token_id=self.tokenizer.eos_token_id,
            no_repeat_ngram_size=3,
            do_sample=True,
            top_k=50,
            top_p=0.95,
            temperature=0.7
        )
        
        # 解码回复
        response = self.tokenizer.decode(
            self.chat_history[:, bot_input.shape[-1]:][0],
            skip_special_tokens=True
        )
        
        return response
    
    def reset(self):
        self.chat_history = None

# 使用
bot = ChatBot()

print("ChatBot: 你好！我是智能助手，有什么可以帮您的？")

while True:
    user_input = input("\nYou: ")
    
    if user_input.lower() in ['quit', 'exit', 'bye']:
        print("ChatBot: 再见！")
        break
    
    if user_input.lower() == 'reset':
        bot.reset()
        print("ChatBot: 对话已重置")
        continue
    
    response = bot.respond(user_input)
    print(f"ChatBot: {response}")
```

## 💡 项目总结

通过这些实战案例，你应该掌握了：

1. **完整NLP项目流程** - 数据处理、模型训练、评估、部署
2. **文本分类** - 新闻分类、情感分析
3. **信息检索** - 问答系统、文本匹配
4. **文本生成** - 摘要生成、对话系统
5. **工程实践** - 模型保存、API设计、性能优化

## 练习项目

1. **垃圾邮件检测** - 分类垃圾邮件和正常邮件
2. **关键词提取** - 自动提取文章关键词
3. **文本纠错** - 检测并纠正文本错误
4. **推荐系统** - 基于文本相似度的内容推荐
5. **舆情监控** - 实时分析社交媒体情感

---

**恭喜完成 NLP 教程！** 🎉

继续学习：[计算机视觉 CV](../cv/) 或 [深度学习框架 PyTorch](../pytorch/)
