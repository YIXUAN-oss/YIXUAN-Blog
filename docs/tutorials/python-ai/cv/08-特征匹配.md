---
title: 特征匹配
---

# 特征匹配

> 掌握特征匹配和图像配准

## 📚 学习目标

- 理解特征匹配
- 掌握BF匹配
- 学会FLANN匹配
- 了解图像拼接

## 1. 暴力匹配

```python
import cv2

# 读取图像
img1 = cv2.imread('image1.jpg', 0)
img2 = cv2.imread('image2.jpg', 0)

# SIFT特征
sift = cv2.SIFT_create()
kp1, des1 = sift.detectAndCompute(img1, None)
kp2, des2 = sift.detectAndCompute(img2, None)

# BF匹配器
bf = cv2.BFMatcher()
matches = bf.knnMatch(des1, des2, k=2)

# 筛选好的匹配
good = []
for m, n in matches:
    if m.distance < 0.75 * n.distance:
        good.append([m])

# 绘制匹配
img_matches = cv2.drawMatchesKnn(img1, kp1, img2, kp2, good, None,
                                 flags=cv2.DrawMatchesFlags_NOT_DRAW_SINGLE_POINTS)
cv2.imshow('Matches', img_matches)
cv2.waitKey(0)
```

## 2. FLANN匹配

```python
# FLANN参数
FLANN_INDEX_KDTREE = 1
index_params = dict(algorithm=FLANN_INDEX_KDTREE, trees=5)
search_params = dict(checks=50)

# FLANN匹配器
flann = cv2.FlannBasedMatcher(index_params, search_params)
matches = flann.knnMatch(des1, des2, k=2)

# 筛选
good = []
for m, n in matches:
    if m.distance < 0.7 * n.distance:
        good.append(m)
```

## 3. 单应性变换

```python
import numpy as np

if len(good) > 10:
    src_pts = np.float32([kp1[m.queryIdx].pt for m in good]).reshape(-1, 1, 2)
    dst_pts = np.float32([kp2[m.trainIdx].pt for m in good]).reshape(-1, 1, 2)
    
    # 计算单应性矩阵
    M, mask = cv2.findHomography(src_pts, dst_pts, cv2.RANSAC, 5.0)
    
    # 透视变换
    h, w = img1.shape
    pts = np.float32([[0, 0], [0, h-1], [w-1, h-1], [w-1, 0]]).reshape(-1, 1, 2)
    dst = cv2.perspectiveTransform(pts, M)
    
    # 绘制边界
    img2_marked = cv2.polylines(img2, [np.int32(dst)], True, 255, 3)
```

## 4. 图像拼接

```python
# 使用Stitcher
stitcher = cv2.Stitcher_create()
status, pano = stitcher.stitch([img1, img2])

if status == cv2.Stitcher_OK:
    cv2.imshow('Panorama', pano)
    cv2.waitKey(0)
else:
    print("拼接失败")
```

---

**下一节：** [CNN基础](09-CNN基础.md)
