---
title: 数据转换
---

# 数据转换

> 掌握数据转换和映射技巧

## 📚 学习目标

- 掌握数据映射
- 学会使用apply函数
- 掌握数据替换
- 学会数据离散化
- 理解数据标准化

## 1. 数据映射

```python
import pandas as pd

df = pd.DataFrame({
    'grade': ['A', 'B', 'C', 'A', 'B']
})

# 使用字典映射
grade_map = {'A': 90, 'B': 80, 'C': 70}
df['score'] = df['grade'].map(grade_map)

# map方法配合函数
df['grade_lower'] = df['grade'].map(lambda x: x.lower())

# replace方法
df['grade_numeric'] = df['grade'].replace({'A': 1, 'B': 2, 'C': 3})
```

## 2. apply函数

```python
df = pd.DataFrame({
    'A': [1, 2, 3],
    'B': [4, 5, 6]
})

# 对列应用函数
df['A_squared'] = df['A'].apply(lambda x: x ** 2)

# 对行应用函数
df['sum'] = df.apply(lambda row: row['A'] + row['B'], axis=1)

# 应用自定义函数
def classify(value):
    if value > 50:
        return 'High'
    else:
        return 'Low'

df['category'] = df['sum'].apply(classify)

# applymap - 对整个DataFrame
df_transformed = df[['A', 'B']].applymap(lambda x: x * 2)
```

## 3. 数据替换

```python
df = pd.DataFrame({
    'value': [1, 2, -999, 4, -999]
})

# 替换单个值
df['value'] = df['value'].replace(-999, np.nan)

# 替换多个值
df['value'] = df['value'].replace({-999: np.nan, -888: np.nan})

# 条件替换
df.loc[df['value'] < 0, 'value'] = 0
```

## 4. 数据离散化

```python
df = pd.DataFrame({
    'age': [18, 25, 35, 45, 55, 65, 75]
})

# cut - 等宽分箱
bins = [0, 30, 50, 100]
labels = ['Young', 'Middle', 'Old']
df['age_group'] = pd.cut(df['age'], bins=bins, labels=labels)

# qcut - 等频分箱
df['age_quartile'] = pd.qcut(df['age'], q=4, labels=['Q1', 'Q2', 'Q3', 'Q4'])

# 自定义分箱
df['age_custom'] = pd.cut(df['age'], 
                          bins=[0, 20, 40, 60, 100],
                          labels=['Teen', 'Adult', 'Middle', 'Senior'])
```

## 5. 数据标准化

```python
from sklearn.preprocessing import StandardScaler, MinMaxScaler

df = pd.DataFrame({
    'value': [10, 20, 30, 40, 50]
})

# Z-score标准化
df['z_score'] = (df['value'] - df['value'].mean()) / df['value'].std()

# Min-Max归一化
df['min_max'] = (df['value'] - df['value'].min()) / (df['value'].max() - df['value'].min())

# 使用sklearn
scaler = StandardScaler()
df['scaled'] = scaler.fit_transform(df[['value']])
```

## 练习题

1. 将分数映射为等级
2. 使用apply计算BMI
3. 对年龄进行分组

---

**下一节：** [数据合并](06-数据合并.md)
