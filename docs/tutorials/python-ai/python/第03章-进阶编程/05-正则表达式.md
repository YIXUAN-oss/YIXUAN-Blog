---
title: 正则表达式
---

# 正则表达式

> 掌握正则表达式，高效处理文本数据

## 📚 学习目标

- 理解正则表达式的基本语法
- 掌握 re 模块的使用
- 学会文本匹配和提取
- 掌握常用的正则表达式模式

## 1. 正则表达式基础

### 1.1 基本匹配

```python
import re

# 精确匹配
pattern = r'hello'
text = 'hello world'
result = re.search(pattern, text)
print(result.group())  # hello

# 忽略大小写
result = re.search(r'HELLO', text, re.IGNORECASE)
print(result.group())  # hello
```

### 1.2 元字符

```python
# . 匹配任意字符（除换行符）
re.search(r'h.llo', 'hello')  # 匹配

# ^ 匹配字符串开始
re.search(r'^hello', 'hello world')  # 匹配
re.search(r'^world', 'hello world')  # 不匹配

# $ 匹配字符串结束
re.search(r'world$', 'hello world')  # 匹配

# * 匹配0次或多次
re.search(r'ab*c', 'ac')    # 匹配
re.search(r'ab*c', 'abc')   # 匹配
re.search(r'ab*c', 'abbc')  # 匹配

# + 匹配1次或多次
re.search(r'ab+c', 'abc')   # 匹配
re.search(r'ab+c', 'ac')    # 不匹配

# ? 匹配0次或1次
re.search(r'ab?c', 'ac')    # 匹配
re.search(r'ab?c', 'abc')   # 匹配
```

### 1.3 字符类

```python
# [] 字符集
re.search(r'[abc]', 'apple')  # 匹配 a
re.search(r'[0-9]', 'abc123')  # 匹配 1

# [^] 取反
re.search(r'[^0-9]', '123abc')  # 匹配 a

# \d 数字 [0-9]
re.search(r'\d+', 'abc123')  # 123

# \D 非数字
re.search(r'\D+', '123abc')  # abc

# \w 字母数字下划线 [a-zA-Z0-9_]
re.search(r'\w+', 'hello_123')  # hello_123

# \W 非字母数字下划线
re.search(r'\W+', 'hello, world!')  # , 

# \s 空白字符
re.search(r'\s+', 'hello world')  # 空格

# \S 非空白字符
re.search(r'\S+', 'hello world')  # hello
```

## 2. re 模块函数

### 2.1 search() - 查找第一个匹配

```python
import re

text = 'My phone: 123-456-7890'
pattern = r'\d{3}-\d{3}-\d{4}'

result = re.search(pattern, text)
if result:
    print(result.group())  # 123-456-7890
    print(result.start())  # 起始位置
    print(result.end())    # 结束位置
```

### 2.2 match() - 从开头匹配

```python
# 从字符串开头匹配
text = 'hello world'
print(re.match(r'hello', text))  # 匹配
print(re.match(r'world', text))  # None
```

### 2.3 findall() - 查找所有匹配

```python
text = 'Email: user@example.com, admin@test.com'
pattern = r'[\w.-]+@[\w.-]+'

emails = re.findall(pattern, text)
print(emails)  # ['user@example.com', 'admin@test.com']
```

### 2.4 finditer() - 迭代器

```python
text = 'Phone: 123-456-7890, 098-765-4321'
pattern = r'\d{3}-\d{3}-\d{4}'

for match in re.finditer(pattern, text):
    print(match.group(), match.span())
```

### 2.5 sub() - 替换

```python
text = 'Hello 123 World 456'

# 替换所有数字
result = re.sub(r'\d+', 'NUM', text)
print(result)  # Hello NUM World NUM

# 限制替换次数
result = re.sub(r'\d+', 'NUM', text, count=1)
print(result)  # Hello NUM World 456
```

### 2.6 split() - 分割

```python
text = 'apple,banana;orange|grape'

# 使用多个分隔符
parts = re.split(r'[,;|]', text)
print(parts)  # ['apple', 'banana', 'orange', 'grape']
```

## 3. 分组和捕获

### 3.1 基本分组

```python
# () 创建捕获组
pattern = r'(\d{4})-(\d{2})-(\d{2})'
text = '2024-01-15'

match = re.search(pattern, text)
print(match.group(0))  # 2024-01-15 (完整匹配)
print(match.group(1))  # 2024 (第一组)
print(match.group(2))  # 01 (第二组)
print(match.group(3))  # 15 (第三组)
print(match.groups())  # ('2024', '01', '15')
```

### 3.2 命名分组

```python
pattern = r'(?P<year>\d{4})-(?P<month>\d{2})-(?P<day>\d{2})'
text = '2024-01-15'

match = re.search(pattern, text)
print(match.group('year'))   # 2024
print(match.group('month'))  # 01
print(match.group('day'))    # 15
print(match.groupdict())     # {'year': '2024', 'month': '01', 'day': '15'}
```

### 3.3 非捕获组

```python
# (?:...) 非捕获组
pattern = r'(?:http|https)://(\w+\.\w+)'
text = 'https://www.example.com'

match = re.search(pattern, text)
print(match.group(0))  # https://www.example.com
print(match.group(1))  # www.example.com
```

## 4. 常用正则模式

### 4.1 邮箱验证

```python
def validate_email(email):
    pattern = r'^[\w.-]+@[\w.-]+\.\w+$'
    return re.match(pattern, email) is not None

print(validate_email('user@example.com'))  # True
print(validate_email('invalid.email'))      # False
```

### 4.2 手机号验证

```python
def validate_phone(phone):
    # 中国手机号
    pattern = r'^1[3-9]\d{9}$'
    return re.match(pattern, phone) is not None

print(validate_phone('13812345678'))  # True
print(validate_phone('12345678901'))  # False
```

### 4.3 URL 提取

```python
def extract_urls(text):
    pattern = r'https?://[\w.-]+(?:/[\w.-]*)*'
    return re.findall(pattern, text)

text = 'Visit https://example.com and http://test.org'
print(extract_urls(text))
```

### 4.4 IP 地址验证

```python
def validate_ip(ip):
    pattern = r'^(\d{1,3}\.){3}\d{1,3}$'
    if not re.match(pattern, ip):
        return False
    
    # 检查每个数字是否在 0-255 范围内
    parts = ip.split('.')
    return all(0 <= int(part) <= 255 for part in parts)

print(validate_ip('192.168.1.1'))   # True
print(validate_ip('256.1.1.1'))     # False
```

### 4.5 身份证号验证

```python
def validate_id_card(id_card):
    # 18位身份证
    pattern = r'^\d{17}[\dXx]$'
    return re.match(pattern, id_card) is not None

print(validate_id_card('110101199003071234'))  # True
```

## 5. 高级特性

### 5.1 贪婪与非贪婪

```python
text = '<div>content1</div><div>content2</div>'

# 贪婪匹配（默认）
greedy = re.search(r'<div>.*</div>', text)
print(greedy.group())  # <div>content1</div><div>content2</div>

# 非贪婪匹配
non_greedy = re.search(r'<div>.*?</div>', text)
print(non_greedy.group())  # <div>content1</div>
```

### 5.2 前瞻和后顾

```python
# 正向前瞻 (?=...)
text = 'Python3.11'
result = re.search(r'Python(?=3)', text)
print(result.group())  # Python

# 负向前瞻 (?!...)
result = re.search(r'Python(?!2)', text)
print(result.group())  # Python

# 正向后顾 (?<=...)
result = re.search(r'(?<=Python)\d+', text)
print(result.group())  # 3

# 负向后顾 (?<!...)
text = 'abc123'
result = re.search(r'(?<![a-z])\d+', '123')
print(result.group())  # 123
```

### 5.3 编译正则表达式

```python
# 频繁使用的模式应该编译
pattern = re.compile(r'\d+')

# 提高性能
for text in ['abc123', 'def456', 'ghi789']:
    result = pattern.findall(text)
    print(result)
```

## 6. 实战案例

### 案例1：日志解析

```python
def parse_log(log_line):
    pattern = r'(?P<ip>\d+\.\d+\.\d+\.\d+).*\[(?P<time>.*?)\].*"(?P<method>\w+)\s+(?P<url>.*?)\s+'
    
    match = re.search(pattern, log_line)
    if match:
        return match.groupdict()
    return None

log = '192.168.1.1 - - [15/Jan/2024:10:30:00] "GET /index.html HTTP/1.1"'
print(parse_log(log))
```

### 案例2：HTML 标签清理

```python
def remove_html_tags(html):
    pattern = r'<[^>]+>'
    return re.sub(pattern, '', html)

html = '<p>This is <b>bold</b> text</p>'
print(remove_html_tags(html))  # This is bold text
```

### 案例3：敏感信息脱敏

```python
def mask_sensitive_info(text):
    # 手机号脱敏
    text = re.sub(r'(\d{3})\d{4}(\d{4})', r'\1****\2', text)
    
    # 身份证脱敏
    text = re.sub(r'(\d{6})\d{8}(\d{4})', r'\1********\2', text)
    
    return text

text = '手机: 13812345678, 身份证: 110101199003071234'
print(mask_sensitive_info(text))
```

### 案例4：文本提取

```python
def extract_data(text):
    # 提取价格
    prices = re.findall(r'¥\d+(?:\.\d{2})?', text)
    
    # 提取日期
    dates = re.findall(r'\d{4}-\d{2}-\d{2}', text)
    
    # 提取邮箱
    emails = re.findall(r'[\w.-]+@[\w.-]+\.\w+', text)
    
    return {
        'prices': prices,
        'dates': dates,
        'emails': emails
    }

text = '价格: ¥99.99, 日期: 2024-01-15, 联系: user@example.com'
print(extract_data(text))
```

## 7. 常用正则表达式

```python
# 常见模式
patterns = {
    '手机号': r'^1[3-9]\d{9}$',
    '邮箱': r'^[\w.-]+@[\w.-]+\.\w+$',
    'URL': r'^https?://[\w.-]+(?:/[\w.-]*)*$',
    'IP地址': r'^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$',
    '日期': r'^\d{4}-\d{2}-\d{2}$',
    '时间': r'^\d{2}:\d{2}:\d{2}$',
    '身份证': r'^\d{17}[\dXx]$',
    '邮政编码': r'^\d{6}$',
    '中文': r'^[\u4e00-\u9fa5]+$',
    '数字': r'^\d+$',
    '字母': r'^[a-zA-Z]+$',
    '用户名': r'^[a-zA-Z]\w{4,15}$',
    '密码': r'^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$',
}
```

## 📝 练习题

1. 编写正则表达式验证强密码（包含大小写字母、数字、特殊字符）
2. 提取HTML中的所有链接
3. 实现一个简单的Markdown解析器
4. 编写手机号和邮箱的批量提取工具

---

**下一节：** [多线程与多进程](06-多线程与多进程.md)
