---
title: è£…é¥°å™¨
---

# è£…é¥°å™¨

> æŒæ¡Pythonè£…é¥°å™¨çš„ä½¿ç”¨ï¼Œç¼–å†™æ›´ä¼˜é›…çš„ä»£ç 

## ğŸ“š å­¦ä¹ ç›®æ ‡

- ç†è§£è£…é¥°å™¨çš„æ¦‚å¿µå’ŒåŸç†
- æŒæ¡å‡½æ•°è£…é¥°å™¨çš„ä½¿ç”¨
- å­¦ä¼šåˆ›å»ºå¸¦å‚æ•°çš„è£…é¥°å™¨
- æŒæ¡ç±»è£…é¥°å™¨

## 1. è£…é¥°å™¨åŸºç¡€

### 1.1 ä»€ä¹ˆæ˜¯è£…é¥°å™¨

```python
# è£…é¥°å™¨ï¼šåœ¨ä¸ä¿®æ”¹åŸå‡½æ•°ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºå‡½æ•°æ·»åŠ æ–°åŠŸèƒ½
def timer(func):
    """è®¡æ—¶è£…é¥°å™¨"""
    import time
    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        end = time.time()
        print(f'{func.__name__} è€—æ—¶: {end - start:.4f}ç§’')
        return result
    return wrapper

# ä½¿ç”¨è£…é¥°å™¨
@timer
def slow_function():
    import time
    time.sleep(1)
    print('å‡½æ•°æ‰§è¡Œå®Œæˆ')

slow_function()
```

### 1.2 è£…é¥°å™¨åŸç†

```python
# @timer ç­‰ä»·äº
def slow_function():
    pass

slow_function = timer(slow_function)
```

## 2. å¸¸ç”¨è£…é¥°å™¨æ¨¡å¼

### 2.1 æ—¥å¿—è£…é¥°å™¨

```python
def logger(func):
    """æ—¥å¿—è£…é¥°å™¨"""
    def wrapper(*args, **kwargs):
        print(f'è°ƒç”¨å‡½æ•°: {func.__name__}')
        print(f'å‚æ•°: args={args}, kwargs={kwargs}')
        result = func(*args, **kwargs)
        print(f'è¿”å›å€¼: {result}')
        return result
    return wrapper

@logger
def add(a, b):
    return a + b

add(3, 5)
```

### 2.2 ç¼“å­˜è£…é¥°å™¨

```python
def cache(func):
    """ç®€å•çš„ç¼“å­˜è£…é¥°å™¨"""
    cached_results = {}
    
    def wrapper(*args):
        if args in cached_results:
            print(f'ä»ç¼“å­˜è·å–: {args}')
            return cached_results[args]
        
        result = func(*args)
        cached_results[args] = result
        return result
    
    return wrapper

@cache
def fibonacci(n):
    if n < 2:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

print(fibonacci(10))
```

### 2.3 éªŒè¯è£…é¥°å™¨

```python
def validate_input(func):
    """è¾“å…¥éªŒè¯è£…é¥°å™¨"""
    def wrapper(x, y):
        if not isinstance(x, (int, float)):
            raise TypeError('x å¿…é¡»æ˜¯æ•°å­—')
        if not isinstance(y, (int, float)):
            raise TypeError('y å¿…é¡»æ˜¯æ•°å­—')
        if y == 0:
            raise ValueError('é™¤æ•°ä¸èƒ½ä¸ºé›¶')
        return func(x, y)
    return wrapper

@validate_input
def divide(x, y):
    return x / y

print(divide(10, 2))  # 5.0
```

## 3. å¸¦å‚æ•°çš„è£…é¥°å™¨

### 3.1 åŸºæœ¬è¯­æ³•

```python
def repeat(times):
    """é‡å¤æ‰§è¡Œè£…é¥°å™¨"""
    def decorator(func):
        def wrapper(*args, **kwargs):
            for _ in range(times):
                result = func(*args, **kwargs)
            return result
        return wrapper
    return decorator

@repeat(3)
def greet(name):
    print(f'Hello, {name}!')

greet('Python')
```

### 3.2 æƒé™æ£€æŸ¥è£…é¥°å™¨

```python
def require_auth(role):
    """æƒé™æ£€æŸ¥è£…é¥°å™¨"""
    def decorator(func):
        def wrapper(*args, **kwargs):
            user_role = kwargs.get('role', 'guest')
            if user_role != role:
                raise PermissionError(f'éœ€è¦ {role} æƒé™')
            return func(*args, **kwargs)
        return wrapper
    return decorator

@require_auth('admin')
def delete_user(user_id, role='guest'):
    print(f'åˆ é™¤ç”¨æˆ·: {user_id}')

delete_user(123, role='admin')  # æˆåŠŸ
```

## 4. ç±»è£…é¥°å™¨

### 4.1 ä½¿ç”¨ç±»ä½œä¸ºè£…é¥°å™¨

```python
class Counter:
    """è®¡æ•°è£…é¥°å™¨"""
    
    def __init__(self, func):
        self.func = func
        self.count = 0
    
    def __call__(self, *args, **kwargs):
        self.count += 1
        print(f'è°ƒç”¨æ¬¡æ•°: {self.count}')
        return self.func(*args, **kwargs)

@Counter
def say_hello():
    print('Hello!')

say_hello()  # è°ƒç”¨æ¬¡æ•°: 1
say_hello()  # è°ƒç”¨æ¬¡æ•°: 2
```

### 4.2 è£…é¥°ç±»

```python
def singleton(cls):
    """å•ä¾‹è£…é¥°å™¨"""
    instances = {}
    
    def get_instance(*args, **kwargs):
        if cls not in instances:
            instances[cls] = cls(*args, **kwargs)
        return instances[cls]
    
    return get_instance

@singleton
class Database:
    def __init__(self):
        print('åˆå§‹åŒ–æ•°æ®åº“è¿æ¥')

db1 = Database()  # åˆå§‹åŒ–æ•°æ®åº“è¿æ¥
db2 = Database()  # ä¸ä¼šå†æ¬¡åˆå§‹åŒ–
print(db1 is db2)  # True
```

## 5. functools æ¨¡å—

### 5.1 wraps è£…é¥°å™¨

```python
from functools import wraps

def my_decorator(func):
    @wraps(func)  # ä¿ç•™åŸå‡½æ•°çš„å…ƒä¿¡æ¯
    def wrapper(*args, **kwargs):
        print('è£…é¥°å™¨æ‰§è¡Œ')
        return func(*args, **kwargs)
    return wrapper

@my_decorator
def example():
    """è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å‡½æ•°"""
    pass

print(example.__name__)  # example
print(example.__doc__)   # è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å‡½æ•°
```

### 5.2 lru_cache ç¼“å­˜

```python
from functools import lru_cache

@lru_cache(maxsize=128)
def fibonacci(n):
    if n < 2:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

print(fibonacci(100))  # å¿«é€Ÿè®¡ç®—
print(fibonacci.cache_info())  # æŸ¥çœ‹ç¼“å­˜ä¿¡æ¯
```

## 6. å¤šä¸ªè£…é¥°å™¨

```python
def decorator1(func):
    print('è£…é¥°å™¨1')
    def wrapper(*args, **kwargs):
        print('æ‰§è¡Œè£…é¥°å™¨1')
        return func(*args, **kwargs)
    return wrapper

def decorator2(func):
    print('è£…é¥°å™¨2')
    def wrapper(*args, **kwargs):
        print('æ‰§è¡Œè£…é¥°å™¨2')
        return func(*args, **kwargs)
    return wrapper

@decorator1
@decorator2
def my_function():
    print('åŸå§‹å‡½æ•°')

my_function()
# è¾“å‡ºé¡ºåºï¼šè£…é¥°å™¨2 -> è£…é¥°å™¨1 -> æ‰§è¡Œè£…é¥°å™¨1 -> æ‰§è¡Œè£…é¥°å™¨2 -> åŸå§‹å‡½æ•°
```

## 7. å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹1ï¼šæ€§èƒ½ç›‘æ§

```python
import time
from functools import wraps

def performance_monitor(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        start_memory = get_memory_usage()
        
        result = func(*args, **kwargs)
        
        end_time = time.time()
        end_memory = get_memory_usage()
        
        print(f'å‡½æ•°: {func.__name__}')
        print(f'è€—æ—¶: {end_time - start_time:.4f}ç§’')
        print(f'å†…å­˜: {end_memory - start_memory:.2f}MB')
        
        return result
    return wrapper
```

### æ¡ˆä¾‹2ï¼šé‡è¯•æœºåˆ¶

```python
import time
from functools import wraps

def retry(max_tries=3, delay=1):
    """é‡è¯•è£…é¥°å™¨"""
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            for attempt in range(max_tries):
                try:
                    return func(*args, **kwargs)
                except Exception as e:
                    if attempt == max_tries - 1:
                        raise
                    print(f'ç¬¬ {attempt + 1} æ¬¡å°è¯•å¤±è´¥ï¼Œ{delay}ç§’åé‡è¯•...')
                    time.sleep(delay)
        return wrapper
    return decorator

@retry(max_tries=3, delay=2)
def unstable_function():
    import random
    if random.random() < 0.7:
        raise Exception('éšæœºå¤±è´¥')
    return 'æˆåŠŸ'
```

## ğŸ“ ç»ƒä¹ é¢˜

1. åˆ›å»ºä¸€ä¸ªé€Ÿç‡é™åˆ¶è£…é¥°å™¨
2. å®ç°ä¸€ä¸ªå‚æ•°ç±»å‹æ£€æŸ¥è£…é¥°å™¨
3. ç¼–å†™ä¸€ä¸ªå¼‚å¸¸å¤„ç†è£…é¥°å™¨

---

**ä¸‹ä¸€èŠ‚ï¼š** [ä¸Šä¸‹æ–‡ç®¡ç†å™¨](04-ä¸Šä¸‹æ–‡ç®¡ç†å™¨.md)
