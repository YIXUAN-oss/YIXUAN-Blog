# 面向对象初级

## 一、面向对象概述

### 1. 什么是面向对象？

面向对象编程（Object-Oriented Programming，OOP）是一种程序设计思想，将数据和操作数据的方法封装在一起。

**核心概念：**
- **类（Class）**：对象的模板，定义了对象的属性和方法
- **对象（Object）**：类的实例，具体的事物

**类比：**
- 类就像"图纸"，对象就像根据图纸制造出来的"产品"
- 类就像"模具"，对象就像用模具生产出来的"商品"

### 2. 面向对象 vs 面向过程

**面向过程：**
- 关注"怎么做"
- 按照步骤一步步执行
- 适合简单的线性任务

**面向对象：**
- 关注"谁来做"
- 将功能封装到对象中
- 适合复杂的大型项目

---

## 二、类的定义

### 1. 基本语法

```python
class 类名:
    # 类属性
    类变量 = 值
    
    # 初始化方法
    def __init__(self, 参数):
        self.实例属性 = 参数
    
    # 实例方法
    def 方法名(self, 参数):
        方法体
```

### 2. 创建简单的类

```python
class Student:
    """学生类"""
    
    def __init__(self, name, age):
        """初始化方法（构造函数）"""
        self.name = name
        self.age = age
    
    def introduce(self):
        """自我介绍方法"""
        print(f"大家好，我是{self.name}，今年{self.age}岁")

# 创建对象
student1 = Student("张三", 18)
student2 = Student("李四", 19)

# 调用方法
student1.introduce()  # 大家好，我是张三，今年18岁
student2.introduce()  # 大家好，我是李四，今年19岁
```

---

## 三、类的属性

### 1. 实例属性

每个对象独有的属性，通过`self.属性名`定义。

```python
class Person:
    def __init__(self, name, age):
        self.name = name  # 实例属性
        self.age = age    # 实例属性

person1 = Person("张三", 18)
person2 = Person("李四", 20)

print(person1.name)  # 张三
print(person2.name)  # 李四

# 修改实例属性
person1.age = 19
print(person1.age)  # 19
```

### 2. 类属性

所有对象共享的属性，定义在类中但在方法外。

```python
class Student:
    # 类属性
    school = "清华大学"
    count = 0
    
    def __init__(self, name):
        self.name = name
        Student.count += 1  # 修改类属性

# 访问类属性
print(Student.school)  # 清华大学

# 创建对象
s1 = Student("张三")
s2 = Student("李四")

# 通过类名访问
print(Student.count)  # 2

# 通过对象访问
print(s1.school)  # 清华大学
print(s2.school)  # 清华大学
```

### 3. 私有属性

以双下划线`__`开头的属性是私有属性，外部无法直接访问。

```python
class Person:
    def __init__(self, name, age):
        self.name = name
        self.__age = age  # 私有属性
    
    def get_age(self):
        """获取年龄"""
        return self.__age
    
    def set_age(self, age):
        """设置年龄"""
        if age > 0:
            self.__age = age
        else:
            print("年龄必须大于0")

person = Person("张三", 18)
print(person.name)  # 张三
# print(person.__age)  # AttributeError

# 通过方法访问私有属性
print(person.get_age())  # 18
person.set_age(20)
print(person.get_age())  # 20
```

---

## 四、类的方法

### 1. 实例方法

最常用的方法，第一个参数必须是`self`，表示实例本身。

```python
class Calculator:
    def __init__(self, x, y):
        self.x = x
        self.y = y
    
    def add(self):
        """实例方法"""
        return self.x + self.y
    
    def subtract(self):
        return self.x - self.y

calc = Calculator(10, 5)
print(calc.add())       # 15
print(calc.subtract())  # 5
```

### 2. 类方法

使用`@classmethod`装饰器，第一个参数是`cls`，表示类本身。

```python
class Student:
    count = 0
    
    def __init__(self, name):
        self.name = name
        Student.count += 1
    
    @classmethod
    def get_count(cls):
        """类方法"""
        return cls.count

s1 = Student("张三")
s2 = Student("李四")

# 通过类调用
print(Student.get_count())  # 2

# 通过对象调用
print(s1.get_count())  # 2
```

### 3. 静态方法

使用`@staticmethod`装饰器，不需要`self`或`cls`参数。

```python
class MathUtils:
    @staticmethod
    def add(x, y):
        """静态方法"""
        return x + y
    
    @staticmethod
    def multiply(x, y):
        return x * y

# 通过类调用
print(MathUtils.add(3, 5))       # 8
print(MathUtils.multiply(3, 5))  # 15

# 通过对象调用也可以
utils = MathUtils()
print(utils.add(2, 3))  # 5
```

---

## 五、特殊方法（魔术方法）

### 1. `__init__()` - 初始化方法

创建对象时自动调用。

```python
class Person:
    def __init__(self, name, age):
        print("初始化方法被调用")
        self.name = name
        self.age = age

person = Person("张三", 18)
# 输出：初始化方法被调用
```

### 2. `__str__()` - 字符串表示

定义对象的字符串表示形式。

```python
class Person:
    def __init__(self, name, age):
        self.name = name
        self.age = age
    
    def __str__(self):
        return f"Person(name={self.name}, age={self.age})"

person = Person("张三", 18)
print(person)  # Person(name=张三, age=18)
```

### 3. `__repr__()` - 官方字符串表示

用于调试，通常返回可以重新创建对象的字符串。

```python
class Person:
    def __init__(self, name, age):
        self.name = name
        self.age = age
    
    def __repr__(self):
        return f"Person('{self.name}', {self.age})"

person = Person("张三", 18)
print(repr(person))  # Person('张三', 18)
```

### 4. `__len__()` - 长度方法

定义对象的长度。

```python
class MyList:
    def __init__(self, items):
        self.items = items
    
    def __len__(self):
        return len(self.items)

my_list = MyList([1, 2, 3, 4, 5])
print(len(my_list))  # 5
```

### 5. `__del__()` - 析构方法

对象被销毁时自动调用。

```python
class Person:
    def __init__(self, name):
        self.name = name
        print(f"{self.name} 被创建")
    
    def __del__(self):
        print(f"{self.name} 被销毁")

person = Person("张三")
del person  # 张三 被销毁
```

---

## 六、实战案例

### 案例1：学生管理系统

```python
class Student:
    """学生类"""
    
    def __init__(self, name, age, student_id):
        self.name = name
        self.age = age
        self.student_id = student_id
        self.scores = {}
    
    def add_score(self, subject, score):
        """添加成绩"""
        self.scores[subject] = score
    
    def get_average_score(self):
        """计算平均分"""
        if not self.scores:
            return 0
        return sum(self.scores.values()) / len(self.scores)
    
    def __str__(self):
        return f"学生：{self.name}，学号：{self.student_id}，平均分：{self.get_average_score():.2f}"

# 创建学生对象
student = Student("张三", 18, "2024001")

# 添加成绩
student.add_score("语文", 85)
student.add_score("数学", 92)
student.add_score("英语", 88)

# 输出信息
print(student)
print(f"各科成绩：{student.scores}")
```

### 案例2：银行账户

```python
class BankAccount:
    """银行账户类"""
    
    def __init__(self, account_number, owner, balance=0):
        self.account_number = account_number
        self.owner = owner
        self.__balance = balance  # 私有属性
    
    def deposit(self, amount):
        """存款"""
        if amount > 0:
            self.__balance += amount
            print(f"存款成功！当前余额：{self.__balance}元")
        else:
            print("存款金额必须大于0")
    
    def withdraw(self, amount):
        """取款"""
        if amount > 0:
            if amount <= self.__balance:
                self.__balance -= amount
                print(f"取款成功！当前余额：{self.__balance}元")
            else:
                print("余额不足")
        else:
            print("取款金额必须大于0")
    
    def get_balance(self):
        """查询余额"""
        return self.__balance
    
    def __str__(self):
        return f"账户：{self.account_number}，户主：{self.owner}，余额：{self.__balance}元"

# 创建账户
account = BankAccount("6222021234567890", "张三", 1000)

# 操作账户
print(account)
account.deposit(500)
account.withdraw(300)
print(f"当前余额：{account.get_balance()}元")
```

### 案例3：图书管理

```python
class Book:
    """图书类"""
    
    def __init__(self, title, author, isbn, price):
        self.title = title
        self.author = author
        self.isbn = isbn
        self.price = price
        self.is_borrowed = False
    
    def borrow(self):
        """借书"""
        if not self.is_borrowed:
            self.is_borrowed = True
            print(f"《{self.title}》借阅成功")
        else:
            print(f"《{self.title}》已被借出")
    
    def return_book(self):
        """还书"""
        if self.is_borrowed:
            self.is_borrowed = False
            print(f"《{self.title}》归还成功")
        else:
            print(f"《{self.title}》未被借出")
    
    def __str__(self):
        status = "已借出" if self.is_borrowed else "可借阅"
        return f"《{self.title}》- {self.author}，状态：{status}"

# 创建图书
book1 = Book("Python编程", "张三", "978-7-111-12345-6", 89.00)
book2 = Book("Java核心技术", "李四", "978-7-111-23456-7", 99.00)

# 操作图书
print(book1)
book1.borrow()
print(book1)
book1.return_book()
print(book1)
```

---

## 七、实战练习

### 练习1：矩形类

```python
class Rectangle:
    """矩形类"""
    
    def __init__(self, width, height):
        self.width = width
        self.height = height
    
    def area(self):
        """计算面积"""
        return self.width * self.height
    
    def perimeter(self):
        """计算周长"""
        return 2 * (self.width + self.height)
    
    def __str__(self):
        return f"矩形(宽={self.width}, 高={self.height})"

# 测试
rect = Rectangle(5, 3)
print(rect)
print(f"面积：{rect.area()}")
print(f"周长：{rect.perimeter()}")
```

### 练习2：时钟类

```python
class Clock:
    """时钟类"""
    
    def __init__(self, hour=0, minute=0, second=0):
        self.hour = hour
        self.minute = minute
        self.second = second
    
    def run(self):
        """时钟走一秒"""
        self.second += 1
        if self.second >= 60:
            self.second = 0
            self.minute += 1
        if self.minute >= 60:
            self.minute = 0
            self.hour += 1
        if self.hour >= 24:
            self.hour = 0
    
    def __str__(self):
        return f"{self.hour:02d}:{self.minute:02d}:{self.second:02d}"

# 测试
clock = Clock(23, 59, 58)
for _ in range(5):
    print(clock)
    clock.run()
```

---

## 八、知识点总结

### ✅ 核心要点

1. **类和对象**：类是模板，对象是实例
2. **属性**：实例属性、类属性、私有属性
3. **方法**：实例方法、类方法、静态方法
4. **特殊方法**：`__init__`、`__str__`、`__repr__`等
5. **封装**：通过私有属性隐藏内部实现

### 📝 面试重点

- 类和对象的关系
- 实例方法、类方法、静态方法的区别
- `self`的作用
- 私有属性的实现原理
- `__init__`和`__new__`的区别

---

**上一章：** [函数进阶](02-函数进阶.md)  
**下一章：** [面向对象进阶](04-面向对象进阶.md) →
