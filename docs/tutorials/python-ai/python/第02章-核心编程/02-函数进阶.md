# å‡½æ•°è¿›é˜¶

## ä¸€ã€å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’

### 1. åŸºæœ¬æ¦‚å¿µ

åœ¨Pythonä¸­ï¼Œå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼ˆFirst-Class Objectï¼‰ï¼Œå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ã€‚

```python
def test_func(compute):
    result = compute(1, 2)
    print(result)

def add(x, y):
    return x + y

def multiply(x, y):
    return x * y

# ä¼ é€’ä¸åŒçš„å‡½æ•°
test_func(add)       # 3
test_func(multiply)  # 2
```

**åº”ç”¨åœºæ™¯ï¼š** ä¼ é€’è®¡ç®—é€»è¾‘ï¼Œè€Œéæ•°æ®ã€‚

---

## äºŒã€LambdaåŒ¿åå‡½æ•°

### 1. Lambdaè¯­æ³•

```python
lambda å‚æ•°åˆ—è¡¨: è¡¨è¾¾å¼
```

- `lambda`æ˜¯å…³é”®å­—ï¼Œè¡¨ç¤ºå®šä¹‰åŒ¿åå‡½æ•°
- å‚æ•°åˆ—è¡¨ï¼šå½¢å¼å‚æ•°ï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨é€—å·åˆ†éš”
- è¡¨è¾¾å¼ï¼šå‡½æ•°ä½“ï¼Œåªèƒ½å†™ä¸€è¡Œä»£ç ï¼Œæ— æ³•å†™å¤šè¡Œ

### 2. åŸºæœ¬ä½¿ç”¨

```python
# æ™®é€šå‡½æ•°
def add(x, y):
    return x + y

# Lambdaå‡½æ•°
add_lambda = lambda x, y: x + y

print(add(1, 2))        # 3
print(add_lambda(1, 2)) # 3
```

### 3. Lambdaä½œä¸ºå‚æ•°

```python
def test_func(compute):
    result = compute(1, 2)
    print(result)

# ä½¿ç”¨lambda
test_func(lambda x, y: x + y)  # 3
test_func(lambda x, y: x * y)  # 2
test_func(lambda x, y: x ** y) # 1
```

### 4. Lambdaçš„åº”ç”¨

#### é…åˆsorted()æ’åº

```python
# æŒ‰å­—ç¬¦ä¸²é•¿åº¦æ’åº
words = ['python', 'java', 'c', 'javascript']
sorted_words = sorted(words, key=lambda x: len(x))
print(sorted_words)  # ['c', 'java', 'python', 'javascript']

# æŒ‰å­—å…¸çš„å€¼æ’åº
students = [
    {'name': 'å¼ ä¸‰', 'score': 85},
    {'name': 'æå››', 'score': 92},
    {'name': 'ç‹äº”', 'score': 78}
]
sorted_students = sorted(students, key=lambda x: x['score'], reverse=True)
for student in sorted_students:
    print(f"{student['name']}: {student['score']}")
```

#### é…åˆfilter()è¿‡æ»¤

```python
# è¿‡æ»¤å¶æ•°
numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
evens = list(filter(lambda x: x % 2 == 0, numbers))
print(evens)  # [2, 4, 6, 8, 10]
```

#### é…åˆmap()æ˜ å°„

```python
# è®¡ç®—å¹³æ–¹
numbers = [1, 2, 3, 4, 5]
squares = list(map(lambda x: x ** 2, numbers))
print(squares)  # [1, 4, 9, 16, 25]
```

---

## ä¸‰ã€é€’å½’å‡½æ•°

### 1. ä»€ä¹ˆæ˜¯é€’å½’ï¼Ÿ

é€’å½’æ˜¯æŒ‡å‡½æ•°è‡ªå·±è°ƒç”¨è‡ªå·±çš„ç¼–ç¨‹æŠ€å·§ã€‚

**é€’å½’çš„ä¸¤ä¸ªè¦ç´ ï¼š**
1. é€’å½’å‡ºå£ï¼ˆç»ˆæ­¢æ¡ä»¶ï¼‰
2. é€’å½’è°ƒç”¨ï¼ˆè‡ªå·±è°ƒç”¨è‡ªå·±ï¼‰

### 2. é€’å½’ç¤ºä¾‹

#### ç¤ºä¾‹1ï¼šè®¡ç®—é˜¶ä¹˜

```python
def factorial(n):
    """
    è®¡ç®—nçš„é˜¶ä¹˜
    n! = n * (n-1) * (n-2) * ... * 1
    """
    # é€’å½’å‡ºå£
    if n == 1:
        return 1
    
    # é€’å½’è°ƒç”¨
    return n * factorial(n - 1)

print(factorial(5))  # 120 (5*4*3*2*1)
```

#### ç¤ºä¾‹2ï¼šæ–æ³¢é‚£å¥‘æ•°åˆ—

```python
def fibonacci(n):
    """
    è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ç¬¬né¡¹
    F(n) = F(n-1) + F(n-2)
    F(1) = F(2) = 1
    """
    # é€’å½’å‡ºå£
    if n == 1 or n == 2:
        return 1
    
    # é€’å½’è°ƒç”¨
    return fibonacci(n - 1) + fibonacci(n - 2)

# è¾“å‡ºå‰10é¡¹
for i in range(1, 11):
    print(fibonacci(i), end=' ')
# è¾“å‡ºï¼š1 1 2 3 5 8 13 21 34 55
```

### 3. é€’å½’çš„ä¼˜ç¼ºç‚¹

**ä¼˜ç‚¹ï¼š**
- ä»£ç ç®€æ´ï¼Œæ˜“äºç†è§£
- é€‚åˆå¤„ç†æ ‘å½¢ç»“æ„ã€åˆ†æ²»é—®é¢˜

**ç¼ºç‚¹ï¼š**
- å¯èƒ½å¯¼è‡´æ ˆæº¢å‡º
- æ€§èƒ½è¾ƒå·®ï¼ˆé‡å¤è®¡ç®—ï¼‰

**ä¼˜åŒ–æ–¹æ¡ˆï¼š** ä½¿ç”¨è®°å¿†åŒ–ï¼ˆç¼“å­˜ï¼‰æˆ–æ”¹ç”¨è¿­ä»£

```python
# ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–æ–æ³¢é‚£å¥‘
def fibonacci_cache(n, cache={}):
    if n in cache:
        return cache[n]
    
    if n == 1 or n == 2:
        return 1
    
    cache[n] = fibonacci_cache(n - 1, cache) + fibonacci_cache(n - 2, cache)
    return cache[n]

print(fibonacci_cache(100))  # å¾ˆå¿«å¾—å‡ºç»“æœ
```

---

## å››ã€é—­åŒ…ï¼ˆClosureï¼‰

### 1. ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ

é—­åŒ…æ˜¯æŒ‡å†…å±‚å‡½æ•°å¼•ç”¨äº†å¤–å±‚å‡½æ•°çš„å˜é‡ï¼Œå³ä½¿å¤–å±‚å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œå†…å±‚å‡½æ•°ä»ç„¶å¯ä»¥è®¿é—®è¿™äº›å˜é‡ã€‚

### 2. é—­åŒ…çš„å®šä¹‰

```python
def outer(x):
    def inner(y):
        return x + y
    return inner

# åˆ›å»ºé—­åŒ…
add_5 = outer(5)
add_10 = outer(10)

print(add_5(3))   # 8  (5 + 3)
print(add_10(3))  # 13 (10 + 3)
```

### 3. é—­åŒ…çš„åº”ç”¨

#### ç¤ºä¾‹1ï¼šè®¡æ•°å™¨

```python
def counter():
    count = 0
    
    def increment():
        nonlocal count  # å£°æ˜ä½¿ç”¨å¤–å±‚å˜é‡
        count += 1
        return count
    
    return increment

# åˆ›å»ºä¸¤ä¸ªç‹¬ç«‹çš„è®¡æ•°å™¨
counter1 = counter()
counter2 = counter()

print(counter1())  # 1
print(counter1())  # 2
print(counter2())  # 1
print(counter1())  # 3
```

#### ç¤ºä¾‹2ï¼šå‡½æ•°å·¥å‚

```python
def make_multiplier(n):
    """åˆ›å»ºä¸€ä¸ªä¹˜æ³•å‡½æ•°"""
    def multiplier(x):
        return x * n
    return multiplier

# åˆ›å»ºä¸åŒçš„ä¹˜æ³•å‡½æ•°
times_2 = make_multiplier(2)
times_3 = make_multiplier(3)
times_5 = make_multiplier(5)

print(times_2(10))  # 20
print(times_3(10))  # 30
print(times_5(10))  # 50
```

---

## äº”ã€è£…é¥°å™¨ï¼ˆDecoratorï¼‰

### 1. ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼Ÿ

è£…é¥°å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œç”¨äºåœ¨ä¸ä¿®æ”¹åŸå‡½æ•°ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºå‡½æ•°æ·»åŠ é¢å¤–çš„åŠŸèƒ½ã€‚

### 2. è£…é¥°å™¨çš„åŸºæœ¬è¯­æ³•

```python
def decorator(func):
    def wrapper(*args, **kwargs):
        # åœ¨å‡½æ•°æ‰§è¡Œå‰åšäº›ä»€ä¹ˆ
        print("å‡½æ•°æ‰§è¡Œå‰")
        result = func(*args, **kwargs)
        # åœ¨å‡½æ•°æ‰§è¡Œååšäº›ä»€ä¹ˆ
        print("å‡½æ•°æ‰§è¡Œå")
        return result
    return wrapper

# ä½¿ç”¨è£…é¥°å™¨
@decorator
def say_hello():
    print("Hello!")

say_hello()
# è¾“å‡ºï¼š
# å‡½æ•°æ‰§è¡Œå‰
# Hello!
# å‡½æ•°æ‰§è¡Œå
```

### 3. è£…é¥°å™¨çš„åº”ç”¨

#### ç¤ºä¾‹1ï¼šè®¡æ—¶è£…é¥°å™¨

```python
import time

def timer(func):
    """è®¡ç®—å‡½æ•°æ‰§è¡Œæ—¶é—´"""
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        print(f"å‡½æ•° {func.__name__} æ‰§è¡Œæ—¶é—´ï¼š{end_time - start_time:.4f}ç§’")
        return result
    return wrapper

@timer
def slow_function():
    time.sleep(2)
    print("å‡½æ•°æ‰§è¡Œå®Œæ¯•")

slow_function()
# è¾“å‡ºï¼š
# å‡½æ•°æ‰§è¡Œå®Œæ¯•
# å‡½æ•° slow_function æ‰§è¡Œæ—¶é—´ï¼š2.0001ç§’
```

#### ç¤ºä¾‹2ï¼šæ—¥å¿—è£…é¥°å™¨

```python
def log(func):
    """è®°å½•å‡½æ•°è°ƒç”¨æ—¥å¿—"""
    def wrapper(*args, **kwargs):
        print(f"è°ƒç”¨å‡½æ•°ï¼š{func.__name__}")
        print(f"å‚æ•°ï¼šargs={args}, kwargs={kwargs}")
        result = func(*args, **kwargs)
        print(f"è¿”å›å€¼ï¼š{result}")
        return result
    return wrapper

@log
def add(x, y):
    return x + y

add(3, 5)
# è¾“å‡ºï¼š
# è°ƒç”¨å‡½æ•°ï¼šadd
# å‚æ•°ï¼šargs=(3, 5), kwargs={}
# è¿”å›å€¼ï¼š8
```

#### ç¤ºä¾‹3ï¼šæƒé™éªŒè¯è£…é¥°å™¨

```python
def require_auth(func):
    """æƒé™éªŒè¯è£…é¥°å™¨"""
    def wrapper(*args, **kwargs):
        # å‡è®¾ä»æŸå¤„è·å–ç”¨æˆ·ç™»å½•çŠ¶æ€
        is_logged_in = True
        
        if is_logged_in:
            return func(*args, **kwargs)
        else:
            print("è¯·å…ˆç™»å½•ï¼")
            return None
    return wrapper

@require_auth
def view_profile():
    print("æŸ¥çœ‹ä¸ªäººèµ„æ–™")

view_profile()  # æŸ¥çœ‹ä¸ªäººèµ„æ–™
```

### 4. å¸¦å‚æ•°çš„è£…é¥°å™¨

```python
def repeat(times):
    """é‡å¤æ‰§è¡Œè£…é¥°å™¨"""
    def decorator(func):
        def wrapper(*args, **kwargs):
            for _ in range(times):
                result = func(*args, **kwargs)
            return result
        return wrapper
    return decorator

@repeat(3)
def say_hello():
    print("Hello!")

say_hello()
# è¾“å‡ºï¼š
# Hello!
# Hello!
# Hello!
```

### 5. å¤šä¸ªè£…é¥°å™¨å åŠ 

```python
def decorator1(func):
    def wrapper(*args, **kwargs):
        print("è£…é¥°å™¨1")
        return func(*args, **kwargs)
    return wrapper

def decorator2(func):
    def wrapper(*args, **kwargs):
        print("è£…é¥°å™¨2")
        return func(*args, **kwargs)
    return wrapper

@decorator1
@decorator2
def test():
    print("åŸå‡½æ•°")

test()
# è¾“å‡ºï¼š
# è£…é¥°å™¨1
# è£…é¥°å™¨2
# åŸå‡½æ•°
```

---

## å…­ã€å†…ç½®é«˜é˜¶å‡½æ•°

### 1. map()å‡½æ•°

å¯¹åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ åº”ç”¨å‡½æ•°ã€‚

```python
# è®¡ç®—å¹³æ–¹
numbers = [1, 2, 3, 4, 5]
squares = list(map(lambda x: x ** 2, numbers))
print(squares)  # [1, 4, 9, 16, 25]

# å­—ç¬¦ä¸²è½¬å¤§å†™
words = ['hello', 'world', 'python']
upper_words = list(map(str.upper, words))
print(upper_words)  # ['HELLO', 'WORLD', 'PYTHON']
```

### 2. filter()å‡½æ•°

è¿‡æ»¤åºåˆ—ä¸­çš„å…ƒç´ ã€‚

```python
# è¿‡æ»¤å¶æ•°
numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
evens = list(filter(lambda x: x % 2 == 0, numbers))
print(evens)  # [2, 4, 6, 8, 10]

# è¿‡æ»¤ç©ºå­—ç¬¦ä¸²
words = ['hello', '', 'world', '', 'python']
non_empty = list(filter(None, words))
print(non_empty)  # ['hello', 'world', 'python']
```

### 3. reduce()å‡½æ•°

å¯¹åºåˆ—ä¸­çš„å…ƒç´ è¿›è¡Œç´¯ç§¯æ“ä½œã€‚

```python
from functools import reduce

# è®¡ç®—ç´¯åŠ å’Œ
numbers = [1, 2, 3, 4, 5]
total = reduce(lambda x, y: x + y, numbers)
print(total)  # 15

# è®¡ç®—ç´¯ä¹˜ç§¯
product = reduce(lambda x, y: x * y, numbers)
print(product)  # 120
```

---

## ä¸ƒã€å®æˆ˜ç»ƒä¹ 

### ç»ƒä¹ 1ï¼šå®ç°ç¼“å­˜è£…é¥°å™¨

```python
def cache(func):
    """ç¼“å­˜è£…é¥°å™¨"""
    cached_results = {}
    
    def wrapper(*args):
        if args in cached_results:
            print(f"ä»ç¼“å­˜ä¸­è·å–ç»“æœï¼š{args}")
            return cached_results[args]
        
        result = func(*args)
        cached_results[args] = result
        return result
    
    return wrapper

@cache
def fibonacci(n):
    if n <= 2:
        return 1
    return fibonacci(n - 1) + fibonacci(n - 2)

print(fibonacci(10))  # 55
print(fibonacci(10))  # ä»ç¼“å­˜ä¸­è·å–
```

### ç»ƒä¹ 2ï¼šå®ç°é‡è¯•è£…é¥°å™¨

```python
import time

def retry(max_attempts=3, delay=1):
    """é‡è¯•è£…é¥°å™¨"""
    def decorator(func):
        def wrapper(*args, **kwargs):
            for attempt in range(max_attempts):
                try:
                    return func(*args, **kwargs)
                except Exception as e:
                    print(f"ç¬¬{attempt + 1}æ¬¡å°è¯•å¤±è´¥ï¼š{e}")
                    if attempt < max_attempts - 1:
                        time.sleep(delay)
                    else:
                        print("è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°")
                        raise
        return wrapper
    return decorator

@retry(max_attempts=3, delay=2)
def unstable_function():
    import random
    if random.random() < 0.7:
        raise Exception("éšæœºé”™è¯¯")
    return "æˆåŠŸ"

# unstable_function()
```

---

## å…«ã€çŸ¥è¯†ç‚¹æ€»ç»“

### âœ… æ ¸å¿ƒè¦ç‚¹

1. **Lambdaå‡½æ•°**ï¼šåŒ¿åå‡½æ•°ï¼Œé€‚åˆç®€å•çš„ä¸€è¡Œè¡¨è¾¾å¼
2. **é€’å½’**ï¼šå‡½æ•°è°ƒç”¨è‡ªå·±ï¼Œéœ€è¦æœ‰é€’å½’å‡ºå£
3. **é—­åŒ…**ï¼šå†…å±‚å‡½æ•°å¼•ç”¨å¤–å±‚å‡½æ•°çš„å˜é‡
4. **è£…é¥°å™¨**ï¼šåœ¨ä¸ä¿®æ”¹åŸå‡½æ•°çš„æƒ…å†µä¸‹æ·»åŠ åŠŸèƒ½
5. **é«˜é˜¶å‡½æ•°**ï¼šmapã€filterã€reduce

### ğŸ“ é¢è¯•é‡ç‚¹

- Lambdaå‡½æ•°çš„ä½¿ç”¨åœºæ™¯
- é€’å½’çš„ä¼˜ç¼ºç‚¹åŠä¼˜åŒ–æ–¹æ³•
- é—­åŒ…çš„æ¦‚å¿µå’Œåº”ç”¨
- è£…é¥°å™¨çš„åŸç†å’Œå®ç°
- nonlocalå…³é”®å­—çš„ä½œç”¨

---

**ä¸Šä¸€ç« ï¼š** [å‡½æ•°åŸºç¡€](01-å‡½æ•°åŸºç¡€.md)  
**ä¸‹ä¸€ç« ï¼š** [é¢å‘å¯¹è±¡åˆçº§](03-é¢å‘å¯¹è±¡åˆçº§.md) â†’
