# 模块与包

## 一、模块的概念

### 1. 什么是模块？

模块是包含Python代码的`.py`文件，可以定义函数、类和变量，也可以包含可执行的代码。

**模块的作用：**
- 代码复用
- 命名空间管理
- 提高代码可维护性

### 2. 模块的分类

- **内置模块**：Python自带的模块（如math、random、os等）
- **第三方模块**：需要安装的模块（如numpy、pandas、requests等）
- **自定义模块**：自己编写的模块

---

## 二、导入模块

### 1. import语句

```python
# 导入整个模块
import math

print(math.pi)        # 3.141592653589793
print(math.sqrt(16))  # 4.0
```

### 2. from...import语句

```python
# 导入模块中的特定成员
from math import pi, sqrt

print(pi)        # 3.141592653589793
print(sqrt(16))  # 4.0
```

### 3. 导入所有成员

```python
# 导入模块中的所有成员（不推荐）
from math import *

print(pi)
print(sqrt(16))
```

**注意：** 使用`from module import *`可能会导致命名冲突，不推荐使用。

### 4. 使用别名

```python
# 给模块起别名
import numpy as np
import pandas as pd

# 给成员起别名
from math import sqrt as square_root

print(square_root(16))  # 4.0
```

---

## 三、自定义模块

### 1. 创建模块

创建一个名为`my_module.py`的文件：

```python
# my_module.py

"""这是一个自定义模块"""

# 模块变量
PI = 3.14159

# 模块函数
def add(x, y):
    """加法函数"""
    return x + y

def subtract(x, y):
    """减法函数"""
    return x - y

# 模块类
class Calculator:
    """计算器类"""
    
    def multiply(self, x, y):
        return x * y
    
    def divide(self, x, y):
        if y != 0:
            return x / y
        return None

# 测试代码（只在直接运行时执行）
if __name__ == '__main__':
    print("测试模块")
    print(add(3, 5))
```

### 2. 使用自定义模块

```python
# main.py

import my_module

# 使用模块变量
print(my_module.PI)  # 3.14159

# 使用模块函数
result = my_module.add(10, 5)
print(result)  # 15

# 使用模块类
calc = my_module.Calculator()
print(calc.multiply(3, 4))  # 12
```

### 3. `__name__`变量

`__name__`是Python的内置变量：
- 直接运行模块时，`__name__`的值是`'__main__'`
- 导入模块时，`__name__`的值是模块名

```python
# my_module.py

def test():
    print("这是测试函数")

if __name__ == '__main__':
    # 只有直接运行此文件时才会执行
    print("直接运行模块")
    test()
else:
    # 被导入时执行
    print("模块被导入")
```

---

## 四、包（Package）

### 1. 什么是包？

包是包含多个模块的文件夹，必须包含一个`__init__.py`文件（Python 3.3+可以省略）。

**包的结构：**
```
my_package/
    __init__.py
    module1.py
    module2.py
    sub_package/
        __init__.py
        module3.py
```

### 2. 创建包

#### 步骤1：创建包目录结构

```
utils/
    __init__.py
    math_utils.py
    string_utils.py
```

#### 步骤2：编写模块

```python
# utils/math_utils.py

def add(x, y):
    return x + y

def multiply(x, y):
    return x * y
```

```python
# utils/string_utils.py

def to_upper(text):
    return text.upper()

def to_lower(text):
    return text.lower()
```

#### 步骤3：编写`__init__.py`

```python
# utils/__init__.py

"""工具包"""

from .math_utils import add, multiply
from .string_utils import to_upper, to_lower

__all__ = ['add', 'multiply', 'to_upper', 'to_lower']
```

### 3. 使用包

```python
# 方式1：导入整个包
import utils

print(utils.add(3, 5))
print(utils.to_upper("hello"))

# 方式2：导入包中的模块
from utils import math_utils

print(math_utils.add(3, 5))

# 方式3：导入包中的特定函数
from utils import add, to_upper

print(add(3, 5))
print(to_upper("hello"))
```

---

## 五、常用内置模块

### 1. math模块

```python
import math

# 常量
print(math.pi)  # 圆周率
print(math.e)   # 自然常数

# 数学函数
print(math.sqrt(16))      # 平方根：4.0
print(math.pow(2, 3))     # 幂运算：8.0
print(math.ceil(3.2))     # 向上取整：4
print(math.floor(3.8))    # 向下取整：3
print(math.fabs(-5))      # 绝对值：5.0

# 三角函数
print(math.sin(math.pi/2))  # 正弦
print(math.cos(0))          # 余弦
```

### 2. random模块

```python
import random

# 生成随机数
print(random.random())           # 0-1之间的随机浮点数
print(random.randint(1, 10))     # 1-10之间的随机整数
print(random.uniform(1.0, 10.0)) # 1.0-10.0之间的随机浮点数

# 随机选择
items = ['apple', 'banana', 'orange']
print(random.choice(items))      # 随机选择一个元素

# 随机打乱
numbers = [1, 2, 3, 4, 5]
random.shuffle(numbers)
print(numbers)

# 随机抽样
print(random.sample(range(1, 50), 6))  # 从1-49中随机抽取6个数
```

### 3. datetime模块

```python
from datetime import datetime, date, time, timedelta

# 获取当前时间
now = datetime.now()
print(now)  # 2025-01-18 21:00:00.123456

# 获取当前日期
today = date.today()
print(today)  # 2025-01-18

# 创建特定时间
dt = datetime(2025, 1, 18, 21, 0, 0)
print(dt)

# 格式化时间
print(now.strftime("%Y-%m-%d %H:%M:%S"))  # 2025-01-18 21:00:00
print(now.strftime("%Y年%m月%d日"))        # 2025年01月18日

# 时间计算
tomorrow = today + timedelta(days=1)
print(tomorrow)

next_week = today + timedelta(weeks=1)
print(next_week)
```

### 4. os模块

```python
import os

# 获取当前工作目录
print(os.getcwd())

# 列出目录内容
print(os.listdir('.'))

# 创建目录
# os.mkdir('new_folder')
# os.makedirs('parent/child')  # 创建多级目录

# 删除目录
# os.rmdir('new_folder')

# 重命名
# os.rename('old_name.txt', 'new_name.txt')

# 删除文件
# os.remove('file.txt')

# 检查路径是否存在
print(os.path.exists('file.txt'))

# 检查是否为文件/目录
print(os.path.isfile('file.txt'))
print(os.path.isdir('folder'))

# 路径操作
path = os.path.join('folder', 'subfolder', 'file.txt')
print(path)

# 分离路径和文件名
print(os.path.split('/path/to/file.txt'))
print(os.path.dirname('/path/to/file.txt'))
print(os.path.basename('/path/to/file.txt'))
```

### 5. sys模块

```python
import sys

# Python版本
print(sys.version)

# 命令行参数
print(sys.argv)

# 模块搜索路径
print(sys.path)

# 退出程序
# sys.exit(0)

# 标准输入输出
sys.stdout.write("Hello\n")
```

### 6. json模块

```python
import json

# Python对象转JSON字符串
data = {
    'name': '张三',
    'age': 18,
    'scores': [85, 92, 78]
}

json_str = json.dumps(data, ensure_ascii=False, indent=2)
print(json_str)

# JSON字符串转Python对象
json_data = '{"name": "李四", "age": 20}'
obj = json.loads(json_data)
print(obj)
print(obj['name'])

# 写入JSON文件
with open('data.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, ensure_ascii=False, indent=2)

# 读取JSON文件
with open('data.json', 'r', encoding='utf-8') as f:
    loaded_data = json.load(f)
    print(loaded_data)
```

---

## 六、第三方模块管理

### 1. pip包管理器

```bash
# 安装模块
pip install requests

# 安装指定版本
pip install requests==2.28.0

# 升级模块
pip install --upgrade requests

# 卸载模块
pip uninstall requests

# 查看已安装的模块
pip list

# 查看模块信息
pip show requests

# 导出依赖列表
pip freeze > requirements.txt

# 安装依赖列表
pip install -r requirements.txt
```

### 2. 使用国内镜像源

```bash
# 临时使用
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple requests

# 永久配置（修改pip.ini或pip.conf）
[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
```

---

## 七、模块搜索路径

### 1. 模块搜索顺序

Python按以下顺序搜索模块：
1. 当前目录
2. PYTHONPATH环境变量指定的目录
3. Python安装目录

### 2. 查看搜索路径

```python
import sys

for path in sys.path:
    print(path)
```

### 3. 添加搜索路径

```python
import sys

# 临时添加
sys.path.append('/path/to/my/modules')

# 或者设置PYTHONPATH环境变量
```

---

## 八、实战案例

### 案例1：工具模块

创建一个实用工具模块：

```python
# utils.py

"""实用工具模块"""

import os
import json
from datetime import datetime

def read_json(filename):
    """读取JSON文件"""
    with open(filename, 'r', encoding='utf-8') as f:
        return json.load(f)

def write_json(filename, data):
    """写入JSON文件"""
    with open(filename, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

def get_file_size(filename):
    """获取文件大小（字节）"""
    return os.path.getsize(filename)

def format_time(timestamp=None):
    """格式化时间"""
    if timestamp is None:
        dt = datetime.now()
    else:
        dt = datetime.fromtimestamp(timestamp)
    return dt.strftime("%Y-%m-%d %H:%M:%S")

def ensure_dir(directory):
    """确保目录存在"""
    if not os.path.exists(directory):
        os.makedirs(directory)

if __name__ == '__main__':
    # 测试代码
    print("工具模块测试")
    print(format_time())
```

### 案例2：配置管理模块

```python
# config.py

"""配置管理模块"""

import json
import os

class Config:
    """配置类"""
    
    def __init__(self, config_file='config.json'):
        self.config_file = config_file
        self.config = self.load()
    
    def load(self):
        """加载配置"""
        if os.path.exists(self.config_file):
            with open(self.config_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        return {}
    
    def save(self):
        """保存配置"""
        with open(self.config_file, 'w', encoding='utf-8') as f:
            json.dump(self.config, f, ensure_ascii=False, indent=2)
    
    def get(self, key, default=None):
        """获取配置项"""
        return self.config.get(key, default)
    
    def set(self, key, value):
        """设置配置项"""
        self.config[key] = value
        self.save()

# 使用示例
if __name__ == '__main__':
    config = Config()
    config.set('app_name', 'MyApp')
    config.set('version', '1.0.0')
    
    print(config.get('app_name'))
    print(config.get('version'))
```

---

## 九、知识点总结

### ✅ 核心要点

1. **模块导入**：import、from...import、别名
2. **自定义模块**：创建.py文件，使用`__name__`
3. **包的概念**：包含`__init__.py`的文件夹
4. **常用模块**：math、random、datetime、os、sys、json
5. **包管理**：pip安装、卸载、管理第三方模块

### 📝 面试重点

- import和from...import的区别
- `__name__`变量的作用
- 包和模块的区别
- 模块搜索路径
- `__init__.py`的作用
- `__all__`变量的作用

---

**上一章：** [面向对象进阶](04-面向对象进阶.md)  
**下一章：** [异常处理](06-异常处理.md) →
